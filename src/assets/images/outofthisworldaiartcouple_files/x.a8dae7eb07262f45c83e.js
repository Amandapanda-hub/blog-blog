var x;(()=>{"use strict";var e,t,i,s,n,a,r,o,h={28132:(e,t,i)=>{i.a(e,(async(e,s)=>{try{i.d(t,{Displacement:()=>a.KL,Mp4:()=>a.HE,PXD:()=>a.BS,ZipReader:()=>a.Mr,ZipWriter:()=>a._Q});var n=i(72982),a=i(82646),r=e([n,a]);[n,a]=r.then?(await r)():r,s()}catch(o){s(o)}}))},82646:(e,t,i)=>{i.a(e,(async(s,n)=>{try{i.d(t,{BS:()=>I,BY:()=>$,HE:()=>A,KL:()=>T,Mr:()=>_,Or:()=>j,Wy:()=>B,_Q:()=>D,gI:()=>q,h4:()=>F,jp:()=>H,nx:()=>O,oH:()=>U,qY:()=>N,ug:()=>V,ut:()=>z});var a=i(36817),r=i(72982);e=i.hmd(e);var o=s([r]);r=(o.then?(await o)():o)[0];let c=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});c.decode();let l=new Uint8Array;function d(){return 0===l.byteLength&&(l=new Uint8Array(r.memory.buffer)),l}function u(e,t){return c.decode(d().subarray(e,e+t))}const p=new Array(32).fill(void 0);p.push(void 0,null,!0,!1);let g=p.length;function m(e){g===p.length&&p.push(p.length+1);const t=g;return g=p[t],p[t]=e,t}function v(e){return p[e]}function f(e){e<36||(p[e]=g,g=e)}function y(e){const t=v(e);return f(e),t}let w=new Int32Array;function x(){return 0===w.byteLength&&(w=new Int32Array(r.memory.buffer)),w}let b=new Uint8ClampedArray;function Z(e,t){return(0===b.byteLength&&(b=new Uint8ClampedArray(r.memory.buffer)),b).subarray(e/1,e/1+t)}let k=0;function E(e,t){const i=t(1*e.length);return d().set(e,i/1),k=e.length,i}let P=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const S="function"==typeof P.encodeInto?function(e,t){return P.encodeInto(e,t)}:function(e,t){const i=P.encode(e);return t.set(i),{read:e.length,written:i.length}};function C(e,t,i){if(void 0===i){const i=P.encode(e),s=t(i.length);return d().subarray(s,s+i.length).set(i),k=i.length,s}let s=e.length,n=t(s);const a=d();let r=0;for(;r<s;r++){const t=e.charCodeAt(r);if(t>127)break;a[n+r]=t}if(r!==s){0!==r&&(e=e.slice(r)),n=i(n,s,s=r+3*e.length);const t=d().subarray(n+r,n+s);r+=S(e,t).written}return k=r,n}function L(e,t){return d().subarray(e/1,e/1+t)}new Float32Array;class T{static __wrap(e){const t=Object.create(T.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_displacement_free(e)}constructor(e,t,i,s,n,a){const o=E(e,r.__wbindgen_malloc),h=k,c=r.displacement_new(o,h,t,i,s,n,a);return T.__wrap(c)}beginStroke(){const e=r.displacement_beginStroke(this.ptr);return R.__wrap(e)}setStampSize(e){r.displacement_setStampSize(this.ptr,e)}setDensity(e){r.displacement_setDensity(this.ptr,e)}setStrength(e){r.displacement_setStrength(this.ptr,e)}retarget(e,t,i){const s=E(e,r.__wbindgen_malloc),n=k;r.displacement_retarget(this.ptr,s,n,t,i)}setMode(e){const t=C(e,r.__wbindgen_malloc,r.__wbindgen_realloc),i=k;r.displacement_setMode(this.ptr,t,i)}applyFast(e){return y(r.displacement_applyFast(this.ptr,m(e)))}applyQuality(e){return y(r.displacement_applyQuality(this.ptr,m(e)))}}class M{static __wrap(e){const t=Object.create(M.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_layer_free(e)}get kind(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.layer_kind(i,this.ptr);var e=x()[i/4+0],t=x()[i/4+1];return u(e,t)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(e,t)}}get x(){return r.layer_x(this.ptr)}get y(){return r.layer_y(this.ptr)}get name(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.layer_name(i,this.ptr);var e=x()[i/4+0],t=x()[i/4+1];return u(e,t)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(e,t)}}get width(){return r.layer_width(this.ptr)}get height(){return r.layer_height(this.ptr)}get alpha(){return r.layer_alpha(this.ptr)}get blendMode(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.layer_blendMode(i,this.ptr);var e=x()[i/4+0],t=x()[i/4+1];return u(e,t)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(e,t)}}get visible(){return 0!==r.layer_visible(this.ptr)}get locked(){return 0!==r.layer_locked(this.ptr)}get rotation(){return r.layer_rotation(this.ptr)}takeCanvas(){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.layer_takeCanvas(s,this.ptr);var e=x()[s/4+0],t=x()[s/4+1],i=Z(e,t).slice();return r.__wbindgen_free(e,1*t),i}finally{r.__wbindgen_add_to_stack_pointer(16)}}takeMask(){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.layer_takeMask(s,this.ptr);var e=x()[s/4+0],t=x()[s/4+1],i=Z(e,t).slice();return r.__wbindgen_free(e,1*t),i}finally{r.__wbindgen_add_to_stack_pointer(16)}}get meta(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.layer_meta(i,this.ptr);var e=x()[i/4+0],t=x()[i/4+1];return u(e,t)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(e,t)}}}class A{static __wrap(e){const t=Object.create(A.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_mp4_free(e)}constructor(e){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.mp4_new(s,e);var t=x()[s/4+0],i=x()[s/4+1];if(x()[s/4+2])throw y(i);return A.__wrap(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}addVideoTrack(e,t,i){try{const a=r.__wbindgen_add_to_stack_pointer(-16),o=E(i,r.__wbindgen_malloc),h=k;r.mp4_addVideoTrack(a,this.ptr,e,t,o,h);var s=x()[a/4+0],n=x()[a/4+1];if(x()[a/4+2])throw y(n);return s>>>0}finally{r.__wbindgen_add_to_stack_pointer(16)}}addFrame(e,t,i,s,n,a){try{const h=r.__wbindgen_add_to_stack_pointer(-16),c=E(a,r.__wbindgen_malloc),l=k;r.mp4_addFrame(h,this.ptr,e,t,i,s,n,c,l);var o=x()[h/4+0];if(x()[h/4+1])throw y(o)}finally{r.__wbindgen_add_to_stack_pointer(16)}}fetchFile(){try{const n=this.__destroy_into_raw(),a=r.__wbindgen_add_to_stack_pointer(-16);r.mp4_fetchFile(a,n);var e=x()[a/4+0],t=x()[a/4+1],i=x()[a/4+2];if(x()[a/4+3])throw y(i);var s=L(e,t).slice();return r.__wbindgen_free(e,1*t),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class I{static __wrap(e){const t=Object.create(I.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_pxd_free(e)}get width(){return r.__wbg_get_pxd_width(this.ptr)}set width(e){r.__wbg_set_pxd_width(this.ptr,e)}get height(){return r.__wbg_get_pxd_height(this.ptr)}set height(e){r.__wbg_set_pxd_height(this.ptr,e)}get layers(){return r.__wbg_get_pxd_layers(this.ptr)}set layers(e){r.__wbg_set_pxd_layers(this.ptr,e)}static decode(e){try{const s=r.__wbindgen_add_to_stack_pointer(-16),n=E(e,r.__wbindgen_malloc),a=k;r.pxd_decode(s,n,a);var t=x()[s/4+0],i=x()[s/4+1];if(x()[s/4+2])throw y(i);return I.__wrap(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}takeNextLayer(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.pxd_takeNextLayer(i,this.ptr);var e=x()[i/4+0],t=x()[i/4+1];if(x()[i/4+2])throw y(t);return M.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class R{static __wrap(e){const t=Object.create(R.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_stroke_free(e)}push(e,t,i){return y(r.stroke_push(this.ptr,e,t,i))}}class _{static __wrap(e){const t=Object.create(_.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_zipreader_free(e)}constructor(e){try{const s=r.__wbindgen_add_to_stack_pointer(-16),n=E(e,r.__wbindgen_malloc),a=k;r.zipreader_new(s,n,a);var t=x()[s/4+0],i=x()[s/4+1];if(x()[s/4+2])throw y(i);return _.__wrap(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}readFile(e){try{const a=r.__wbindgen_add_to_stack_pointer(-16),o=C(e,r.__wbindgen_malloc,r.__wbindgen_realloc),h=k;r.zipreader_readFile(a,this.ptr,o,h);var t=x()[a/4+0],i=x()[a/4+1],s=x()[a/4+2];if(x()[a/4+3])throw y(s);var n=L(t,i).slice();return r.__wbindgen_free(t,1*i),n}finally{r.__wbindgen_add_to_stack_pointer(16)}}readString(e){try{const h=r.__wbindgen_add_to_stack_pointer(-16),c=C(e,r.__wbindgen_malloc,r.__wbindgen_realloc),l=k;r.zipreader_readString(h,this.ptr,c,l);var t=x()[h/4+0],i=x()[h/4+1],s=x()[h/4+2],n=x()[h/4+3],a=t,o=i;if(n)throw a=0,o=0,y(s);return u(a,o)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(a,o)}}}class D{static __wrap(e){const t=Object.create(D.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_zipwriter_free(e)}constructor(){const e=r.zipwriter_new();return D.__wrap(e)}writeFile(e,t,i){try{const n=r.__wbindgen_add_to_stack_pointer(-16),a=C(e,r.__wbindgen_malloc,r.__wbindgen_realloc),o=k,h=E(t,r.__wbindgen_malloc),c=k;r.zipwriter_writeFile(n,this.ptr,a,o,h,c,i);var s=x()[n/4+0];if(x()[n/4+1])throw y(s)}finally{r.__wbindgen_add_to_stack_pointer(16)}}writeString(e,t,i){try{const n=r.__wbindgen_add_to_stack_pointer(-16),a=C(e,r.__wbindgen_malloc,r.__wbindgen_realloc),o=k,h=C(t,r.__wbindgen_malloc,r.__wbindgen_realloc),c=k;r.zipwriter_writeFile(n,this.ptr,a,o,h,c,i);var s=x()[n/4+0];if(x()[n/4+1])throw y(s)}finally{r.__wbindgen_add_to_stack_pointer(16)}}finish(){try{const n=this.__destroy_into_raw(),a=r.__wbindgen_add_to_stack_pointer(-16);r.zipwriter_finish(a,n);var e=x()[a/4+0],t=x()[a/4+1],i=x()[a/4+2];if(x()[a/4+3])throw y(i);var s=L(e,t).slice();return r.__wbindgen_free(e,1*t),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}}function F(e,t){return m(u(e,t))}function z(e){return v(e).x}function N(e){return v(e).y}function O(e){return v(e).width}function B(e){return v(e).height}function U(){return m(r.memory)}function H(e){return m(v(e).buffer)}function q(e,t,i){return m(new Uint8ClampedArray(v(e),t>>>0,i>>>0))}function V(e){y(e)}function $(e,t,i,s){return m(new a.Z(e,t,i,s))}function j(e,t){throw new Error(u(e,t))}n()}catch(h){n(h)}}))},92365:(e,t,i)=>{i.d(t,{J:()=>o,Z:()=>r});var s=i(33655),n=i(4256),a=i(95574);async function r(e){const t=new n.Z;t.addShader("alpha-shift-mask",!0);const i=await o(e.canvas),a=s.qT(i,1080);e.addMask();e.mask.getContext("2d").drawImage(t.apply(a),0,0,e.mask.width,e.mask.height),e.render()}async function o(e){const t=await fetch("/api/auth/ai/remove-background/"),i=await t.json();if(!1===i.status)throw new Error(i.message);const n=new AbortController,{signal:r}=n,o=await new Promise(((t,i)=>{s.eY(e,640,640).toBlob(t,"image/jpeg",.8)})),h=new FormData;h.append("image_file",new File([o],"file.jpg"));const c=await fetch("/api/ai/remove-background",{method:"POST",headers:{authorizationtoken:i.data,Accept:"application/json"},body:h,signal:r}),l=await c.json();if(!l.status)throw new Error(l.error);return await(0,a.OA)("data:image/jpeg;base64,"+l.data)}},71030:(e,t,i)=>{i.d(t,{Z:()=>a});var s=i(74820),n=i(33506);const a=(e,t)=>{var i,a,r;"undefined"==typeof gtag||(null!==(a=null===(i=window.dataLayer)||void 0===i?void 0:i.length)&&void 0!==a?a:0)>1e3||gtag("event",e,{product:s.ZP.product,user_type:null!==(r=null===n.a||void 0===n.a?void 0:n.a.type)&&void 0!==r?r:"guest",label:t})}},92396:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(83990),n=i(87318);class a{constructor(e=!1,t=void 0,i=void 0,s=void 0,n=void 0){this.block=e,this.enter=t,this.scene=i,this.exit=s,this.stagger=n}}a.fromInjection=(e,t)=>{let i=t?a.clone(t):new a;if(i.block=!1,!e)return i;if(e.enter&&(i.enter&&(e.enter.delay=i.enter.delay,e.enter.speed=i.enter.speed),i.enter=e.enter,i.enter.duration=i.enter.duration?i.enter.duration:a.getMotionsDuration(i.enter.motions)),e.scene&&(i.scene&&(e.scene.delay=i.scene.delay,e.scene.speed=i.scene.speed,e.scene.repeat=i.scene.repeat,e.scene.gap=i.scene.gap),i.scene=e.scene,i.scene.motions)){let e=a.getMotionsDuration(i.scene.motions);i.scene.duration=e+i.scene.repeat*(e+i.scene.gap)}return e.exit&&(i.exit&&(e.exit.delay=i.exit.delay,e.exit.speed=i.exit.speed),i.exit=e.exit,i.exit.duration=a.getMotionsDuration(i.exit.motions)),e.stagger&&(i.stagger=e.stagger),i},a.getSegment=(e,t)=>{if(t)switch(e){case"enter":return t.enter;case"scene":return t.scene;case"exit":return t.exit}},a.setSegmentSpeed=(e,t)=>{if(!e)return;e.speed=t;let i=a.getMotionsDuration(e.motions,e.speed);e.duration=i+e.repeat*(i+e.gap)},a.setSegmentRepeat=(e,t)=>{if(!e)return;let i=a.getMotionsDuration(e.motions,e.speed);e.repeat=t,e.duration=i+t*(i+e.gap)},a.setSegmentGap=(e,t)=>{if(!e)return;let i=a.getMotionsDuration(e.motions,e.speed);e.gap=t,e.duration=i+e.repeat*(i+e.gap)},a.getAnimationSegment=(e,t)=>{if(!t)return;const i=new a(t.block);return"enter"===e&&(i.enter=new s.Z(t.enter.name,[...t.enter.motions],t.enter.option,t.enter.duration,t.enter.delay,t.enter.speed,t.enter.repeat,t.enter.gap)),"scene"===e&&(i.scene=new s.Z(t.scene.name,[...t.scene.motions],t.scene.option,t.scene.duration,t.scene.delay,t.scene.speed,t.scene.repeat,t.scene.gap)),"exit"===e&&(i.exit=new s.Z(t.exit.name,[...t.exit.motions],t.exit.option,t.exit.duration,t.exit.delay,t.exit.speed,t.exit.repeat,t.exit.gap)),i},a.getMotionsDuration=(e,t=1)=>{if(!e||0===e.length)return 0;let i=0;for(const s of e)i=Math.max(i,Math.round((s.delay+s.duration)*t));return i},a.clone=e=>{if(!e)return;const t=new a(e.block);return e.enter&&(t.enter=new s.Z(e.enter.name,[...e.enter.motions],e.enter.option,e.enter.duration,e.enter.delay,e.enter.speed,e.enter.repeat,e.enter.gap)),e.scene&&(t.scene=new s.Z(e.scene.name,[...e.scene.motions],e.scene.option,e.scene.duration,e.scene.delay,e.scene.speed,e.scene.repeat,e.scene.gap)),e.exit&&(t.exit=new s.Z(e.exit.name,[...e.exit.motions],e.exit.option,e.exit.duration,e.exit.delay,e.exit.speed,e.exit.repeat,e.exit.gap)),e.stagger&&(t.stagger=new n.Z(e.stagger.duration,e.stagger.metod)),t};const r=a},47339:(e,t,i)=>{i.d(t,{Z:()=>u});var s=i(99872),n=i(43673),a=i(98776),r=i(4256),o=i(89422),h=i(78685),c=i(87318),l=i(92396);class d{constructor(e,t){this.scantime=0,this.scantype="none",this.getDuration=()=>{let e=0;return this.transitions.forEach((t=>{e=Math.max(e,t.getDuration())})),e},this.prepare=e=>{for(const t of this.transitions)t.motion.fill&&(t.begin(this.getProperty(t.motion.method,e)),this.setProperty(t.motion.method,t.motion.manner,e,t.step(0)))},this.step=(e,t)=>{for(const i of this.transitions)i.shouldRun(e)&&(i.playing||i.begin(this.getProperty(i.motion.method,t)),this.setProperty(i.motion.method,i.motion.manner,t,i.step(e)))},this.setProperty=(e,t,i,s)=>{switch(e){case"opacity":this.layer.transform.opacity=s;break;case"rotate":this.layer.transform.rotation=360*s,this.layer.transform.rAnchor=this.anchorToPoint(t);break;case"scale":this.layer.transform.scale.x=s,this.layer.transform.scale.y=s,this.layer.transform.sAnchor=this.anchorToPoint(t);break;case"scale-width":this.layer.transform.scale.x=s,this.layer.transform.sAnchor=this.anchorToPoint(t);break;case"scale-height":this.layer.transform.scale.y=s,this.layer.transform.sAnchor=this.anchorToPoint(t);break;case"self-x":this.layer.transform.offset.x=s*this.layer.getRect().width;break;case"self-y":this.layer.transform.offset.y=s*this.layer.getRect().height;break;case"offset-x":this.layer.transform.offset.x=s*i.width;break;case"offset-y":this.layer.transform.offset.y=s*i.height;break;case"viewport-x":this.layer.transform.offset.x=s*i.width-this.layer.getRect().center().x;break;case"viewport-y":this.layer.transform.offset.y=s*i.height-this.layer.getRect().center().y;break;case"viewport-box-x":const n=this.transformedRectWidth();this.layer.transform.offset.x=this.layer.getRect().center().x-(.5*n+s*(i.width-n));break;case"viewport-box-y":const a=this.transformedRectHeight();this.layer.transform.offset.y=this.layer.getRect().center().y-(.5*a+s*(i.height-a));break;default:this.setShader(e,s,t)}},this.transformedRectWidth=()=>this.layer.getRect().width*this.layer.transform.scale.x,this.transformedRectHeight=()=>this.layer.getRect().height*this.layer.transform.scale.y,this.anchorToPoint=e=>{switch(e){case"topleft":return new n.Z(0,0);case"top":return new n.Z(.5,0);case"topright":return new n.Z(1,0);case"left":return new n.Z(0,.5);case"center":return new n.Z(.5,.5);case"right":return new n.Z(1,.5);case"bottomleft":return new n.Z(0,1);case"bottom":return new n.Z(.5,1);case"bottomright":return new n.Z(1,1)}return new n.Z(.5,.5)},this.setShader=(e,t,i)=>{switch(this.shaders||(this.shaders=new r.Z),e){case"wipe":this.shaders.addShader("wipe",{direction:i,amount:t});break;case"swipe":this.shaders.addShader("swipe",{direction:i,amount:t,color:this.getLayerAccent()});break;case"slot":this.shaders.addShader("slot",{direction:i,amount:t});break;case"blinds":this.shaders.addShader("blinds",{direction:i,amount:t});break;case"melt":this.shaders.addShader("melt",{direction:i,amount:t});break;case"warp":this.shaders.addShader("warp",{direction:i,amount:t});break;case"curtain":this.shaders.addShader("curtain",{direction:i,amount:t});break;case"split":this.shaders.addShader("split",{direction:i,sections:2,amount:t});break;case"line":this.shaders.addShader("split",{direction:i,sections:8,amount:t});break;case"marquee":this.shaders.addShader("marquee",{direction:i,amount:t});break;default:this.shaders.addShader(e,t)}this.layer.transient=this.shaders.apply(this.layer.baked?this.layer.baked:this.layer.canvas)},this.getLayerAccent=()=>this.layer instanceof h.Z&&"color"===this.layer.fill.getType()?this.layer.fill.value:new a.Z(255,255,255),this.getProperty=(e,t)=>{switch(e){case"opacity":return this.layer.transform.opacity;case"rotate":return this.layer.transform.rotation/360;case"scale":case"scale-width":return this.layer.transform.scale.x;case"scale-height":return this.layer.transform.scale.y;case"self-x":return this.layer.transform.offset.x/this.layer.getRect().width;case"self-y":return this.layer.transform.offset.y/this.layer.getRect().height;case"offset-x":return this.layer.transform.offset.x/t.width;case"offset-y":return this.layer.transform.offset.y/t.height;case"viewport-x":return(this.layer.getRect().center().x+this.layer.transform.offset.x)/t.width;case"viewport-y":return(this.layer.getRect().center().y+this.layer.transform.offset.y)/t.height;case"viewport-box-x":return(this.layer.getRect().center().x+this.layer.transform.offset.x)/(t.width-this.transformedRectWidth());case"viewport-box-y":return(this.layer.getRect().center().y+this.layer.transform.offset.y)/(t.height-this.transformedRectHeight())}return 0},this.finish=()=>{this.layer.transient=void 0,this.layer.transform=void 0},this.layer=e,this.transitions=t,this.layer.transform={sAnchor:new n.Z(.5,.5),rAnchor:new n.Z(.5,.5),scale:new n.Z(1,1),offset:new n.Z(0,0),rotation:0,opacity:1}}}d.bakeAnimators=e=>{const t=new Array;for(const i of e.layers)if(i.rect)if(!i.animation&&e.animation){const s=d.createPageTransitions(i,e,e.animation);s.length>0&&t.push(new d(i,s))}else if(i.animation&&!i.animation.block){const e=d.createLayerTransitions(i.animation);t.push(new d(i,e))}return t},d.createPageTransitions=(e,t,i)=>{const n=t.layerNr(e.id),a=t.layers.length,r=new s.Z(t.width,t.height),h=d.filterMotions(i.enter,e,n,a,r),l=d.filterMotions(i.scene,e,n,a,r),u=d.filterMotions(i.exit,e,n,a,r);if(!h&&!l&&!u&&0===h.length&&0===l.length&&0===u.length)return;const p=0===n&&e.settings.locked?0:c.Z.getOffset(e,t,i.stagger),g=i.enter?i.enter.duration+i.enter.delay:0,m=i.scene?i.scene.duration+i.scene.delay:0,v=new Array;if(h)for(const s of h)v.push(new o.Z(s,i.enter.speed,i.enter.delay+p));if(l)for(const s of l)v.push(new o.Z(s,i.scene.speed,i.scene.delay+p+g));if(u)for(const s of u)v.push(new o.Z(s,i.exit.speed,i.enter.delay+p+g+m));return v},d.createLayerTransitions=(e,t=!1)=>{const i=!!e.enter,s=!!e.scene,n=new Array;let a=i?e.enter.duration:0,r=s?e.scene.duration:0;if(!t&&i&&(a+=e.enter.delay),(t&&i&&s||!t&&s)&&(r+=e.scene.delay),e.enter){const i=t?0:e.enter.delay;for(const t of e.enter.motions)n.push(new o.Z(t,e.enter.speed,i))}if(e.scene){const s=t&&!i?0:e.scene.delay;for(const t of e.scene.motions)n.push(new o.Z(t,e.scene.speed,s+a));if(e.scene.repeat>0){let t=l.Z.getMotionsDuration(e.scene.motions,e.scene.speed),i=t+e.scene.gap;for(let r=0;r<e.scene.repeat;r++){for(const t of e.scene.motions)n.push(new o.Z(t,e.scene.speed,i+s+a));i+=t+e.scene.gap}}}if(e.exit){const h=!t||i||s?e.exit.delay:0;for(const t of e.exit.motions)n.push(new o.Z(t,e.exit.speed,h+a+r))}return n},d.createSegmentTransitions=e=>{const t=new Array;if(e)for(const i of e.motions)t.push(new o.Z(i,e.speed));return t},d.filterMotions=(e,t,i,s,n)=>{if(!e||!e.motions||0===e.motions.length)return;let a;for(const r of e.motions)if(d.filterMotion(t,i,s,n,r)){a=r.filter;break}return e.motions.filter((e=>e.filter===a))},d.filterMotion=(e,t,i,s,n)=>{if("background"===n.filter)return 0===t&&e.settings.locked;if(0===t&&e.settings.locked)return!1;if("foreground"===n.filter)return t===i-1;if("all"===n.filter||n.filter===e.type)return!0;if("large"===n.filter)return e.getRect().width>.75*s.width||e.getRect().height>.75*s.height;if("medium"===n.filter)return e.getRect().width>.25*s.width&&e.getRect().width<.75*s.width&&e.getRect().height>.25*s.height&&e.getRect().height<.75*s.height;if("small"===n.filter)return e.getRect().width<.25*s.width||e.getRect().height<.25*s.height;switch(n.filter){case"odd":return t%2==1;case"even":return t%2==0;case"1-three":return t%3==0;case"2-three":return t%3==1;case"3-three":return t%3==2;case"1-four":return t%4==0;case"2-four":return t%4==1;case"3-four":return t%4==2;case"4-four":return t%4==3}};const u=d},71750:(e,t,i)=>{i.d(t,{Z:()=>n});class s{constructor(e){switch(this.type=e,this.type){case s.EASE_LINEAR:this.calculate=s.linear;break;case s.EASE_TWENTY_LADDER:this.calculate=s.ladderTwenty;break;case s.EASE_TEN_LADDER:this.calculate=s.ladderTen;break;case s.EASE_FIVE_LADDER:this.calculate=s.ladderFive;break;case s.EASE_THREE_LADDER:this.calculate=s.ladderThree;break;case s.EASE_IN_SINE:this.calculate=s.inSine;break;case s.EASE_OUT_SINE:this.calculate=s.outSine;break;case s.EASE_IN_OUT_SINE:this.calculate=s.inOutSine;break;case s.EASE_IN_CUBIC:this.calculate=s.inCubic;break;case s.EASE_OUT_CUBIC:this.calculate=s.outCubic;break;case s.EASE_IN_OUT_CUBIC:this.calculate=s.inOutCubic;break;case s.EASE_IN_QUINT:this.calculate=s.inQuint;break;case s.EASE_OUT_QUINT:this.calculate=s.outQuint;break;case s.EASE_IN_OUT_QUINT:this.calculate=s.inOutQuint;break;case s.EASE_IN_CIRC:this.calculate=s.inCirc;break;case s.EASE_OUT_CIRC:this.calculate=s.outCirc;break;case s.EASE_IN_OUT_CIRC:this.calculate=s.inOutCirc;break;case s.EASE_IN_QUAD:this.calculate=s.inQuad;break;case s.EASE_OUT_QUAD:this.calculate=s.outQuad;break;case s.EASE_IN_OUT_QUAD:this.calculate=s.inOutQuad;break;case s.EASE_IN_QUART:this.calculate=s.inQuart;break;case s.EASE_OUT_QUART:this.calculate=s.outQuart;break;case s.EASE_IN_OUT_QUART:this.calculate=s.inOutQuart;break;case s.EASE_IN_EXPO:this.calculate=s.inExpo;break;case s.EASE_OUT_EXPO:this.calculate=s.outExpo;break;case s.EASE_IN_OUT_EXPO:this.calculate=s.inOutExpo;break;case s.EASE_IN_BACK:this.calculate=s.inBack;break;case s.EASE_OUT_BACK:this.calculate=s.outBack;break;case s.EASE_IN_OUT_BACK:this.calculate=s.inOutBack;break;case s.EASE_IN_BOUNCE:this.calculate=s.inBounce;break;case s.EASE_OUT_BOUNCE:this.calculate=s.outBounce;break;case s.EASE_IN_OUT_BOUNCE:this.calculate=s.inOutBounce;break;case s.EASE_IN_ELASTIC:this.calculate=s.inElastic;break;case s.EASE_OUT_ELASTIC:this.calculate=s.outElastic;break;case s.EASE_IN_OUT_ELASTIC:this.calculate=s.inOutElastic}}static inOutQuint(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}static outCirc(e){return Math.sqrt(1-Math.pow(e-1,2))}static inOutCirc(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}}s.EASE_LINEAR="linear",s.EASE_TWENTY_LADDER="twenty-ladder",s.EASE_TEN_LADDER="ten-ladder",s.EASE_FIVE_LADDER="five-ladder",s.EASE_THREE_LADDER="three-ladder",s.EASE_IN_SINE="in-sine",s.EASE_OUT_SINE="out-sine",s.EASE_IN_OUT_SINE="in-out-sine",s.EASE_IN_CUBIC="in-cubic",s.EASE_OUT_CUBIC="out-cubic",s.EASE_IN_OUT_CUBIC="in-out-cubic",s.EASE_IN_QUINT="in-quint",s.EASE_OUT_QUINT="out-quint",s.EASE_IN_OUT_QUINT="in-out-quint",s.EASE_IN_CIRC="in-circ",s.EASE_OUT_CIRC="out-circ",s.EASE_IN_OUT_CIRC="in-out-circ",s.EASE_IN_QUAD="in-quad",s.EASE_OUT_QUAD="out-quad",s.EASE_IN_OUT_QUAD="in-out-quad",s.EASE_IN_QUART="in-quart",s.EASE_OUT_QUART="out-quart",s.EASE_IN_OUT_QUART="in-out-quart",s.EASE_IN_EXPO="in-expo",s.EASE_OUT_EXPO="out-expo",s.EASE_IN_OUT_EXPO="in-out-expo",s.EASE_IN_BACK="in-back",s.EASE_OUT_BACK="out-back",s.EASE_IN_OUT_BACK="in-out-back",s.EASE_IN_BOUNCE="in-bounce",s.EASE_OUT_BOUNCE="out-bounce",s.EASE_IN_OUT_BOUNCE="in-out-bounce",s.EASE_IN_ELASTIC="in-elastic",s.EASE_OUT_ELASTIC="out-elastic",s.EASE_IN_OUT_ELASTIC="in-out-elastic",s.linear=e=>e,s.ladderTwenty=e=>s.ladder(e,20),s.ladderTen=e=>s.ladder(e,10),s.ladderFive=e=>s.ladder(e,5),s.ladderThree=e=>s.ladder(e,3),s.ladder=(e,t)=>Math.ceil(e*t)*(1/t),s.inSine=e=>1-Math.cos(e*Math.PI/2),s.outSine=e=>Math.sin(e*Math.PI/2),s.inOutSine=e=>-(Math.cos(Math.PI*e)-1)/2,s.inCubic=e=>e*e*e,s.outCubic=e=>1-Math.pow(1-e,3),s.inOutCubic=e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,s.inQuint=e=>e*e*e*e*e,s.outQuint=e=>1-Math.pow(1-e,5),s.inCirc=e=>1-Math.sqrt(1-Math.pow(e,2)),s.inQuad=e=>e*e,s.outQuad=e=>1-(1-e)*(1-e),s.inOutQuad=e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,s.inQuart=e=>e*e*e*e,s.outQuart=e=>1-Math.pow(1-e,4),s.inOutQuart=e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,s.inExpo=e=>0===e?0:Math.pow(2,10*e-10),s.outExpo=e=>1===e?1:1-Math.pow(2,-10*e),s.inOutExpo=e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,s.inBack=e=>{const t=1.70158;return 2.70158*e*e*e-t*e*e},s.outBack=e=>{const t=1.70158;return 1+2.70158*Math.pow(e-1,3)+t*Math.pow(e-1,2)},s.inOutBack=e=>{const t=2.5949095;return e<.5?Math.pow(2*e,2)*(7.189819*e-t)/2:(Math.pow(2*e-2,2)*((t+1)*(2*e-2)+t)+2)/2},s.inBounce=e=>1-s.outBounce(1-e),s.outBounce=e=>{const t=7.5625,i=2.75;return e<1/i?t*e*e:e<2/i?t*(e-=1.5/i)*e+.75:e<2.5/i?t*(e-=2.25/i)*e+.9375:t*(e-=2.625/i)*e+.984375},s.inOutBounce=e=>e<.5?(1-s.outBounce(1-2*e))/2:(1+s.outBounce(2*e-1))/2,s.inElastic=e=>{const t=2*Math.PI/3;return 0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*t)},s.outElastic=e=>{const t=2*Math.PI/3;return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*t)+1},s.inOutElastic=e=>{const t=2*Math.PI/4.5;return 0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*t)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*t)/2+1};const n=s},83990:(e,t,i)=>{i.d(t,{Z:()=>n});class s{constructor(e,t,i,n=0,a=0,r=s.SPEED_NORMAL,o=0,h=0){this.name=e,this.motions=t,this.option=i,this.duration=n,this.delay=a,this.speed=r,this.repeat=o,this.gap=h}}s.SPEED_SLOW=2,s.SPEED_NORMAL=1,s.SPEED_FAST=.5;const n=s},87318:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(33655),n=i(43673);class a{constructor(e,t="top"){this.duration=e,this.metod=t}}a.getOffset=(e,t,i)=>{let a=0;if(void 0===i||0===i.duration||!e.rect)return a;switch(i.metod){case"top":a=e.getRect().y/t.height;break;case"bottom":a=1-e.getRect().y/t.height;break;case"left":a=e.getRect().x/t.width;break;case"right":a=1-e.getRect().x/t.width;break;case"back":a=t.layerNr(e.id)/t.layers.length;break;case"front":a=1-t.layerNr(e.id)/t.layers.length;break;case"center":a=new n.Z(t.width/2,t.height/2).distanceTo(e.getRect().center())/Math.sqrt(t.width*t.width+t.height*t.height)/2;break;case"bounds":a=1-new n.Z(t.width/2,t.height/2).distanceTo(e.getRect().center())/Math.sqrt(t.width*t.width+t.height*t.height)/2}return Math.round((0,s.uZ)(a*i.duration,0,i.duration))};const r=a},93409:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(33655),n=i(99872),a=i(47339);class r{constructor(e,t=24,i=1,r=!1,o=!1){this.requestFrame=async()=>{if(this.currentFrame+=1,this.currentFrame>this.totalFrames)return void this.cancel();const e=this.currentFrame*this.interval,t=new n.Z(this.fresco.width,this.fresco.height);for(const i of this.animators)i.step(e,t);return this.stage.renderOutputFrame(this.ctx,this.inclusive,this.transparency),1!==this.scale?(await s.iF(),await s.vJ(this.output,this.scaled.width,this.scaled.height,this.scaled)):this.output},this.cancel=()=>{if(this.animators)for(const e of this.animators)e.finish()},this.scale=i,this.stage=e,this.fresco=e.fresco,this.inclusive=o,this.transparency=r,this.animators=[];let h=this.fresco.width,c=this.fresco.height;if(h%2==1&&(h-=1),c%2==1&&(c-=1),this.output=s.vL(h,c),1!==i){let e=Math.round(this.fresco.width*i),t=Math.round(this.fresco.height*i);e%2==1&&(e-=1),t%2==1&&(t-=1),this.scaled=s.vL(e,t)}this.ctx=this.output.getContext("2d"),this.animators=a.Z.bakeAnimators(e.fresco),this.runTime=0;for(const s of this.animators)this.runTime=Math.max(this.runTime,s.getDuration()),s.prepare(new n.Z(this.fresco.width,this.fresco.height));this.currentFrame=0,this.interval=1e3/t,this.totalFrames=Math.ceil((this.runTime+50)/1e3)*t}}},89422:(e,t,i)=>{i.d(t,{Z:()=>n});var s=i(71750);class n{constructor(e,t,i=0){this.shouldRun=e=>{const t=e<this.idelay,i=e>this.idelay+this.iduration;return i&&!this.end?(this.end=!0,!0):!t&&!i},this.getDuration=()=>this.idelay+this.iduration,this.fill=e=>{this.initial=void 0===this.motion.value.set?e:this.motion.value.set;const t=void 0===this.motion.value.from?this.initial:this.motion.value.from,i=void 0===this.motion.value.to?this.initial:this.motion.value.to;return 2===this.motion.direction||4===this.motion.direction?i-(i-t):t+(i-t)},this.begin=e=>{this.end=!1,this.playing=!0,this.initial=void 0===this.motion.value.set?e:this.motion.value.set,this.ibefore=void 0===this.motion.value.from?this.initial:this.motion.value.from,this.iafter=void 0===this.motion.value.to?this.initial:this.motion.value.to},this.step=e=>{if(0===e||e-this.idelay<1||0===this.ipass||0===this.motion.iterations)return this.ibefore;let t=Math.ceil((e-this.idelay)/this.ipass),i=(e-this.idelay)%this.ipass,s=0===i?1:i/this.ipass;(this.end||t>this.motion.iterations)&&(t=this.motion.iterations,s=1);const n=(this.iafter-this.ibefore)*this.ease.calculate(s);return this.flip(t)?this.iafter-n:this.ibefore+n},this.flip=e=>2===this.motion.direction||3===this.motion.direction&&e%2==0||4===this.motion.direction&&e%2==1,this.motion=e,this.ease=new s.Z(e.easing),this.idelay=Math.round(this.motion.delay*t+i),this.iduration=Math.round(this.motion.duration*t),this.ipass=0===this.iduration||0===this.motion.iterations?0:this.iduration/this.motion.iterations}}},4231:(e,t,i)=>{i.d(t,{$f:()=>n,Ef:()=>d,Gr:()=>o,_Y:()=>c,c0:()=>h,lZ:()=>a,o5:()=>r,ox:()=>l});var s=i(93947);async function n(e,t="GET",i={},n=!1){try{const a={"Content-Type":"application/json"};n&&(a.Authorization=`Bearer ${(0,s.pR)("__pat","")}`);const r={method:t,headers:a};"GET"!==t&&(r.body=JSON.stringify(i));const o=await fetch(e,r);return await o.json()}catch(a){return console.error(a),{status:!1,message:"Internal Server Error"}}}const a=()=>n("/checkout/giftcard"),r=()=>n("/checkout/plans"),o=e=>n("/checkout/upgrade/details","POST",{plan:e}),h=(e={})=>n("/checkout/paymentmethods","POST",e),c=(e,t)=>n(`/paypal/polling?id=${e}&type=${t}`,"POST"),l=()=>n("/api/country/"),d=async()=>{try{const e=await fetch("/api/geoip/"),t=await e.json();return t.registeredCountry.isoCode}catch(e){return"US"}}},27969:(e,t,i)=>{i.d(t,{ZP:()=>c,od:()=>h});var s=i(96548),n=i(71030),a=i(4231),r=i(93947),o=i(61293);const h={AF:"Afghanistan",AX:"Åland Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo, Republic of the (Brazzaville)",CD:"Congo, the Democratic Republic of the (Kinshasa)",CK:"Cook Islands",CR:"Costa Rica",CI:"Côte d'Ivoire, Republic of",HR:"Croatia",CU:"Cuba",CW:"Curaçao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Islas Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern and Antarctic Lands",GA:"Gabon",GM:"Gambia, The",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Laos",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",MD:"Moldova",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestine, State of",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Réunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barthélemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"};class c{constructor(e="chooser",t={method:"popup"}){this.setContent=async(e,t)=>{var i;let s="";switch(e){case"chooser":s=this.Form.chooser();break;case"login":s=this.Form.login();break;case"register":s=await this.Form.register();break;case"forgotPassword":s=this.Form.forgotPassword();break;case"setPassword":this.loadCaptcha(),s=this.Form.resetPassword(!0);break;case"resetPassword":this.loadCaptcha(),s=this.Form.resetPassword();break;case"verification":s=this.Form.verification(null!==(i=t.verify)&&void 0!==i?i:"verification");break;case"changePassword":s=this.Form.changePassword();break;case"changeEmail":s=this.Form.changeEmail();break;case"changeUsername":s=this.Form.changeUsername((0,r.ZP)("change-name").dataset.name);break;case"deleteAccount":const e=(0,r.ZP)("delete-account").dataset.name||"User";s=this.Form.deleteAccount(e);break;case"deleteAccountConfirmation":s=this.Form.deleteAccountConfirmation(t.reason);break;case"additionalVerification":this.passwordVerification="pending",s=this.Form.additionalVerification()}this.content.innerHTML=s,this.setFooter(e)},this.setFooter=e=>{switch(this.footer.style.display="block",e){case"login":this.footer.innerHTML=`${(0,s.Z)("common-notMember")} &nbsp; <a class="anchor" id="load-chooser">${(0,s.Z)("common-signUpNow")}</a>`,(0,r.ZP)("load-chooser").onclick=()=>this.loadForm("chooser");break;case"register":this.footer.innerHTML=`${(0,s.Z)("common-alreadyMember")} &nbsp; <a class="anchor" id="load-login">${(0,s.Z)("common-loginHere")}</a>`,(0,r.ZP)("load-login").onclick=()=>this.loadForm("login");break;case"forgotPassword":this.footer.innerHTML=`<a class="anchor back" id="entry-back">&#10094; &nbsp; ${(0,s.Z)("common-back")}</a>`,(0,r.ZP)("entry-back").onclick=()=>this.loadForm("login");break;case"resetPassword":this.footer.innerHTML=`<a class="anchor back" id="entry-back">&#10094; &nbsp; ${(0,s.Z)("common-back")}</a>`,(0,r.ZP)("entry-back").onclick=()=>this.loadForm("forgotPassword");break;default:return this.footer.innerHTML="",void(this.footer.style.display="none")}},this.keyDown=e=>{"Escape"!==e.key&&"Esc"!==e.key||this.cleanUp()},this.cleanUp=()=>{document.removeEventListener("keydown",this.keyDown,!1),this.dialog.classList.remove("ani"),this.holder.classList.remove("dim"),setTimeout((()=>{this.dialog.remove(),this.dialog=null,this.holder.remove(),this.holder=null}),200)},this.loadForm=async(e,t={})=>{var i,s,n,a,o,h,c,l,d,u,p;if(this.form=e,await this.setContent(e,t),"setPassword"!==e&&"resetPassword"!==e||this.renderCaptcha(),"chooser"===e)document.querySelectorAll(".social-button").forEach((e=>{e.addEventListener("click",(()=>{this.loadSocialLogin(e.dataset.social)}))})),null===(i=(0,r.ZP)("choose-email"))||void 0===i||i.addEventListener("click",(()=>{this.loadForm("register"),this.options.email&&setTimeout((()=>{(0,r.ZP)("entry-email").value=this.options.email}),500)}));if(null===(s=(0,r.ZP)("entry-form"))||void 0===s||s.addEventListener("submit",(e=>{this.submitForm((0,r.ZP)("entry-form").dataset.entry,e)})),"register"!==this.form&&"resetPassword"!==this.form||(null===(n=(0,r.ZP)("entry-password"))||void 0===n||n.addEventListener("focus",(()=>{this.passwordMeter("show",(0,r.ZP)("entry-password"))})),null===(a=(0,r.ZP)("entry-password"))||void 0===a||a.addEventListener("input",(()=>{this.updatePasswordMeter((0,r.ZP)("entry-password"))}))),"setPassword"===this.form&&(t.email=(0,r.ZP)("set-password").dataset.email),"resetPassword"!==this.form&&"setPassword"!==this.form||((0,r.ZP)("entry-email").value=t.email),(0,r.ZP)("entry-to-email")){const e=(0,r.ZP)("entry-to-email").dataset.text.replace("[EMAIL]",t.email);(0,r.ZP)("entry-to-email").innerHTML=e}(0,r.ZP)("verification-email")&&((0,r.ZP)("verification-email").value=t.email),(0,r.ZP)("entry-resend")&&(clearTimeout(this.resendCodeTimeouts),this.resendCodeTimeouts=setTimeout((()=>{(0,r.ZP)("entry-resend").classList.remove("hide")}),3e4),null===(o=(0,r.ZP)("entry-resend"))||void 0===o||o.addEventListener("click",(()=>this.resendCode(t.email)))),null===(h=(0,r.ZP)("entry-email"))||void 0===h||h.addEventListener("keyup",(()=>{this.validateInputTimer("email")})),null===(c=(0,r.ZP)("entry-email"))||void 0===c||c.addEventListener("blur",(()=>{(0,r.b0)((0,r.ZP)("entry-email"),"","email")})),null===(l=(0,r.ZP)("entry-cancel"))||void 0===l||l.addEventListener("click",(()=>this.cleanUp())),null===(d=(0,r.ZP)("load-forgotPassword"))||void 0===d||d.addEventListener("click",(()=>this.loadForm("forgotPassword"))),null===(u=(0,r.ZP)("toggle-password"))||void 0===u||u.addEventListener("click",(()=>this.togglePassword())),null===(p=(0,r.ZP)("toggle-password-2"))||void 0===p||p.addEventListener("click",(()=>this.togglePassword("toggle-password-2","entry-password-new")))},this.loadSocialLogin=async e=>{if((0,n.Z)("login",e),"apple"===e){const e=await new Promise(((e,t)=>{let i=document.createElement("script");i.type="text/javascript",i.crossOrigin="anonymous",i.src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js",document.body.appendChild(i),i.onload=function(){e(AppleID?AppleID.auth:null)},i.onerror=function(){t("Failed to load apple auth script")}}));e&&(e.init({clientId:"com.pixlr.web",scope:"name email",redirectURI:new URL(location.href).origin+"/auth/apple/callback",state:location.href,nonce:"",usePopup:!1}),e.signIn())}else{const t=window.location.origin;window.location.href=`${t}/auth/${e}?callbackUrl=${window.location.href}`}},this.togglePassword=(e="toggle-password",t="entry-password")=>{const i=(0,r.ZP)(e),s=(0,r.ZP)(t);"text"===s.type?(s.type="password",i.src="/img/icon/eye-hide.svg"):(s.type="text",i.src="/img/icon/eye-show.svg")},this.passwordMeter=(e="show",t)=>{if("show"==e&&t){const e=(0,r.ZP)(t.id),i=(0,r.ZP)(t.id).nextElementSibling;e.classList.remove("invalid"),i.style.display="none"}(0,r.ZP)("password-meter").style.display="show"==e?"flex":"none"},this.updatePasswordMeter=e=>{let t=(0,r.ZP)("password-meter"),i=(0,r.ZP)("password-meter").classList.value.replace(" ",","),s=0;switch(e.value.match(/[a-z]/)&&s++,e.value.match(/[A-Z]/)&&s++,e.value.match(/\d/)&&s++,e.value.match(/[!@#$%&*?'"~_./+\-|()^`:;<>,]/)&&s++,e.value.length<8&&0!==s&&(s=0),s){case 0:t.classList.replace(i,"none");break;case 1:t.classList.replace(i,"weak");break;case 2:t.classList.replace(i,"soso");break;case 3:t.classList.replace(i,"good");break;case 4:t.classList.replace(i,"great")}},this.validateInputTimer=e=>{this.validationTimer[e]&&clearTimeout(this.validationTimer[e]),this.validationTimer[e]=setTimeout((()=>(0,r.b0)((0,r.ZP)(`entry-${e}`),"",e)),1e3)},this.loadCaptcha=()=>{let e=document.createElement("script");e.id="recaptcha-js-api",e.defer=!0,e.src="https://www.google.com/recaptcha/api.js",document.getElementsByTagName("head")[0].appendChild(e)},this.renderCaptcha=()=>{this.captcha=void 0;const e=window.location.href.includes("localhost")?"6LeBQzcaAAAAAPwVny3IG23_fY_FasFVKXvQG9qB":"6LcqBEsaAAAAAF-JcOUzRtVKASZt5b-EMITWxEJf";setTimeout((()=>{try{this.captcha=grecaptcha.render((0,r.ZP)("recaptcha"),{sitekey:e})}catch(t){console.error("Failed to load Captcha, please check your network connection!")}}),2500)},this.getFormInput=()=>{const e={},t=(0,r.ZP)("entry-form");return t.querySelectorAll("input").forEach((t=>{"checkbox"==t.type?e[t.name]=t.checked:e[t.name]=t.value})),t.querySelectorAll("select").forEach((t=>{e[t.name]=t.value})),e},this.submitForm=async(e,t)=>{switch(t.preventDefault(),e){case"login":this.loginHandler();break;case"register":this.registerHandler();break;case"verification":this.verificationHandler();break;case"forgotPassword":this.forgotPasswordHandler();break;case"setPassword":this.passwordResetHandler(!0);break;case"resetPassword":this.passwordResetHandler();break;case"changeEmail":this.changeEmailHandler();break;case"changeEmailVerification":this.changeEmailVerificationHandler();break;case"changePassword":this.changePasswordHandler();break;case"changeUsername":this.changeUsernameHandler();break;case"deleteAccount":this.deleteAccountHandler();break;case"deleteAccountConfirmation":this.deleteAccountConfirmationHandler()}},this.loginHandler=async()=>{const e=this.getFormInput();e.email=e.email.trim();const t=(0,r.b0)((0,r.ZP)("entry-email"),e.email,"email"),i=(0,r.b0)((0,r.ZP)("entry-password"),e.password,"password");if(!t||!i)return;(0,r.ZP)("entry-submit").innerHTML='\n            <img src="/images/myaccount/loading.gif" alt="loading" style="margin-top:12px;">\n        ';const o=await(0,a.$f)("/auth/login","POST",e);if(o.status)if((0,n.Z)("login","password"),(0,r.ZP)("entry-submit").innerHTML=(0,s.Z)("common-login"),this.callbackUrl){const e=decodeURIComponent(this.callbackUrl).split("#")[0];window.location.href=e}else window.location.reload();else o.verify?(this.loadForm("verification",{email:e.email}),(0,r.FN)("danger",o.message,5)):((0,r.ZP)("entry-submit").innerText="Login",(0,r.FN)("danger",o.message,5))},this.registerHandler=async()=>{this.registerData=this.getFormInput();const e=(0,r.b0)((0,r.ZP)("entry-email"),this.registerData.email,"email"),t=(0,r.b0)((0,r.ZP)("entry-password"),this.registerData.password,"password");if(!e||!t)return;const i=this.getFormInput();Object.assign(i,this.registerData);const s=await(0,a.$f)("/auth/register","POST",i);if(!s.status)return(0,r.FN)("danger",s.message,5),void this.loadForm("register");this.loadForm("verification",{email:i.email})},this.verificationHandler=async()=>{const e=this.getFormInput(),t=await(0,a.$f)("/auth/verify","POST",e);if(!t.status)return(0,r.FN)("danger",t.message,5);(0,r.FN)("success",t.message,5),this.cleanUp(),setTimeout((()=>{if(this.callbackUrl){const e=decodeURIComponent(this.callbackUrl).split("#")[0];window.location.href=e}else window.location.reload()}),1e3)},this.forgotPasswordHandler=async()=>{const e=this.getFormInput();if(!(0,r.b0)((0,r.ZP)("entry-email"),e.email,"email"))return;e.resend=!1;const t=await(0,a.$f)("/auth/request/code/","POST",e);if(!t.status)return(0,r.FN)("danger",t.message,5);(0,r.FN)("success",t.message,5,e.email),this.loadForm("resetPassword",{email:e.email})},this.passwordResetHandler=async(e=!1)=>{let t;try{if(t=grecaptcha.getResponse(this.captcha),grecaptcha.reset(this.captcha),!t)return(0,r.FN)("danger","Please complete the CAPTCHA!",3)}catch(c){console.error("Failed to get Captcha Token!")}const i=this.getFormInput();i.token=t;const s=(0,r.b0)((0,r.ZP)("entry-email"),i.email,"email"),n=(0,r.b0)((0,r.ZP)("entry-password"),i.password,"password"),o=(0,r.b0)((0,r.ZP)("entry-code"),i.code,"code");if(!s||!n||!o)return;const h=await(0,a.$f)("/auth/reset","POST",i);if(!h.status)return(0,r.FN)("danger",h.message,5);(0,r.FN)("success",h.message,5),this.cleanUp(),setTimeout((()=>{e?window.location.href="/logout":window.location.reload()}),1e3)},this.resendCode=async e=>{(0,r.ZP)("entry-resend").classList.add("hide"),this.resendCodeTimeouts=setTimeout((()=>{(0,r.ZP)("entry-resend").classList.remove("hide")}),3e4);const t=await(0,a.$f)("/auth/request/code/","POST",{email:e,resend:!0});if(!t.status)return(0,r.FN)("danger",t.message,5);(0,r.FN)("success",t.message,5,e)},this.changeEmailHandler=async()=>{const e=this.getFormInput();if(!(0,r.b0)((0,r.ZP)("entry-email"),e.email,"email"))return;const t=await(0,a.$f)("/auth/changeemail/request","POST",{newEmail:e.email});if(!t.status)return(0,r.FN)("danger",t.message);this.loadForm("verification",{email:e.email,verify:"changeEmailVerification"}),(0,r.FN)("success",t.message,5,e.email)},this.changeEmailVerificationHandler=async()=>{const e=this.getFormInput();e.newEmail=e.email;if(!(0,r.b0)((0,r.ZP)("entry-code"),e.code,"code"))return;const t=await(0,a.$f)("/auth/changeemail/verify","POST",e);if(!t.status)return(0,r.FN)("danger",t.message,5);(0,r.FN)("success",t.message,5),setTimeout((()=>{window.location.replace(`/logout?callbackUrl=${window.location.href}`)}),1e3)},this.changePasswordHandler=async()=>{const e=this.getFormInput(),t=(0,r.b0)((0,r.ZP)("entry-password"),e.password,"password"),i=(0,r.b0)((0,r.ZP)("entry-password-new"),e["new-password"],"password");if(!t||!i)return;const s=await(0,a.$f)("/auth/changepassword","PUT",{oldPassword:e.password,newPassword:e["new-password"]});if(!s.status)return(0,r.FN)("danger",s.message,5);(0,r.FN)("success",s.message,5),setTimeout((()=>{window.location.replace(`/logout?callbackUrl=${window.location.href}`)}),2e3)},this.changeUsernameHandler=async()=>{const e=this.getFormInput(),t=await(0,a.$f)("/myaccount/api/profile","PUT",e,!0);if(!t.status)return(0,r.FN)("danger",t.message);(0,r.FN)("success",t.message),setTimeout((()=>window.location.reload()),500)},this.deleteAccountHandler=async()=>{const e=this.getFormInput();"leavingReasonDefault"!==e.reason&&this.loadForm("deleteAccountConfirmation",{reason:e.reason})},this.deleteAccountConfirmationHandler=async()=>{const e=this.getFormInput();if(!(0,r.b0)((0,r.ZP)("entry-password"),e.password,"password"))return;(0,r.ZP)("entry-cancel").style.display="none",(0,r.ZP)("delete-confirm").innerText=(0,s.Z)("common-deleteInProgress");const t=await(0,a.$f)("/api/myaccount/profile","DELETE",e,!0);if(!t.status)return(0,r.ZP)("entry-cancel").style.display="block",(0,r.ZP)("delete-confirm").innerText=(0,s.Z)("deleteMyAccount"),(0,r.FN)("danger",t.message);window.location.href="/logout/"},this.getAdditionalVerificationstatus=()=>(0,r.ZP)("entry-modal"),this.additionalVerificationHandler=async()=>{const e=this.getFormInput();if(!(0,r.b0)((0,r.ZP)("entry-password"),e.password,"password"))return!1;const t=await(0,a.$f)("/api/myaccount/verification","POST",e,!0);return t.status?(this.cleanUp(),!0):((0,r.FN)("danger",t.message),!1)},this.Form=new o.Z,this.form=e,this.options=t,this.registerData={},this.validationTimer={},this.captcha={},t.callback&&(this.callbackUrl=t.callback),"popup"===this.options.method?(this.holder=(0,r.T)("div",{id:"entry-modal",className:"modal"}),document.body.appendChild(this.holder),this.dialog=(0,r.T)("div",{className:"entry pop"}),this.holder.appendChild(this.dialog),this.content=(0,r.T)("div",{className:"entry-content"}),this.footer=(0,r.T)("div",{id:"entry-footer"}),this.dialog.append((0,r.T)("img",{id:"popup-close",className:"close",src:"/img/icon/close-black.svg",onclick:()=>this.cleanUp()}),this.content,this.footer),document.addEventListener("keydown",this.keyDown,!1),setTimeout((()=>this.dialog.classList.add("ani")),5),setTimeout((()=>this.holder.classList.add("dim")),5)):(this.dialog=this.options.holder,this.dialog.classList.add("entry"),this.content=(0,r.T)("div",{className:"entry-content"}),this.footer=(0,r.T)("div",{id:"entry-footer"}),this.dialog.append(this.content,this.footer)),this.loadForm(e)}}},61293:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(96548),n=i(27969),a=i(4231),r=i(33506);class o{constructor(){this.chooser=()=>`\n            <h1>${(0,s.Z)("common-signUpLogIn")}</h1>\n            <p>\n            ${(0,s.Z)("common-agreeTo")} <a href="/terms-of-use/" target='_new'>${(0,s.Z)("common-termsOfUse")}</a> ${(0,s.Z)("common-and")} <a href="/privacy-policy/" target='_new'> ${(0,s.Z)("common-privacyPolicy")}</a>.\n            </p>\n            <div class="chooser">\n                <div class="social-button" data-social="google">\n                    <img src="/images/icon/google.svg" alt="google">\n                    ${(0,s.Z)("common-continueWith")} Google\n                </div>\n                <div class="social-button" data-social="facebook">\n                    <img src="/images/icon/facebook.svg" alt="facebook">\n                    ${(0,s.Z)("common-continueWith")} Facebook\n                </div>\n                <div class="social-button" data-social="apple">\n                    <img src="/images/icon/apple_gray.svg" alt="apple">\n                    ${(0,s.Z)("common-continueWith")} Apple\n                </div>\n                <a class="anchor top-20" style="display:block;text-align:center;font-size:15px;" id="choose-email">\n                    ${(0,s.Z)("common-orUseEmail")}\n                </a>\n            </div>\n        `,this.login=()=>`\n            <h1>${(0,s.Z)("common-login")}</h1>\n\n            <form id="entry-form" data-entry="login">\n                <div class="input-group">\n                    <label for="entry-email">${(0,s.Z)("common-email")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email" placeholder="Email address">\n                    <p class="error-msg">${(0,s.Z)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password" placeholder="Enter password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <button type="submit" class="button big positive full top-40" id="entry-submit">${(0,s.Z)("common-login")}</button>\n                <div class="input-group inline space-between">\n                    <div class="inline">\n                        <input type="checkbox" id="entry-rememberMe" name="rememberMe"/>\n                        <label for="entry-rememberMe" class="custom-checkbox">${(0,s.Z)("common-rememberMe")}</label>\n                    </div>\n                    <div>\n                        <a class="anchor" id="load-forgotPassword">${(0,s.Z)("common-forgotPass")}</a>\n                    </div>\n                </div>\n            </form>\n        `,this.register=async()=>{let e="",t=!1;const i=await(0,a.Ef)();for(let s in n.od)t||"US"!==s&&i!=s?e+=`<option value="${s}">${n.od[s]}</option>`:(e+=`<option value="${s}" selected>${n.od[s]}</option>`,t=!0);return`\n            <h1>${(0,s.Z)("common-signUp")}</h1>\n\n            <form id="entry-form" data-entry="register">\n                <div class="input-group">\n                    <label for="entry-email">${(0,s.Z)("common-email")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email" placeholder="Email address">\n                    <p class="error-msg">${(0,s.Z)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password" placeholder="Enter password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <div class="input-group">\n                    <label for="country">${(0,s.Z)("common-country")}</label>\n                    <select name="country">\n                        ${e}\n                    </select>\n                </div>\n\n                <div class="input-group">\n                    <div class="checkbox-group inline">\n                        <input type="checkbox" id="entry-newsletter" name="newsletter" checked/>\n                        <label for="entry-newsletter" class="custom-checkbox">${(0,s.Z)("subscribeToNewsletter")}</label>\n                    </div>\n                </div>\n\n                <button type="submit" class="button big positive full top-20" style="margin-bottom: 20px">${(0,s.Z)("common-signUp")}</button>\n            </form>\n        `},this.forgotPassword=()=>`\n            <h1>${(0,s.Z)("common-forgotPass")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="forgotPassword">\n                <div class="input-group">\n                    <label for="entry-email">${(0,s.Z)("common-email")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email" placeholder="Email address"/>\n                    <p class="error-msg">${(0,s.Z)("common-enterValidEmail")}</p>\n                </div>\n\n                <button type="submit" class="button big positive full top-40" id="load-verification">${(0,s.Z)("common-reqCode")}</button>\n            </form>\n        `,this.resetPassword=(e=!1)=>{const t=e?"setPassword":"resetPassword";return`\n            <h1>${e?(0,s.Z)("common-setPassword"):(0,s.Z)("common-resetPass")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="${t}">\n                <div class="input-group">\n                    <label for="entry-email">${(0,s.Z)("common-email")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email" readonly/>\n                    <p class="error-msg">${(0,s.Z)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-newPass")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <div class="input-group">\n                    <label for="entry-code">${(0,s.Z)("common-code")}</label>\n                    <input type="number" name="code" id="entry-code" onkeypress="if(this.value.length===6)return false;">\n                    <p class="error-msg">${(0,s.Z)("common-enterValidCode")}</p>                    \n                </div>\n                \n                ${e?`<p class="top-10 text-center"><a class="anchor" id="entry-resend">${(0,s.Z)("common-SendResetCode")}</a></p>`:""}\n\n                <div id="recaptcha" style="padding-top: 5px"></div>\n                <button class="button big positive full" type="submit">${(0,s.Z)("common-updatePass")}</button>\n                ${e?"":`<p class="top-10 hide text-center" id="entry-resend">${(0,s.Z)("common-didNotReceiveCode")} <a class="anchor">${(0,s.Z)("common-resend")}</a></p>`}\n            </form>\n        `},this.verification=e=>`\n            <h1>${(0,s.Z)("common-verifyAcc")}</h1>\n            <p id="entry-to-email" data-text="${(0,s.Z)("common-sentCodeDesc")}">${(0,s.Z)("common-sentCodeDesc")}</p>\n\n            <form id="entry-form" data-entry="${e}">\n                <input id="verification-email" type="hidden" name="email" readonly/>\n                <div class="input-group">\n                    <label for="code">${(0,s.Z)("common-code")}</label>\n                    <input type="number" name="code" id="entry-code" onkeypress="if(this.value.length===6)return false;">\n                    <p class="error-msg">${(0,s.Z)("common-enterValidCode")}</p>\n                </div>\n\n                <button type="submit" class="button big positive full top-20">${(0,s.Z)("common-verify")}</button>\n                <p class="top-20 hide text-center" id="entry-resend">${(0,s.Z)("common-didNotReceiveCode")} &nbsp; <a class="anchor">${(0,s.Z)("common-resend")}</a></p>\n            </form>\n        `,this.changePassword=()=>`\n            <h1>${(0,s.Z)("common-changePassword")}</h1>\n            <form id="entry-form" class="top-30" data-entry="changePassword">\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-oldPass")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-newPass")}</label>\n                    <input type="password" name="new-password" id="entry-password-new">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password-2" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <button type="submit" class="button full top-20" style="margin-bottom: 20px">${(0,s.Z)("common-changePassword")}</button>\n            </form>\n        `,this.changeEmail=()=>`\n            <h1>${(0,s.Z)("common-changeEmail")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="changeEmail">\n                <div class="input-group">\n                    <label class="text-capitalize" for="email">${(0,s.Z)("common-newEmail")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email">\n                    <p class="error-msg">${(0,s.Z)("common-EnterValidEmail")}</p>\n                </div>\n            \n                <button type="submit" class="button full top-20" style="margin-bottom: 20px">${(0,s.Z)("common-newEmail")}</button>\n            </form>\n        `,this.changeUsername=(e="")=>`\n            <h1>${(0,s.Z)("changeUsername")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="changeUsername">\n                <div class="input-group">\n                    <label for="entry-username">${(0,s.Z)("newUsername")}</label>\n                    <input type="text" name="name" id="entry-username" value="${e}">\n                </div>\n\n                <button type="submit" class="button full top-20">${(0,s.Z)("update")}</button>\n            </form>\n        `,this.deleteAccount=e=>`\n            <h1>${(0,s.Z)("common-deleteMyAccount")}</h1>\n            <p class="top-20">Hey ${e},</p>\n            <p class="no-margin">${(0,s.Z)("common-sadToSeeYouGoWhyLeaving")}</p>\n\n            <form id="entry-form" data-entry="deleteAccount">\n                <div class="input-group">\n                    <label class="top-20 text-uppercase">${(0,s.Z)("common-leavingBecause")}</label>\n                    <select name="reason">\n                        <option value="leavingReasonDefault" disabled selected>${(0,s.Z)("common-leavingReasonDefault")}</option>\n                        <option value="leavingReasons1">${(0,s.Z)("common-leavingReasons1")}</option>\n                        <option value="leavingReasons2">${(0,s.Z)("common-leavingReasons2")}</option>\n                        <option value="leavingReasons3">${(0,s.Z)("common-leavingReasons3")}</option>\n                        <option value="leavingReasons4">${(0,s.Z)("common-leavingReasons4")}</option>\n                        <option value="leavingReasons5">${(0,s.Z)("common-leavingReasons5")}</option>\n                    <select>\n                </div>\n\n                <button type="submit" class="button red full top-20" style="margin-bottom: 20px">${(0,s.Z)("common-deleteMyAccount")}</button>\n            </form>\n        `,this.deleteAccountConfirmation=(e="leavingReasonDefault")=>`\n            <h4 class="top-35 text-default">${(0,s.Z)("areYouSureYouWantToDelete")} </h4>\n            ${r.a.subscription?`<p class="top-35">${(0,s.Z)("common-youHaveActiveSubsBeforeDelete")}</p>`:""}\n            <p class="top-15">${(0,s.Z)("youCanStillChangeYourMind")} </p>\n\n            <form id="entry-form" data-entry="deleteAccountConfirmation">\n                <input type="hidden" name="reason" value="${e}">\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <div class="input-group checkbox-group inline justify-center flex-wrap" style="margin-top: 30px">\n                    <button id="entry-cancel" class="button full positive">${(0,s.Z)("cancel")}</button>\n                    <button id="delete-confirm" type="submit" class="button full transparent">${(0,s.Z)("deleteMyAccount")}</button>\n                </div>\n            </form>\n        `,this.additionalVerification=()=>`\n            <h3 class="heavy">${(0,s.Z)("enterYourPasswordToContinue")}</h3>\n\n            <form id="entry-form" data-entry="additionalVerification">\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <div class="input-group checkbox-group inline justify-center" style="margin-top: 30px">\n                    <button type="submit" class="button full top-20">Continue</button>\n                </div>\n            </form>\n        `}}},97666:(e,t,i)=>{i.d(t,{By:()=>a,Cj:()=>o,L8:()=>r});var s=i(96548),n=i(93947);function a(e,t=100,i="",a="",r=""){return(0,n.T)("div",{className:`form-group w-${t}`},(0,n.T)("div",{className:"adyen-checkout-title"},(0,n.T)("span",{className:"adyen-checkout__label__text"},`${(0,s.Z)(e)} ${(0,s.Z)(a)}`),r),(0,n.T)("input",{type:"text",id:e.replace("checkout-",""),maxLength:56,required:!0,value:i}))}function r(e){return(0,n.T)("div",{className:"tooltip"},(0,n.T)("span",{className:"tooltiptext"},(0,n.T)("img",{src:"/img/icon/information.svg",alt:"i"})),(0,n.T)("div",{className:"right"},e,(0,n.T)("i")))}function o(e,t=100){return(0,n.T)("div",{className:`form-group w-${t}`},(0,n.T)("span",{className:"adyen-checkout__label__text"},(0,s.Z)(e)),(0,n.T)("select",{id:"country",name:"country",className:"country-select"}))}},16577:(e,t,i)=>{i.d(t,{Z:()=>p});var s=i(96548),n=i(4231),a=i(93947),r=i(97666),o=i(57909),h=i(21951),c=i(70840),l=i(99344),d=i(33506),u=i(57246);class p extends o.Z{constructor(e,t){var o,p,g,m,v,f;if(super(!0),this.checkoutType="subscription",this.checkoutMode="checkout",this.checkoutUrl="/checkout/payments",this.selectedPaymentMethod="credit",this.productName="Pixlr Premium",this.totalPrice=59,this.renewalPrice=59,this.seatPrice=3.99,this.currency="USD",this.currencySymbol="$",this.checkoutPlan="premium-yearly",this.checkoutDiscountPercentage="",this.savedCardId="",this.billingAddress={},this.billingAddressRequired=["firstName","lastName","address","city","zipCode","state"],this.encryptedCardData={isValid:!1,paymentMethod:{}},this.freeTrial=!1,this.balanceCredit=0,this.tax={status:!1},this.additionalSeats={status:!1},this.promoCode={promoApplied:!1,code:"",discountedAmount:0},this.paypalCheckoutSubscriptionsUrl="/paypal/subscriptions",this.paypalCheckoutTemplateUrl="/paypal/purchase",this.monthName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.loadEventListener=()=>{var e,t,i,s,n,r;"seats"!==this.checkoutType&&"Pixlr Team"!==this.productName||document.getElementsByClassName("radio-options")[1]&&(document.getElementsByClassName("radio-options")[1].style.display="none"),null===(e=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.addEventListener("click",this.makePayment),(0,a.ZP)("add-billing-info").addEventListener("click",this.showAndGetBilling),(0,a.ZP)("back-billing-icon").addEventListener("click",this.creditCardForm),null===(t=(0,a.ZP)("paypal-radio-option"))||void 0===t||t.addEventListener("click",this.checkoutMethod),(0,a.ZP)("adyen-radio-option").addEventListener("click",this.checkoutMethod),(0,a.ZP)("back-premium-icon").classList.remove("hide"),(0,a.ZP)("back-premium-icon").addEventListener("click",this.backPreviousPopup),null===(i=(0,a.ZP)("collapse-seat"))||void 0===i||i.addEventListener("click",this.collapseSeat),null===(s=(0,a.ZP)("country"))||void 0===s||s.addEventListener("change",this.updateCountry),null===(n=document.getElementsByClassName("seat-option-custom")[0])||void 0===n||n.addEventListener("input",(()=>{this.selectSeats(document.getElementsByClassName("seat-option-custom")[0],!0)})),null===(r=document.getElementsByClassName("seat-option-custom")[0])||void 0===r||r.addEventListener("click",(function(){const e=this.children[0];e.value||(e.value="1")})),document.querySelectorAll(".seat-option").forEach((e=>{e.addEventListener("click",(()=>{this.selectSeats(e,"seats"===this.checkoutType)}))})),this.creditCardForm(),this.populateCountry()},this.populateCountry=async()=>{const{data:e}=await n.ox();this.countryList=e;const t=(0,a.ZP)("country");for(const i in this.countryList.country){const e=(0,a.T)("option",{value:this.countryList.country[i]},this.countryList.country[i]);(null===d.a||void 0===d.a?void 0:d.a.country)===i&&(e.selected=!0),t.append(e)}this.updateCountry()},this.creditCardForm=async()=>{var e;const[t]=await Promise.all([i.e(6600).then(i.bind(i,4884)).then((e=>e.default)),i.e(6600).then(i.bind(i,80697))]);(0,a.ZP)("billing-page").classList.add("hide"),(0,a.ZP)("payment-method").classList.remove("hide"),(0,a.ZP)("card-page").classList.remove("hide"),(0,a.ZP)("back-premium-icon").classList.remove("hide"),null===(e=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.classList.remove("hide"),"subscription"===this.checkoutType?this.freeTrial?(0,a.ZP)("subscription-pay-btn").innerText=(0,s.Z)("start30DaysTrial"):(0,a.ZP)("subscription-pay-btn").innerText=(0,s.Z)("payAmountNow",`${this.currency} ${this.totalPrice.toFixed(2)}`):"template"===this.checkoutType?(0,a.ZP)("template-pay-btn").innerHTML=(0,s.Z)("payNow"):"seats"===this.checkoutType&&((0,a.ZP)("seats-pay-btn").innerText=(0,s.Z)("payAmountNow",`${this.currency} ${this.totalPrice.toFixed(2)}`)),this.isReadyToPay();const{paymentMethods:r,paymentCards:o,adyenClientKey:h,proRatedSeats:c}=await n.c0({splan:this.checkoutPlan});(null==r?void 0:r.storedPaymentMethods)&&o&&this.populateSavedCard(r.storedPaymentMethods,o),c&&((0,a.ZP)("prorated-seat").style.display="block",this.seatPrice=0,this.updatePrice());return new t({locale:"en_US",environment:"pixlr.com"===window.location.hostname?"live":"test",clientKey:h,paymentMethodsResponse:r,onChange:this.handleOnChange}).create("card",{hasHolderName:!0,holderNameRequired:!0}).mount("#component-container"),!0},this.paypalForm=()=>{var e;(0,a.ZP)("card-page").classList.add("hide"),(0,a.ZP)(`${this.checkoutType}-pay-btn`).innerHTML=(0,s.Z)("continueOnPaypal"),null===(e=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.removeAttribute("disabled")},this.checkoutMethod=()=>{for(var e=document.getElementsByName("payment"),t=0;t<e.length;t++)1==e[t].checked&&this.paymentSection(e[t].value)},this.paymentSection=async e=>{switch(e){case"adyen":default:this.creditCardForm(),this.selectedPaymentMethod="credit";break;case"paypal":this.paypalForm(),this.selectedPaymentMethod="paypal"}this.toggleCheckoutPlan()},this.showAndGetBilling=()=>{(0,a.ZP)("card-page").classList.add("hide"),(0,a.ZP)("payment-method").classList.add("hide"),(0,a.ZP)("billing-page").classList.remove("hide"),(0,a.ZP)("back-premium-icon").classList.add("hide");const e=(0,a.ZP)("billing-address").getElementsByTagName("input");for(let t=0;t<e.length;t++){const i=e[t];i.addEventListener("keyup",(()=>{this.billingAddress[i.id]=i.value,this.isReadyToPay()}))}},this.updateCountry=()=>{const e=Object.keys(this.countryList.country).find((e=>this.countryList.country[e]===(0,a.ZP)("country").value));this.countryList.tax[e]?(this.tax.status=!0,this.tax.percentage=this.countryList.tax[e]):this.tax.status=!1,this.countryList.countryEU.some((t=>t===e))?this.currency="EUR":this.currency="USD",this.currencySymbol="USD"===this.currency?"$":"€",document.querySelectorAll(".currency").forEach((e=>e.innerHTML=this.currency)),document.querySelectorAll(".currency-symbol").forEach((e=>e.innerHTML=this.currencySymbol)),(0,a.ZP)("tax-included")&&((0,a.ZP)("tax-included").style.display=this.tax.status?"block":"none"),this.updatePrice()},this.populateSavedCard=(e=[],t)=>{if(!e.length)return;const i=(0,a.ZP)("saved-cards");i.innerHTML="",e.forEach(((e,s)=>{if(!t.includes(e.id))return;const n=(0,a.T)("div",{id:e.id,className:"saved-card-item"},(0,a.T)("img",{src:`https://checkoutshopper-live.adyen.com/checkoutshopper/images/logos/${e.brand}.svg`,alt:`${e.brand} icon`}),(0,a.T)("div",(0,a.T)("span",{style:"font-size: 12px;"},`**** **** **** ${e.lastFour}`),(0,a.T)("span",{className:"heavy",style:"font-size: 10px; color: #A2A2A4;"},`EXP DATE ${e.expiryMonth}/${e.expiryYear.substring(4,2)}`)));n.addEventListener("click",(()=>{this.selectSavedCard(e)})),t[0]===e.id?i.prepend(n):i.append(n)}))},this.resultModal=e=>{(0,a.ZP)("overview").style.display="none",(0,a.ZP)("checkout").style.display="none";const t=e.status;return(t||"success"===t)&&Object.assign(d.a,e.data.settings),(0,a.ZP)("result-modal")&&(0,a.ZP)("result-modal").remove(),e.loading?`\n            <div id="result-modal" class="loader">\n                <img src="/images/myaccount/black-loading.gif" alt="loading" style="width: 150px">\n                <h2>${(0,s.Z)("pleaseCompleteYourPaymentAtPaypal")}!</h2>\n                <p class="top-20">${(0,s.Z)("pleaseDoNotRefreshOrCloseThisPageWhilePaymentIsProcessing")}.</p>\n                <p>${"web"===this.options.platform?(0,s.Z)("youWillAutomaticallyBeRedirectedToMyAccount"):(0,s.Z)("youWillAutomaticallyBeRedirectedToTheEditor")}</p>\n            </div>\n            `:t||"success"===t?((0,a.ZP)("try-premium")&&((0,a.ZP)("try-premium").style.display="none"),`\n            <div id="result-modal">\n                <img src="/images/icon/green-tick.png" alt="green tick icon" style="width: 50px; height: 50px">\n                <h2 class="top-20 heavy">${(0,s.Z)("paymentSuccessful")}!</h2>\n\n                ${"template"===this.checkoutType?`<p class="pad-10 text-center">${(0,s.Z)("theTemplateIsLoading")}`:""}\n                ${"giftcard"===this.checkoutType?`<p class="top-20 text-center">${(0,s.Z)("thankYouForYourPurchaseEmail",this.options.isAGift.to||d.a.email)}`:`<p class="top-10">${"web"===this.options.platform?(0,s.Z)("youWillAutomaticallyBeRedirectedToMyAccount"):(0,s.Z)("youWillAutomaticallyBeRedirectedToTheEditor")}</p>`}\n            </div>`):`\n            <div id="result-modal">\n                <img src="/images/icon/red-cross.png" alt="fail" style="width: 50px; height: 50px">\n                <h1 class="heavy top-20">${(0,s.Z)("paymentFailed")}</h1>\n                <p class="pad-10">${(0,s.Z)("paymentUnsuccessful")}.</p>\n            </div>`},this.handleOnChange=e=>{const{data:{paymentMethod:t},isValid:i}=e;this.encryptedCardData.isValid=i,this.encryptedCardData.paymentMethod=t,this.encryptedCardData.cardHolderName=document.getElementsByClassName("adyen-checkout__input--text")[0].value,this.isReadyToPay()},this.getCheckoutData=()=>{const e={billingAddress:this.billingAddress,currency:this.currency,promo:this.promoCode,seatsToAdd:this.additionalSeats.status?this.additionalSeats.count:0,freeTrialSource:"editor",checkoutMethod:this.checkoutMode};if("credit"===this.selectedPaymentMethod)e.paymentMethod=this.encryptedCardData.paymentMethod;else if("saved-card"===this.selectedPaymentMethod&&this.savedCardId)e.paymentCard=this.savedCardId;else if("paypal"!==this.selectedPaymentMethod)throw new Error("Failed to get checkout information!");return"subscription"===this.checkoutType?(e.splan=this.checkoutPlan,this.freeTrial&&(e.freeTrial="true")):"template"===this.checkoutType?e.templateId=this.templateId:"giftcard"===this.checkoutType&&(e.giftId=this.options.giftcard,e.giftDetails=this.options.isAGift),e},this.selectSavedCard=e=>{const t=(0,a.ZP)(e.id);t.className.includes("selected")?(t.classList.remove("selected"),(0,a.ZP)("component-container").classList.remove("blocked"),this.savedCardId="",this.selectedPaymentMethod="credit"):(document.querySelectorAll(".saved-card-item").forEach((e=>e.classList.remove("selected"))),t.classList.add("selected"),(0,a.ZP)("component-container").classList.add("blocked"),this.savedCardId=e.id,this.selectedPaymentMethod="saved-card"),this.isReadyToPay()},this.makePayment=async()=>{var e;if(!this.isReadyToPay())return;if(null===(e=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.setAttribute("disabled","true"),"paypal"===this.selectedPaymentMethod)return this.paypalCheckout();let t;this.billingAddress.country=(0,a.ZP)("country").value,"subscription"===this.checkoutType?t=this.checkoutUrl:"template"===this.checkoutType?t=this.checkoutUrl+"/template/":"seats"===this.checkoutType?t=this.checkoutUrl+"/seats/":"giftcard"===this.checkoutType&&(t=this.checkoutUrl+"/giftcard/");const i=this.getCheckoutData();i.captchaToken="!!";const s=this.getUTMParam();try{const e=await fetch(t+"?platform=editor"+s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)}),n=await e.json();"subscription"===this.checkoutType&&n.status&&this.trackShareASale(n.data),this.setContent(this.resultModal(n)),n.status&&("web"===this.options.platform?setTimeout((()=>{"seats"===this.checkoutType?window.location.href="/myaccount/?tab=team":"giftcard"===this.checkoutType?window.location.href="/myaccount/?tab=redeem":window.location.href="/myaccount/?tab=subscription"}),1500):setTimeout((()=>{var e;null===(e=null==this?void 0:this.stage)||void 0===e||e.unblock(),null==this||this.cleanUp()}),2500))}catch({message:n}){this.setContent(this.resultModal({status:!1}))}},this.paypalCheckout=async()=>{const e="subscription"===this.checkoutType?this.paypalCheckoutSubscriptionsUrl:this.paypalCheckoutTemplateUrl,t=this.getCheckoutData();try{const i=await fetch(e+"?platform=editor",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)}),s=await i.json();if(s.status){const e=this.createPopupWin(s.redirectUrl,"Paypal Checkout",800,650);this.setContent(this.resultModal({loading:!0}));const t=await(0,l.n)((async()=>{try{const e=await n._Y(s.id,this.checkoutType);return Promise.resolve(e)}catch(e){return Promise.reject(e)}}),500,15e3);"success"===t.status&&((0,a.ZP)("try-premium")&&((0,a.ZP)("try-premium").style.display="none"),e.close(),this.setContent(this.resultModal(t)),setTimeout((()=>{null==this||this.cleanUp(),this.stage&&this.stage.unblock(),"web"===this.options.platform&&(window.location.href="/myaccount/?tab=subscription")}),2500))}else this.setContent(this.resultModal({status:!1}))}catch(i){console.error(i),this.setContent(this.resultModal({status:!1}))}},this.promoCodeOnInput=()=>{const e=(0,a.ZP)("promocode-input");e.value=e.value.toUpperCase()},this.applyPromoCode=async()=>{if("Remove"===(0,a.ZP)("promocode-submit").innerText)return this.removePromoCode(),!1;const e=(0,a.ZP)("promocode-input");this.options.code&&((0,a.ZP)("promocode-add").style.display="none",(0,a.ZP)("promocode-toggle").style.display="block",e.value=this.options.code);let t=this.options.code&&""!==this.options.code?this.options.code:e.value.toUpperCase().trim();try{const i=await fetch(`/api/promo/status/?code=${t}&product=${this.productName}&splan=${this.checkoutPlan}`),n=await i.json();if(!n.status)throw new Error("Invalid promocode!");const{percentage:r,amount:o,productName:h,productCode:c}=n.promo;return(0,a.ZP)("promo-remarks").innerText=r?(0,s.Z)("discountPercentageOffFirstPayingMonth").replace("{discountAmount}",`${r}%`):(0,s.Z)("discountAmountOnlyFirstPayingMonth").replace("{discountAmount}",o),this.promoCode=Object.assign(Object.assign({},this.promoCode),{percentage:r,amount:o,productName:h,productCode:c}),this.promoCode.code=t,this.togglePromoApplied(),this.updatePrice(),e.readOnly=!0,(0,a.ZP)("promocode-submit").innerText=(0,s.Z)("remove"),!0}catch({response:i,message:n}){return t="",e.value="",(0,a.ZP)("promocode-error").style.display="block",setTimeout((()=>{(0,a.ZP)("promocode-error").style.display="none"}),1500),!1}},this.removePromoCode=()=>{this.promoCode={promoApplied:!1,code:"",discountedAmount:0},this.updatePrice(this.renewalPrice);const e=(0,a.ZP)("promocode-input");e.value="",e.readOnly=!1,(0,a.ZP)("promo-tac").style.display="block",(0,a.ZP)("promo-section").style.display="flex",(0,a.ZP)("promocode-submit").innerText="Apply"},this.togglePromoApplied=()=>{this.promoCode.promoApplied=!this.promoCode.promoApplied},this.updatePrice=e=>{if(e&&(this.renewalPrice=e,this.totalPrice=e),this.promoCode.promoApplied){this.promoCode.productName.includes(this.productName)&&this.promoCode.productCode.includes(this.checkoutPlan)?(this.promoCode.percentage&&(this.promoCode.discountedAmount=this.renewalPrice*(this.promoCode.percentage/100)),this.promoCode.amount&&(this.promoCode.discountedAmount=this.promoCode.amount)):this.removePromoCode()}if(this.additionalSeats.status&&this.additionalSeats.count?this.additionalSeats.amount=this.additionalSeats.count*this.seatPrice:this.additionalSeats.amount=0,this.tax.status?this.tax.amount=(this.renewalPrice-this.promoCode.discountedAmount-this.balanceCredit+this.additionalSeats.amount)*(this.tax.percentage/100):this.tax.amount=0,this.totalPrice=this.renewalPrice-this.promoCode.discountedAmount-this.balanceCredit+this.additionalSeats.amount+this.tax.amount,this.freeTrial){const e=new Date;e.setMonth(e.getMonth()+1);const t=`${e.getDate()} ${this.monthName[e.getMonth()]} ${e.getFullYear()}`,i=document.getElementById("freetrial-note");null!=i&&(i.innerHTML=`${(0,s.Z)("cancelAnytimeOrAutoRenewalForAmount",t,this.currencySymbol+this.totalPrice.toFixed(2))}`,i.style.display="block")}(0,a.ZP)("plan-price")&&((0,a.ZP)("plan-price").innerText="seats"===this.checkoutType?this.seatPrice.toFixed(2):this.renewalPrice.toFixed(2)),(0,a.ZP)("total-price")&&((0,a.ZP)("total-price").innerText=`${this.freeTrial?"0.00":this.totalPrice.toFixed(2)}`),"subscription"!==this.checkoutType&&"seats"!==this.checkoutType||(this.freeTrial?(0,a.ZP)("subscription-pay-btn").innerText=`${(0,s.Z)("start30DaysTrial")}`:(0,a.ZP)(`${this.checkoutType}-pay-btn`).innerText=`PAY ${this.currency}${this.totalPrice.toFixed(2)} NOW`),this.shouldShowPriceSummary()},this.toggleCheckoutPlan=(e=void 0)=>{if("upgrade"===this.checkoutMode)return void((0,a.ZP)("plan-duration").innerText=(0,s.Z)("year"));"stack"===this.checkoutMode?(0,a.ZP)("checkout-plan").checked=!0:e&&((0,a.ZP)("checkout-plan").checked=e);const t=(0,a.ZP)("checkout-plan").checked,i=(0,a.ZP)("checkout-toggler");if(this.freeTrial=this.isEligibleForTrialCheckout(),t){switch(this.productName){case"Pixlr Plus":this.checkoutPlan="plus-yearly";break;case"Pixlr Premium":this.checkoutPlan="premium-yearly";break;case"Pixlr Team":this.checkoutPlan="team-yearly"}i.getElementsByClassName("switch-plan")[0].classList.remove("isMonthly"),i.getElementsByClassName("switch-plan")[0].classList.add("isYearly"),i.getElementsByClassName("switch-plan-monthly")[0].classList.remove("active"),i.getElementsByClassName("switch-plan-yearly")[0].classList.add("active"),(0,a.ZP)("plan-duration").innerText="year",(0,a.ZP)("promo-remarks").style.display="none","Pixlr Team"===this.productName&&(this.seatPrice=47.88),this.updatePrice(this.getRenewalPrice(this.checkoutPlan))}else{switch(this.productName){case"Pixlr Plus":this.checkoutPlan="plus-monthly";break;case"Pixlr Premium":this.checkoutPlan="premium-monthly";break;case"Pixlr Team":this.checkoutPlan="team-monthly"}i.getElementsByClassName("switch-plan")[0].classList.remove("isYearly"),i.getElementsByClassName("switch-plan")[0].classList.add("isMonthly"),i.getElementsByClassName("switch-plan-yearly")[0].classList.remove("active"),i.getElementsByClassName("switch-plan-monthly")[0].classList.add("active"),"Pixlr Team"===this.productName&&(this.seatPrice=3.99),(0,a.ZP)("plan-duration").innerText="month",(0,a.ZP)("promo-remarks").style.display="block",this.updatePrice(this.getRenewalPrice(this.checkoutPlan))}(0,a.ZP)("freetrial-note").style.display=this.freeTrial?"block":"none",(0,a.ZP)("renewal-price").innerHTML=`${this.getRenewalPrice(this.checkoutPlan).toFixed(2)}`},this.isEligibleForTrialCheckout=()=>{var e;let t=!1;null===(e=(0,a.ZP)("checkout-plan"))||void 0===e||e.checked;return t=!(!(null===d.a||void 0===d.a?void 0:d.a.eligibleForTrail)||"Pixlr Premium"!==this.productName),t},this.isReadyToPay=()=>{var e,t;const{isValid:i,paymentMethod:s}=this.encryptedCardData,n=Object.values(this.billingAddress).filter((e=>""!==e)).length;try{if("paypal"===this.selectedPaymentMethod)return!0;if("credit"===this.selectedPaymentMethod){if(!i)throw!1;if(0===this.encryptedCardData.cardHolderName.length)throw!1}return 0!==n&&this.billingAddressRequired.forEach((e=>{if(!this.billingAddress[e])throw!1})),null===(e=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.removeAttribute("disabled"),!0}catch({message:r}){return null===(t=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===t||t.setAttribute("disabled","true"),!1}},this.createPopupWin=(e,t,i,s)=>{const n=(screen.width-i)/2,a=(screen.height-s)/4;return window.open(e,t,`resizable=yes,width=${i},height=${s},top=${a},left=${n}`)},this.collapseSeat=()=>{(0,a.ZP)("collapse-seat").classList.toggle("active");document.getElementsByClassName("seat-select")[0].classList.toggle("hide")},this.cleanUp=()=>{(0,a.ZP)("workspace")&&(0,a.ZP)("workspace").classList.remove("blur"),(0,a.ZP)("home")&&(0,a.ZP)("home").classList.remove("blur"),document.removeEventListener("keydown",this.keyDown,!1),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.backPreviousPopup=()=>{switch(this.cleanUp(),this.options.bounceSource){case"premiumbounce":new h.Z(this.options.bounceType);break;case"premiumtemplatebounce":new c.Z(this.stage);break;case"paywall":new u.Z}},this.shouldShowPriceSummary=()=>{"upgrade"===this.checkoutMode&&this.upgradeDetails.status&&this.balanceCredit>0?((0,a.ZP)("balance-credit-summary").style.display="block",(0,a.ZP)("balance-credit-details").innerHTML=`- ${this.currency} ${this.balanceCredit.toFixed(2)}`):((0,a.ZP)("balance-credit-summary").style.display="none",(0,a.ZP)("balance-credit-details").innerHTML=""),this.promoCode.promoApplied?((0,a.ZP)("promo-summary").style.display="block",(0,a.ZP)("promo-details").innerHTML=`- ${this.currency} ${this.promoCode.discountedAmount.toFixed(2)}`):((0,a.ZP)("promo-summary").style.display="none",(0,a.ZP)("promo-details").innerHTML=""),this.additionalSeats.status&&this.additionalSeats.amount>0?((0,a.ZP)("additional-seats-summary").style.display="block",(0,a.ZP)("additional-seats-count").innerHTML=this.additionalSeats.count.toString(),(0,a.ZP)("additional-seats-details").innerHTML=`${this.currency} ${this.additionalSeats.amount.toFixed(2)}`):(0,a.ZP)("additional-seats-summary").style.display="none",this.tax.status?((0,a.ZP)("tax-summary").style.display="block",(0,a.ZP)("tax-details").innerHTML=`${this.currency} ${this.tax.amount.toFixed(2)}`):((0,a.ZP)("tax-summary").style.display="none",(0,a.ZP)("tax-details").innerHTML="")},this.getUTMParam=()=>{const e={};let t="";return this.options.utm_source&&(e.utm_source=this.options.utm_source),this.options.utm_medium&&(e.utm_medium=this.options.utm_medium),this.options.utm_campaign&&(e.utm_campaign=this.options.utm_campaign),t+=Object.keys(e).map((t=>t+"="+e[t])).join("&"),t?`&${t}`:t},this.getRenewalPrice=e=>{const t=this.subscriptionPlans.filter((t=>t.code===e))[0];if(t.pricing[this.currency].amount)return t.pricing[this.currency].amount;if("premium-monthly"===e)return 7.99;if("premium-yearly"===e)return 59;if("team-monthly"===e)return 12.99;if("team-yearly"===e)return 119;if("plus-monthly"===e)return 1.99;if("plus-yearly"===e)return 8.99;throw new Error("Failed to get pricing details")},this.selectSeats=(e,t=!1)=>{const i=e;if(document.querySelectorAll(".seat-option").forEach((e=>{e!==i&&e.classList.remove("active")})),"subscription"===this.checkoutType&&i.classList.toggle("active"),"seats"===this.checkoutType&&(i.classList.contains("active")||i.classList.toggle("active")),i.classList.contains("active"))if(i.classList.contains("seat-option-custom")){const e=i.getElementsByTagName("input")[0];""==e.value?(this.additionalSeats.status=!1,this.additionalSeats.count=0):(this.additionalSeats.status=!0,this.additionalSeats.count=Number(e.value))}else"0"==i.dataset.value?(this.additionalSeats.status=!1,this.additionalSeats.count=0):(this.additionalSeats.count=Number(i.dataset.value),this.additionalSeats.status=!0);else this.additionalSeats.status=!1,this.additionalSeats.count=0;this.updatePrice()},this.trackShareASale=e=>{const{merchantReference:t,paidAmount:i,currency:s,sscid:n,newCustomer:a=0}=e;if(n){const e=document.createElement("img");e.id="_SHRSL_img_1",e.src=`https://www.shareasale.com/sale.cfm?tracking=${t}&amount=${i}&merchantID=94987&transtype=sale&sscidmode=6&sscid=${n}&currency=${s}&newcustomer=${a}`,e.style.width="1",e.style.height="1";const r=document.createElement("script");r.src="https://www.dwin1.com/19038.js",r.type="text/javascript",r.defer=!0,this.dialog.appendChild(e),this.dialog.appendChild(r)}},i.e(1477).then(i.bind(i,64593)),this.content.id="checkout-modal",this.dialog.style.maxWidth="900px",this.checkoutType=e,this.options=t,this.options.platform||(this.options.platform="suite"),this.options.stage&&(this.stage=this.options.stage),""!==(0,a.pR)("promo-code","")&&(this.options.code=(0,a.pR)("promo-code","")),this.setContent('\n            <div id="checkout-loading">\n                Please wait while checkout is loading\n            </div>\n        '),"giftcard"===this.checkoutType&&Promise.all([n.lZ()]).then((([e])=>{var t,i,s,n;if(!e.status)throw new Error("Failed to get gift details");const r=e.data.find((e=>e.code===this.options.giftcard));this.productName=r.product,this.totalPrice=r.amount,this.renewalPrice=r.amount,null===(t=(0,a.ZP)("checkout-loading"))||void 0===t||t.remove(),this.setContent(`\n                    <div id="checkout" class="">\n                        <img id="back-premium-icon" class="hide" src="/img/icon/arrow-left-black.svg">\n                        ${y}\n                        ${w}\n                        ${x}\n                    </div>\n                    <div id="overview" class="left-panel"></div>\n                `),(0,a.ZP)("overview").innerHTML=P(this.productName),(0,a.ZP)("gift-price").innerText=String(this.renewalPrice.toFixed(2)),null===(i=(0,a.ZP)("promocode-submit"))||void 0===i||i.addEventListener("click",this.applyPromoCode),null===(s=(0,a.ZP)("promocode-input"))||void 0===s||s.addEventListener("input",this.promoCodeOnInput),(0,a.ZP)("paypal-checkout-option")&&((0,a.ZP)("paypal-checkout-option").style.display="none"),null===(n=(0,a.ZP)("promocode-add"))||void 0===n||n.addEventListener("click",(()=>{(0,a.ZP)("promocode-toggle").style.display="block",(0,a.ZP)("promocode-add").style.display="none"})),this.loadEventListener()})),"template"===this.checkoutType){if(!this.options.stage)throw new Error("Failed to load stage");this.templateId=null!==(g=null===(p=null===(o=this.stage.fresco)||void 0===o?void 0:o.templateMeta)||void 0===p?void 0:p.templateId)&&void 0!==g?g:"-",this.renewalPrice=1,this.totalPrice=1}"seats"===this.checkoutType&&(this.seatPrice=(null===(m=null===d.a||void 0===d.a?void 0:d.a.subscriptionCode)||void 0===m?void 0:m.includes("monthly"))?3.99:47.88,this.renewalPrice=0,this.totalPrice=this.seatPrice),"subscription"===this.checkoutType&&(this.options.plan&&(this.checkoutPlan=this.options.plan),this.options.checkoutMode&&(this.checkoutMode=this.options.checkoutMode),this.checkoutPlan.includes("premium")&&(this.productName="Pixlr Premium",this.checkoutDiscountPercentage="-38%"),this.checkoutPlan.includes("plus")&&(this.productName="Pixlr Plus",this.checkoutDiscountPercentage="-62%"),this.checkoutPlan.includes("team")&&(this.productName="Pixlr Team",this.seatPrice="team-monthly"===this.checkoutPlan?3.99:47.88,this.checkoutDiscountPercentage="-31%"),this.freeTrial=!("Pixlr Premium"!==this.productName||!(null===d.a||void 0===d.a?void 0:d.a.eligibleForTrail)),Promise.all([n.o5(),n.Gr(this.checkoutPlan)]).then((([e,t])=>{var i,s,n,r,o;if(this.upgradeDetails=t,!e.status)throw new Error("Failed to get plan details");"upgrade"===this.checkoutMode&&(this.freeTrial=!1,t.status&&(this.balanceCredit=t.data.balanceCredit)),this.subscriptionPlans=e.data,this.renewalPrice=this.totalPrice=this.getRenewalPrice(this.checkoutPlan),null===(i=(0,a.ZP)("checkout-loading"))||void 0===i||i.remove(),this.setContent(`\n                    <div id="checkout" class="">\n                        <img id="back-premium-icon" class="hide" src="/img/icon/arrow-left-black.svg">\n                        ${y}\n                        ${w}\n                        ${x}\n                    </div>\n                    <div id="overview" class="left-panel"></div>\n                `),(0,a.ZP)("overview").innerHTML=k(this.productName,this.checkoutPlan,this.totalPrice),null===(s=(0,a.ZP)("checkout-plan"))||void 0===s||s.addEventListener("change",(()=>this.toggleCheckoutPlan())),"upgrade"!==this.checkoutMode||t.status?("checkout"===this.checkoutMode&&"Pixlr Plus"===this.productName||"upgrade"===this.checkoutMode&&"premium-yearly"!==this.checkoutPlan?(0,a.ZP)("promocode-add").style.display="none":(null===(n=(0,a.ZP)("promocode-submit"))||void 0===n||n.addEventListener("click",this.applyPromoCode),null===(r=(0,a.ZP)("promocode-input"))||void 0===r||r.addEventListener("input",this.promoCodeOnInput),null===(o=(0,a.ZP)("promocode-add"))||void 0===o||o.addEventListener("click",(()=>{(0,a.ZP)("promocode-toggle").style.display="block",(0,a.ZP)("promocode-add").style.display="none"}))),this.checkoutPlan.includes("yearly")&&this.toggleCheckoutPlan(!0),this.options.code&&this.applyPromoCode(),this.loadEventListener()):this.setContent(this.resultModal({status:!1}))})));const y=`\n            <div id="payment-method" class="hide top-20">\n                <h2 class="heavy">${(0,s.Z)("paymentMethod")}</h2>\n                \n            <div id="saved-cards"></div>\n        \n                <div class="payment-options top-20">\n                    <div class="radio-options">\n                        <input type="radio" name="payment" value="adyen" id="adyen-radio-option" data-checked="true" checked/>\n                        <label for="adyen-radio-option">${(0,s.Z)("useCreditCard")}</label>\n                    </div>\n                    <div id="paypal-checkout-option" class="radio-options ${"checkout"===this.checkoutMode?"":"hidden"}">\n                        <input type="radio" name="payment" value="paypal" id="paypal-radio-option" data-checked="false"/>\n                        <label for="paypal-radio-option"> ${(0,s.Z)("payWith")} <img class="paypal-icon" src="/img/icon/paypal.png"/></label>\n                    </div>\n                </div>\n            </div>\n        `,w=`\n            <div id="card-page" class="hide">\n                <div class="w-100">\n                    <div id="component-container" style="padding: 15px 0 10px"></div>\n                    <div id="add-billing-container">\n                        <a id="add-billing-info" class="heavy anchor"><img src="/img/icon/plus-circle-light-blue.svg">${(0,s.Z)("AddOptionalBillingInformation")}</a>\n                    </div>\n                </div>\n            </div>\n        `,x=`\n            <div id="billing-page" class="hide top-20">\n                <img id="back-billing-icon" src="/img/icon/arrow-left-black.svg">\n                <div class="billing-form w-100">\n                    <h3 class="heavy">${(0,s.Z)("billingDetailsSmallCap")}</h3>\n                    <form id="billing-address" style="padding: 15px 0 10px">`+(0,a.T)("div",{className:"flex"},r.By("checkout-firstName",50),r.By("checkout-lastName",50)).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-company-name",100,"","checkout-optional")).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-vatNumber",100,"","checkout-optional",r.L8("For value-added  tax purposes"))).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-companyRegistrationNumber",100,"","checkout-optional")).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-department",100,"","checkout-optional")).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-address",100)).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-city",50),r.By("checkout-zipCode",50)).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-state",50),r.Cj("checkout-country",50)).outerHTML+"</form>\n                </div>\n\t\t\t</div>\n        ",b=`\n            <a id="promocode-add">${(0,s.Z)("iHaveAPromoCode")}!</a>\n            <div id="promocode-toggle" class="w-100 top-15" style="display:none">\n                <p class="heavy" style="font-size: 12px">${(0,s.Z)("promoCode")} </p>\n                <div id="promo-section">\n                    <input type="text" id="promocode-input" placeholder="${(0,s.Z)("promoCode")} *">\n                    <span id="promocode-submit" class="apply">${(0,s.Z)("apply")}</span>\n                </div>\n                <p id="promocode-error">${(0,s.Z)("invalidPromoCode")}</p>\n                <p id="promo-tac">* ${(0,s.Z)("codeIsvalidForOneTimeOnlyDiscountNotAppliedToNextCharges")}</p>\n            </div>\n        `,Z=()=>`\n                <div id="breakdown-summary" class="top-20">\n                    ${"subscription"===this.checkoutType&&this.productName?`\n                        <div>\n                            <p>\n                                ${this.productName.replace("Pixlr","")+" "+(0,s.Z)("subscription")}\n                                <span style="float: right;" id="renewal-price">${this.renewalPrice.toFixed(2)}</span>\n                                <span style="float: right; margin-right: 5px;" class="currency">${this.currency}</span>\n                            </p>\n                            <span>${"Pixlr Team"===this.productName?(0,s.Z)("x5SeatIncluded"):""}</span>\n                        </div>\n                        `:""}\n                    ${"giftcard"===this.checkoutType?`\n                            <div>\n                                <p>\n                                    ${(0,s.Z)("price")}\n                                    <span style="float: right;" id="gift-price">${this.renewalPrice.toFixed(2)}</span>\n                                    <span style="float: right; margin-right: 5px;" class="currency">${this.currency}</span>\n                                </p>\n                                <span></span>\n                            </div>\n                        `:""}\n                    <div id="promo-summary" style="display: none;">\n                        <p>\n                            ${(0,s.Z)("promoCode")}: \n                            <span id="promo-details" style="float:right;"></span>\n                        </p>\n                        <span id="promo-remarks"></span>\n                    </div>\n                    <div id="balance-credit-summary" style="display: none;">\n                        <p>\n                            Balance Credit:\n                            <span id="balance-credit-details" style="float:right;"></span>\n                        </p>\n                    </div>\n                    <div id="additional-seats-summary" style="display: none;">\n                        <p>\n                            ${(0,s.Z)("additionalSeats")}\n                            <span id="additional-seats-details" style="float:right;"></span>\n                        </p>\n                        <span>x<span id="additional-seats-count"></span> ${(0,s.Z)("seats")}</span>\n                    </div>\n                    <div id="tax-summary" style="display: none;">\n                        <p>\n                            GST: 8%\n                            <span id="tax-details" style="float:right;"></span>\n                        </p>\n                    </div>\n                </div>\n            `,k=(e,t,i)=>`\n                <div class="card">\n\n                    <p class="small heavy">\n                        ${e}\n                        <a class="semi-bold anchor" style="float:right;font-size:10px;line-height:18px;" href="/pricing/" target="_blank">${(0,s.Z)("subscriptionBenefits")}</a>\n                    </p>\n\n                    ${"checkout"===this.checkoutMode?`\n                        <div class="row pad-10">\n                            <div id="checkout-toggler">\n                                <input type="checkbox" class="toggle-check" id="checkout-plan" />\n                                <label for="checkout-plan">\n                                    <div class="switch-plan ${t.includes("monthly")?"isMonthly":"isYearly"}">\n                                        <div class="switch-plan-monthly ${t.includes("monthly")?"active":""}">${(0,s.Z)("monthly")}</div>\n                                        <div class="switch-plan-yearly ${t.includes("yearly")?"active":""}">${(0,s.Z)("yearly")} <span class="yearly-badge" style="${this.checkoutDiscountPercentage?"":"display:none"}">${this.checkoutDiscountPercentage}</span></div>\n                                    </div>\n                                </label>\n                            </div>\n                        </div>\n                    `:""}\n\n                    <p style="font-size:14px">\n                        <span class="currency" style="font-size:14px">${this.currency} </span> \n                        <span id="plan-price" style="font-size:14px">${i}</span>/<span id="plan-duration" style="font-size:14px">month</span> • ${(0,s.Z)("checkout-autorenewalBasis")}\n                    </p>\n                    <p style="font-size:12px; line-height:14px; margin:15px 0">${(0,s.Z)("youCanCancelAuto")}</p>\n\n                    <div style="border-top: 1px solid #D3D4D4; width: 100%; margin:10px 0"></div>\n\n                    ${"Pixlr Team"===e?`\n                    <div style="width: 100%">\n                        <p class="heavy" style="padding-bottom: 10px; font-size: 12px; display: flex; align-items: center">\n                            <img src="/images/icon/team-blue.svg" style="width: 20px; height: 20px; margin-right: 5px"> \n                            ${(0,s.Z)("needMoreSeats")}\n                            <img id="collapse-seat" class="pointer" src="/images/icon/small-arrow-down.svg" style="margin-left: 8px; width: 12px">\n                        </p>\n                        <div class="seat-select hide">\n                            <span class="seat-option" data-value="5">5 ${(0,s.Z)("seats")}</span>\n                            <span class="seat-option" data-value="10">10 ${(0,s.Z)("seats")}</span>\n                            <span class="seat-option" data-value="20">20 ${(0,s.Z)("seats")}</span>\n                            <span class="seat-option seat-option-custom"><input type="number" placeholder="Custom" min="1" max="100" oninput="this.value = !!this.value && Math.abs(this.value) >= 1 ? Math.abs(this.value) : null"></span>\n                        </div>\n                    </div>\n                    `:""}\n\n                    ${b}\n                    ${Z()}\n\n                    <div style="padding-bottom: 18px; border-bottom: 1px dashed #D3D4D4; width: 100%"></div>\n                    <div class="row space-between" style="padding: 18px 0; width: 100%; align-items: center">\n                        <div>\n                            <h3 class="heavy" style="text-transform: none; opacity: 1;color: #333">\n                                ${(0,s.Z)("checkout-totalDue")}:\n                            </h3>\n                            <span id="tax-included" style="display: none;font-size: 14px; color: #A3A3A3">(incl. GST)</span>\n                        </div>\n                        <h3 style="font-size: 18px;opacity: 1;color: #333">\n                            <span class="currency heavy" style="font-size: 18px">${this.currency}</span>\n                            <span class="heavy" id="total-price" style="font-size: 18px">${i}</span>\n                        </h3>\n                    </div>\n                    <button id="subscription-pay-btn" class="button big positive w-100">${(0,s.Z)("payAmountNow").replace("{number}",`${this.currency} ${i.toFixed(2)}`)}</button>\n                    <span id="freetrial-note" class="pad-10"></span>\n                    \n                </div>\n            `,E=`\n            <div id="premium-options" class="card">\n                <p style="font-weight: bold;">Pixlr Template</p>\n                <p><span class="currency">${this.currency}</span> ${this.currencySymbol}1.00/template</p>\n\n                <div class="column space-between pad-15 template-info">\n                    <div id="template-canvas" style="padding:9px;"></div>\n                    <div class="desc">${(0,s.Z)("dontJustPayForOne")} <span id="premium-check">here</span></div>\n                </div>\n\n                ${Z()}\n\n                <div class="row space-between pad-0" style="margin-bottom: 15px">\n                    <h3 style="text-transform: none; font-size:18px" class="heavy">${(0,s.Z)("checkout-totalDue")}:</h3>\n                    <h3 style="font-size:18px">\n                        <span class="currency heavy">${this.currency}</span>\n                        <span class="heavy" id="total-price">${this.totalPrice.toFixed(2)}</span>\n                    </h3>\n                </div>\n                <button id="template-pay-btn" class="button big positive w-100 pad-15">${(0,s.Z)("payNow")}</button>\n            </div>\n        `,P=e=>`\n            <div id="premium-options" class="card">\n                <p style="font-weight: bold; font-size: 18px">${(0,s.Z)("giftCard")}</p>\n                \n                <div style="display: flex; column-gap: 15px" class="top-20">\n                    <img src="/images/license/gift-card/thumb.svg">\n                    <div>\n                        <b style="font-size: 13px">${this.options.giftcard.includes("yearly")?"1 year":"Quarterly"} ${e} gift card</b><br>\n                        <span style="font-size: 11px"><b>Purchase for :</b> ${this.options.isAGift.to?"Someone else":"Myself"}</span>\n                    </div>\n                </div>\n\n                <div style="padding-bottom: 18px; border-bottom: 1px dashed #D3D4D4; width: 100%"></div>\n\n                ${Z()}\n\n                <div style="padding-bottom: 18px; border-bottom: 1px dashed #D3D4D4; width: 100%"></div>\n                <div class="row space-between" style="padding: 18px 0; width: 100%">\n                    <div>\n                        <h3 class="heavy" style="text-transform: none; opacity: 1;color: #333">\n                            ${(0,s.Z)("checkout-totalDue")}:\n                        </h3>\n                        <span id="tax-included" style="display: none;font-size: 14px; color: #A3A3A3">(incl. GST)</span>\n                    </div>\n                    <h3 style="font-size:18px">\n                        <span class="currency heavy">${this.currency}</span>\n                        <span class="heavy" id="total-price">${this.totalPrice.toFixed(2)}</span>\n                    </h3>\n                </div>\n                <button id="giftcard-pay-btn" class="button big positive w-100">${(0,s.Z)("payNow")}</button>\n            </div>\n        `,S=`\n            <div id="premium-options" class="card">\n\n                <div style="margin:-15px -15px 0 -15px;padding:15px;">\n                    <h3 class="heavy" style="margin-top: 25px">${(0,s.Z)("additionalSeats")}</h3>\n\n                    <p class="heavy" style="font-size:14px">\n                        <span class="currency heavy" style="font-size:14px">${this.currency} </span> \n                        ${this.currencySymbol}\n                        <span id="plan-price" class="heavy" style="font-size:14px">${this.seatPrice}</span>/<span id="plan-duration" class="heavy" style="font-size:14px">${(0,s.Z)("seats")}</span>\n                    </p>\n\n                    <p id="prorated-seat" style="font-size: 11px; line-height: 16px; display: none;">\n                        Enjoy added seats for free until your next renewal. Cost for any additonal seats will be prorated to your subscription renewal.\n                    </p>\n                </div>\n\n                <div style="border-top: 1px solid #D3D4D4; width: 100%"></div>\n\n                <div>\n                    <p class="heavy" style="padding-bottom: 10px; font-size: 12px; display: flex; align-items: center">\n                        <img src="/images/icon/team-blue.svg" style="width: 20px; height: 20px; margin-right: 5px"> \n                        ${(0,s.Z)("needMoreSeats")}\n                        <img id="collapse-seat" src="/images/icon/small-arrow-down.svg" style="margin-left: 5px">\n                    </p>\n                    <div class="seat-select">\n                        <span class="seat-option active" data-value="5">5 ${(0,s.Z)("seats")}</span>\n                        <span class="seat-option" data-value="10">10 ${(0,s.Z)("seats")}</span>\n                        <span class="seat-option" data-value="20">20 ${(0,s.Z)("seats")}</span>\n                        <span class="seat-option seat-option-custom"><input type="number" placeholder="Custom" min="1" max="100" oninput="this.value = !!this.value && Math.abs(this.value) >= 1 ? Math.abs(this.value) : null"></span>\n                    </div>\n                </div>\n\n                ${Z()}\n\n                <div style="padding-bottom: 18px; border-bottom: 1px dashed #D3D4D4; width: 100%"></div>\n                <div class="row space-between" style="padding: 18px 0; width: 100%">\n                    <h3 class="heavy" style="text-transform: none;opacity: 1;color: #333">${(0,s.Z)("checkout-totalDue")}:</h3>\n                    <h3 style="font-size: 18px;opacity: 1;color: #333">\n                        <span class="currency heavy">${this.currency}</span>\n                        <span class="heavy" id="total-price">${this.totalPrice}</span>\n                    </h3>\n                </div>\n                <button id="seats-pay-btn" class="button big positive w-100">${(0,s.Z)("payAmountNow",`${this.currency} ${this.totalPrice.toFixed(2)}`)}</button>\n                <span id="freetrial-note" class="pad-10"></span>\n                    \n            </div>\n        `;"template"===this.checkoutType&&(null===(v=(0,a.ZP)("checkout-loading"))||void 0===v||v.remove(),this.setContent(`\n                <div id="checkout" class="">\n                    <img id="back-premium-icon" class="hide" src="/img/icon/arrow-left-black.svg">\n                    ${y}\n                    ${w}\n                    ${x}\n                </div>\n                <div id="overview" class="left-panel"></div>\n            `),(0,a.ZP)("overview").innerHTML=E,(0,a.ZP)("template-canvas").appendChild(this.stage.getOutputCanvas(this.stage.fresco,.08)),(0,a.ZP)("premium-check").addEventListener("click",(()=>{this.cleanUp(),new c.Z(this.stage)})),this.loadEventListener()),"seats"===this.checkoutType&&(null===(f=(0,a.ZP)("checkout-loading"))||void 0===f||f.remove(),this.setContent(`\n                <div id="checkout" class="">\n                    <img id="back-premium-icon" class="hide" src="/img/icon/arrow-left-black.svg">\n                    ${y}\n                    ${w}\n                    ${x}\n                </div>\n                <div id="overview" class="left-panel"></div>\n            `),(0,a.ZP)("overview").innerHTML=S,this.updatePrice(),this.selectSeats(document.getElementsByClassName("seat-option")[0]),this.loadEventListener())}}},92409:(e,t,i)=>{i.d(t,{Ev:()=>a,V:()=>r,ZF:()=>h});var s=i(93947),n=i(74820);async function a(){if(!("getDigitalGoodsService"in window))return!1;try{return!!(await window.getDigitalGoodsService("https://play.google.com/billing"))}catch(e){return console.log(e),!1}}async function r(e,t){const i=(0,s.pR)("__pat",""),a="premium_monthly",r="product_1",h="com.pixlr."+n.ZP.product;if("getDigitalGoodsService"in window)try{const s=await window.getDigitalGoodsService("https://play.google.com/billing");if(s){if(!("PaymentRequest"in window))return console.log("something went wrong"),!1;{const n=new PaymentRequest([{supportedMethods:"https://play.google.com/billing",data:{sku:e?r:a}}]);try{const c=await n.show();if(await c.complete(),e){let e=await async function(e,t,i,s,n){try{const a=await fetch("/api/purchase/validate/google",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+e},body:JSON.stringify({productId:t,packageName:s,purchaseToken:i,itemId:n})});return null!=(await a.json()).status}catch(a){return console.log(a),!1}}(i,r,c.details.token,h,t);return e?"acknowledge"in s?(console.log("v1"),await s.acknowledge(c.details.token,"repeatable"),!0):(await s.consume(c.details.token),console.log("v2"),!0):(console.log("status false"),!1)}return!!(await o(i,a,c.details.token,h))&&("acknowledge"in s&&await s.acknowledge(c.details.token,"onetime"),!0)}catch(c){return console.log("catch false"),console.log(c),!1}}}}catch(c){return console.log(c),!1}}async function o(e,t,i,s,n=!1){try{const a=await fetch("/api/subscription/validate/google",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+e},body:JSON.stringify({productId:t,packageName:s,purchaseToken:i,freeTrial:n})});return null!=(await a.json()).status}catch(a){return console.log(a),!1}}async function h(){const e=(0,s.pR)("__pat",""),t="com.pixlr."+n.ZP.product;if(!("getDigitalGoodsService"in window))return console.log("no digital good window"),!1;try{const s=await window.getDigitalGoodsService("https://play.google.com/billing");if(!s)return console.log("no playbilling service"),!1;{const n=await s.listPurchases();if(n&&n.length)for(const s of n)try{const i=await fetch("/api/subscription/google/get",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({packageName:t,productId:s.itemId,purchaseToken:s.purchaseToken})}),n=await i.json();if(n&&0===n.data.acknowledgementState){return!!(await o(e,s.itemId,s.purchaseToken,t,!0))}}catch({message:i,response:a}){return console.log(a),!1}}}catch(r){return console.error("Play billing",r),!1}}},99344:(e,t,i)=>{async function s(e,t=5e3,i=3e4){const s=(new Date).getTime()+i,n=(i,a)=>{Promise.resolve(e()).then((e=>{console.log(e);const r=(new Date).getTime();"success"===e.status?i(e):r<s||"pending"===e.status?setTimeout(n,t,i,a):a(new Error("AsyncPoller: reached timeout"))})).catch((e=>{a(e)}))};return new Promise(n)}i.d(t,{n:()=>s})},23770:(e,t,i)=>{i.d(t,{X3:()=>n});var s=i(33655);async function n(){try{return await o.open()}catch(e){return Promise.resolve(new l)}}class a{constructor(e){this.next=()=>this.queue.pop(),this.queue=[new s.L5];let t=this.queue[0];e.onsuccess=()=>{const i=e.result;i?(t.resolve({done:!1,value:i.value}),t=new s.L5,this.queue.unshift(t),i.continue()):t.resolve({done:!0,value:void 0})},e.onerror=()=>{t.reject(e.error)}}[Symbol.asyncIterator](){return this}}class r{constructor(e){this.inner=e}static bound(e,t,i=!1,s=!1){return new r(IDBKeyRange.bound(e,t,i,s))}static lowerBound(e,t){return new r(IDBKeyRange.lowerBound(e,t))}static upperBound(e,t){return new r(IDBKeyRange.upperBound(e,t))}static only(e){return new r(IDBKeyRange.only(e))}static unwrap(e){return e instanceof r?e.inner:e}}class o{constructor(e){this.underlying=e}static availiable(){return!navigator.userAgent.includes("Edge")&&!!window.indexedDB}transaction(e,...t){const i=this.underlying.transaction(t,e);return t.map((e=>new h(i.objectStore(e))))}}o.open=async()=>o.availiable()?new Promise(((e,t)=>{const i=window.indexedDB.open("pixlr",2);i.onupgradeneeded=e=>{const t=i.result;0===e.oldVersion?(t.createObjectStore("blobs"),t.createObjectStore("fonts"),t.createObjectStore("document-meta",{keyPath:"id"}),t.createObjectStore("document-selection"),t.createObjectStore("document-thumbnail"),t.createObjectStore("layer-meta",{keyPath:"id"}).createIndex("document","document"),t.createObjectStore("layer-mask"),t.createObjectStore("layer-bitmap")):t.deleteObjectStore("history")},i.onerror=e=>t(i.error),i.onsuccess=()=>e(new o(i.result))})):Promise.reject(new Error("Browser does not support indexedDB"));class h{constructor(e){this.underlying=e}get(e){return new Promise(((t,i)=>{const s=this.underlying.get(e);s.onsuccess=()=>t(s.result),s.onerror=()=>i(s.error)}))}getAll(e,t){return new Promise(((i,s)=>{const n=this.underlying.getAll(r.unwrap(e),t);n.onsuccess=()=>i(n.result),n.onerror=()=>s(n.error)}))}iterate(e,t){const i=this.underlying.openCursor(r.unwrap(e),t);return new a(i)}index(e){const t=this.underlying.index(e);return new c(t)}cursor(e,t,i){return new Promise(((s,n)=>{const a=this.underlying.openCursor(r.unwrap(t),i);a.onsuccess=()=>{const t=a.result;if(t){const i=e(t.value,t);"number"==typeof i?t.advance(i):!1!==i?t.continue():s()}else s()},a.onerror=()=>n(a.error)}))}put(e,t){return new Promise(((i,s)=>{const n=this.underlying.put(e,t);n.onsuccess=()=>{i()},n.onerror=()=>{s(n.error)}}))}add(e,t){return new Promise(((i,s)=>{const n=this.underlying.add(e,t);n.onsuccess=()=>{i()},n.onerror=()=>{s(n.error)}}))}clear(){return new Promise(((e,t)=>{let i=this.underlying.clear();i.onsuccess=()=>e(),i.onerror=()=>t(i.error)}))}count(e){return new Promise(((t,i)=>{let s;s=void 0===e?this.underlying.count():this.underlying.count(r.unwrap(e)),s.onsuccess=()=>t(s.result),s.onerror=()=>i(s.error)}))}delete(e){return new Promise(((t,i)=>{const s=this.underlying.delete(r.unwrap(e));s.onsuccess=()=>t(),s.onerror=()=>i(s.error)}))}}class c{constructor(e){this.underlying=e,this.name=e.name,this.keyPath=e.keyPath,this.multiEntry=e.multiEntry,this.unique=e.unique}get(e){return new Promise(((t,i)=>{const s=this.underlying.get(e);s.onsuccess=()=>t(s.result),s.onerror=()=>i(s.error)}))}getAll(e,t){return new Promise(((i,s)=>{const n=this.underlying.getAll(r.unwrap(e),t);n.onsuccess=()=>i(n.result),n.onerror=()=>s(n.error)}))}count(e){return new Promise(((t,i)=>{let s;s=void 0===e?this.underlying.count():this.underlying.count(r.unwrap(e)),s.onsuccess=()=>t(s.result),s.onerror=()=>i(s.error)}))}cursor(e,t,i){return new Promise(((s,n)=>{const a=this.underlying.openCursor(r.unwrap(t),i);a.onsuccess=()=>{const t=a.result;t?(e(t.value,t),t.continue()):s()},a.onerror=()=>n(a.error)}))}iterate(e,t){const i=this.underlying.openCursor(r.unwrap(e),t);return new a(i)}getAllKeys(e,t){return new Promise(((i,s)=>{const n=this.underlying.getAllKeys(r.unwrap(e),t);n.onsuccess=()=>i(n.result),n.onerror=()=>s(n.error)}))}}class l{transaction(e,...t){return t.map((e=>new d(e)))}}class d{constructor(e){this.name=e}index(e){return this}put(e,t){}add(e,t){}clear(){}delete(e){}async get(e){}async getAll(e,t){return[]}async count(e){return 0}async cursor(e,t,i){}iterate(e,t){return{next:()=>Promise.resolve({done:!0,value:void 0}),[Symbol.asyncIterator](){return this}}}}},93947:(e,t,i)=>{i.d(t,{FN:()=>c,Rg:()=>h,T:()=>r,ZP:()=>a,b0:()=>l,pR:()=>o});var s=i(96548),n=i(43673);function a(e){return document.getElementById(e)}function r(e,...t){const i=document.createElement(e);if(0===t.length)return i;const s=t[0],n=!("string"==typeof s||s instanceof HTMLElement),a=n?t.slice(1):t;if(n&&s){if(s.style){const e=s.style;delete s.style,"string"==typeof e?i.setAttribute("style",e):Object.assign(i.style,e)}if(s.dataset){const e=s.dataset;delete s.dataset,"object"==typeof e&&Object.entries(e).map((([e,t])=>i.setAttribute(`data-${e}`,t)))}Object.assign(i,s)}return i.append(...a.filter((e=>null!=e))),i}function o(e,t){const i=document.cookie.split(";").map((e=>e.trim().split("="))).find((([t,i])=>t===e));return i?i[1]:t}function h(e,t,i,s){e.style.touchAction="none";const a=e=>{e.stopPropagation(),e.preventDefault(),i&&i(new n.Z(e.clientX,e.clientY))},r=t=>{t.stopPropagation(),t.preventDefault(),s&&s(new n.Z(t.clientX,t.clientY)),e.removeEventListener("pointermove",a,!0),e.removeEventListener("pointerup",r,!0),e.releasePointerCapture(t.pointerId)};e.addEventListener("pointerdown",(i=>{i.preventDefault(),i.button>0||(e.addEventListener("pointermove",a,!0),e.addEventListener("pointerup",r,!0),e.setPointerCapture(i.pointerId),t&&t(new n.Z(i.clientX,i.clientY)))}),!0)}const c=(e="success",t="common-ServerError",i=3,n)=>{let o=t?(0,s.Z)(t):"danger"==e?(0,s.Z)("common-ServerError"):(0,s.Z)("common-success");n&&(o=o.replace("{email}",n)),document.body.append(r("div",{id:"toast-box",className:`toast ${e}`},r("span",r("img",{src:`/images/icon/${e}_alert.svg`})),r("span",{className:"toast-text"},o),r("span",{className:`toast-close ${e}`,style:"line-height: 0;",onclick:()=>{var e;return null===(e=a("toast-box"))||void 0===e?void 0:e.remove()}},r("img",{style:"width: 14px;",src:"/images/icon/close.png"})))),setTimeout((()=>{var e;return null===(e=a("toast-box"))||void 0===e?void 0:e.remove()}),1e3*i)};function l(e,t,i,n=!1){let a=!1;if(t||(t=e.value),"email"===i)(t=t.trim()).match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||n&&""===t?(e.classList.remove("invalid"),e.nextElementSibling.style.display="none"):(a=!0,e.classList.add("invalid"),e.nextElementSibling.style.display="block");else if("password"===i){const i=e.nextElementSibling;t.length<8||t.length>50?(a=!0,e.classList.add("invalid"),i.style.display="block",t.length<8?i.innerHTML=(0,s.Z)("common-MinPassword"):t.length>50&&(i.innerHTML=(0,s.Z)("common-MaxPassword"))):t.indexOf("'")>-1||t.indexOf('"')>-1?(a=!0,e.classList.add("invalid"),i.style.display="block",i.innerHTML=(0,s.Z)("common-InvalidSpecialChar")):(e.classList.remove("invalid"),i.style.display="none")}else if("code"===i){const i=e.nextElementSibling;6!==t.length?(e.classList.add("invalid"),i.style.display="block",a=!0):(e.classList.remove("invalid"),i.style.display="none"),setTimeout((()=>{e.classList.remove("invalid"),i.style.display="none"}),3e3)}return!a}},47163:(e,t,i)=>{i.d(t,{Z:()=>c});var s=i(33655),n=i(23770),a=i(95574),r=i(77758);class o{constructor(e,t,i=!1,s="woff",n,a){this.name=e,this.short=t,this.premium=i,this.local=!!n,this.thumb=a,this.font=n,this.type=s}static async save(e){const t=await(0,n.X3)(),[i]=t.transaction("readwrite","fonts");await i.put(e,e.name)}static async delete(e){const t=await(0,n.X3)(),[i]=t.transaction("readwrite","fonts");await i.delete(e.name)}}class h{static async loadFontFromTemplate(e,t,i){var s,n;let a=null===(s=i.split(".")[0])||void 0===s?void 0:s.toLowerCase(),r=null===(n=i.split(".")[1])||void 0===n?void 0:n.toLowerCase();return await h.createLocalFontDesc(e,t,a,r)}static async loadFontFromUpload(e){var t,i;let s=null===(t=e.name.split(".")[0])||void 0===t?void 0:t.toLowerCase().substring(0,50).replace(" ","-"),n=null===(i=e.name.split(".")[1])||void 0===i?void 0:i.toLowerCase(),a=s.substring(0,20).replace("-","").toLowerCase();if(s=(null==s?void 0:s.charAt(0).toUpperCase())+(null==s?void 0:s.slice(1)),h.fontList.find((e=>e.name===s)))return void document.dispatchEvent(new CustomEvent("notification",{detail:"Font already exists!"}));let r=n;switch(n){case"otf":r="opentype";break;case"ttf":r="truetype"}const o=new Blob([e],{type:"font/"+r});let c=await h.createLocalFontDesc(o,s,a,n);return c&&document.dispatchEvent(new CustomEvent("notification",{detail:"Font was added!"})),c}static async createLocalFontDesc(e,t,i,n){const a=new o(t,i,!1,n,e);try{await h.addToDOM(a)}catch(p){return console.log(p),void document.dispatchEvent(new CustomEvent("notification",{detail:"Failed to load font!"}))}let c=new r.Z(t,56);c.height>72&&c.setSize(Math.floor(72/c.height*56));const l=s.vL(400,80),d=l.getContext("2d");d.font=c.getCssFont(),d.fillStyle="#ffffff",d.textBaseline="top",d.fillText(t,0,Math.round((80-c.height)/2)-c.ascent);var u;return a.thumb=await(u=l,new Promise(((e,t)=>{u.toBlob((t=>{e(t)}),"image/png")}))),await o.save(a),h.fontList.unshift(a),a}static async removeLocalFontDesc(e){let t=h.getFontDesc(e);t&&(await o.delete(t),h.fontList=h.fontList.filter((e=>e!==t)))}static async addToDOM(e){if(!e)return;const t=e.local?new FontFace(e.name,await(0,a.h0)(e.font)):new FontFace(e.name,`url(/font/${e.short}.woff) format('woff')`);if(document.fonts.has(t))return Promise.resolve(t);let i=await t.load();return document.fonts.add(i),i}static getFontDesc(e){return h.fontList.find((t=>t.name===e))}static async getFontFile(e){let t=this.getFontDesc(e);if(!t)return;if(t.local)return new File([t.font],t.name);let i=await fetch("/font/"+t.short+".woff").then((e=>e.blob()));return i?new File([i],t.short+".woff",{type:"font/woff"}):void 0}static async loadSaved(){const e=await(0,n.X3)(),[t]=e.transaction("readonly","fonts");return t.iterate()}}h.fontList=[new o("Arial","arial"),new o("Courier New","courier"),new o("Georgia","georgia"),new o("Trebuchet MS","trebuchet"),new o("Verdana","verdana"),new o("Aberus","aberus"),new o("Ablation","ablation",!0),new o("Adeft","adeft"),new o("Adelya","adelya",!0),new o("Adios Amigos","adios"),new o("Adolfine","adolfine"),new o("Agnostic","agnostic",!0),new o("Aiden","aiden"),new o("Amaranth","amaranth"),new o("Amateur Typewriter","amateur",!0),new o("Alder","alder",!0),new o("Almondia","almondia"),new o("Aloma Island","alomaisland",!0),new o("Alvida","alvida"),new o("Amoreiza","amoreiza"),new o("AmoretteLight","amorette"),new o("Angeleno Brush Script","angeleno",!0),new o("Antreas","antreas"),new o("Arm Race","arm"),new o("Artick","artick"),new o("Asap","asap"),new o("Atomsfer","atomosfer"),new o("Atthens","atthens"),new o("Avocado Sans","avocado",!0),new o("Baangkarr Press","baangkarr",!0),new o("Badstar","badstar",!0),new o("Bahram","bahram"),new o("Baileyns","baileyns"),new o("Barooduck","barooduck",!0),new o("Bearley","bearley"),new o("Beat","beat",!0),new o("BebasNeue","bebasneue"),new o("Bellquinas","bellquinas"),new o("Bengrraas","bengrraas"),new o("Beornheard","beornheard"),new o("Berretti","berretti"),new o("Biker New","biker",!0),new o("Blossom Berry Script","blossomberry",!0),new o("Boullervard","boullervard"),new o("Bondie","bondie",!0),new o("Bondrians","bondrians",!0),new o("Braga Deco","braga"),new o("Brave Hearted","brave"),new o("Bright Orchid","brightorchid",!0),new o("Brioche","brioche",!0),new o("Brocklyn","brocklyn"),new o("Bronzier","bronzier",!0),new o("Brooklyn","brooklyn",!0),new o("Brodetto","brodetto"),new o("Bronela","bronela",!0),new o("The Brownies","brownies"),new o("Bubbble Gum","bubbblegum",!0),new o("Brushcheetah","brushcheetah"),new o("Butternut Script","butternut",!0),new o("Caang","caang"),new o("Cakehtreuks","cakehtreuks"),new o("Cannoli Poke","cannoli",!0),new o("Camille","camille"),new o("Calamandria","calamandria"),new o("Caldwell","caldwell",!0),new o("Carafun","carafun"),new o("Carnavonts","carnavonts"),new o("Carvino","carvino"),new o("Cervantes","cervantes"),new o("Chaiaathah","chaiaathah",!0),new o("Chalkyal","chalkyal"),new o("Chiqarine","chiqarine"),new o("Chukies","chukies"),new o("Cincoyo","cincoyo"),new o("Clockwise","clockwise",!0),new o("Coast Redwood","coast"),new o("Colombo","colombo",!0),new o("College","college",!0),new o("Companion","companion"),new o("Corlombus","corlombus"),new o("Conseration","conseration",!0),new o("CuprumFFU","cuprum"),new o("Cupello sons","cupello",!0),new o("Costa Mala","costamala",!0),new o("Cozy","cozy",!0),new o("CreamyMoony","creamy"),new o("Cross Road","crossroad",!0),new o("Cross Road Slab","crossroadslab",!0),new o("Daddy Day","daddy"),new o("Dankduck","dankduck"),new o("Darbots","darbots",!0),new o("Davish","davish",!0),new o("Davish Rounded","davishround",!0),new o("Dear Journal","dearjournal",!0),new o("Delicious","delicious",!0),new o("Desmodus","desmodus"),new o("Desmosedici","desmosedici"),new o("Dhangdose","dhangdose"),new o("Dingle","dingle",!0),new o("Djangart Rough","djangart"),new o("Dolington","dolington",!0),new o("Doppelganger","doppelganger",!0),new o("Dorr","dorr",!0),new o("Dustin","dustin",!0),new o("Earth And Sky","earth"),new o("Easterica","easterica"),new o("Eastone","eastone"),new o("Eastwood","eastwood",!0),new o("Echizen","echizen"),new o("El-Karnito","elkarnito"),new o("Elliot","elliot"),new o("Elysian","elysian",!0),new o("Emery","emery"),new o("Empire View","empire"),new o("Eugiene","eugiene"),new o("Espano","espano",!0),new o("Erleane","erleane"),new o("Everleigh","everleigh",!0),new o("Exquisite","exquisite",!0),new o("Espano","espano",!0),new o("Farewell Angelina","angelina",!0),new o("Father and Son","father"),new o("Fatherly","fatherly"),new o("Fenord","fenord",!0),new o("Finland","finland",!0),new o("Flamingo","flamingo"),new o("FoxyMist","foxy"),new o("Forever Freedom","forever",!0),new o("Game On","game"),new o("Gamour","gamour",!0),new o("Gallerina","gallerina",!0),new o("Geronide","geronide",!0),new o("Geronide Stamp","geronidestamp",!0),new o("Gingle Snowland","ginglesnowland",!0),new o("Gingerbreads","gingerbreads"),new o("Gladiolusy","gladiolusy",!0),new o("Glamper","glamper",!0),new o("Goldie Dreambox","goldiedreambox",!0),new o("Gordon","gordon",!0),new o("Gorgeous","gorgeous",!0),new o("Gingerly","gingerly",!0),new o("Goorraatt","goorraatt"),new o("Grayson","grayson",!0),new o("Great Again","great"),new o("Grovana","grovana",!0),new o("Gustavo","gustavo"),new o("Haahloddoh","haahloddoh"),new o("Hadrea","hadrea"),new o("Hairmusk","hairmusk"),new o("Hakushou","hakushou"),new o("Harietta","harietta",!0),new o("Hattori Hanzo","hattori"),new o("Haystacks","haystacks",!0),new o("Heater","heater"),new o("Hedonist","hedonist",!0),new o("Hello Alpha","helloa"),new o("Hello Daddy","hellod",!0),new o("Hello People","hello"),new o("Hello Spring","hellospring",!0),new o("Hellowins","hellowins"),new o("Heypatricks","heypatricks"),new o("Highway","highway",!0),new o("Hippo Letto","hippo"),new o("Historia","historia",!0),new o("Hollawind","hollawind"),new o("Hodor","hodor",!0),new o("Honey","honey"),new o("Honeyspice","honeyspice",!0),new o("Huckleberries","huckleberries"),new o("Hymned Sans","hymnedsans",!0),new o("Hymned Script","hymnedscript",!0),new o("IacottNeue","iacottneue",!0),new o("Icebold","icebold",!0),new o("Inder","inder"),new o("Indigo","indigo",!0),new o("Irish gold","irishgold"),new o("Irishgreen","irishgreen"),new o("Its mine","itsmine"),new o("Jacinda","jacinda",!0),new o("Jared","jared"),new o("Jarots","jarots"),new o("Jomantara","jomantara"),new o("Josefin","josefin"),new o("Juneville","juneville"),new o("Jura","jura"),new o("Kajika","kajika"),new o("Kakamora","kakamora"),new o("Katey Blue","kateyblue",!0),new o("Keripik","keripik"),new o("Ketapang","ketapang"),new o("Kindel","kindel",!0),new o("Kingbirds","kingbirds",!0),new o("Laahleggek","laahleggek"),new o("Laborations","laborations"),new o("La Fiesta","lafiesta"),new o("Landon","landon"),new o("Landre","landre",!0),new o("Langley","langley"),new o("La Vonn","vonn"),new o("Laudya Bloods","laudya"),new o("Leaderson","leaderson"),new o("Leath","leath"),new o("Legendum","legendum"),new o("Leobronx","leobronx"),new o("Little Edelweiss","little"),new o("Little Girl","littlegirl"),new o("Lotus Eater","lotuseater",!0),new o("Lobster","lobster"),new o("Lovalicious","lovalicious",!0),new o("Loverstruck","loverstruck"),new o("MaaLLaangBronks","maallaangbronks"),new o("Madison","madison"),new o("Magic Winter","magicwinter"),new o("Magic Trick","magic"),new o("Mai Leho Bahhrala","maileho"),new o("Maldisa","maldisa"),new o("Malinsha","malinsha",!0),new o("Maple Leaves","mapleleaves",!0),new o("Maxton","maxton"),new o("Market","market"),new o("Marones","marones",!0),new o("Me and my dog","meandmydog",!0),new o("Meidy","meidy"),new o("Menighampiil","menighampiil"),new o("Mewton","mewton"),new o("Merry Merry","merrymerry",!0),new o("Molot","molot"),new o("Momday","momday"),new o("Moms Note","moms"),new o("Monday Lovers","monday"),new o("Monetta","monetta"),new o("Mongli","mongli"),new o("Montour","montour"),new o("Morissette Script","morissette"),new o("Mountain","mountain"),new o("Mooka","mooka",!0),new o("More Magic","moremagic",!0),new o("Morgana Sonz","morgana",!0),new o("Nature Force","natureforce",!0),new o("Ms Orange Sky","ms"),new o("Najova","najova"),new o("Natarajasana","natarajasana"),new o("Naville","naville"),new o("Neorah","neorah"),new o("New Autumn","new"),new o("No Siesta","nosiesta"),new o("Night Jump","nightjump"),new o("Notes","notes",!0),new o("NoFire","nofire"),new o("North Avellion","northavellion",!0),new o("Northern","northern"),new o("North High Shadow","northhighsdw",!0),new o("North High","northhigh",!0),new o("Novante","novante",!0),new o("Nunu","nunu"),new o("Offlander","offlander",!0),new o("Oliemolly","oliemolly",!0),new o("Oracles","oracles"),new o("Ostern","ostern"),new o("Otakaku","otakaku"),new o("Out Hill","out"),new o("Overdose","overdose"),new o("Paabaalioot","paabaalioot"),new o("Painted Gallery","paintedgallery",!0),new o("Pandoura","pandoura"),new o("PapaRocknRoll","papa"),new o("Paradise","paradise"),new o("Patlabour","patlabour",!0),new o("Peach Market","peachmarket",!0),new o("Peanut","peanut"),new o("Peony Rose","peonyrose",!0),new o("Perfect Thoughts","perfectthoughts",!0),new o("Pina Colada","pinacolada",!0),new o("Piqolo","piqolo"),new o("Pixelo","pixelo"),new o("Plunge","plunge"),new o("Pop Fist","pop"),new o("Ponch","ponch",!0),new o("Popera","popera"),new o("Powder","powder",!0),new o("Practish","practish"),new o("Print Clearly","print"),new o("Pulsate","pulsate",!0),new o("Qlassik","qlassik"),new o("quatro","quatro",!0),new o("Quattrocento","quattrocento"),new o("Queenata","queenata"),new o("Quella Script","quella"),new o("Questro","questro"),new o("Quickie Sweet","quickie"),new o("Quill & Ink","quillink"),new o("Quish","quish"),new o("Ranania","ranania"),new o("Rankings Caps","rankingscaps",!0),new o("Raroedette","raroedette"),new o("Rawwwing","rawwwing"),new o("Raquella","raquella"),new o("Reepouh","reepouh"),new o("Regan Slab","regan"),new o("Reewoooh","reewoooh",!0),new o("Reilly","reilly"),new o("Remembrance","remembrance",!0),new o("Retrocycles","retrocycles"),new o("Retros","retros"),new o("Revans","revans",!0),new o("Reynolds Square","reynoldssquare",!0),new o("Rhapsody","rhapsody"),new o("Riverside","riverside"),new o("Republiko","republiko",!0),new o("Rocky","rocky"),new o("Roars","roars"),new o("Rockford","rockford",!0),new o("Rockrace","rockrace",!0),new o("Romaniesta","romaniesta"),new o("Romelio","romelio"),new o("Roossooh","roossooh"),new o("Ropa","ropa"),new o("Rolves","rolves",!0),new o("Roque","roque"),new o("Rosario","rosario"),new o("Roundaries","roundaries"),new o("Rowan","rowan",!0),new o("Salmonberry","salmonberry",!0),new o("San Barley","san"),new o("Saqanone","saqanone"),new o("Sants","sants"),new o("Sanur beach","sanur"),new o("Scriptonesia","scriptonesia",!0),new o("Secretary Typewriter","secretary",!0),new o("Sedalia","sedalia",!0),new o("Search","search",!0),new o("Searchlight","searchlight",!0),new o("See De Mayo","see"),new o("Serenity","serenity"),new o("The Servant","servant"),new o("Sheraton","sheraton",!0),new o("Shoelaces","shoelaces",!0),new o("Silvertone","silvertone",!0),new o("Smoother","smoother",!0),new o("Spring Break","springbreak",!0),new o("Spotlights Thin","spotlightsthin",!0),new o("Spotlights Chunky","spotlightschunky",!0),new o("Squiborn","squiborn",!0),new o("Staatliches","staatliches"),new o("Stardust Moonlight","stardust"),new o("The Stoothgart","stoothgart"),new o("Summer Coconut","summer"),new o("Summer Joy","summerjoy"),new o("Summer Nude","summernude",!0),new o("Summer Peach","summerpeach"),new o("Summer Solstice","summersolstice",!0),new o("Summery","summery"),new o("Sun Again","sunagain"),new o("Sun Pepper","sun"),new o("Sun Streets","sunstreets"),new o("Sunny Bay","sunnybay",!0),new o("Sunshine Boy","sunshine"),new o("Super Slayers","super"),new o("Surface","surface"),new o("Sweeneey","sweeneey"),new o("Teaspoon","teaspoon"),new o("Tabu","tabu"),new o("Teodore","teodore",!0),new o("TeXGyreHeros","texgyreheros"),new o("The Brocker","brocker"),new o("The California","thecalifornia"),new o("The Harison","harison"),new o("The Love For Money","theloveformoney",!0),new o("The Mastiff","mastiff"),new o("The Patriot","patriot"),new o("The Pinta","pinta"),new o("The Roxv","roxv"),new o("The Rogue","rogue"),new o("The Stegris","thestegris",!0),new o("The Queen","queen"),new o("Thirtylane","thirtylane",!0),new o("Titian","titian"),new o("Todes","todes",!0),new o("Tropical Coast","tropicalcoast"),new o("Torberta","torberta"),new o("Twigs","twigs"),new o("Twirly Ballerina","twirly",!0),new o("Unreal","unreal"),new o("Vaganza","vaganza"),new o("Valeria","valeria",!0),new o("Valery","valery"),new o("Vignette","vignette"),new o("Von Everect","von"),new o("The Voyager","voyager",!0),new o("Wandering Flowers","wandering",!0),new o("Wargate","wargate",!0),new o("Western Shooter","westernshooter",!0),new o("West Java","westjava",!0),new o("Winter Sunrise","wintersunrise",!0),new o("White Wonder","whitewonder",!0),new o("Yanone Kaffeesatz","kaffeesatz"),new o("Wonderul Wilderness","wonderulwilderness",!0),new o("Yoseline","yoseline"),new o("Zombie Dust","zombie")],h.loadFont=e=>{let t=h.fontList.find((t=>t.name===e));if(t)return h.addToDOM(t)};const c=h},95574:(e,t,i)=>{async function s(e,t){return new Promise(((i,s)=>{var n=new XMLHttpRequest,a=!1;n.responseType="arraybuffer",n.withCredentials=!1,n.open("GET",e,!0),n.onprogress=function(e){e.lengthComputable?t&&t(e.loaded/e.total*100):a||(a=!0,t&&t(-1))},n.onloadend=function(){n.status.toString().match(/^2/)?(a||t&&t(100),i(new Blob([this.response],{type:n.getResponseHeader("Content-Type")}))):s(n)},n.send()}))}function n(e){return new Promise(((t,i)=>{let s=new Image;s.onload=()=>t(s),s.onerror=e=>i(e),s.src=e}))}function a(e){return new Promise(((t,i)=>{const s=new FileReader;s.onerror=()=>i(s.error),s.onloadend=()=>t(s.result),s.readAsArrayBuffer(e)}))}function r(e){return new Promise((async(t,i)=>{const s=URL.createObjectURL(e);let n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{URL.revokeObjectURL(s),n.width+n.height==0?i("Could not open file!"):t(n)},n.onerror=function(){URL.revokeObjectURL(s),i("Could not open file!")},n.name=e instanceof File?e.name:"",n.src=s}))}i.d(t,{OA:()=>n,c6:()=>s,h0:()=>a,s4:()=>r})},75934:(e,t,i)=>{i.d(t,{$k:()=>F,Av:()=>B,Hi:()=>D,Q0:()=>I,ZB:()=>_,d3:()=>N});var s=i(96548),n=i(93947),a=i(33655),r=i(4375),o=i(95574),h=i(9591),c=i(36817),l=i(82542),d=i(98776),u=i(43673),p=i(56584),g=i(39868),m=i(71030),v=i(74820),f=i(44170),y=i(78685),w=i(87108),x=i(51294),b=i(82282),Z=i(84253),k=i(77359),E=i(77758),P=i(44686),S=i(68934),C=i(9067),L=i(47163),T=(i(45453),i(33506)),M=i(58027),A=i(32804);function I(e,t=!1){return new Promise(((i,s)=>{(0,n.ZP)("browse")&&(0,n.ZP)("browse").remove();let a=document.createElement("input");a.id="browse",a.type="file",a.multiple=e,a.className="offscreen",t&&(a.accept="image/*",a.capture="camera"),a.addEventListener("change",(()=>{a.files.length>0?i(a.files):i(void 0),(0,n.ZP)("workspace").removeChild(a)}),!1),(0,n.ZP)("workspace").appendChild(a),a.click()}))}async function R(e){await async function(e,t,i=3e4){let s=!1;for(let n=0;n<document.head.childNodes.length;n++){const t=document.head.childNodes[n];if(t.nodeType===Node.ELEMENT_NODE&&t.getAttribute("src")===e){s=!0;break}}s||document.head.appendChild((0,n.T)("script",{src:e}));let r=0;for(;!t();){if(r>=i)throw new Error(`Timeout triggered when loading script ${e}`);const t=500;r+=t,await a.Dc(t)}}("/js/psd.js",(()=>window.require&&window.require("psd")));const t=window.require("psd"),i=await new Response(e).arrayBuffer(),s=new t(new Uint8Array(i));return s.parse(),s}async function _(e,t,s=!0,n="add"){var r,h;if(t){const u=null!==(r=t.type)&&void 0!==r?r:"";(0,m.Z)("open-file",u);try{switch(u){case"image/psd":case"application/psd":case"application/photoshop":case"application/x-photoshop":case"image/vnd.adobe.photoshop":(0,m.Z)("open-file","image/psd"),await U(e,t,n);break;case"image/tiff":await async function(e,t,s){const n=await async function(e){const t=(await i.e(2556).then(i.t.bind(i,74166,23))).default,s=await(0,o.h0)(e);return t.initialize({TOTAL_MEMORY:2*s.byteLength}),new t({buffer:s})}(t);let a=t.name.replace(/^.*[\\\/]/,"");e.addImage(n.toCanvas(),a,"add")}(e,t);break;default:const r=null===(h=t.name)||void 0===h?void 0:h.toLowerCase();if(r){if(r.endsWith(".psd"))return(0,m.Z)("open-file","image/psd"),void(await U(e,t,n));if(r.endsWith(".pxd"))return(0,m.Z)("open-file","image/pxd"),void(await async function(e,t,s){document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));const{PXD:n}=await Promise.all([i.e(2646),i.e(5215)]).then(i.bind(i,28132)),r=await(0,o.h0)(t),h=n.decode(new Uint8Array(r)),l=new M.Z(a.M8(),t.name,h.width,h.height,void 0,void 0,void 0,s);try{e.supressRender=!0,e.addTab(l,"document");for(let t=0;t<h.layers;t++){const t=h.takeNextLayer(),i=t.width,s=t.height;switch(t.kind){case"bitmap":case"shape":{if(0===i||0===s){const i=new b.Z(a.M8(),t.name,void 0,void 0,!1);i.settings.opacity=t.alpha,i.settings.blendmode=t.blendMode,i.settings.visible=t.visible,i.settings.locked=t.locked,e.fresco.layers.push(i),t.free();continue}const n=a.vL(i,s),r=n.getContext("2d"),o=t.takeCanvas();r.putImageData(new ImageData(o,i,s),0,0);const h=new b.Z(a.M8(),t.name,n,new c.Z(t.x,t.y,i,s,t.rotation),t.locked);h.settings.opacity=t.alpha,h.settings.blendmode=t.blendMode,h.settings.visible=t.visible;const l=t.takeMask();if(l.length>0){const e=a.vL(i,s);e.getContext("2d").putImageData(new ImageData(l,i,s),0,0),h.mask=e,h.render()}e.fresco.layers.push(h);break}case"text":{const n=JSON.parse(t.meta),r=new E.Z(n.textSettings.font,n.textSettings.size);Object.assign(r,n.textSettings);const o=new y.Z(a.M8(),n.text,new c.Z(t.x,t.y,i,s,t.rotation),r);o.settings.opacity=t.alpha,o.settings.blendmode=t.blendMode,o.settings.visible=t.visible,await L.Z.loadFont(r.font),r.measureText(),await o.prepare(),e.fresco.layers.push(o)}}t.free()}}finally{h.free(),e.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}return await e.syncDocument(e.fresco),e.selectLayer(e.fresco.layers[0]),e.setZoom("fit"),document.dispatchEvent(new CustomEvent("layer-list-render")),Promise.reject()}(e,t,n));if(r.endsWith(".pxz"))return(0,m.Z)("open-file","image/pxz"),void(await z(e,t,void 0,n));if(r.endsWith(".svg")&&"frame"!==n)return(0,m.Z)("open-file","image/svg+xml"),void(await async function(e,t,i=!0,s="add"){let n=await t.text();e.addSVGShape(n,t.name,s)}(e,t,s,n));if(r.endsWith(".otf")||r.endsWith(".ttf")||r.endsWith(".woff")||r.endsWith(".woff2"))return(0,m.Z)("open-file","font/"+t.name.split(".")[1]),void(await L.Z.loadFontFromUpload(t))}await async function(e,t,i=!0,s){const n=await(0,o.s4)(t);let r,h,d="e"===v.ZP.product&&i||"e"!==v.ZP.product?"create":"layer";if(("x"===v.ZP.product||"drop"===s)&&(d=i&&e.fresco?await(new g.Z).init():e.fresco?"layer":"create","close"===d))return;if(v.ZP.askToPreResize&&"m"!==v.ZP.product&&"create"===d&&(n.width>2500||n.height>2500)){if([r,h]=await new p.Z(n,await l.Z.rotation(t)).init(),void 0===r)return}else r=c.Z.bestFit(n.width,n.height,"premium"===(null===T.a||void 0===T.a?void 0:T.a.subscriptionAccess)?8196:4096,"premium"===(null===T.a||void 0===T.a?void 0:T.a.subscriptionAccess)?8196:4096).size(),h=0;let u=a.qT(n,r.width>r.height?r.width:r.height,h),m=t.name?t.name:n.src.replace(/^.*[\\\/]/,"");"create"===d&&e.addTab(new M.Z(a.M8(),m,u.width,u.height,void 0,void 0,void 0,s),"image");e.addImage(u,m,s)}(e,t,s,n)}}catch(d){throw document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),d}}else document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}async function D(e,t){let i=await A._y(t);await F(e,i)}async function F(e,t){(0,m.Z)("template-"+t.category,t.id);const{url:i,purchased:n}=await A.cI(t.id),a=new r.Z({title:t.name,referrer:(0,s.Z)("templates")});let o=await a.load(i);if(!o)return;let h={locked:t.premium&&"premium"!==(null===T.a||void 0===T.a?void 0:T.a.subscriptionAccess),premium:t.premium,templateId:t.id,category:t.category};n&&(h.locked=!1);try{(0,m.Z)("open-file","image/pxz"),await z(e,o,h)}catch(c){throw document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),c}}async function z(e,t,s,n){const{ZipReader:r}=await Promise.all([i.e(2646),i.e(5215)]).then(i.bind(i,28132));let o;try{e.supressRender=!0;let i=await t.arrayBuffer();o=new r(new Uint8Array(i));let c=o.readString("manifest.json"),l=JSON.parse(c);const d=new M.Z(a.M8(),l.name,l.width,l.height,l.background,l.animation,s,n);e.addTab(d,"template"),document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));try{let t=o.readFile("thumbnail.webp"),i=await a.Td(new Blob([t.buffer]));e.renderPreview(i)}catch(h){console.log(h)}let p=await O(l,new u.Z,o);e.fresco.layers.push(...p),await e.syncDocument(e.fresco)}catch(c){return console.log(c),void alert("Error while loading PXZ file :(")}finally{null==o||o.free(),e.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}e.selectLayer(e.fresco.layers[0]),e.setZoom("fit"),document.dispatchEvent(new CustomEvent("layer-list-render"))}async function N(e,t){let i;document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));let s=new u.Z;try{const n=await fetch(t),a=await n.json();s.x=Math.round((e.fresco.width-a.width)/2),s.y=Math.round((e.fresco.height-a.height)/2),i=await O(a,s)}catch(n){console.log(n),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}i&&0!==i.length&&(e.addLayer(i),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")))}async function O(e,t=new u.Z,i,s){var n;let r=new Array;if(e.stack)for(let l=0;l<e.stack.length;l++){let u=e.stack[l];switch(u.type){case f.Z.TYPE_IMAGE:case f.Z.TYPE_ELEMENT:{let e,n=u.rect?new c.Z(u.rect.x+t.x,u.rect.y+t.y,u.rect.w,u.rect.h,u.rect.r):void 0;if(void 0!==u.content)if(i){let t=i.readFile(u.content);t&&(e=await a.Td(new Blob([t.buffer])))}else{let t=await(0,o.c6)(s+u.content);t&&(e=await a.Td(t))}let h=new b.Z(a.M8(),u.name,e,n,u.locked);if(void 0!==u.opacity&&(h.settings.opacity=u.opacity),void 0!==u.blendmode&&(h.settings.blendmode=u.blendmode),void 0!==u.locked&&(h.settings.locked=u.locked),void 0!==u.visible&&(h.settings.visible=u.visible),void 0!==u.animation&&(h.animation=u.animation),void 0!==u.macro&&(h.macro=u.macro),void 0!==u.mask&&i){let e=i.readFile(u.mask);e&&(h.mask=await a.Td(new Blob([e.buffer]))),h.render()}r.push(h);break}case f.Z.TYPE_TEXT:{if(!u.format)continue;let e=new E.Z(null===(n=u.format.font)||void 0===n?void 0:n.name,u.format.size);void 0!==u.format.align&&(e.align=u.format.align),void 0!==u.format.bold&&(e.bold=u.format.bold),void 0!==u.format.italic&&(e.italic=u.format.italic),void 0!==u.format.underline&&(e.underline=u.format.underline),void 0!==u.format.uppercase&&(e.uppercase=u.format.uppercase),void 0!==u.format.linespace&&(e.lineSpace=u.format.linespace),void 0!==u.format.letterspace&&(e.letterSpace=u.format.letterspace);let l=new y.Z(a.M8(),u.content,new c.Z(u.rect.x+t.x,u.rect.y+t.y,u.rect.w,u.rect.h,u.rect.r),e);if(void 0!==u.opacity&&(l.settings.opacity=u.opacity),void 0!==u.blendmode&&(l.settings.blendmode=u.blendmode),void 0!==u.locked&&(l.settings.locked=u.locked),void 0!==u.visible&&(l.settings.visible=u.visible),void 0!==u.animation&&(l.animation=u.animation),void 0!==u.macro&&(l.macro=u.macro),e.font){let t=L.Z.getFontDesc(e.font);if(!t&&u.format.font.content){let e;e=i?new Blob([i.readFile(u.format.font.content)]):await(0,o.c6)(s+u.format.font.content),e&&(t=await L.Z.loadFontFromTemplate(e,u.format.font.name,u.format.font.content))}else t&&await L.Z.addToDOM(t);e.measureText()}if(u.style&&(u.style.curve&&(l.textSettings.curve=!0,void 0!==u.style.curve.type&&(l.textSettings.curveType=u.style.curve.type),void 0!==u.style.curve.amount&&(l.textSettings.curveAmount=u.style.curve.amount),void 0!==u.style.curve.spread&&(l.textSettings.curveSpread=u.style.curve.spread),void 0!==u.style.curve.flip&&(l.textSettings.curveFlip=u.style.curve.flip)),u.style.warp&&(l.textSettings.warp=!0,void 0!==u.style.warp.type&&(l.textSettings.warpType=u.style.warp.type),void 0!==u.style.warp.mode&&(l.textSettings.warpMode=u.style.warp.mode),void 0!==u.style.warp.edgesize&&(l.textSettings.warpEdgeSize=u.style.warp.edgesize),void 0!==u.style.warp.centersize&&(l.textSettings.warpCenterSize=u.style.warp.centersize),void 0!==u.style.warp.verticaloffset&&(l.textSettings.warpVerticalOffset=u.style.warp.verticaloffset),void 0!==u.style.warp.horizontaloffset&&(l.textSettings.warpHorizontalOffset=u.style.warp.horizontaloffset)),u.style.background&&(l.textSettings.background=!0,void 0!==u.style.background.color&&(l.textSettings.backgroundColor=u.style.background.color),void 0!==u.style.background.type&&(l.textSettings.backgroundType=u.style.background.type),void 0!==u.style.background.punch&&(l.textSettings.backgroundPunch=u.style.background.punch),void 0!==u.style.background.offset&&(l.textSettings.backgroundOffset=u.style.background.offset)),u.style.outline&&(l.textSettings.outline=!0,void 0!==u.style.outline.size&&(l.textSettings.outlineSize=u.style.outline.size),void 0!==u.style.outline.color&&(l.textSettings.outlineColor=u.style.outline.color),void 0!==u.style.outline.punch&&(l.textSettings.outlinePunch=u.style.outline.punch),void 0!==u.style.outline.distance&&(l.textSettings.outlineDistance=u.style.outline.distance),void 0!==u.style.outline.direction&&(l.textSettings.outlineDirection=u.style.outline.direction)),u.style.shadow&&(l.textSettings.shadow=!0,void 0!==u.style.shadow.blur&&(l.textSettings.shadowBlur=u.style.shadow.blur),void 0!==u.style.shadow.color&&(l.textSettings.shadowColor=u.style.shadow.color),void 0!==u.style.shadow.opacity&&(l.textSettings.shadowAlpha=u.style.shadow.opacity),void 0!==u.style.shadow.distance&&(l.textSettings.shadowDistance=u.style.shadow.distance),void 0!==u.style.shadow.direction&&(l.textSettings.shadowDirection=u.style.shadow.direction))),void 0!==u.format.fill){let e;switch(u.format.fill.type){case"color":e=new h.Z(d.Z.fromHEX(u.format.fill.value));break;case"gradient":e=new h.Z(k.ZP.fromIGradient(u.format.fill.value));break;case"pattern":let t=u.format.fill.value;if(i)t.svg=i.readString(t.svg);else{let e=await(0,o.c6)(s+t.svg);e&&(t.svg=await e.text())}e=new h.Z(await C.Z.fromIPattern(t))}l.textSettings.fillType=e.getType(),l.textSettings.fillValue=e.getStringValue(),l.fill=e}await l.prepare(),l.settings.name=u.name,r.push(l);break}case f.Z.TYPE_SHAPE:{let e=new P.Z;if(e.variant=u.format?u.format.variant:"svg","svg"===e.variant){let t;if(u.content)if(i)t=i.readString(u.content);else{let e=await(0,o.c6)(s+u.content);e&&(t=await e.text())}if(!t)continue;e.content=t}"path"===e.variant&&(e.content=u.content),u.style&&(u.style.outline&&(void 0!==u.style.outline.size&&(e.outlineSize=u.style.outline.size),void 0!==u.style.outline.color&&(e.outlineColor=u.style.outline.color)),u.style.shadow&&(e.shadow=!0,void 0!==u.style.shadow.blur&&(e.shadowBlur=u.style.shadow.blur),void 0!==u.style.shadow.color&&(e.shadowColor=u.style.shadow.color),void 0!==u.style.shadow.opacity&&(e.shadowOpacity=u.style.shadow.opacity),void 0!==u.style.shadow.distance&&(e.shadowDistance=u.style.shadow.distance),void 0!==u.style.shadow.direction&&(e.shadowDirection=u.style.shadow.direction)));let n=new w.Z(a.M8(),u.name,new c.Z(u.rect.x+t.x,u.rect.y+t.y,u.rect.w,u.rect.h,u.rect.r),e);if(void 0!==u.opacity&&(n.settings.opacity=u.opacity),void 0!==u.blendmode&&(n.settings.blendmode=u.blendmode),void 0!==u.locked&&(n.settings.locked=u.locked),void 0!==u.visible&&(n.settings.visible=u.visible),void 0!==u.animation&&(n.animation=u.animation),void 0!==u.macro&&(n.macro=u.macro),void 0!==u.format){if(void 0!==u.format.fill){let e;switch(u.format.fill.type){case"color":e=new h.Z(d.Z.fromHEX(u.format.fill.value));break;case"gradient":e=new h.Z(k.ZP.fromIGradient(u.format.fill.value));break;case"pattern":let t=u.format.fill.value;if(i)t.svg=i.readString(t.svg);else{let e=await(0,o.c6)(s+t.svg);e&&(t.svg=await e.text())}e=new h.Z(await C.Z.fromIPattern(t))}n.shapeSettings.fillType=e.getType(),n.shapeSettings.fillValue=e.getStringValue(),n.fill=e}u.format.radii&&(n.shapeSettings.radii=u.format.radii)}await n.prepare(),r.push(n);break}case f.Z.TYPE_FRAME:{let e=new x.Z(a.M8(),u.name,new c.Z(u.rect.x+t.x,u.rect.y+t.y,u.rect.w,u.rect.h,u.rect.r));if(void 0!==u.opacity&&(e.settings.opacity=u.opacity),void 0!==u.blendmode&&(e.settings.blendmode=u.blendmode),void 0!==u.locked&&(e.settings.locked=u.locked),void 0!==u.visible&&(e.settings.visible=u.visible),void 0!==u.animation&&(e.animation=u.animation),void 0!==u.macro&&(e.macro=u.macro),u.frame&&(void 0!==u.frame.trim&&(e.trim=new c.Z(u.frame.trim.x,u.frame.trim.y,u.frame.trim.w,u.frame.trim.h)),void 0!==u.frame.clip&&(e.frameSettings.clip=u.frame.clip)),u.content)if(i){let t=i.readFile(u.content);t&&(e.canvas=await a.Td(new Blob([t.buffer])))}else{let t=await(0,o.c6)(s+u.content);t&&(e.canvas=await a.Td(t))}u.style&&(u.style.outline&&(e.frameSettings.outline=!0,void 0!==u.style.outline.size&&(e.frameSettings.outlineSize=u.style.outline.size),void 0!==u.style.outline.color&&(e.frameSettings.outlineColor=u.style.outline.color)),u.style.shadow&&(e.frameSettings.shadow=!0,void 0!==u.style.shadow.blur&&(e.frameSettings.shadowBlur=u.style.shadow.blur),void 0!==u.style.shadow.color&&(e.frameSettings.shadowColor=u.style.shadow.color),void 0!==u.style.shadow.opacity&&(e.frameSettings.shadowOpacity=u.style.shadow.opacity),void 0!==u.style.shadow.distance&&(e.frameSettings.shadowDistance=u.style.shadow.distance),void 0!==u.style.shadow.direction&&(e.frameSettings.shadowDirection=u.style.shadow.direction))),e.prepare(),r.push(e);break}case f.Z.TYPE_GROUP:{let e=new Z.Z(a.M8(),u.name,new S.Z);void 0!==u.meta&&(void 0!==u.meta.color&&(e.groupSettings.color=u.meta.color),void 0!==u.meta.collapsed&&(e.groupSettings.collapsed=u.meta.collapsed),void 0!==u.meta.members&&(e.groupSettings.numberOfMembers=u.meta.members)),void 0!==u.opacity&&(e.settings.opacity=u.opacity),void 0!==u.locked&&(e.settings.locked=u.locked),void 0!==u.visible&&(e.settings.visible=u.visible),void 0!==u.animation&&(e.animation=u.animation),void 0!==u.macro&&(e.macro=u.macro);break}}}return r}async function B(e,t,i,s=!0,n){let r,o,h="e"===v.ZP.product&&s||"e"!==v.ZP.product?"create":"layer";if(("x"===v.ZP.product||"drop"===n)&&(h=s&&e.fresco?await(new g.Z).init():e.fresco?"layer":"create","close"===h))return;if(v.ZP.askToPreResize&&"m"!==v.ZP.product&&"create"===h&&(t.width>2500||t.height>2500)){if([r,o]=await new p.Z(t,0).init(),void 0===r)return}else r=c.Z.bestFit(t.width,t.height,"premium"===(null===T.a||void 0===T.a?void 0:T.a.subscriptionAccess)?8196:4096,"premium"===(null===T.a||void 0===T.a?void 0:T.a.subscriptionAccess)?8196:4096).size(),o=0;let l=a.qT(t,r.width>r.height?r.width:r.height,o);"create"===h&&e.addTab(new M.Z(a.M8(),i,l.width,l.height,void 0,void 0,void 0,n),"image"),e.addImage(l,i,n)}async function U(e,t,i){document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));const s=await R(t),n=s.tree(),r=new M.Z(a.M8(),t.name,s.header.cols,s.header.rows,void 0,void 0,void 0,i);try{e.supressRender=!0,e.addTab(r,"document");let t=n.descendants();for(let i=t.length-1;i>=0;i--){const s=t[i];if(!s.isGroup())try{const n=new c.Z(s.layer.left,s.layer.top,s.layer.width,s.layer.height),r=s.get("typeTool");let o;if(r){const e=r.export();let t=e.font.sizes?e.font.sizes[0]:12;const i=e.font.name.trim(),s=new E.Z(i.substr(0,i.length-1),t);o=new y.Z(a.M8(),e.value.trim(),n.clone(),s),o.textSettings.fillType="color",o.textSettings.fillValue=new d.Z(e.font.colors[0][0],e.font.colors[0][1],e.font.colors[0][2],e.font.colors[0][3]).toHEX(),o.prepare()}else{const e=await new Promise(((e,t)=>{const i=s.toPng();i.onload=()=>e(i),i.onerror=e=>t(e)}));let r=a.qT(e,4096);o=new b.Z(a.M8(),s.layer.name,r,n,i==t.length-1)}const h={norm:"source-over",dark:"darken",lite:"lighten",hue:"hue",sat:"saturation",colr:"color",lum:"luminosity",mul:"multiply",scrn:"screen",diss:"source-over",over:"overlay",hLit:"hard-light",sLit:"soft-light",diff:"difference",smud:"exclusion",div:"color-doge",idiv:"color-burn",lbrn:"source-over",lddg:"source-over",vLit:"source-over",lLit:"source-over",pLit:"source-over",hMix:"source-over",pass:"source-over",dkCl:"source-over",lgCl:"source-over",fsub:"source-over",fdiv:"source-over"};o.settings.blendmode=h[s.layer.blendMode.blendKey]||"source-over",o.settings.visible=s.layer.visible,o.settings.opacity=s.layer.opacity/255,e.fresco.layers.push(o)}catch(o){console.log("pxd layer read",o)}}e.selectLayer(e.fresco.layers[0]),await e.syncDocument(e.fresco)}catch(o){throw e.close(r.id),o}finally{e.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}e.setZoom("fit"),document.dispatchEvent(new CustomEvent("layer-list-render"))}},47630:(e,t,i)=>{i.d(t,{BI:()=>v,DD:()=>b,Zp:()=>g,b4:()=>Z,f1:()=>m,iM:()=>y,sj:()=>w,vV:()=>f});var s=i(93947),n=i(33655),a=i(77359),r=i(71030),o=i(98776),h=i(44170),c=i(9067),l=i(93409),d=i(77664),u=i(47163),p=i(87282);function g(){return void 0!==window.showSaveFilePicker}async function m(e,t,i,s="image/png"){try{return await window.showSaveFilePicker({suggestedName:e+"."+t,types:[{description:i,accept:{[s]:["."+t]}}]})}catch(n){return console.log(n,n.name),"AbortError"!==n.name&&void 0}}async function v(e,t){try{const i=await e.createWritable();await i.write(t),await i.close()}catch(i){return console.log(i),!1}return!0}function f(e,t,i){let n=(0,s.T)("a",{id:"download-link"});window.document.body.append(n),n.download=t+"."+i,n.href=URL.createObjectURL(e),void 0===n.download?window.location=n.href:n.click(),n.remove()}async function y(e,t,s=e.fresco){const{ZipWriter:r}=await Promise.all([i.e(2646),i.e(5215)]).then(i.bind(i,28132)),l="pixel"!==t.unit,p=s.color&&"component"!==t.type?s.color:void 0;let g=(e,t)=>0==t?e:g(t,e%t),m=e=>l?e/s.width:e,v=e=>l?e/s.height:e;const f=g(s.width,s.height),y=l?s.width/f:s.width,x=l?s.height/f:s.height;let b={id:t.id,name:t.name,type:t.type,unit:t.unit,width:y,height:x,background:p,stack:new Array};s.animation&&(b.animation=s.animation);const Z=new Array,k=new Array,E=e.getOutputCanvas(s);if("template"===t.type&&e.fresco===s){const t=n.Ai(E,Math.round(s.width*(640/s.height)),640),i=await new Promise((e=>t.toBlob(e,"image/webp",90)));if(Z.push(new File([i],"preview.webp")),e.fresco.hasAnimation()){const t=300/x,i=await w(e,24,t,!0);Z.push(new File([i],"preview.mp4"))}}const P="component"===t.type?480:350,S=n.Ai(E,Math.round(s.width*(P/s.height)),P),C=await new Promise((e=>S.toBlob(e,"image/webp",70)));Z.push(new File([C],"thumbnail.webp"));for(let i=0;i<s.layers.length;i++){let e=s.layers[i];if("document"!==t.type&&!e.settings.visible||!e.rect)continue;if("template"===t.type&&"group"===e.type)continue;const r=n.Zd();let l={name:e.settings.name,type:e.type,rect:e.rect?{x:m(e.rect.x),y:v(e.rect.y),w:m(e.rect.width),h:v(e.rect.height),r:Number(e.rect.rotation.toFixed(2))}:void 0,blendmode:""!==e.settings.blendmode?e.settings.blendmode:void 0,opacity:Math.round(100*e.settings.opacity)/100,locked:e.settings.locked,visible:e.settings.visible,link:e.settings.link};switch(e.animation&&(l.animation=e.animation),e.macro&&(l.macro=e.macro),e.type){case h.Z.TYPE_ELEMENT:case h.Z.TYPE_IMAGE:l.type=h.Z.TYPE_IMAGE;let i=e.canvas;if(e instanceof d.Z&&e.rect&&i&&(e.rect.width===i.width&&e.rect.height===i.height||(i=n.Ai(i,e.rect.width,e.rect.height))),e.mask){let t=n.Zd();const i=await new Promise((t=>e.mask.toBlob(t,"image/webp",60)));Z.push(new File([i],t+".webp")),l.mask=t+".webp"}if(i){const e=await new Promise((e=>i.toBlob(e,t.nonDestructive?"image/png":"image/webp",t.quality)));Z.push(new File([e],r+(t.nonDestructive?".png":".webp"))),l.content=r+(t.nonDestructive?".png":".webp")}break;case h.Z.TYPE_TEXT:let s=e,p=u.Z.getFontDesc(s.textSettings.font);if(p&&!k.find((e=>e.name===p.name))&&k.push(p),l.content=s.text,l.format={size:v(s.textSettings.size),align:s.textSettings.align,bold:s.textSettings.bold,italic:s.textSettings.italic,underline:s.textSettings.underline,uppercase:s.textSettings.uppercase,linespace:s.textSettings.lineSpace,letterspace:s.textSettings.letterSpace,font:{name:s.textSettings.font,content:p?p.short+"."+p.type:""}},s.fill&&s.fill.value&&(l.format.fill={type:s.fill.getType()},s.fill.value instanceof o.Z&&(l.format.fill.value=s.fill.value.toHEX()),s.fill.value instanceof a.ZP&&(l.format.fill.value=s.fill.value.toIGradient()),s.fill.value instanceof c.Z)){let e=n.Zd();Z.push(new File([new Blob([s.fill.value.svg],{type:"image/svg+xml;charset=utf-8"})],e+".svg")),l.format.fill.value=s.fill.value.toIPattern(e+".svg")}(s.textSettings.curve||s.textSettings.warp||s.textSettings.background||s.textSettings.outline||s.textSettings.shadow)&&(l.style={},s.textSettings.warp&&(l.style.warp={type:s.textSettings.warpType,mode:s.textSettings.warpMode,edgesize:s.textSettings.warpEdgeSize,centersize:s.textSettings.warpCenterSize,verticaloffset:s.textSettings.warpVerticalOffset,horizontaloffset:s.textSettings.warpHorizontalOffset}),s.textSettings.curve&&(l.style.curve={type:s.textSettings.curveType,amount:s.textSettings.curveAmount,spread:s.textSettings.curveSpread,flip:s.textSettings.curveFlip}),s.textSettings.background&&(l.style.background={type:s.textSettings.backgroundType,color:s.textSettings.backgroundColor,punch:s.textSettings.backgroundPunch,offset:s.textSettings.backgroundOffset}),s.textSettings.outline&&(l.style.outline={size:s.textSettings.outlineSize,color:s.textSettings.outlineColor,punch:s.textSettings.outlinePunch,distance:s.textSettings.outlineDistance,direction:s.textSettings.outlineDirection}),s.textSettings.shadow&&(l.style.shadow={blur:s.textSettings.shadowBlur,color:s.textSettings.shadowColor,opacity:s.textSettings.shadowAlpha,distance:s.textSettings.shadowDistance,direction:s.textSettings.shadowDirection}));break;case h.Z.TYPE_SHAPE:let g=e;if("svg"===g.shapeSettings.variant)g.shapeSettings.content&&(Z.push(new File([new Blob([g.shapeSettings.content],{type:"image/svg+xml;charset=utf-8"})],r+".svg")),l.content=r+".svg"),l.format={variant:g.shapeSettings.variant};else if(l.content=g.shapeSettings.content,l.format={variant:g.shapeSettings.variant},0!==g.shapeSettings.radii&&(l.format.radii=g.shapeSettings.radii),g.fill&&g.fill.value&&(l.format.fill={type:g.fill.getType()},g.fill.value instanceof o.Z&&(l.format.fill.value=g.fill.value.toHEX()),g.fill.value instanceof a.ZP&&(l.format.fill.value=g.fill.value.toIGradient()),g.fill.value instanceof c.Z)){let e=n.Zd();Z.push(new File([new Blob([g.fill.value.svg],{type:"image/svg+xml;charset=utf-8"})],e+".svg")),l.format.fill.value=g.fill.value.toIPattern(e+".svg")}(g.shapeSettings.shadow||g.shapeSettings.outlineSize>0)&&(l.style={},g.shapeSettings.outlineSize>0&&(l.style.outline={size:g.shapeSettings.outlineSize,color:g.shapeSettings.outlineColor}),g.shapeSettings.shadow&&(l.style.shadow={blur:g.shapeSettings.shadowBlur,color:g.shapeSettings.shadowColor,opacity:g.shapeSettings.shadowOpacity,distance:g.shapeSettings.shadowDistance,direction:g.shapeSettings.shadowDirection}));break;case h.Z.TYPE_FRAME:let f=e;if(f.canvas){!f.trim||f.trim.width===f.canvas.width&&f.trim.height===f.canvas.height||(f.canvas=n.Ai(f.canvas,f.trim.width,f.trim.height));const e=await new Promise((e=>f.canvas.toBlob(e,"image/webp",t.quality)));Z.push(new File([e],r+".webp")),l.content=r+".webp"}l.frame={trim:f.trim?{x:m(f.trim.x),y:v(f.trim.y),w:m(f.trim.width),h:v(f.trim.height),r:0}:void 0,clip:f.frameSettings.clip},(f.frameSettings.outline||f.frameSettings.shadow)&&(l.style={},f.frameSettings.outline&&(l.style.outline={size:f.frameSettings.outlineSize,color:f.frameSettings.outlineColor}),f.frameSettings.shadow&&(l.style.shadow={blur:f.frameSettings.shadowBlur,color:f.frameSettings.shadowColor,opacity:f.frameSettings.shadowOpacity,distance:f.frameSettings.shadowDistance,direction:f.frameSettings.shadowDirection}));break;case h.Z.TYPE_GROUP:let y=e;l.meta={members:y.groupSettings.numberOfMembers,collapsed:y.groupSettings.collapsed,color:y.groupSettings.color}}b.stack.push(l)}let L=new r;L.writeString("manifest.json",JSON.stringify(b),!0);for(let i=0;i<Z.length;i++){const e=Z[i];let t=await e.arrayBuffer(),s=new Uint8Array(t);L.writeFile(e.name,s,e.name.endsWith(".svg"))}for(let i=0;i<k.length;i++){const e=k[i];let t=await u.Z.getFontFile(e.name);if(t){let i=await t.arrayBuffer(),s=new Uint8Array(i);L.writeFile(e.short+"."+e.type,s,!0)}}const T=L.finish();return new Blob([T.buffer])}function w(e,t,s,a,o){return function(e){let t;try{return t=new window.VideoEncoder({output:()=>{},error:()=>{}}),t.configure({width:16,height:16,codec:e,hardwareAcceleration:"prefer-software",framerate:30,bitrate:4e6}),!0}catch(i){return!1}finally{null==t||t.close()}}("avc1.420034")?((0,r.Z)("video-encode","fast"),function(e,t,s,a,r){let o,h;const c=new n.k3((()=>new Promise((async(n,c)=>{try{const{Mp4:d}=await Promise.all([i.e(2646),i.e(8132)]).then(i.bind(i,28132)),u=1e6;h=new d(u);const p=Math.round(u/t),g=new l.Z(e,t,s,!1,a);let m=0,v=!1,f=null;o=new VideoEncoder({output:(e,t)=>{if(v)return void console.error("Unexpected frames to process");if(null===f&&"key"===e.type){const e=new Uint8Array(t.decoderConfig.description);f=h.addVideoTrack(t.decoderConfig.codedWidth,t.decoderConfig.codedHeight,e)}const i=new Uint8Array(e.byteLength);e.copyTo(i),h.addFrame(f,p*m,p,0,"key"===e.type,i),m+=1,r&&r(m/g.totalFrames),m===g.totalFrames&&(v=!0,n(new Blob([h.fetchFile()],{type:"video/mp4"})))},error:e=>{console.error(e),c(e)}});let y=await g.requestFrame();const w=x(y.width,y.height,t);for(o.configure({width:y.width,height:y.height,codec:"avc1.420034",hardwareAcceleration:"prefer-software",framerate:t,bitrate:w});y;){const e=new VideoFrame(y,{timestamp:p*(g.currentFrame-1),duration:p});o.encode(e),e.close(),y=await g.requestFrame()}await o.flush()}catch(d){console.error(d)}finally{try{null==o||o.close()}catch(u){}}}))),(()=>{try{null==o||o.close(),null==h||h.free()}catch(e){}}));return c}(e,t,s,a,o)):((0,r.Z)("video-encode","slow"),function(e,t,i,s,a){const r=new p.Y3,o=new n.k3((async()=>{try{const h=new l.Z(e,t,i,!1,s);let c,d,u=await h.requestFrame();for(;u;){const e=await new Promise(((e,t)=>{u.toBlob((t=>e(t)),"image/jpeg",.92)})),t=await new Promise(((t,i)=>{const s=new FileReader;s.onload=()=>t(new Uint8Array(s.result)),s.readAsArrayBuffer(e)}));if(o.isCanceled())throw new n.Mk;r.send({type:"addFile",name:`${h.currentFrame}.jpeg`,data:t},[t.buffer]),c=u.width,d=u.height,a&&a(h.currentFrame/h.totalFrames/2),u=await h.requestFrame()}const p=x(c,d,t);for(r.send({type:"run",arguments:["-r",t.toFixed(0),"-f","image2","-s",`${c}x${d}`,"-i","%d.jpeg","-start_number","1","-vframes",h.totalFrames.toFixed(0),"-vcodec","libx264","-crf","23","-vb",p.toFixed(0),"-pix_fmt","yuv420p","-preset","ultrafast","out.mp4"]});;){const e=await r.receive();switch(e.type){case"progress":a&&a(e.frame/h.totalFrames/2+.5);break;case"result":return new Blob([e.data],{type:"video/mp4"})}}}finally{null==r||r.terminate()}}),(()=>{null==r||r.terminate()}));return o}(e,t,s,a,o))}function x(e,t,i,s=.18){return Math.round(e*t*i*s)}function b(e,t,i,s,a,r,o,h){const c=new p.Bm;return new n.k3((async()=>{try{let n=new l.Z(e,t,i,r,o),d=Math.round(100/t/s),u=await n.requestFrame();for(c.send({type:"start",width:u.width,height:u.height,repeat:a}),await c.receive();u;){let e=u.getContext("2d").getImageData(0,0,u.width,u.height);h&&h(n.currentFrame/n.totalFrames);const t=c.receive();c.send({type:"frame",buffer:e,delay:d},[e.data.buffer]),u=await n.requestFrame(),await t}c.send({type:"done"});const p=await c.receive();if("result"!==p.type)throw new Error("No file");return new Blob([p.message])}finally{c.terminate()}}),(()=>{null==c||c.terminate()}))}async function Z(e,t){const s=await i.e(4500).then(i.bind(i,99055)),n=await s.PDFDocument.create(),a=n.addPage([e.fresco.width,e.fresco.height]),r=await n.embedJpg(await t.arrayBuffer());return a.drawImage(r,{x:0,y:0,width:e.fresco.width,height:e.fresco.height}),new Blob([await n.save()])}},32804:(e,t,i)=>{async function s(e,t={},i){const s=function(e,t={}){const i=[];for(var s in t)i.push(`${s}=${encodeURIComponent(t[s].toString())}`);return 0===i.length?e:`${e}?${i.join("&")}`}(`https://${function(){const e=window.location.hostname;return"localhost"===e?"pixlr.com":"dev.pixlr.com"===e||"staging.pixlr.com"===e||"dev-robert.pixlr.com"===e?e:"pixlr.com"}()}`+e,t),n=await fetch(s,{method:i||"GET"}),a=n.headers.get("content-type");if(a&&-1===a.indexOf("application/json"))return;const r=await n.json();if(!1===r.status)throw new Error(r.message);return r.data}i.d(t,{Pi:()=>h,Qz:()=>n,RH:()=>r,_y:()=>a,cI:()=>o});const n=(e={})=>s("/api/templates/",Object.assign({features:"image,text,shape,frame,group,animation"},e)),a=e=>s(`/api/templates/${e}/`),r=(e,t)=>s(`/api/templates/collections/${e}/?limit=${t}`),o=e=>s(`/api/templates/${e}/download/`),h=(e={})=>s("/api/templates/favorites/",e)},13049:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(e,t,i){this.framebuffer=e,this.renderbuffer=t,this.texture=i}destroy(e){e.deleteFramebuffer(this.framebuffer),e.deleteRenderbuffer(this.renderbuffer),e.deleteTexture(this.texture)}}},32673:(e,t,i)=>{i.d(t,{Z:()=>n});var s=i(82381);class n{constructor(e,t,i){this.uniform={},this.attribute={},this.texture=new Map,this.program=e.createProgram(),e.attachShader(this.program,this.compile(e,t,e.VERTEX_SHADER)),e.attachShader(this.program,this.compile(e,i,e.FRAGMENT_SHADER)),e.linkProgram(this.program),e.useProgram(this.program),e.getProgramParameter(this.program,e.LINK_STATUS)||console.log(e.getProgramInfoLog(this.program));const n=this.collect(t,"attribute");for(const[s,c]of n)this.attribute[s]=e.getAttribLocation(this.program,s);let a=[];const r=this.collect(t,"uniform");for(const[s,c]of r)this.uniform[s]=e.getUniformLocation(this.program,s);const o=this.collect(i,"uniform");for(const[s,c]of o)this.uniform[s]=e.getUniformLocation(this.program,s),"sampler2D"===c&&a.push(s);for(var h in a){let t=a[h],i=e.getUniformLocation(this.program,t);"texture"===t?(e.uniform1i(i,0),this.texture.set(0,new s.Z(t))):(e.uniform1i(i,1),this.texture.set(1,new s.Z(t)))}}collect(e,t){const i=[],s=new RegExp("\\b"+t+" (\\w+) (\\w+)","ig");return e.replace(s,(function(e,t,s){return i.push([s,t]),e})),i}compile(e,t,i){var s=e.createShader(i);return e.shaderSource(s,t),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)?s:(console.log(e.getShaderInfoLog(s)),console.log(t),null)}getTextureById(e){let t=null;return this.texture.forEach((function(i){i.id!==e||(t=i)})),t||(console.error("Having no texture that is named `%s`.",e),null)}destroy(e){e.deleteProgram(this.program),this.texture.forEach((function(t){t.destroy(e)})),this.texture.clear()}}},4256:(e,t,i)=>{i.d(t,{Z:()=>g});var s=i(43673),n=i(98776),a=i(82381),r=i(32673),o=i(71030),h=i(94084),c=i(13049),l=i(9389),d=i(92672),u=i(71662),p=i(60134);class g{constructor(e){this.drawShader=0,this.sourceTexture=null,this.vertexBuffer=null,this.debug=!1,this.lastInChain=!1,this.currentFramebufferIndex=0,this.tempFramebuffers={},this.width=-1,this.height=-1,this.lastTextureSlot=-1,this.handleContextLost=()=>{null==this.canvas&&(this.canvas=document.createElement("canvas")),this.initContext()},this.getError=()=>{this.debug&&this.ctx.getError()},this.addShader=(e,t,i=!1)=>{if("fill"==e&&0==t.amount||"toning"==e&&0==t.amount||"levels"==e&&t.isFlat()||null==t||0===t)this.removeShader(e,i);else{for(var s=0;s<this.chain.length;s++)if(this.chain[s].type===e&&this.chain[s].sidekick===i)return void(this.chain[s].value=t);this.chain.push(new m(e,t,i))}},this.getShaderValue=e=>{for(var t=0;t<this.chain.length;t++)if(this.chain[t].type==e)return this.chain[t].value},this.addPreset=(e,t=1)=>{const i=d.Z.named(e);i&&(1!==t?i.forEach((e=>{switch(e.name){case"curves":{const i=e.value,s=p.z.createCurveSet(i);s.percent=t,this.addShader(e.name,s);break}case"levels":{const i=e.value,s=new u.Z(Math.round(i.minin*t),Math.round(255-(255-i.maxin)*t));this.addShader(e.name,s);break}case"toning":{const i=e.value,s=new l.Z(i.highlight,i.midtone,i.shadow,i.amount*t);this.addShader(e.name,s);break}case"fill":{const i=e.value,s=new h.Z(i.color,i.blend,i.amount*t);this.addShader(e.name,s);break}default:this.addShader(e.name,e.value*t)}})):i.forEach((e=>this.addShader(e.name,e.value))))},this.removeShaderSidekick=()=>{let e=new Array;for(var t=0;t<this.chain.length;t++)this.chain[t].sidekick||e.push(this.chain[t]);this.chain=e},this.removeShader=(e,t=!1)=>{for(var i=0;i<this.chain.length;i++)if(this.chain[i].type===e&&this.chain[i].sidekick===t)return void this.chain.splice(i,1)},this.runShader=(e,t)=>{switch(e){case"vibrance":return this.vibrance(t);case"brightness":return this.brightness(t);case"temperature":return this.temperature(t);case"balance":return this.balance(t);case"tint":return this.tint(t);case"colorize":return this.colorize(t);case"grain":return this.grain(t);case"noise":return this.noise(t);case"vignette":return this.vignette(t);case"sharpen":return this.sharpen(t);case"blur":return this.blur(t);case"zoom":return this.zoom(t);case"bokeh":return this.bokeh(t);case"gaussian":return this.gaussian(t);case"motion":return this.motion(t);case"radial":return this.radial(t);case"smooth":return this.smooth(t);case"denoise":return this.denoise(t);case"contrast":return this.contrast(t);case"monochrome":return this.monochrome(t);case"desaturate":return this.desaturate();case"invert":return this.invert();case"exposure":return this.exposure(t);case"highlights":return this.highlights(t);case"shadows":return this.shadows(t);case"dehaze":return this.dehaze(t);case"curves":return this.curves(t);case"toning":return this.toning(t);case"lookup":return this.lookup(t);case"fill":return this.fill(t);case"bwpoint":return this.bwpoint(t);case"levels":return this.levels(t);case"multilevels":return this.multilevels(t);case"threshold":return this.threshold(t);case"bloom":return this.bloom(t);case"glamour":return this.glamour(t);case"mimichdr":return this.mimicHDR(t);case"posterize":return this.posterize(t);case"fringe":return this.fringe(t);case"pixelate":return this.pixelate(t);case"clarity":return this.clarity(t);case"mosaic":return this.mosaic(t);case"polarcoordinates":return this.polarcoordinates(t);case"kaleidoscope":return this.kaleidoscope(t);case"reflect":return this.reflect(t);case"wave":return this.wave(t);case"fisheye":return this.fisheye(t);case"scanlines":return this.scanlines(t);case"dealiasing":return this.dealiasing();case"alpha-reset":return this.alphaReset();case"alpha-invert":return this.alphaInvert();case"alpha-mask":return this.alphaMask();case"alpha-shift-mask":return this.alphaShiftMask();case"outer-glow":return this.outerGlow(t);case"inner-glow":return this.innerGlow(t);case"sobel":return this.sobel();case"solarize":return this.solarize();case"halftone":return this.halftone(t);case"stroke":return this.stroke(t);case"bevel":return this.bevel(t);case"border":return this.border(t);case"rgb-split":return this.rgbSplit(t);case"slice":return this.slice(t);case"bleed":return this.bleed(t);case"interference":return this.interference(t);case"hue":return this.hue(t);case"hue-red":return this.hue(t,317,46);case"hue-yellow":return this.hue(t,17,106);case"hue-green":return this.hue(t,77,166);case"hue-cyan":return this.hue(t,137,226);case"hue-blue":return this.hue(t,197,286);case"hue-magenta":return this.hue(t,257,346);case"saturation":return this.saturation(t);case"saturation-red":return this.saturation(t,317,46);case"saturation-yellow":return this.saturation(t,17,106);case"saturation-green":return this.saturation(t,77,166);case"saturation-cyan":return this.saturation(t,137,226);case"saturation-blue":return this.saturation(t,197,286);case"saturation-magenta":return this.saturation(t,257,346);case"lightness":return this.lightness(t);case"lightness-red":return this.lightness(t,317,46);case"lightness-yellow":return this.lightness(t,17,106);case"lightness-green":return this.lightness(t,77,166);case"lightness-cyan":return this.lightness(t,137,226);case"lightness-blue":return this.lightness(t,197,286);case"lightness-magenta":return this.lightness(t,257,346);case"melt":return this.melt(t);case"gooey":return this.gooey(t);case"block":return this.block(t);case"curtain":return this.curtain(t);case"blinds":return this.blinds(t);case"wipe":return this.wipe(t);case"slot":return this.slot(t);case"split":return this.split(t);case"circular":return this.circular(t);case"ripple":return this.ripple(t);case"warp":return this.warp(t);case"swipe":return this.swipe(t);case"marquee":return this.marquee(t);default:return console.error("We don't have this type shader, "+e)}},this.reset=()=>{this.chain=[],this.compiledProgram.forEach((function(e){e.destroy(this.ctx)}),this),this.compiledProgram.clear(),this.sourceTexture&&(this.activeSourceTexture=void 0,this.sourceTexture.destroy(this.ctx),this.sourceTexture=null);for(let e in this.tempFramebuffers){this.tempFramebuffers[e].destroy(this.ctx)}this.tempFramebuffers={}},this.apply=(e,t=!1)=>{if(0==this.chain.length)return e;this.resize(e.width,e.height),this.drawShader=0,this.sourceTexture&&this.width==e.width&&this.height==e.height||(this.sourceTexture&&(this.sourceTexture.destroy(this.ctx),this.sourceTexture=null),this.sourceTexture=new a.Z("texture"),this.sourceTexture.createTexture(this.ctx,e.width,e.height)),(e!==this.activeSourceTexture||t)&&(this.sourceTexture.uploadData(this.ctx,e),this.activeSourceTexture=e);for(var i=0;i<this.chain.length;i++)this.lastInChain=i==this.chain.length-1,this.runShader(this.chain[i].type,this.chain[i].value);return this.currentFramebufferIndex=0,this.canvas},this.resize=(e,t)=>{if(e!=this.width||t!=this.height){if(this.canvas.width=this.width=e,this.canvas.height=this.height=t,!this.vertexBuffer){var i=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,-1,1,0,1,1,-1,1,0,1,1,1,1]);this.ctx||this.initContext(),this.vertexBuffer=this.ctx.createBuffer(),this.ctx.bindBuffer(this.ctx.ARRAY_BUFFER,this.vertexBuffer),this.ctx.bufferData(this.ctx.ARRAY_BUFFER,i,this.ctx.STATIC_DRAW)}this.ctx.viewport(0,0,this.width,this.height);for(let e in this.tempFramebuffers){this.tempFramebuffers[e].destroy(this.ctx)}this.tempFramebuffers={}}},this.getTempFramebuffer=e=>(this.tempFramebuffers[e]=this.tempFramebuffers[e]||this.createFramebufferTexture(this.width,this.height),this.tempFramebuffers[e]),this.createFramebufferTexture=(e,t)=>{let i=this.ctx.createFramebuffer();this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,i);let s=this.ctx.createRenderbuffer();this.ctx.bindRenderbuffer(this.ctx.RENDERBUFFER,s),this.ctx.renderbufferStorage(this.ctx.RENDERBUFFER,this.ctx.DEPTH_COMPONENT16,e,t);let n=this.ctx.createTexture();return this.ctx.bindTexture(this.ctx.TEXTURE_2D,n),this.ctx.texImage2D(this.ctx.TEXTURE_2D,0,this.ctx.RGBA,e,t,0,this.ctx.RGBA,this.ctx.UNSIGNED_BYTE,null),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_MAG_FILTER,this.ctx.NEAREST),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_MIN_FILTER,this.ctx.NEAREST),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_WRAP_S,this.ctx.CLAMP_TO_EDGE),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_WRAP_T,this.ctx.CLAMP_TO_EDGE),this.ctx.framebufferTexture2D(this.ctx.FRAMEBUFFER,this.ctx.COLOR_ATTACHMENT0,this.ctx.TEXTURE_2D,n,0),this.ctx.framebufferRenderbuffer(this.ctx.FRAMEBUFFER,this.ctx.DEPTH_ATTACHMENT,this.ctx.RENDERBUFFER,s),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),new c.Z(i,s,n)},this.draw=(e,t=!1)=>{if((this.chain.length<=1||this.lastInChain)&&!t)this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null);else{let e=this.getTempFramebuffer(this.currentFramebufferIndex);this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,e.framebuffer)}this.ctx.uniform4f(e.uniform.transform,1,1,0,0),this.ctx.clear(this.ctx.COLOR_BUFFER_BIT),this.ctx.clearColor(0,0,0,0),this.setTexture(e.texture),this.ctx.drawArrays(this.ctx.TRIANGLES,0,6),this.drawShader++,this.currentFramebufferIndex^=1,this.getError()},this.setTexture=e=>{let t=-1;e.forEach((function(e,i){if(this.ctx.activeTexture(this.ctx.TEXTURE0+i),0===i&&0===this.drawShader)this.ctx.bindTexture(this.ctx.TEXTURE_2D,this.sourceTexture.texture);else if(0===i){let e=1^this.currentFramebufferIndex,t=this.getTempFramebuffer(e);this.ctx.bindTexture(this.ctx.TEXTURE_2D,t.texture)}else this.ctx.bindTexture(this.ctx.TEXTURE_2D,e.texture);t=Math.max(t,i)}),this);for(let i=t+1;i<=this.lastTextureSlot;++i)this.ctx.activeTexture(this.ctx.TEXTURE0+i),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null);this.lastTextureSlot=t},this.cleanUp=()=>{this.sourceTexture=null,this.canvas=null,this.ctx=null},this.compileShader=(e,t=this.VERTEX_IDENTITY)=>{let i=new r.Z(this.ctx,t,e);var s=Float32Array.BYTES_PER_ELEMENT;return this.ctx.enableVertexAttribArray(i.attribute.apos),this.ctx.vertexAttribPointer(i.attribute.apos,2,this.ctx.FLOAT,!1,4*s,0*s),this.ctx.enableVertexAttribArray(i.attribute.auv),this.ctx.vertexAttribPointer(i.attribute.auv,2,this.ctx.FLOAT,!1,4*s,2*s),i},this.VERTEX_IDENTITY="\n        precision highp float;\n        attribute vec2 apos;\n        attribute vec2 auv;\n        varying vec2 uv;\n        uniform vec4 transform;\n\n        void main(void) {\n            uv = auv;\n            gl_Position = vec4(apos.x * transform.x + transform.z, apos.y * transform.y + transform.w, 0.0, 1.0);\n        }",this.FRAGMENT_IDENTITY="\n        precision highp float;\n        varying vec2 uv;\n        uniform sampler2D texture;\n\n        void main(void) {\n            gl_FragColor = texture2D(texture, uv);\n        }",this.GAUSSKERN_MAX=15,this.cloneChain=()=>{var e,t,i;const s=[];for(let n=0;n<this.chain.length;n++){const a=this.chain[n];let r;switch(a.type){case"curves":{const e=a.value,t=e.rgb.map((e=>e.clone())),i=e.red.map((e=>e.clone())),s=e.green.map((e=>e.clone())),n=e.blue.map((e=>e.clone()));r=new p.Z(e.scale,t,i,s,n);break}case"levels":{const e=a.value;r=new u.Z(e.minin,e.maxin,e.minout,e.maxout,e.midin,e.mid);break}case"toning":{const s=a.value;r=new l.Z(null===(e=s.highlight)||void 0===e?void 0:e.clone(),null===(t=s.midtone)||void 0===t?void 0:t.clone(),null===(i=s.shadow)||void 0===i?void 0:i.clone(),s.amount);break}case"fill":{const e=a.value;r=new h.Z(e.color.clone(),e.blend,e.amount);break}default:r=a.value}s.push(new m(a.type,r))}return s},this.chain=e||[],this.compiledProgram=new Map,this.canvas=document.createElement("canvas"),this.initContext(),this.canvas.addEventListener("webglcontextlost",this.handleContextLost,!1)}initContext(){this.ctx=this.canvas.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1}),this.ctx||(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("webgl"),(0,o.Z)("weg-gl-pre-error")),this.ctx||(console.log("Could not get shaders webgl canvas context!"),(0,o.Z)("weg-gl-error"))}bevel(e){let t=this.compiledProgram.get("bevel");if(!t){let e="\n                precision highp float;\n\n                varying vec2 uv;\n                \n                uniform float zeroPoint;\n                uniform vec3 lightNormal;\n                uniform float dz;\n                uniform float size;\n\n                uniform vec4 lowColor;\n                uniform vec4 highColor;\n                \n                uniform sampler2D dist;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n                \n                void main() {                    \n                    vec2 flipuv = vec2(uv.x, 1.0 - uv.y);\n                                         \n                    /* PER PIXEL OPS */\n                    float tl = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x, -px.y)).a);\n                    float tm = clamp(0.0, size, texture2D(dist, flipuv + vec2(    0, -px.y)).a);\n                    float tr = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x, -px.y)).a);\n                \n                    float ml = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x,     0)).a);\n                    float mr = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x,     0)).a);\n                \n                    float bl = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x,  px.y)).a);\n                    float bm = clamp(0.0, size, texture2D(dist, flipuv + vec2(    0,  px.y)).a);\n                    float br = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x,  px.y)).a);\n                \n                    float dx = (tr + 2.0 * mr + br) - (tl + 2.0 * ml + bl);\n                    float dy = (bl + 2.0 * bm + br) - (tl + 2.0 * tm + tr);\n                \n                    vec3 surfaceNormal = vec3(dx, dy, dz);\n                    float norm = sqrt(dx*dx + dy*dy + dz*dz);\n                \n                    // Calculate incident light amount, range [-1, 0]\n                    float incidentLight = ((dot(surfaceNormal, lightNormal) / norm) - zeroPoint) - (1.0 - zeroPoint);\n                    \n                    vec4 slopes = mix(lowColor, highColor, 1.0 - abs(incidentLight));\n                    \n                    // Texture\n                    vec4 color = texture2D(texture, uv);\n\n                    // Bevel color, only use the the color where we need it\n                    float alpha = smoothstep(1e-5, dz + 8.0, distance(vec3(0.0,0.0,dz), surfaceNormal));\n                    vec4 bevelColor = vec4(slopes.rgb, slopes.a * alpha);\n\n                    gl_FragColor = straightBlend(\n                        bevelColor,\n                        color\n                    );\n                }";t=this.compileShader(e),this.compiledProgram.set("bevel",t)}this.ctx.useProgram(t.program);t.getTextureById("dist").setTexture(e.distanceMap);const i=Math.sin(e.lightElevation);this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(t.uniform.zeroPoint,i),this.ctx.uniform3f(t.uniform.lightNormal,Math.cos(e.lightElevation)*-Math.cos(e.lightAngle),Math.cos(e.lightElevation)*-Math.sin(e.lightAngle),i),this.ctx.uniform4f(t.uniform.lowColor,e.lowLightColor.r/255,e.lowLightColor.g/255,e.lowLightColor.b/255,e.lowOpacity),this.ctx.uniform4f(t.uniform.highColor,e.highLightColor.r/255,e.highLightColor.g/255,e.highLightColor.b/255,e.highOpacity),this.ctx.uniform1f(t.uniform.dz,1/e.depth),this.ctx.uniform1f(t.uniform.size,e.size),this.draw(t)}stroke(e){const t="stroke"+(e.cutout?"-cutout":"");let i=this.compiledProgram.get(t);if(!i){let s=`\n                precision highp float;\n\n                #define CUTOUT ${e.cutout?1:0}\n\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n\n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float gAlpha = 1.0-smoothstep(size - 3.0, size, distance);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        gAlpha * glowColor.a\n                    );\n\n                    vec4 texColor = texture2D(texture, uv);\n\n                    #if CUTOUT == 1\n                        vec4 tran = vec4(0);\n                        gl_FragColor = mix(gColor, tran, texColor.a);\n                    #else\n                        gl_FragColor = straightBlend(texColor, gColor);                    \n                    #endif\n                }\n            `;i=this.compileShader(s),this.compiledProgram.set(t,i)}this.ctx.useProgram(i.program),this.ctx.uniform4f(i.uniform.glowColor,e.color.r/255,e.color.g/255,e.color.b/255,e.opacity);i.getTextureById("distanceMap").setTexture(e.distanceMap),this.ctx.uniform1f(i.uniform.size,e.size),this.draw(i)}innerGlow(e){let t=this.compiledProgram.get("innerglow");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n                uniform float feather;\n\n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float balance = 1.0-smoothstep(size * (1.0-feather), size, distance);\n\n                    vec4 texColor = texture2D(texture, uv);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        texColor.a\n                    );\n                       \n                    gl_FragColor = mix(texColor, gColor, balance * glowColor.a);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("innerglow",t)}this.ctx.useProgram(t.program),this.ctx.uniform4f(t.uniform.glowColor,e.color.r/255,e.color.g/255,e.color.b/255,e.opacity);t.getTextureById("distanceMap").setTexture(e.distanceMap),this.ctx.uniform1f(t.uniform.size,e.size),this.ctx.uniform1f(t.uniform.feather,e.feather),this.draw(t)}outerGlow(e){let t=this.compiledProgram.get("outerglow");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n                uniform float feather;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n                \n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float gAlpha = 1.0-smoothstep(size * (1.0-feather), size, distance);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        gAlpha * glowColor.a\n                    );\n\n                    vec4 texColor = texture2D(texture, uv);\n                    \n                    gl_FragColor = straightBlend(texColor, gColor);                    \n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("outerglow",t)}this.ctx.useProgram(t.program),this.ctx.uniform4f(t.uniform.glowColor,e.color.r/255,e.color.g/255,e.color.b/255,e.opacity);t.getTextureById("distanceMap").setTexture(e.distanceMap),this.ctx.uniform1f(t.uniform.size,e.size),this.ctx.uniform1f(t.uniform.feather,e.feather),this.draw(t)}sobel(){let e=this.compiledProgram.get("sobel");if(!e){let t="\n                precision mediump float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                uniform float m[3];\n                #define M_PI 3.1415926535897932384626433832795\n                #define GET_PIXEL(x,y) (texture2D(texture, uv + px*vec2(x,y)))\n\n                void main() {\n\n                    float dx = (length(GET_PIXEL(-1, -1)*m[0] +\n                                GET_PIXEL(-1,  0)*m[1] +\n                                GET_PIXEL(-1, +1)*m[2]) -\n                            length(GET_PIXEL(+1, -1)*m[0] +\n                                GET_PIXEL(+1,  0)*m[1] +\n                                GET_PIXEL(+1, +1)*m[2]));\n\n                    float dy = (length(GET_PIXEL(-1, -1)*m[0] +\n                                GET_PIXEL(0, -1)*m[1] +\n                                GET_PIXEL(+1, -1)*m[2]) -\n                            length(GET_PIXEL(-1, +1)*m[0] +\n                                GET_PIXEL(0, +1)*m[1] +\n                                GET_PIXEL(+1, +1)*m[2]));\n\n                    float theta = (atan(dy, dx) + M_PI) / (2.0*M_PI);\n\n                    gl_FragColor = vec4(length(vec2(dx, dy)), theta, 0.0, 1.0);\n                }";e=this.compileShader(t),this.compiledProgram.set("sobel",e)}if(this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform1fv(e.uniform.m,[1,2,1]),this.draw(e,!0),e=this.compiledProgram.get("sobelNMS"),!e){let t="\n                precision mediump float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                #define M_PI 3.1415926535897932384626433832795\n\n                void main() {\n                    vec4 cc = texture2D(texture, uv);  \n                    float theta = degrees(cc.y*M_PI*2.0); \n                    int ax = 0, ay = 0; \n                    if ((theta >= 337.5) || (theta < 22.5)) { ax = 1; ay = 0; } \n                    else if ((theta >= 22.5) && (theta < 67.5)) { ax = 1; ay = 1; } \n                    else if ((theta >= 67.5) && (theta < 112.5)) { ax = 0; ay = 1; } \n                    else if ((theta >= 112.5) && (theta < 157.5)) { ax =-1; ay = 1; } \n                    else if ((theta >= 157.5) && (theta < 202.5)) { ax =-1; ay = 0; } \n                    else if ((theta >=202.5) && (theta < 247.5)) { ax =-1; ay =-1; } \n                    else if ((theta >=247.5) && (theta < 292.5)) { ax = 0; ay =-1; } \n                    else if ((theta >= 292.5) && (theta < 337.5)) { ax = 1; ay =-1; }\n                \n                    vec4 ca = texture2D(texture, uv + px*vec2(ax, ay));\n                    vec4 cb = texture2D(texture, uv + px*vec2(-ax, -ay));\n                    gl_FragColor = vec4((((cc.x <= ca.x) || (cc.x < cb.x)) ? vec3(0) : vec3(cc.x)), 1.0);\n                }";e=this.compileShader(t),this.compiledProgram.set("sobelNMS",e)}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.draw(e)}vibrance(e){let t=this.compiledProgram.get("vibrance");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n\n                    vec4 col = texture2D(texture, uv.xy);\n                    vec3 color = col.rgb;\n                \n                    float luminance = color.r*0.299 + color.g*0.587 + color.b*0.114;\n                    float mn = min(min(color.r, color.g), color.b);\n                    float mx = max(max(color.r, color.g), color.b);\n                    float sat = (1.0-(mx - mn)) * (1.0-mx) * luminance * 5.0;\n                    vec3 lightness = vec3((mn + mx)/2.0);\n                \n                    // vibrance\n                    color = mix(color, mix(color, lightness, -amount), sat);\n                \n                    // negative vibrance\n                    gl_FragColor = vec4(mix(color, lightness, (1.0-lightness)*(1.0-amount)/2.0*abs(amount)), col.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("vibrance",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}brightness(e){let t;if(e>0){if(t=this.compiledProgram.get("brightness-up"),!t){let e="\n                    precision highp float;\n                    varying vec2 uv;\n                    uniform sampler2D texture;\n                    uniform float amount;\n\n                    #define PI 3.1415926535897932384626433832795\n\n                    void main() {\n                        vec4 color = texture2D(texture, uv);\n\n                        color.r = color.r + amount * sin(color.r * PI);\n                        color.g = color.g + amount * sin(color.g * PI);\n                        color.b = color.b + amount * sin(color.b * PI);\n\n                        gl_FragColor = color;\n                    }";t=this.compileShader(e),this.compiledProgram.set("brightness-up",t)}}else if(t=this.compiledProgram.get("brightness-down"),!t){let e="\n                    precision highp float;\n                    varying vec2 uv;\n                    uniform sampler2D texture;\n                    uniform float amount;\n\n                    void main() {\n                        vec4 color = texture2D(texture, uv);\n     \n                        color.r = (1.0 + amount) * color.r;\n                        color.g = (1.0 + amount) * color.g;\n                        color.b = (1.0 + amount) * color.b;\n\n                        gl_FragColor = color;\n                    }";t=this.compileShader(e),this.compiledProgram.set("brightness-down",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e>0?.35*e:.75*e),this.draw(t)}bwpoint(e){let t=this.compiledProgram.get("bwpoint");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform float white;\n                uniform float black;\n\n                void main() {\n\n                    float bval = black / 255.0;\n                    float wval = (255.0 / (white - black));\n                \n                    vec3 color = texture2D(texture, uv).rgb;\n                    color = color * wval - (bval *  wval);\n\n                    gl_FragColor = vec4(color, texture2D(texture, uv).a);\n                }";t=this.compileShader(e),this.compiledProgram.set("bwpoint",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.black,e.black),this.ctx.uniform1f(t.uniform.white,e.white),this.draw(t)}dealiasing(){let e=this.compiledProgram.get("dealiasing");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.a = (color.a < 0.25) ? 0.0 : 1.0;\n                    gl_FragColor = color;\n                }";e=this.compileShader(t),this.compiledProgram.set("dealiasing",e)}this.ctx.useProgram(e.program),this.draw(e)}alphaInvert(){let e=this.compiledProgram.get("alpha-invert");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.a = 1.0 - color.a;\n                    gl_FragColor = color;\n                }";e=this.compileShader(t),this.compiledProgram.set("alpha-invert",e)}this.ctx.useProgram(e.program),this.draw(e)}alphaMask(){let e=this.compiledProgram.get("alpha-mask");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    gl_FragColor = vec4(0,0,0, texture2D(texture, uv).a);\n                }";e=this.compileShader(t),this.compiledProgram.set("alpha-mask",e)}this.ctx.useProgram(e.program),this.draw(e)}alphaShiftMask(){let e=this.compiledProgram.get("alpha-shift-mask");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    gl_FragColor = vec4(0,0,0, texture2D(texture, uv).r);\n                }";e=this.compileShader(t),this.compiledProgram.set("alpha-shift-mask",e)}this.ctx.useProgram(e.program),this.draw(e)}alphaReset(){let e=this.compiledProgram.get("alpha-reset");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    gl_FragColor = vec4(color.rgb, 1.0);\n                }";e=this.compileShader(t),this.compiledProgram.set("alpha-reset",e)}this.ctx.useProgram(e.program),this.draw(e)}border(e){let t=this.compiledProgram.get("border");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform float size;\n                uniform vec4 color;\n                uniform vec2 screen;\n                uniform vec2 px;\n\n                void main() {\n                    vec4 pixel = texture2D(texture, uv);\n\n                    if(uv.y <= size*px.y || uv.y >= (screen.y-size)*px.y ||\n                       uv.x <= size*px.x || uv.x >= (screen.x-size)*px.x) {\n                        gl_FragColor = color;\n                    } else {\n                        gl_FragColor = pixel;\n                    }\n                }";t=this.compileShader(e),this.compiledProgram.set("border",t)}let i=Math.round((this.width+this.height)/2*e.size);this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.size,i),this.ctx.uniform2f(t.uniform.screen,this.width,this.height),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform4f(t.uniform.color,e.color.r/255,e.color.g/255,e.color.b/255,1),this.draw(t)}balance(e){let t=this.compiledProgram.get("balance");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform float sr;\n                uniform float sg;\n                uniform float sb;\n                uniform float mr;\n                uniform float mg;\n                uniform float mb;\n                uniform float hr;\n                uniform float hg;\n                uniform float hb;\n                uniform float preserve;\n\n                #define PI 3.1415926535897932384626433832795\n\n                float Lum(vec4 c){\n                    return 0.299*c.r + 0.587*c.g + 0.114*c.b;\n                }\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    \n                    float olum = Lum(color);\n\n                    //highlight\n                    color.r = clamp(color.r + (hr * (exp(color.r) - 1.0)), 0.0, 1.0);\n                    color.g = clamp(color.g + (hg * (exp(color.g) - 1.0)), 0.0, 1.0);\n                    color.b = clamp(color.b + (hb * (exp(color.b) - 1.0)), 0.0, 1.0);\n\n                    //midtone\n                    color.r = clamp(color.r + (mr * 0.25) * sin(color.r * PI), 0.0, 1.0);\n                    color.g = clamp(color.g + (mg * 0.25) * sin(color.g * PI), 0.0, 1.0);\n                    color.b = clamp(color.b + (mb * 0.25) * sin(color.b * PI), 0.0, 1.0);\n\n                    //shadow\n                    color.r = clamp((1.0 - sr * 0.5) * color.r + (1.0 - (1.0 - sr * 0.5)), 0.0, 1.0);\n                    color.g = clamp((1.0 - sg * 0.5) * color.g + (1.0 - (1.0 - sg * 0.5)), 0.0, 1.0);\n                    color.b = clamp((1.0 - sb * 0.5) * color.b + (1.0 - (1.0 - sb * 0.5)), 0.0, 1.0);\n                    \n                    if(preserve == 1.0) {\n                        float nlum = Lum(color);\n                        color.rgb = color.rgb * (olum/nlum);\n                    }\n\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("balance",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.sr,e.shadowRed),this.ctx.uniform1f(t.uniform.sg,e.shadowGreen),this.ctx.uniform1f(t.uniform.sb,e.shadowBlue),this.ctx.uniform1f(t.uniform.mr,e.midtoneRed),this.ctx.uniform1f(t.uniform.mg,e.midtoneGreen),this.ctx.uniform1f(t.uniform.mb,e.midtoneBlue),this.ctx.uniform1f(t.uniform.hr,e.highlightRed),this.ctx.uniform1f(t.uniform.hg,e.highlightGreen),this.ctx.uniform1f(t.uniform.hb,e.highlightBlue),this.ctx.uniform1f(t.uniform.preserve,Number(e.preserve)),this.draw(t)}temperature(e){let t=this.compiledProgram.get("temperature");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.r = clamp(color.r + amount, 0.0, 1.0);\n                    color.b = clamp(color.b - amount, 0.0, 1.0);\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("temperature",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e/6),this.draw(t)}tint(e){let t=this.compiledProgram.get("tint");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.g = clamp(color.g + amount, 0.0, 1.0);\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("tint",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e/6),this.draw(t)}threshold(e){let t=this.compiledProgram.get("threshold");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    float value = (color.r + color.g + color.b) / 3.0 < amount ? 0.0 : 1.0;\n                    gl_FragColor = vec4(value, value, value, color.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("threshold",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}noise(e){let t=this.compiledProgram.get("noise");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                float random(vec2 p) {\n                    vec2 r = vec2(23.14069263277926,2.665144142690225);\n                    return fract(cos(mod(12345678.,256. * dot(p,r))));\n                }\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    float noise = (random(uv) -0.5)*amount;\n\n                    gl_FragColor = vec4(color.r+noise, color.g+noise, color.b+noise, color.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("noise",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}halftone(e){let t=this.compiledProgram.get("halftone");if(!t){this.ctx.getExtension("OES_standard_derivatives");let e="\n                #ifdef GL_OES_standard_derivatives\n                #extension GL_OES_standard_derivatives : enable\n                #endif\n\n                precision highp float;                \n\n                uniform sampler2D texture;\n                uniform vec2 size;\n                uniform float frequency;\n  \n                varying vec2 uv; // Texcoords\n\n                float aastep(float threshold, float value) {\n                #ifdef GL_OES_standard_derivatives\n                    float afwidth = 0.7 * length(vec2(dFdx(value), dFdy(value)));\n                #else\n                    float afwidth = frequency * (1.0/size.x);\n                #endif\n                    return smoothstep(threshold-afwidth, threshold+afwidth, value);\n                }\n\n                // Explicit bilinear texture lookup to circumvent bad hardware precision.\n                // The extra arguments specify the dimension of the texture. (GLSL 1.30\n                // introduced textureSize() to get that information from the sampler.)\n                // 'dims' is the width and height of the texture, 'one' is 1.0/dims.\n                // (Precomputing 'one' saves two divisions for each lookup.)\n                vec4 texture2D_bilinear(sampler2D tex, vec2 st, vec2 dims, vec2 one) {\n                    vec2 uv = st * dims;\n                    vec2 uv00 = floor(uv - vec2(0.5)); // Lower left corner of lower left texel\n                    vec2 uvlerp = uv - uv00 - vec2(0.5); // Texel-local lerp blends [0,1]\n                    vec2 st00 = (uv00 + vec2(0.5)) * one;\n                    vec4 texel00 = texture2D(tex, st00);\n                    vec4 texel10 = texture2D(tex, st00 + vec2(one.x, 0.0));\n                    vec4 texel01 = texture2D(tex, st00 + vec2(0.0, one.y));\n                    vec4 texel11 = texture2D(tex, st00 + one);\n                    vec4 texel0 = mix(texel00, texel01, uvlerp.y); \n                    vec4 texel1 = mix(texel10, texel11, uvlerp.y); \n                    return mix(texel0, texel1, uvlerp.x);\n                }\n\n                vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n                vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n                vec3 permute(vec3 x) { return mod289((( x * 34.0) + 1.0) * x); }\n                \n                float snoise(vec2 v) {\n                    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                                        -0.577350269189626,  // -1.0 + 2.0 * C.x\n                                        0.024390243902439); // 1.0 / 41.0\n                    // First corner\n                    vec2 i = floor(v + dot(v, C.yy) );\n                    vec2 x0 = v - i + dot(i, C.xx);\n                    // Other corners\n                    vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n                    vec4 x12 = x0.xyxy + C.xxzz;\n                    x12.xy -= i1;\n                    // Permutations\n                    i = mod289(i); // Avoid truncation effects in permutation\n                    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n                                            + i.x + vec3(0.0, i1.x, 1.0 ));\n                    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),\n                                            dot(x12.zw,x12.zw)), 0.0);\n                    m = m*m; m = m*m;\n                    // Gradients\n                    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n                    vec3 h = abs(x) - 0.5;\n                    vec3 a0 = x - floor(x + 0.5);\n                    // Normalise gradients implicitly by scaling m\n                    m *= 1.792843 - 0.853735 * ( a0*a0 + h*h );\n                    // Compute final noise value at P\n                    vec3 g;\n                    g.x = a0.x * x0.x + h.x * x0.y;\n                    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n                    return 130.0 * dot(m, g);\n                }\n                \n                void main() {\n                    // Correct UVs for aspect ratio so we get round balls not squished\n                    vec2 auv = uv;\n                    auv.x *= size.x / size.y;\n\n                    vec3 color = texture2D_bilinear(texture, uv, size, 1.0 / size).rgb;\n\n                    float n = 0.1*snoise(auv*200.0); // Fractal noise\n                    n += 0.05*snoise(auv*400.0);\n                    n += 0.025*snoise(auv*800.0);\n\n                    vec3 white = vec3(n*0.2 + 0.97);\n                    vec3 black = vec3(n + 0.1);\n\n                    // Perform a rough RGB-to-CMYK conversion\n                    vec4 cmyk;\n                    cmyk.xyz = 1.0 - color;\n                    cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); // Create K\n                    cmyk.xyz -= cmyk.w; // Subtract K equivalent from CMY\n                \n                    // Distance to nearest point in a grid of\n                    // (frequency x frequency) points over the unit square\n                    vec2 Kst = frequency*mat2(0.707, -0.707, 0.707, 0.707)*auv;\n                    vec2 Kuv = 2.0*fract(Kst)-1.0;\n                    float k = aastep(0.0, sqrt(cmyk.w)-length(Kuv)+n);\n                    vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966)*auv;\n                    vec2 Cuv = 2.0*fract(Cst)-1.0;\n                    float c = aastep(0.0, sqrt(cmyk.x)-length(Cuv)+n);\n                    vec2 Mst = frequency*mat2(0.966, 0.259, -0.259, 0.966)*auv;\n                    vec2 Muv = 2.0*fract(Mst)-1.0;\n                    float m = aastep(0.0, sqrt(cmyk.y)-length(Muv)+n);\n                    vec2 Yst = frequency*auv; // 0 deg\n                    vec2 Yuv = 2.0*fract(Yst)-1.0;\n                    float y = aastep(0.0, sqrt(cmyk.z)-length(Yuv)+n);\n                \n                    vec3 rgbscreen = 1.0 - 0.9*vec3(c,m,y) + n;\n                    rgbscreen = mix(rgbscreen, black, 0.85*k + 0.3*n);\n                \n                    #ifdef GL_OES_standard_derivatives\n                        float afwidth = 2.0 * frequency * max(length(dFdx(uv)), length(dFdy(uv)));\n                    #else\n                        float afwidth = frequency * (1.0/size.x);\n                    #endif\n                    \n                    float blend = smoothstep(0.7, 1.4, afwidth); \n                    gl_FragColor = vec4(mix(rgbscreen, color, blend), 1.0);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("halftone",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.size,this.width,this.height),this.ctx.uniform1f(t.uniform.frequency,Math.round(100*e)),this.draw(t)}vignette(e){let t=this.compiledProgram.get(e<0?"vignette-white":"vignette-black");if(!t){let i=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","uniform float size;","void main() {","vec4 color = texture2D(texture, uv);","float dist = distance(uv, vec2(0.5, 0.5));","float grd = smoothstep(0.8, size * 0.799, dist * (amount*0.6 + size*2.0));","color.rgb += vec3(1.0, 1.0, 1.0) * (1.0 - grd);","gl_FragColor = color;","}"].join("\n"),s=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","uniform float size;","void main() {","vec4 color = texture2D(texture, uv);","float dist = distance(uv, vec2(0.5, 0.5));","color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount*0.75 + size*2.0));","gl_FragColor = color;","}"].join("\n");t=this.compileShader(e<0?i:s),this.compiledProgram.set(e<0?"vignette-white":"vignette-black",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.size,.25),this.ctx.uniform1f(t.uniform.amount,e<0?-1*e:e),this.draw(t)}grain(e){let t=this.compiledProgram.get("grain");if(!t){let e=["precision highp float;","uniform sampler2D texture;","varying vec2 uv;","uniform float width;","uniform float height;","uniform float grainamount;","uniform float timer;","const float permTexUnit = 1.0/256.0;","const float permTexUnitHalf = 0.5/256.0;","float grainsize = 1.8;","float lumamount = 1.0;","vec4 rnm(in vec2 tc)","{","float noise =  sin(dot(tc + vec2(timer,timer),vec2(12.9898,78.233))) * 43758.5453;","float noiseR =  fract(noise)*2.0-1.0;","float noiseG =  fract(noise*1.2154)*2.0-1.0; ","float noiseB =  fract(noise*1.3453)*2.0-1.0;","float noiseA =  fract(noise*1.3647)*2.0-1.0;","return vec4(noiseR,noiseG,noiseB,noiseA);","}","float fade(in float t) {","return t*t*t*(t*(t*6.0-15.0)+10.0);","}","float pnoise3D(in vec3 p)","{","vec3 pi = permTexUnit*floor(p)+permTexUnitHalf;","vec3 pf = fract(p);","float perm00 = rnm(pi.xy).a ;","vec3  grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;","float n000 = dot(grad000, pf);","vec3  grad001 = rnm(vec2(perm00, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));","float perm01 = rnm(pi.xy + vec2(0.0, permTexUnit)).a ;","vec3  grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;","float n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));","vec3  grad011 = rnm(vec2(perm01, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));","float perm10 = rnm(pi.xy + vec2(permTexUnit, 0.0)).a ;","vec3  grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;","float n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));","vec3  grad101 = rnm(vec2(perm10, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));","float perm11 = rnm(pi.xy + vec2(permTexUnit, permTexUnit)).a ;","vec3  grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;","float n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));","vec3  grad111 = rnm(vec2(perm11, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));","vec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));","vec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));","float n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));","return n_xyz;","}","vec2 coordRot(in vec2 tc, in float angle)","{","float aspect = width/height;","float rotX = ((tc.x*2.0-1.0)*aspect*cos(angle)) - ((tc.y*2.0-1.0)*sin(angle));","float rotY = ((tc.y*2.0-1.0)*cos(angle)) + ((tc.x*2.0-1.0)*aspect*sin(angle));","rotX = ((rotX/aspect)*0.5+0.5);","rotY = rotY*0.5+0.5;","return vec2(rotX,rotY);","}","void main() ","{","vec3 rotOffset = vec3(1.425,3.892,5.835);","vec2 rotCoordsR = coordRot(uv, timer + rotOffset.x);","vec3 noise = vec3(pnoise3D(vec3(rotCoordsR*vec2(width/grainsize,height/grainsize),0.0)));","vec4 tex = texture2D(texture, uv);","vec3 col = tex.rgb;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float luminance = mix(0.0,dot(col, lumcoeff),lumamount);","float lum = smoothstep(0.2,0.0,luminance);","lum += luminance;","noise = mix(noise,vec3(0.0),pow(lum,4.0));","col = col+noise*grainamount;","gl_FragColor =  vec4(col, tex.w);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("grain",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.width,this.width),this.ctx.uniform1f(t.uniform.height,this.height),this.ctx.uniform1f(t.uniform.grainamount,e/10),this.draw(t)}sharpen(e){let t=this.compiledProgram.get("sharpen");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n                uniform float m[9];\n                uniform float amount;\n\n                void main(void) {\n                    vec4 c11 = texture2D(texture, uv - px); // top left\n                    vec4 c12 = texture2D(texture, vec2(uv.x, uv.y - px.y)); // top center\n                    vec4 c13 = texture2D(texture, vec2(uv.x + px.x, uv.y - px.y)); // top right\n\n                    vec4 c21 = texture2D(texture, vec2(uv.x - px.x, uv.y) ); // mid left\n                    vec4 c22 = texture2D(texture, uv); // mid center\n                    vec4 c23 = texture2D(texture, vec2(uv.x + px.x, uv.y) ); // mid right\n\n                    vec4 c31 = texture2D(texture, vec2(uv.x - px.x, uv.y + px.y) ); // bottom left\n                    vec4 c32 = texture2D(texture, vec2(uv.x, uv.y + px.y) ); // bottom center\n                    vec4 c33 = texture2D(texture, uv + px ); // bottom right\n\n                    vec4 color = \n                        c11 * m[0] + c12 * m[1] + c13 * m[2] +\n                        c21 * m[3] + c22 * m[4] + c23 * m[5] +\n                        c31 * m[6] + c32 * m[7] + c33 * m[8];\n\n                    gl_FragColor = color * amount + (c22 * (1.0 - amount));\n                }";t=this.compileShader(e),this.compiledProgram.set("sharpen",t)}let i=new Float32Array([-1,-1,-1,-1,9,-1,-1,-1,-1]);this.ctx.useProgram(t.program),this.ctx.uniform1fv(t.uniform.m,i),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(t.uniform.amount,e/2),this.draw(t)}blur(e,t=!1){let i=this.compiledProgram.get("blur");if(!i){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 size;\n                float random(vec3 scale, float seed) {\n                    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n                }\n                void main() {\n                    vec4 color = vec4(0.0);\n                    float total = 0.0;\n                    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n                    for (float t = -30.0; t <= 30.0; t++) {\n                        float percent = (t + offset - 0.5) / 30.0;\n                        float weight = 1.0 - abs(percent);\n                        vec4 sample = texture2D(texture, uv + size * percent);\n                        sample.rgb *= sample.a;\n                        color += sample * weight;\n                        total += weight;\n                    }\n                    gl_FragColor = color / total;\n                    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n                }";i=this.compileShader(e),this.compiledProgram.set("blur",i)}let s=40*e/this.canvas.width,n=40*e/this.canvas.height;this.ctx.useProgram(i.program),this.ctx.uniform2f(i.uniform.size,0,n),this.draw(i,!0),this.ctx.uniform2f(i.uniform.size,s,0),this.draw(i,t)}zoom(e){let t=this.compiledProgram.get("zoom");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform vec2 center;\n                uniform float amount;\n                uniform vec2 px;\n                \n                float random(vec3 scale, float seed) {\n                    /* use the fragment position for a different seed per-pixel */                    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n                }\n                void main() {\n                    vec4 color = vec4(0.0);\n                    float total = 0.0;\n                    vec2 toCenter = (center - uv) * px;\n                    \n                    /* randomize the lookup values to hide the fixed number of samples */\n                    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n                    \n                    for (float t = 0.0; t <= 40.0; t++) {\n                        float percent = (t + offset) / 40.0;\n                        float weight = 4.0 * (percent - percent * percent);\n                        vec4 sample = texture2D(texture, uv + toCenter * percent * amount / px);\n                        \n                        /* switch to pre-multiplied alpha to correctly blur transparent images */\n                        sample.rgb *= sample.a;\n                        \n                        color += sample * weight;\n                        total += weight;\n                    }\n                    gl_FragColor = color / total;\n                    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n                }";t=this.compileShader(e),this.compiledProgram.set("zoom",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform2f(t.uniform.center,e.x,e.y),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}makeKernel(e){const t=this.GAUSSKERN_MAX+Number(!(1&this.GAUSSKERN_MAX)),i=Math.sqrt(2*Math.PI)*e,s=2*e*e;var n,a,r=~~(t/2),o=new Float32Array(t);for(a=0,n=-r;a<t;n++,a++)o[a]=Math.exp(-n*n/s)/i;return o}scaleKernel(e){const t=e.reduce(((e,t)=>e+t))||1;return e.map((e=>e/t))}gaussian(e){const t=this.makeKernel(10*e),i=t.length+Number(!(1&t.length));let s=this.compiledProgram.get(`guass-${i}`);if(!s){let e=`\n                precision mediump float;\n                #define KERNEL_SIZE ${i}\n                #define KERNEL_HALF KERNEL_SIZE / 2\n                // our texture\n                varying vec2 uv;\n                uniform vec2 px;\n                uniform sampler2D texture;\n                uniform float kernel[KERNEL_SIZE];\n                void main() {\n                    vec4 result = vec4(0.0);\n                    for (int i = 0; i < KERNEL_SIZE; i++) {\n                        result += texture2D(texture, uv + px*vec2(i - KERNEL_HALF))*kernel[i];\n                    }\n                    gl_FragColor = result;\n                }\n            `;s=this.compileShader(e),this.compiledProgram.set(`guass-${i}`,s)}this.ctx.useProgram(s.program),this.ctx.uniform2f(s.uniform.px,0,1/this.height),this.ctx.uniform1fv(s.uniform.kernel,this.scaleKernel(t)),this.draw(s,!0),this.ctx.uniform2f(s.uniform.px,1/this.width,0),this.draw(s)}radial(e){let t=this.compiledProgram.get("radial");if(!t){let e="\n                precision highp float;\n                const float PI = 3.1415926535897932384626433832795;\n                const float samples = 100.;\n\n                uniform sampler2D texture;\n\n                varying vec2 uv;\n                uniform vec2 center;\n                uniform vec2 resolution;\n\n                uniform float amount;\n                uniform int direction;\n                uniform int symmetry;\n               \n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 rotateUV(vec2 uv, mat2 transform, vec2 centerc) {\n                    uv -= centerc;\n                    uv = transform * uv;\n                    uv += centerc;\n                    return uv;\n                }\n             \n                void main(void) {\n                    float ar = resolution.x / resolution.y;\n                    vec2 uvc = uv;\n                    vec2 centerc = center;\n\n                    if (symmetry == 1)\n                    {\n                        if (resolution.x > resolution.y) {\n                            centerc.y /= ar;\n                            uvc.y /= ar;\n                        }\n                        else {\n                            centerc.x *= ar;\n                            uvc.x *= ar;\n                        }\n                    }\n\n                    vec2 coordcw = uvc;\n                    vec2 coordccw = uvc;\n                    vec4 FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n                    vec2 toCenter = uvc - centerc;\n                    float endsamples = 0.;\n\n                    float a = amount / samples;\n\n                    mat2 matcw = rotate2d(-a * PI / 180.);\n                    mat2 matccw = rotate2d(a * PI / 180.);\n\n                    for (float i = 0.; i < samples; i+=1.) {\n                        if (direction == 1 || direction == 2) {\n                            coordccw = rotateUV(coordccw, matccw, centerc);\n                            FragColor += texture2D(texture, coordccw);\n                            endsamples += 1.;\n                        }\n\n                        if (direction == 0 || direction == 2) {\n                            coordcw = rotateUV(coordcw, matcw, centerc);\n                            FragColor += texture2D(texture, coordcw);\n                            endsamples += 1.;\n                        }\n                    }\n                    FragColor /= endsamples;\n                    gl_FragColor = FragColor;\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("radial",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,180*e.amount),this.ctx.uniform2f(t.uniform.center,e.x,e.y),this.ctx.uniform1i(t.uniform.direction,e.direction),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.ctx.uniform1i(t.uniform.symmetry,e.symmetry?1:0),this.draw(t)}motion(e){let t=this.compiledProgram.get("motion");if(!t){let e="\n                precision mediump float;\n                uniform float KERNEL_SIZE;\n                varying vec2 uv;\n                uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float angle;\n\n                bool outOfRange(vec2 uv) {\n                    return uv.x < 0. || uv. y < 0. || uv.x > 1. || uv.y > 1.;\n                }\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n                void main() {\n                    vec4 result = vec4(0.0);\n                    vec2 resol = vec2 (1./resolution.x, 0.);//1./resolution.y);\n                    resol = rotate2d(angle) * resol;\n                    float divcnt = 1.;\n                    for (float i=1.; i <= 100.; i+=1.) {\n                        vec2 before = uv - resol * i;\n                        if (!outOfRange(before)) {\n                            result += texture2D(texture, before);\n                            divcnt += 1.;\n                        }\n                        vec2 after = uv + resol * i;\n                        if (!outOfRange(after)) {\n                            result += texture2D(texture, after);\n                            divcnt += 1.;\n                        }\n                        if (i >= KERNEL_SIZE) break;\n                    }\n                    result += texture2D(texture, uv);\n                    result /= divcnt;\n                    gl_FragColor = result;\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("motion",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.KERNEL_SIZE,100*e.amount),this.ctx.uniform1f(t.uniform.angle,e.angle),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}clarity(e){let t=this.compiledProgram.get("clarity");if(!t){const e="\n                #define GLSLIFY 1\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n                           \n                float Lum(vec3 c){\n                    return 0.299*c.r + 0.587*c.g + 0.114*c.b;\n                }\n                float BlendOverlayf(float base, float blend){\n                    return (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n                }\n                vec3 BlendOverlay(vec3 base, vec3 blend){\n                    return vec3(BlendOverlayf(base.r, blend.r), BlendOverlayf(base.g, blend.g), BlendOverlayf(base.b, blend.b));\n                }\n                float BlendVividLightf(float base, float blend){\n                    float BlendColorBurnf = (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n                    float BlendColorDodgef =  (((2.0 * (blend - 0.5)) == 1.0) ? (2.0 * (blend - 0.5)) : min(base / (1.0 - (2.0 * (blend - 0.5))), 1.0));\n                    return ((blend < 0.5) ? BlendColorBurnf : BlendColorDodgef);\n                }\n                vec3 BlendVividLight(vec3 base, vec3 blend){\n                    return vec3(BlendVividLightf(base.r, blend.r), BlendVividLightf(base.g, blend.g), BlendVividLightf(base.b, blend.b));\n                }\n\n                float normpdf(in float x, in float sigma) {\n                    return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;\n                }\n\n                vec3 blurMap() {\n                    //declare stuff\n                    const int mSize = 11;\n                    const int kSize = (mSize-1)/2;\n                    float kernel[mSize];\n                    vec3 final_colour = vec3(0.0);\n                    \n                    //create the 1-D kernel\n                    float sigma = 7.0;\n                    float Z = 0.0;\n                    for (int j = 0; j <= kSize; ++j){\n                        kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), sigma);\n                    }\n                    \n                    //get the normalization factor (as the gaussian has been clamped)\n                    for (int j = 0; j < mSize; ++j){\n                        Z += kernel[j];\n                    }\n                    \n                    //read out the texels\n                    for (int i=-kSize; i <= kSize; ++i){\n                        for (int j=-kSize; j <= kSize; ++j){\n                            final_colour += kernel[kSize+j] * kernel[kSize+i] * texture2D(texture, (uv.xy + vec2(float(i),float(j))*px)).rgb;\n                        }\n                    }\n                    return vec3(final_colour/(Z*Z));\n                }\n    \n                void main() {\n\n                    vec4 base4 = texture2D(texture, uv.xy);\n                    \n                    vec3 blurMap = blurMap();\n                    vec3 base = base4.rgb;\n                    \n                    float intensity = (amount < 0.0) ? (amount / 2.0) : amount;\n                    float lum = Lum(base);\n                  \n                    vec3 col = vec3(lum);\n                    vec3 mask = vec3(1.0 - pow(lum, 1.8));\n                    // invert blurred texture\n                    vec3 layer = vec3(1.0 - Lum(blurMap));\n                    vec3 detail = clamp(BlendVividLight(col, layer), 0.0, 1.0);\n                    // we get negative detail by inverting the detail layer\n                    vec3 inverse = mix(1.0 - detail, detail, (intensity+1.0)/2.0);\n                  \n                    gl_FragColor = vec4(BlendOverlay(base, mix(vec3(0.5), inverse, mask)), base4.a);       \n                }";t=this.compileShader(e),this.compiledProgram.set("clarity",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(t.uniform.amount,2*e),this.draw(t)}smooth(e){let t=this.compiledProgram.get("smooth");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n                uniform float m[9];\n                uniform float amount;\n\n                void main(void) {\n                    vec4 c11 = texture2D(texture, uv - px);\n                    vec4 c12 = texture2D(texture, vec2(uv.x, uv.y - px.y));\n                    vec4 c13 = texture2D(texture, vec2(uv.x + px.x, uv.y - px.y));\n\n                    vec4 c21 = texture2D(texture, vec2(uv.x - px.x, uv.y) );\n                    vec4 c22 = texture2D(texture, uv);\n                    vec4 c23 = texture2D(texture, vec2(uv.x + px.x, uv.y) );\n\n                    vec4 c31 = texture2D(texture, vec2(uv.x - px.x, uv.y + px.y) );\n                    vec4 c32 = texture2D(texture, vec2(uv.x, uv.y + px.y) );\n                    vec4 c33 = texture2D(texture, uv + px );\n\n                    vec4 color = \n                        c11 * m[0] + c12 * m[1] + c13 * m[2] +\n                        c21 * m[3] + c22 * m[4] + c23 * m[5] +\n                        c31 * m[6] + c32 * m[7] + c33 * m[8];\n\n                    gl_FragColor = color * amount + (c22 * (1.0 - amount));\n                }";t=this.compileShader(e),this.compiledProgram.set("smooth",t)}let i=new Float32Array([1/16,2/16,1/16,2/16,.25,2/16,1/16,2/16,1/16]);this.ctx.useProgram(t.program),this.ctx.uniform1fv(t.uniform.m,i),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}denoise(e){const t=Math.round(30*e[0]);let i=this.compiledProgram.get("denoise"+t);if(!i){let e="\n                precision mediump float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                \n                uniform float sigma;\n                uniform float threshold;\n                uniform vec2 resolution;\n\n                #define INV_SQRT_OF_2PI 0.39894228040143267793994605993439  // 1.0/SQRT_OF_2PI\n                #define INV_PI 0.31830988618379067153776752674503\n                #define RADIUS %radius%.0\n              \n                void main(void) {\n\n                       float invSigmaQx2 = .5 / (sigma * sigma);      // 1.0 / (sigma^2 * 2.0)\n                       float invSigmaQx2PI = INV_PI * invSigmaQx2;    // 1.0 / (sqrt(PI) * sigma)\n                       \n                       float invThresholdSqx2 = .5 / (threshold * threshold);     // 1.0 / (sigma^2 * 2.0)\n                       float invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;   // 1.0 / (sqrt(2*PI) * sigma)\n                       \n                       vec4 center = texture2D(texture,uv); \n                       \n                       float zBuff = 0.0;\n                       vec4 aBuff = vec4(0.0);\n                       \n                       for(float x=-RADIUS; x <= RADIUS; x++) {\n                           float pt = sqrt(RADIUS*RADIUS-x*x);  // pt = yRadius: have circular trend\n                           for(float y=-RADIUS; y <= RADIUS; y++) {\n   \n                               if(y >= pt || y <= pt) {\n   \n                                   vec2 d = vec2(x,y)/resolution;\n                       \n                                   float blurFactor = exp( -dot(d , d) * invSigmaQx2 ) * invSigmaQx2;\n                                   \n                                   vec4 pxx =  texture2D(texture,uv+d);\n                       \n                                   vec4 dC = pxx-center;\n                                   float deltaFactor = exp( -dot(dC, dC) * invThresholdSqx2) * invThresholdSqrt2PI * blurFactor;\n                                                       \n                                   zBuff += deltaFactor;\n                                   aBuff += deltaFactor*pxx;\n                               }\n                           }\n                       }\n                       gl_FragColor = aBuff/zBuff;\n                } ";i=this.compileShader(e.replace(/%radius%/g,t.toString())),this.compiledProgram.set("denoise"+t,i)}this.ctx.useProgram(i.program),this.ctx.uniform1f(i.uniform.sigma,t/3),this.ctx.uniform1f(i.uniform.threshold,e[1]),this.ctx.uniform2f(i.uniform.resolution,this.width,this.height),this.draw(i)}colorMatrix(e){let t=new Float32Array(e);t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255;let i=this.compiledProgram.get("colormatrix");if(!i){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float m[20];\n\n                void main(void) {\n                    vec4 c = texture2D(texture, uv);\n                    gl_FragColor.r = m[0] * c.r + m[1] * c.g + m[2] * c.b + m[3] * c.a + m[4];\n                    gl_FragColor.g = m[5] * c.r + m[6] * c.g + m[7] * c.b + m[8] * c.a + m[9];\n                    gl_FragColor.b = m[10] * c.r + m[11] * c.g + m[12] * c.b + m[13] * c.a + m[14];\n                    gl_FragColor.a = m[15] * c.r + m[16] * c.g + m[17] * c.b + m[18] * c.a + m[19];\n                } ";i=this.compileShader(e),this.compiledProgram.set("colormatrix",i)}this.ctx.useProgram(i.program),this.ctx.uniform1fv(i.uniform.m,t),this.draw(i)}colorMatrixRange(e,t,i){let s=new Float32Array(e);s[4]/=255,s[9]/=255,s[14]/=255,s[19]/=255;let n=this.compiledProgram.get("colormatrix-range");if(!n){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float m[20];\n                uniform float from;\n                uniform float to;\n\n                vec3 rgb2hsv(vec3 c) {\n                    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n                    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n                    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n                \n                    float d = q.x - min(q.w, q.y);\n                    float e = 1.0e-10;\n                    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n                }\n\n                void main(void) {\n                    vec4 c = texture2D(texture, uv);\n                    vec3 hsv = rgb2hsv(c.rgb);\n\n                    gl_FragColor = c;\n\n                    if((hsv.x >= from && hsv.x <= to) || (to < from && (hsv.x >= from || hsv.x <= to))) {\n\n                        float blend = 1.0;\n                        float grad = 29.0/360.0;\n\n                        float distFrom = distance(hsv.x, from);\n                        float distTo = distance(hsv.x, to);\n\n                        if(distFrom <= grad) blend = distFrom / grad;\n                        if(distTo <= grad) blend = distTo / grad;\n\n                        vec4 b = vec4(\n                            m[0] * c.r + m[1] * c.g + m[2] * c.b + m[3] * c.a + m[4],\n                            m[5] * c.r + m[6] * c.g + m[7] * c.b + m[8] * c.a + m[9],\n                            m[10] * c.r + m[11] * c.g + m[12] * c.b + m[13] * c.a + m[14],\n                            m[15] * c.r + m[16] * c.g + m[17] * c.b + m[18] * c.a + m[19]);\n                        \n                        gl_FragColor = mix(c, b, blend);\n                    }\n                } ";n=this.compileShader(e),this.compiledProgram.set("colormatrix-range",n)}this.ctx.useProgram(n.program),this.ctx.uniform1fv(n.uniform.m,s),this.ctx.uniform1f(n.uniform.from,t/360),this.ctx.uniform1f(n.uniform.to,i/360),this.draw(n)}desaturate(){this.saturation(-1)}invert(){this.colorMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0])}contrast(e){let t=e+1,i=-128*(t-1);this.colorMatrix([t,0,0,0,i,0,t,0,0,i,0,0,t,0,i,0,0,0,1,0])}hue(e,t,i){let s=this.compiledProgram.get("hue"+(t?"-range":""));if(!s){let e="\n            precision highp float;\n            varying vec2 uv;\n            \n            uniform sampler2D texture;\n            uniform float rotation;\n            uniform float from;\n            uniform float to;\n            \n            vec3 rgb2hsv(vec3 c) {\n                vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n                vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n                vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n            \n                float d = q.x - min(q.w, q.y);\n                float e = 1.0e-10;\n                return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n            }\n            vec3 hsv2rgb(vec3 c) {\n                vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n                vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n                return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n            }";e+=t?"\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    vec3 hsv = rgb2hsv(base.rgb);\n\n                    gl_FragColor = base;\n\n                    if((hsv.x >= from && hsv.x <= to) || (to < from && (hsv.x >= from || hsv.x <= to))) {\n\n                        float blend = 1.0;\n                        float grad = 29.0/360.0;\n\n                        float distFrom = distance(hsv.x, from);\n                        float distTo = distance(hsv.x, to);\n\n                        if(distFrom <= grad) blend = distFrom / grad;\n                        if(distTo <= grad) blend = distTo / grad;\n                        \n                        hsv.x += rotation * blend;\n                        \n                        gl_FragColor.rgb = hsv2rgb(hsv);\n                    }\n                }":"\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    vec3 hsv = rgb2hsv(base.rgb);\n\n                    hsv.x += rotation;\n\n                    gl_FragColor = vec4(hsv2rgb(hsv), base.a);\n                }",s=this.compileShader(e),this.compiledProgram.set("hue"+(t?"-range":""),s)}this.ctx.useProgram(s.program),this.ctx.uniform1f(s.uniform.rotation,e/360),t&&(this.ctx.uniform1f(s.uniform.from,t/360),this.ctx.uniform1f(s.uniform.to,i/360)),this.draw(s)}saturation(e,t,i){let s=2*e/3+1,n=-.5*(s-1);t?this.colorMatrixRange([s,n,n,0,0,n,s,n,0,0,n,n,s,0,0,0,0,0,1,0],t,i):this.colorMatrix([s,n,n,0,0,n,s,n,0,0,n,n,s,0,0,0,0,0,1,0])}lightness(e,t,i){e*=255,t?this.colorMatrixRange([1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0],t,i):this.colorMatrix([1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0])}colorize(e){this.fill(new h.Z(n.Z.fromHSB(e,1,1),"color",1))}exposure(e){let t=this.compiledProgram.get("exposure");if(!t){let e=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float ramp(in float t){","t *= 2.0;","if (t >= 1.0) {","t -= 1.0;","t = log(0.5) / log(0.5*(1.0-t) + 0.9332*t);","}","return clamp(t, 0.001, 10.0);","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","vec3 base = col.rgb * matRGBtoROMM;","float a = abs(amount) * col.a + epsilon;","float v = pow(2.0, a*2.0+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (amount > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = pow(res, vec3(ramp(1.0 - (0.0 * col.a + 1.0) / 2.0)));","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("exposure",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}highlights(e){let t=this.compiledProgram.get("highlights");if(!t){let e=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const float PI = 3.1415926535897932384626433832795;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float luma_romm(in vec3 color){","return dot(color, vec3(0.242655, 0.755158, 0.002187));","}","float luma(in vec3 color){","return dot(color, vec3(0.298839, 0.586811, 0.11435));","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","float gaussian(in float x) {","return 1.0 - exp(-PI*2.0*x*x);","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","lowp vec3 map = col.rgb;","vec3 base = col.rgb * matRGBtoROMM;","float base_lum = luma(col.rgb);","float map_lum = luma_romm(map * matRGBtoROMM);","float exposure = mix(amount, 0.0, 1.0 - map_lum) * col.a;","float a = abs(exposure) * col.a + epsilon;","float v = pow(2.0, a+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (exposure > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("highlights",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}shadows(e){let t=this.compiledProgram.get("shadows");if(!t){let e=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const float PI = 3.1415926535897932384626433832795;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float luma_romm(in vec3 color){","return dot(color, vec3(0.242655, 0.755158, 0.002187));","}","float luma(in vec3 color){","return dot(color, vec3(0.298839, 0.586811, 0.11435));","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","float gaussian(in float x) {","return 1.0 - exp(-PI*2.0*x*x);","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","lowp vec3 map = col.rgb;","vec3 base = col.rgb * matRGBtoROMM;","float base_lum = luma(col.rgb);","float map_lum = luma_romm(map * matRGBtoROMM);","float exposure = mix(0.0, amount, 1.0 - map_lum) * col.a;","float a = abs(exposure) * col.a + epsilon;","float v = pow(2.0, a+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (exposure > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("shadows",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}dehaze(e){let t=this.compiledProgram.get("dehaze");if(!t){let e="\n\n                #define GLSLIFY 1;\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform float amount;  // -1.0 ~ 1.0\n\n                uniform vec2 size;\n\n                float hazeMap(vec4 base) {\n                    vec3 color = vec3(1.0, 1.0, 1.0);\n                    vec2 step = vec2(1.0 / size.xy);\n                    const int patchRadius = 1; // the half size for shift in 3 x 3 patch.\n                    for (int i = -patchRadius; i <= patchRadius; ++i) {\n                       for (int j = -patchRadius; j <= patchRadius; ++j) {\n                           vec2 uv = clamp(uv + (vec2(i, j) * step), 0.0, 1.0);\n                           color = min(color, base.rgb);\n                        }\n                    }\n                    return min(color.r, min(color.g, color.b));\n                }\n\n                void main() {\n                    \n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    lowp float haze = hazeMap(base);\n\n                    float transmission = 1.0 - 0.95 * haze;\n                    const float A = 0.95; //0.95 intensity. We can consider to collect 0.1% brightest pixel from the dark channel image.\n                    const float t0 = 0.1; //0.1 in the paper, we can increase it for solving the color bleeding.\n                    float t = mix(1.0, max(t0, transmission), amount);\n                    vec3 J = (base.rgb - A) / t + A;\n                    gl_FragColor = vec4(J, base.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("dehaze",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.size,this.width,this.height),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}solarize(){this.paletteMap||(this.paletteMap=new ImageData(256,1));for(let e=0;e<256;++e){let t=255*(e/255>.5?2*(e/255-.5):2*(.5-e/255));t=t>255?255:t<0?0:t,this.paletteMap.data[4*e]=this.paletteMap.data[4*e+1]=this.paletteMap.data[4*e+2]=t}this.mapping(this.paletteMap)}monochrome(e){let t=this.compiledProgram.get("monochrome");if(!t){let e="\n            precision highp float;\n            varying vec2 uv;\n            \n            uniform sampler2D texture;\n\n            uniform float r;\n            uniform float g;\n            uniform float b;\n            \n            float luma(vec3 color) {\n                return dot(color, vec3(r, g, b));\n            }\n            void main() {\n                lowp vec4 base = texture2D(texture, uv.xy);\n                float avg = luma(base.rgb);\n\n                gl_FragColor = vec4(avg, avg, avg, base.a);\n            }";t=this.compileShader(e),this.compiledProgram.set("monochrome",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.r,e.r),this.ctx.uniform1f(t.uniform.g,e.g),this.ctx.uniform1f(t.uniform.b,e.b),this.draw(t)}curves(e){this.paletteMap||(this.paletteMap=new ImageData(256,1)),void 0!==e.preset&&(e=p.z.createCurveSet(e)),p.Z.fillPaletteMap(e,this.paletteMap),this.mapping(this.paletteMap)}levels(e){this.paletteMap||(this.paletteMap=new ImageData(256,1)),u.Z.fillPaletteMap(e,this.paletteMap),this.mapping(this.paletteMap)}multilevels(e){this.paletteMap||(this.paletteMap=new ImageData(256,1)),u.Z.fillRGBPaletteMap(e[0].isFlat()?void 0:e[0],e[1].isFlat()?void 0:e[1],e[2].isFlat()?void 0:e[2],this.paletteMap),this.mapping(this.paletteMap)}mapping(e){let t=this.compiledProgram.get("mapping");if(!t){let e="\n                #define GLSLIFY 1\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform sampler2D paletteMap;\n\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    float r = texture2D(paletteMap, vec2(base.r, 0)).r;\n                    float g = texture2D(paletteMap, vec2(base.g, 0)).g;\n                    float b = texture2D(paletteMap, vec2(base.b, 0)).b;\n                    gl_FragColor = vec4(r, g, b, base.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("mapping",t)}this.ctx.useProgram(t.program);let i=t.getTextureById("paletteMap");i.createTexture(this.ctx,e.width,e.height),i.uploadData(this.ctx,e),this.draw(t)}lookup(e){let t=this.compiledProgram.get("lookup");if(!t){let e="\n            precision highp float;\n            varying vec2 uv;\n\n            uniform sampler2D texture;\n            uniform sampler2D paletteMap;\n            \n            float luma(vec3 color) {\n                return dot(color, vec3(0.299, 0.587, 0.114));\n            }\n\n            void main() {\n                lowp vec4 base = texture2D(texture, uv.xy);\n                float avg = luma(base.rgb);\n                float r = texture2D(paletteMap, vec2(avg, 0)).r;\n                float g = texture2D(paletteMap, vec2(avg, 0)).g;\n                float b = texture2D(paletteMap, vec2(avg, 0)).b;\n                gl_FragColor = vec4(r, g, b, base.a);\n            }";t=this.compileShader(e),this.compiledProgram.set("lookup",t)}this.ctx.useProgram(t.program);let i=t.getTextureById("paletteMap");i.createTexture(this.ctx,e.width,e.height),i.uploadData(this.ctx,e),this.draw(t)}toning(e){this.paletteMap||(this.paletteMap=new ImageData(256,1)),l.Z.fillPaletteMap(e,this.paletteMap);let t=this.compiledProgram.get("toning");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform sampler2D paletteMap;\n\n                uniform float amount;\n                \n                float luma(vec3 color) {\n                    return dot(color, vec3(0.299, 0.587, 0.114));\n                }\n\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    float avg = luma(base.rgb);\n                    float r = texture2D(paletteMap, vec2(avg, 0)).r;\n                    float g = texture2D(paletteMap, vec2(avg, 0)).g;\n                    float b = texture2D(paletteMap, vec2(avg, 0)).b;\n                    gl_FragColor = mix(base, vec4(r, g, b, base.a), amount);\n                }";t=this.compileShader(e),this.compiledProgram.set("toning",t)}this.ctx.useProgram(t.program);let i=t.getTextureById("paletteMap");i.createTexture(this.ctx,this.paletteMap.width,this.paletteMap.height),i.uploadData(this.ctx,this.paletteMap),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}fill(e){let t=this.compiledProgram.get("fill-"+e.blend);if(!t){let i="";switch(e.blend){case"color":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        vec3 blendColor(vec3 base, vec3 blend) {\n                            vec3 color = vec3(blend.rgb);\n                            base.r = base.r * 0.30 + base.g * 0.59 + base.b * 0.11;\n                            \n                            vec3 power = (color.r+color.g+color.b) * 0.3333 - color;\n                            base.rgb = pow(base.rrr, 1.0 + power);\n\n                            return base;\n                        }\n                        vec3 blendColor(vec3 base, vec3 blend, float opacity) {\n                            return (blendColor(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColor(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"soft-light":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendSoftLight(float base, float blend) {\n                            return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n                        }\n                        vec3 blendSoftLight(vec3 base, vec3 blend) {\n                            return vec3(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b));\n                        }\n                        vec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendSoftLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"hard-light":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendOverlay(float base, float blend) {\n                            return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend) {\n                            return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n                        }\n                        vec3 blendHardLight(vec3 base, vec3 blend) {\n                            return blendOverlay(blend,base);\n                        }\n                        vec3 blendHardLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendHardLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendHardLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"vivid-light":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendColorBurn(float base, float blend) {\n                            return (blend==0.0)?blend:max((1.0-((1.0-base)/blend)),0.0);\n                        }\n                        float blendColorDodge(float base, float blend) {\n                            return (blend==1.0)?blend:min(base/(1.0-blend),1.0);\n                        }\n                        float blendVividLight(float base, float blend) {\n                            return (blend<0.5)?blendColorBurn(base,(2.0*blend)):blendColorDodge(base,(2.0*(blend-0.5)));\n                        }\n                        vec3 blendVividLight(vec3 base, vec3 blend) {\n                            return vec3(blendVividLight(base.r,blend.r),blendVividLight(base.g,blend.g),blendVividLight(base.b,blend.b));\n                        }\n                        vec3 blendVividLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendVividLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendVividLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"overlay":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendOverlay(float base, float blend) {\n                            return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend) {\n                            return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n                            return (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendOverlay(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"multiply":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        vec3 blendMultiply(vec3 base, vec3 blend) {\n                            return base*blend;\n                        }\n                        vec3 blendMultiply(vec3 base, vec3 blend, float opacity) {\n                            return (blendMultiply(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendMultiply(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"color-dodge":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendColorDodge(float base, float blend) {\n                            return (blend==1.0)?blend:min(base/(1.0-blend),1.0);\n                        }\n                        vec3 blendColorDodge(vec3 base, vec3 blend) {\n                            return vec3(blendColorDodge(base.r,blend.r),blendColorDodge(base.g,blend.g),blendColorDodge(base.b,blend.b));\n                        }\n                        vec3 blendColorDodge(vec3 base, vec3 blend, float opacity) {\n                            return (blendColorDodge(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColorDodge(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"color-burn":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendColorBurn(float base, float blend) {\n                            return (blend==0.0)?blend:max((1.0-((1.0-base)/blend)),0.0);\n                        }\n                        vec3 blendColorBurn(vec3 base, vec3 blend) {\n                            return vec3(blendColorBurn(base.r,blend.r),blendColorBurn(base.g,blend.g),blendColorBurn(base.b,blend.b));\n                        }\n                        vec3 blendColorBurn(vec3 base, vec3 blend, float opacity) {\n                            return (blendColorBurn(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColorBurn(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"screen":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendScreen(float base, float blend) {\n                            return 1.0-((1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendScreen(vec3 base, vec3 blend) {\n                            return vec3(blendScreen(base.r,blend.r),blendScreen(base.g,blend.g),blendScreen(base.b,blend.b));\n                        }\n                        vec3 blendScreen(vec3 base, vec3 blend, float opacity) {\n                            return (blendScreen(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendScreen(base.rgb, color.rgb, amount), base.a);\n                        }";break;default:i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = mix(base, color, amount);\n                        }"}t=this.compileShader(i),this.compiledProgram.set("fill-"+e.blend,t)}this.ctx.useProgram(t.program),this.ctx.uniform4f(t.uniform.color,e.color.r/255,e.color.g/255,e.color.b/255,1),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}glamour(e){let t=this.compiledProgram.get("glamour");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n\n                float normpdf(in float x, in float sigma) {\n                    return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;\n                }\n\n                vec3 blurMap() {\n                    //declare stuff\n                    const int mSize = 11;\n                    const int kSize = (mSize-1)/2;\n                    float kernel[mSize];\n                    vec3 final_colour = vec3(0.0);\n                    \n                    //create the 1-D kernel\n                    float sigma = 7.0;\n                    float Z = 0.0;\n                    for (int j = 0; j <= kSize; ++j){\n                        kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), sigma);\n                    }\n                    \n                    //get the normalization factor (as the gaussian has been clamped)\n                    for (int j = 0; j < mSize; ++j){\n                        Z += kernel[j];\n                    }\n                    \n                    //read out the texels\n                    for (int i=-kSize; i <= kSize; ++i){\n                        for (int j=-kSize; j <= kSize; ++j){\n                            final_colour += kernel[kSize+j] * kernel[kSize+i] * texture2D(texture, (uv.xy + vec2(float(i),float(j))*px)).rgb;\n                        }\n                    }\n                    return vec3(final_colour/(Z*Z));\n                }\n\n                float luma(vec3 color) {\n                    return dot(color, vec3(0.299, 0.587, 0.114));\n                }\n\n                void main() {\n                    \n                    vec4 base = texture2D(texture, uv);\n                    vec3 color = blurMap();\n                    \n                    color = vec3(luma(color));\n\n                    color = vec3(\n                        (base.r <= 0.5) ? (2.0 * base.r * color.r) : (1.0 - 2.0 * (1.0 - base.r) * (1.0 - color.r)),\n                        (base.g <= 0.5) ? (2.0 * base.g * color.g) : (1.0 - 2.0 * (1.0 - base.g) * (1.0 - color.g)),\n                        (base.b <= 0.5) ? (2.0 * base.b * color.b) : (1.0 - 2.0 * (1.0 - base.b) * (1.0 - color.b))\n                    );\n                \n                    gl_FragColor = mix(base, vec4(color, base.a), amount);\n                }";t=this.compileShader(e),this.compiledProgram.set("glamour",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}kaleidoscope(e){let t=this.compiledProgram.get("kaleidoscope");if(!t){let e="\n                precision mediump float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n\n                uniform sampler2D texture;\n                uniform vec2 resolution;\n\n                uniform float u_stretch;\n                uniform float u_position;\n                uniform float u_amount;\n\n                int modwhole(float a, float b) {\n                    float m = mod(a, b);\n\n                    return int (m+.5);\n                }\n\n                void main(void) {\n                    int numOfAxis = int(u_amount);\n                    float angleFrac = (2. * PI) / float ( 2 * numOfAxis);\n\n                    vec2 uvc = uv;\n                    uvc -= .5;\n\n                    // Convert to Polar\n                    float phi = abs(atan(uvc.x, uvc.y));\n                    float r = length(uvc);\n\n                    int count = int(phi / angleFrac);\n\n                    phi = mod(phi, angleFrac);\n                    if (modwhole (float(count), 2.) == 1) {\n                        phi = angleFrac - phi;\n                    }\n\n                    // from polar coordiantes\n                    float x = r * cos(phi);\n                    float y = r * sin(phi);\n\n                    float stretch = 1. + (1. - u_stretch);\n                    float position = u_position * PI * .5;\n\n                    uvc = vec2(x, y) * stretch + sin(position);\n\n                    if (uvc.x < 0.) uvc.x += 1.;\n                    if (uvc.x > 1.) uvc.x -= 1.;\n                \n                    if (uvc.y < 0.) uvc.y += 1.;\n                    if (uvc.y > 1.) uvc.y -= 1.;\n\n                    gl_FragColor = texture2D (texture, uvc);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("kaleidoscope",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.u_amount,e.amount),this.ctx.uniform1f(t.uniform.u_stretch,e.stretch),this.ctx.uniform1f(t.uniform.u_position,e.position),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}polarcoordinates(e){let t=this.compiledProgram.get("polarcoordinates");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n                #define PI_2 6.2831\n\n                uniform sampler2D texture;\n                uniform int flip;\n                uniform float overlap;\n                uniform float rotate;\n                uniform vec2 resolution;\n                uniform int symmetry;\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 squareImage(vec2 uv) {\n                    // Aspect Ratio\n                    float ar = resolution.x / resolution.y;\n\n                    // Square the image at the center if rectangular\n                    if (symmetry == 1) {\n                        if (resolution.x > resolution.y) {\n                            float leftEdge = (1.0-1.0/ar) * 0.5;\n                            float rightEdge = 1.0 - leftEdge;\n\n                            if (uv.x < leftEdge) {\n                                uv = vec2(0, uv.y); // Fill in the left edge\n                            } else if (uv.x > rightEdge) {\n                                uv = vec2(1, uv.y); // Fill in the right edge\n                            }\n                            else {\n                                uv.x -= leftEdge; // Square the image on X\n                                uv.x *= ar;\n                            }\n                        } else if (resolution.y > resolution.x) {\n                            float bottomEdge = (1.0-ar) * 0.5;\n                            float topEdge = 1.0 - bottomEdge;\n\n                            if (uv.y < bottomEdge) {\n                                uv = vec2(uv.x, 0); // Fill in the bottom edge\n                            } else if (uv.y > topEdge) {\n                                uv = vec2(uv.x, 1); // Fill in the top edge\n                            }\n                            else {\n                                uv.y -= bottomEdge; // Square the image on Y\n                                uv.y /= ar;\n                            }\n                        }\n                    }\n                    return uv;\n                }\n\n                void main(void) {           \n                    // Square the image\n                    vec2 uvc = squareImage(uv);\n\n                    // Bring uv coordinates to center 0.5\n                    uvc = uvc-0.5;\n\n                    // Rotate uv by angle\n                    uvc = rotate2d( rotate ) * uvc;\n\n                    // Cartesian to polar\n                    float r = length(uvc) * 2.0;\n                    float a = atan(uvc.x, uvc.y);\n\n                    // Move from -PI -> PI to 0 -> 1\n                    vec2 uvp = vec2(a / (PI_2 + overlap) + 0.5, r);\n\n                    // Flip the image by 180 degrees\n                    uvp = flip == 1 ? 1.0 - uvp : uvp;\n\n                    // Compute color\n                    gl_FragColor = texture2D(texture, uvp);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("polarcoordinates",t)}this.ctx.useProgram(t.program),this.ctx.uniform1i(t.uniform.flip,e.flip?1:0),this.ctx.uniform1i(t.uniform.symmetry,e.symmetry?1:0),this.ctx.uniform1f(t.uniform.overlap,e.overlap),this.ctx.uniform1f(t.uniform.rotate,e.rotate),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}fisheye(e){let t=this.compiledProgram.get("fisheye");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n\n                uniform sampler2D texture;\n                uniform vec2 center;\n                uniform float amount;\n                uniform float aperture;\n                uniform int edgeFill;\n                uniform vec2 resolution;\n\n                vec2 edgeFillReflect(vec2 uvc) {\n                    if (uvc.x < 0.) uvc.x = -uvc.x;\n                    if (uvc.y < 0.) uvc.y = -uvc.y;\n                    if (uvc.x > 1.) uvc.x = 2. - uvc.x;\n                    if (uvc.y > 1.) uvc.y = 2. - uvc.y;\n\n                    return uvc;\n                }\n\n                vec2 edgeFillRepeat(vec2 uvc) {\n                    if (uvc.x < 0.) uvc.x = 1. + uvc.x;\n                    if (uvc.y < 0.) uvc.y = 1. + uvc.y;\n                    if (uvc.x > 1.) uvc.x = uvc.x - 1.;\n                    if (uvc.y > 1.) uvc.y = uvc.y - 1.;\n\n                    return uvc;\n                }\n\n                int edgeFillNone(vec2 uvc) {\n                    if (uvc.x < 0. || uvc.y < 0. || uvc.x > 1. || uvc.y > 1.) {\n                        return 1;\n                    }\n                    return 0;\n                }\n\n                void main(void) {\n\n                    // Normalized device space i.e. range of [-1, 1]\n                    vec2 ndcPos = uv * 2. - center * 2.;\n\n                    // Aspect ratio of the viewport\n                    float aspect = resolution.x / resolution.y;\n\n                    // Relationship between the radius of the perimeter circle (r or half_dist) and\n                    // the angle (eye_angle): \n                    // Bisect the isosceles triangle\n                    float eye_angle = abs(aperture);\n                    float half_angle = eye_angle / 2.;\n                    float half_dist = tan(half_angle);\n\n                    // With the aspect ratio of the viewport (aspect)\n                    vec2 vp_scale = vec2(aspect, 1.);\n                    vec2 P = ndcPos * vp_scale;\n\n                    // Diameter or the length of the viewport\n                    float vp_dia = length(vp_scale);\n\n                    // Relative distance to the center of the viewport\n                    float rel_dist = length(P) / vp_dia;\n\n                    // Relative position of the point P in relation to the aspect ratio\n                    vec2 rel_P = normalize(P) / normalize(vp_scale);\n\n                    vec2 pos_prj = ndcPos;\n                    if (aperture > 0.) {\n                        // Projection from spherical surface to the place\n                        float beta = rel_dist * half_angle;\n                        pos_prj = rel_P * tan(beta) / half_angle * pow(.9, amount * 5.);\n                    } else if (aperture < 0.) {\n                        // Projection from the plane to the spherical surface\n                        float beta = atan(rel_dist * half_dist);\n                        pos_prj = rel_P * beta / half_angle * pow(.9, amount * 5.);\n                    }\n\n                    vec2 uv_prj = pos_prj * .5 + center;\n\n                    // Return transparent if no edge fill\n                    if (edgeFill == 0) {\n                        if (edgeFillNone(uv_prj) == 1) {\n                            discard;\n                        }\n                    }\n                    if (edgeFill == 1) {\n                        uv_prj = edgeFillReflect(uv_prj);\n                    } \n                    if (edgeFill == 2) {\n                        uv_prj = edgeFillRepeat(uv_prj);\n                    }\n\n                    gl_FragColor = texture2D(texture, uv_prj);;\n                }";t=this.compileShader(e),this.compiledProgram.set("fisheye",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform1f(t.uniform.aperture,e.aperture),this.ctx.uniform2f(t.uniform.center,e.x,e.y),this.ctx.uniform1i(t.uniform.edgeFill,e.edgeFill),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}wave(e){let t=this.compiledProgram.get("wave");if(!t){let e="\n                precision mediump float;\n                uniform int type;\n                uniform float amplitude;\n                uniform float scale;\n                varying vec2 uv;\n                uniform int edgeApprox;\n                // uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float rotate;\n                #define PI 3.14159265359\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                float cot(float angle) {\n                    return cos(angle) / sin(angle);\n                }\n\n                float sinewave(float rad) {\n                    return amplitude * sin(scale * 2. * PI * rad);\n                }\n\n                float trianglewave(float rad) {\n                    return amplitude * 2. / PI * asin(sin(scale * 2. * PI * rad));\n                }\n\n                float squarewave(float rad) {\n                    return amplitude * sign(sin(scale * 2. * PI * rad));\n                }\n\n                void main() {\n                    vec2 uvc = uv;\n\n                    uvc -= 0.5;\n                    uvc = rotate2d(-rotate) * uvc;\n\n                    if (type == 0) {\n                        // sine wave\n                        uvc.y = sinewave(uvc.x) + uvc.y;\n                    } else if (type == 1) {\n                        // triangular wave\n                        uvc.y = trianglewave(uvc.x) + uvc.y;\n                    } else if (type == 2) {\n                        // square wave\n                        uvc.y = squarewave(uvc.x) + uvc.y;\n                    } else {\n                        // sawtooth wave\n                        // uvc.y = amplitude * 2. / PI * atan(cot(scale * 2. * PI * uvc.x));\n                    }\n                    \n                    uvc = rotate2d(rotate) * uvc;\n                    uvc += 0.5;\n                    \n                    // Clamp\n                    // uvc = clamp(uvc, 0., 1.);\n\n                    if (edgeApprox == 2) {\n                        // Repeat acros the edges with the opposite side color\n                        if (uvc.x < 0.) uvc.x = 1. + uvc.x;\n                        if (uvc.y < 0.) uvc.y = 1. + uvc.y;\n                        if (uvc.x > 1.) uvc.x = uvc.x - 1.;\n                        if (uvc.y > 1.) uvc.y = uvc.y - 1.;\n                    } else if (edgeApprox == 1) {\n                        // Approximate (natural) around the edges with the reflection color\n                        if (uvc.x < 0.) uvc.x = -uvc.x;\n                        if (uvc.y < 0.) uvc.y = -uvc.y;\n                        if (uvc.x > 1.) uvc.x = 2. - uvc.x;\n                        if (uvc.y > 1.) uvc.y = 2. - uvc.y;    \n                    } else {\n                        // Don't approximate, render transparent\n                        if (uvc.x < 0. || uvc.x > 1. || \n                            uvc.y < 0. || uvc.y > 1.) {\n                            gl_FragColor = vec4 (0.0, 0.0, 0.0, 0.0);\n                            return;\n                        }    \n                    }\n\n                    gl_FragColor = texture2D(texture, uvc);\n                    return;\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("wave",t)}this.ctx.useProgram(t.program),this.ctx.uniform1i(t.uniform.type,e.type),this.ctx.uniform1f(t.uniform.amplitude,e.amplitude),this.ctx.uniform1f(t.uniform.scale,e.scale),this.ctx.uniform1f(t.uniform.rotate,e.rotate),this.ctx.uniform1i(t.uniform.edgeApprox,e.edgeApprox),this.draw(t)}reflect(e){let t=this.compiledProgram.get("reflect");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n                #define PI_2 6.2831\n\n                uniform sampler2D texture;\n                uniform int type;\n                uniform vec2 resolution;\n                uniform vec2 center;\n\n                // constant integers for directions\n                const int RIGHT = 1, LEFT = -1, ZERO = 0;\n\n                const float ALMOST_ZERO = 0.00001;\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 squareImage(vec2 uv) {\n                    // return uv;\n\n                    float ar = resolution.x / resolution.y;\n\n                    if (resolution.x > resolution.y) {\n                        uv.y /= ar;\n                    }\n                    else {\n                        uv.x *= ar;\n                    }\n                    return uv;\n                }\n\n                vec2 squareImagereverse(vec2 uv) {\n                    float ar = resolution.x / resolution.y;\n\n                    if (resolution.x > resolution.y) {\n                        uv.y /= ar;\n                        uv.y += (1. - 1./ar) * 0.5;\n                    }\n                    else {\n                        uv.x *= ar;\n                        uv.x += (1. - ar) * 0.5;\n                    }\n                    return uv;\n                }\n\n                int direction(vec2 A, vec2 B, vec2 P) {\n                    // subtracting co-ordinates of point A from\n                    // B and P, to make A as origin\n                    B.x -= A.x;\n                    B.y -= A.y;\n                    P.x -= A.x;\n                    P.y -= A.y;\n                \n                    // Determining cross Product\n                    float cross_product = B.x * P.y - B.y * P.x;\n                \n                    // return RIGHT if cross product is positive\n                    if (cross_product > ALMOST_ZERO)\n                        return LEFT;\n                \n                    // return LEFT if cross product is negative\n                    if (cross_product < -ALMOST_ZERO)\n                        return RIGHT;\n                \n                    // return ZERO if cross product is zero.\n                    return ZERO;\n                }\n                \n                vec2 reflectmagic(vec2 uvc, int reflectfrom, mat2 transf, vec2 A, vec2 B, vec2 center) {\n\n                    vec2 cent = center - 0.5;\n                    uvc -= center;\n\n                    int dircent = direction(A, B, cent);\n                    int diruv = direction(A, B, uvc);\n\n                    uvc = dircent >= ZERO && diruv >= ZERO || dircent == LEFT && diruv == LEFT ? transf * uvc : uvc;\n\n                    uvc += center;\n\n                    uvc -= 0.5;\n\n                    if (reflectfrom == LEFT) {\n                        uvc = dircent >= ZERO ? uvc : transf * uvc;\n                    } else {\n                        uvc = dircent == LEFT ? uvc : transf * uvc;\n                    }\n\n                    uvc += 0.5;\n\n                    return uvc;\n                }\n\n                vec2 reflectx(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(-1., 0., 0., 1.);     \n\n                    vec2 A = vec2 (0., -1.);\n                    vec2 B = vec2 (0., 1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, center);\n                }\n\n                vec2 reflecty(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(1., 0., 0., -1.);    \n\n                    vec2 A = vec2 (-1., 0.);\n                    vec2 B = vec2 (1., 0.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, center);\n                }\n\n                vec2 reflectxequalminusy(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(0., 1., 1., 0.);\n\n                    vec2 A = vec2 (-1., -1.);\n                    vec2 B = vec2 (1., 1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, vec2(center.x, 1.-center.x));\n                }\n\n                vec2 reflectxequaly(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(0., -1., -1., 0.);\n\n                    vec2 A = vec2 (-1., 1.);\n                    vec2 B = vec2 (1., -1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, vec2(center.x, center.x));\n                }\n\n                vec2 reflect(vec2 uvc) {\n                    //reflect-type-minus-x\n                    if (type == 1) {\n                        uvc = reflectx(uvc, LEFT);\n                    }\n\n                    //reflect-type-minus-y\n                    else if (type == 2) {\n                        uvc = reflecty(uvc, LEFT);\n                    }\n\n                    //reflect-type-plus-x\n                    if (type == 3) {\n                        uvc = reflectx(uvc, RIGHT);\n                    }\n\n                    //reflect-type-plus-y\n                    else if (type == 4) {\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n\n                    //reflect-type-minus-x-minus-y\n                    else if (type == 5) {\n                        uvc = reflectx(uvc, LEFT);\n                        uvc = reflecty(uvc, LEFT);\n                    }\n\n                    //reflect-type-minus-x-plus-y\n                    else if (type == 6) {\n                        uvc = reflectx(uvc, LEFT);\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n\n                    //reflect-type-plus-x-plus-y\n                    else if (type == 7) {\n                        uvc = reflectx(uvc, RIGHT);\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n\n                    //reflect-type-plus-x-minus-y\n                    else if (type == 8) {\n                        uvc = reflectx(uvc, RIGHT);\n                        uvc = reflecty(uvc, LEFT);\n                    }\n\n                    //reflect-type-above-x-equalto-y\n                    else if (type == 9) {\n                        uvc = reflectxequalminusy(uvc, LEFT);\n                    }\n\n                    // reflect-type-below-x-equalto-minus-y\n                    else if (type == 10) {\n                        uvc = reflectxequaly(uvc, RIGHT);\n                    }\n\n                    // reflect-type-above-x-equalto-minus-y\n                    else if (type == 11) {\n                        uvc = reflectxequaly(uvc, LEFT);\n                    }\n\n                    // reflect-type-below-x-equalto-y\n                    else if (type == 12) {\n                        uvc = reflectxequalminusy(uvc, RIGHT);\n                    }\n\n                    return uvc;\n                }\n\n                void main(void) {\n                    vec2 uvc = reflect(uv);\n                    gl_FragColor = texture2D(texture, uvc);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("reflect",t)}this.ctx.useProgram(t.program),this.ctx.uniform1i(t.uniform.type,e.type),this.ctx.uniform2f(t.uniform.center,e.x,e.y),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}bloom(e){let t=this.compiledProgram.get("bloom");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n                float thresh = .5;\n                \n                void main() {\n                    vec4 sum = vec4(0);\n                \n                    // mess of for loops due to gpu compiler/hardware limitations\n                    int j=-2;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=-1;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=0;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=1;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=2;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    sum/=25.0;\n                \n                    gl_FragColor= texture2D(texture, uv);\n                \n                    // use the blurred colour if it's bright enough\n                    if (length(sum) > thresh) {\n                        gl_FragColor += sum*amount;\n                    }\n                }";t=this.compileShader(e),this.compiledProgram.set("bloom",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}posterize(e){let t=this.compiledProgram.get("posterize");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                float areas = 256.0 / amount;\n                float values = 255.0 / (amount - 1.0);\n                \n                void main() {\n                    vec4 px = texture2D(texture, uv);\n\n                    px.r = floor(values * floor((px.r*255.0) / areas))/255.0;\n                    px.g = floor(values * floor((px.g*255.0) / areas))/255.0;\n                    px.b = floor(values * floor((px.b*255.0) / areas))/255.0;\n\n                    gl_FragColor = px;\n                }";t=this.compileShader(e),this.compiledProgram.set("posterize",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,100*e+1),this.draw(t)}fringe(e){let t=this.compiledProgram.get("fringe");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 amount;\n\n                void main() {\n                    vec2 dir = uv - vec2( .5 );\n                    float d = .7 * length( dir );\n                    normalize( dir );\n                    vec2 value = d * dir * amount;\n                \n                    vec4 c1 = texture2D( texture, uv - value);\n                    vec4 c2 = texture2D( texture, uv );\n                    vec4 c3 = texture2D( texture, uv + value);\n                    \n                    gl_FragColor = vec4( c1.r, c2.g, c3.b, c1.a + c2.a + c3.b);\n                }";t=this.compileShader(e),this.compiledProgram.set("fringe",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.amount,e,e),this.draw(t)}rgbSplit(e){let t=0,i=0,s=0;const n=e.distance;switch(e.type){case"red-blue":t=n,s=-n;break;case"green-red":t=-n,i=n;break;case"blue-green":i=-n,s=n;break;case"red":t=n;break;case"green":i=n;break;case"blue":s=n}let a=this.compiledProgram.get("rgb-split");if(!a){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                uniform vec2 r;\n                uniform vec2 g;\n                uniform vec2 b;\n\n                void main() {\n                \n                    vec4 px = texture2D(texture, uv);\n\n                    vec4 c1 = texture2D( texture, uv - r);\n                    vec4 c2 = texture2D( texture, uv - g);\n                    vec4 c3 = texture2D( texture, uv - b);\n                    \n                    gl_FragColor = mix(px, vec4( c1.r, c2.g, c3.b, (c1.a + c2.a + c3.a)/3.0), amount);\n                }";a=this.compileShader(e),this.compiledProgram.set("rgb-split",a)}this.ctx.useProgram(a.program),this.ctx.uniform1f(a.uniform.amount,e.amount);var r=e.direction*Math.PI/180,o=Math.cos(r),h=Math.sin(r);this.ctx.uniform2f(a.uniform.r,o*t,h*t),this.ctx.uniform2f(a.uniform.g,o*i,h*i),this.ctx.uniform2f(a.uniform.b,o*s,h*s),this.draw(a)}interference(e){let t=this.compiledProgram.get("interference");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float amount;\n                uniform int direction;\n\n                float rand(vec2 co){\n                    return fract(sin(dot(co.xy, vec2(12.9898,78.233)*3.141)) * 43758.5453);\n                }\n\n                void main() {\n\n                    float rand1 = rand(vec2(seed,seed));\n                    float rand2 = rand(vec2(seed,rand1));\n                \n                    float rand1xy = rand(vec2(rand1*uv.x,rand2*uv.y));\n                    float rand2xy = rand(vec2(rand1*uv.y,rand2*uv.x));\n                  \n                    float rand1x = rand(vec2(rand1*uv.x,rand2));\n                    float rand2x = rand(vec2(rand1x,rand1x));     \n\n                    float rand1y = rand(vec2(rand1*uv.y,rand2));\n                    float rand2y = rand(vec2(rand1y,rand1y));                       \n                    \n                    if(direction == 0) {\n                        if(rand2y/100.0 > rand1y) {\n                            if(rand2xy < 0.3) gl_FragColor = vec4(rand1xy, rand1xy, rand1xy, 0.0);\n                            else gl_FragColor = texture2D(texture, uv);\n                        }\n                        else {\n                            gl_FragColor = texture2D(texture, vec2(uv.x + rand1y * amount, uv.y));\n                        }\n                    } else {\n                        if(rand2x/100.0 > rand1x) {\n                            if(rand2xy < 0.3) gl_FragColor = vec4(rand1xy, rand1xy, rand1xy, 0.0);\n                            else gl_FragColor = texture2D(texture, uv);\n                        }\n                        else {\n                            gl_FragColor = texture2D(texture, vec2(uv.x, uv.y + rand1x * amount));\n                        }\n                    }\n                }";t=this.compileShader(e),this.compiledProgram.set("interference",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.seed,e.seed),this.ctx.uniform1f(t.uniform.amount,e.amount/15),this.ctx.uniform1i(t.uniform.direction,e.direction?1:0),this.draw(t)}bleed(e){let t=this.compiledProgram.get("bleed");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float block;\n                uniform float amplitude;\n              \n                float rand(vec2 n) { \n                    return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n                }\n                float randomRange (in vec2 sd, in float min, in float max) {\n                    return min + rand(sd) * (max - min);\n                }\n                float insideRange(float v, float bottom, float top) {\n                   return step(bottom, v) - step(top, v);\n                }\n\n                float noise(vec2 uv, float blockiness){   \n                    vec2 lv = fract(uv);\n                    vec2 id = floor(uv);\n                    \n                    float n1 = rand(id);\n                    float n2 = rand(id+vec2(1,0));\n                    float n3 = rand(id+vec2(0,1));\n                    float n4 = rand(id+vec2(1,1));\n                    \n                    vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n\n                    return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n                }\n\n                float fbm(vec2 uv, int count, float blockiness, float complexity) {\n                    float val = 0.0;\n                    float amp = 0.5;\n                    \n                    for (int i = 0; i < 1000; i++) {\n                        if(i == count) break;\n                        \n                        val += amp * noise(uv, blockiness);\n                        amp *= 0.5;\n                        uv *= complexity;    \n                    }  \n                    return val;\n                }\n\n                const float shift = 2.0; //2\n\n                void main()\n                {\n                    vec4 px = texture2D(texture, uv);\n\n                    for (float i = 0.0; i < 20.0; i += 1.0) {\n\n                        float sliceY = rand(vec2(seed, 2035.0 + float(i)));\n                        float sliceX = rand(vec2(seed, 3234.0 + float(i)));\n\n                        float sliceH = rand(vec2(seed, 2035.0 - float(i))) * 0.1;\n                        float sliceW = rand(vec2(seed, 3234.0 + float(i))) * 1.5;\n\n                        if(insideRange(uv.y, sliceY, fract(sliceY+sliceH)) == 1.0 && insideRange(uv.x, sliceX, fract(sliceX+sliceW)) == 1.0){\n                           \n                            vec2 id = floor(uv * 5.0);\n        \n                            // Generate shift amplitude\n                            float shift = amplitude * fbm(uv, int(id * 6.), shift, block);\n                            //float shift = randomRange(vec2(seed, 5234.0 + float(i)), -amplitude, amplitude);\n        \n                            float r = texture2D(texture, vec2(uv.x + shift, uv.y)).r * (1. - shift) ;\n                            float g = texture2D(texture, vec2(uv.x - shift, uv.y)).g * (1. - shift) + rand(id) * shift;\n                            float b = texture2D(texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n        \n                            px = mix(vec4(r, g, b, px.a), px, 0.5);\n                        }\n                        gl_FragColor = px;\n                    }\n                }";t=this.compileShader(e),this.compiledProgram.set("bleed",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.seed,e.seed),this.ctx.uniform1f(t.uniform.amplitude,e.amplitude),this.ctx.uniform1f(t.uniform.block,e.block),this.draw(t)}slice(e){let t=this.compiledProgram.get("slice");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float amount;\n                uniform float distance;\n                uniform int line;\n\n                //2D (returns 0 - 1)\n                float random2d(vec2 n) { \n                    return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n                }\n                float randomRange (in vec2 sd, in float min, in float max) {\n                    return min + random2d(sd) * (max - min);\n                }\n                \n                // return 1 if v inside 1d range\n                float insideRange(float v, float bottom, float top) {\n                   return step(bottom, v) - step(top, v);\n                }\n                  \n                void main() {\n                  \n                    vec4 px = texture2D(texture, uv);\n\n                    for (float i = 0.0; i < 100.0; i += 1.0) {\n\n                        if(i == amount) break;\n\n                        float sliceY = random2d(vec2(seed, 2035.0 + float(i)));\n                        float sliceX = random2d(vec2(seed, 5234.0 + float(i)));\n\n                        float sliceH = random2d(vec2(seed, 2035.0 - float(i))) * 0.1;\n                        float sliceW = random2d(vec2(seed, 5234.0 + float(i))) * 1.5;\n\n                        float hOffset = randomRange(vec2(seed, 2035.0 + float(i)), -distance*.5, distance*.5);\n                        float wOffset = randomRange(vec2(seed, 5234.0 + float(i)), -distance, distance);\n\n                        vec2 uvOff = uv;\n                        uvOff.x += wOffset;\n                        uvOff.y += hOffset;\n\n                        if(insideRange(uv.y, sliceY, fract(sliceY+sliceH)) == 1.0 && (line == 1 || insideRange(uv.x, sliceX, fract(sliceX+sliceW)) == 1.0)){\n                            px = texture2D(texture, uvOff);\n                        }\n                    }\n                    gl_FragColor = px;\n                }";t=this.compileShader(e),this.compiledProgram.set("slice",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.seed,e.seed),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform1f(t.uniform.distance,e.distance/3),this.ctx.uniform1i(t.uniform.line,e.line?1:0),this.draw(t)}mimicHDR(e){let t=this.compiledProgram.get("mimicHDR");if(!t){const e="\n                precision highp float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform sampler2D blurMap;\n\n                uniform float amount;\n                uniform float contra;\n                \n                float blendSoftLight(float base, float blend) {\n                    return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n                }\n                vec4 blendSoftLight(vec4 base, vec4 blend) {\n                    return vec4(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b), base.a);\n                }\n\n                float blendOverlay(float base, float blend) {\n                    return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                }\n                vec4 blendOverlay(vec4 base, vec4 blend) {\n                    return vec4(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b), base.a);\n                }\n               \n                void main() {\n                    vec4 px = texture2D(texture, uv);\n                    vec4 blur = texture2D(blurMap, uv);\n\n                    vec4 blend = blendOverlay(px, blur);\n                    blend = mix(blend, blendSoftLight(px, blend), contra);\n\n                    gl_FragColor = mix(px, blend, amount);\n                }";t=this.compileShader(e),this.compiledProgram.set("mimicHDR",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform1f(t.uniform.contra,e.contra);let i=t.getTextureById("blurMap");i.createTexture(this.ctx,e.blurMap.width,e.blurMap.height),i.uploadData(this.ctx,e.blurMap),this.draw(t)}pixelate(e){let t=this.compiledProgram.get("pixelate");if(!t){const e="\n                precision highp float;\n                varying vec2 uv;\n                uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    float d = 1.0 / amount;\n                    float ar = resolution.x / resolution.y;\n                    float u = floor( uv.x / d ) * d + d*0.5;\n                    d = ar / amount;\n                    float v = floor( uv.y / d ) * d + d*0.5;\n                    gl_FragColor = texture2D(texture, vec2( u, v ) );\n                }";t=this.compileShader(e),this.compiledProgram.set("pixelate",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,4*(100-100*e)),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}scanlines(e){let t=this.compiledProgram.get("scanlines");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform float size;\n\n                uniform int colorize;\n                uniform int direction;\n\n                void main() {\n                    \n                    vec2 sl;\n                    vec4 scanlines;\n                    vec4 color = texture2D(texture, uv);\n\n                    if(direction == 0) {\n                        sl = vec2(sin(uv.y * size), cos(uv.y * size)) * amount;\n                    }\n                    else {\n                        sl = vec2(sin(uv.x * size), cos(uv.x * size)) * amount;\n                    }\n\n                    if(colorize == 1) {\n                        scanlines = vec4(sl.x, sl.y, sl.x, 1.0);\n                    } \n                    else {\n                        scanlines = vec4(sl.x, sl.x, sl.x, 1.0);\n                    }\n\n                    gl_FragColor = vec4(color.r + scanlines.r, color.g + scanlines.g, color.b + scanlines.b, color.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("scanlines",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.size,e.direction?Math.round(this.height/e.size):Math.round(this.width/e.size)),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform1i(t.uniform.colorize,e.colorize?1:0),this.ctx.uniform1i(t.uniform.direction,e.direction?1:0),this.draw(t)}mosaic(e){let t=this.compiledProgram.get("mosaic");if(!t){const e="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform vec2 num;\n                \n                void main()\n                {\n                    vec2 uv = uv;\n                    vec2 uv2 = floor(uv*num)/num;\n                    uv -= uv2;\n                    uv *= num;\n                    gl_FragColor = texture2D(texture, \n                                    uv2 + vec2(step(1.0-uv.y,uv.x)/(2.0*num.x),\n                                    step(uv.x,uv.y)/(2.0*num.y)));\n                }";t=this.compileShader(e),this.compiledProgram.set("mosaic",t)}let i=Math.round(100*(1-e)),s=Math.round(this.height/this.width*i);this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.num,i,s),this.draw(t)}bokeh(e){let t=this.compiledProgram.get("bokeh-"+e.type);if(!t){let i="";switch(e.type){case"circle":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define PI 3.1415926538\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);                          \n                            float rc = 0.0;\n\n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    float l = length(vec2(x-spread,y-spread));\n                                    if(l <= spread)\n                                    {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }";break;case"square":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg = vec3(0.0);\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                    mcol = max(mcol, col);\n                                    avg += col;\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / (myx * myx), mcol, amount), 1.0);\n                        }";break;case"hexagon":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define PI 3.1415926538\n                        #define PI2 6.283185308\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);\n                            float rc = 0.0;\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    vec2 pt = vec2(x-spread, y-spread);\n        \n                                    float an = 0.33 + atan(pt.x, pt.y); //0.33 Angle\n                                    float ngon = cos(an - (PI2 * floor((PI + 6.0 * an) / PI2)) / 6.0) / cos(PI / 6.0); //6 corners\n                                    float ngonSdf = ngon * length(pt) - spread;\n                            \n                                    if(ngonSdf <= 0.0) {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread, y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }";break;case"cross":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n        \n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);\n                            float rc = 0.0;\n        \n                            float myx = spread*2.0;\n                            float low = spread*.7;\n                            float high = spread*1.3;\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    if((y > low && y < high) || (x > low && x < high))\n                                    {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }"}t=this.compileShader(i),this.compiledProgram.set("bokeh-"+e.type,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.size,e.size),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}art(e){let t=this.compiledProgram.get("art");if(!t){let e=["precision highp float;","uniform sampler2D texture;","varying vec2 uv;","void main() {","vec4 color, tmp, add;","vec2 uv = uv + vec2( sin( uv.y * 100.0 ), sin( uv.x * 100.0 )) * 0.0005;","color = texture2D( texture, uv );","add = tmp = texture2D( texture, uv + vec2( 0.0015, 0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.0015, 0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.0015, -0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0.0015, -0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0.002, 0.0 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.002, 0.0 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0, 0.002 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0, -0.002 ));","if( tmp.r < color.r ) color = tmp;","uv = (uv - vec2(0.5)) * vec2(0.7);","gl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("art",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.screenWidth,this.canvas.width),this.ctx.uniform1f(t.uniform.screenHeight,this.canvas.height),this.ctx.uniform1f(t.uniform.sampleDistance,e),this.ctx.uniform1f(t.uniform.waveFactor,.01),this.draw(t)}melt(e){let t=this.compiledProgram.get("melt");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 center;\n              \n                float rand(vec2 co){\n                    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n                }\n                vec3 mod289(vec3 x) {\n                    return x - floor(x * (1.0 / 289.0)) * 289.0;\n                }\n                  \n                vec2 mod289(vec2 x) {\n                    return x - floor(x * (1.0 / 289.0)) * 289.0;\n                }\n                  \n                vec3 permute(vec3 x) {\n                    return mod289(((x*34.0)+1.0)*x);\n                }\n                  \n                float snoise(vec2 v) {\n\n                    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                                       -0.577350269189626,  // -1.0 + 2.0 * C.x\n                                        0.024390243902439); // 1.0 / 41.0\n                  // First corner\n                    vec2 i  = floor(v + dot(v, C.yy) );\n                    vec2 x0 = v -   i + dot(i, C.xx);\n                  \n                  // Other corners\n                    vec2 i1;\n                    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n                    vec4 x12 = x0.xyxy + C.xxzz;\n                    x12.xy -= i1;\n                  \n                  // Permutations\n                    i = mod289(i); // Avoid truncation effects in permutation\n                    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n                          + i.x + vec3(0.0, i1.x, 1.0 ));\n                  \n                    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n                    m = m*m ;\n                    m = m*m ;\n                                   \n                    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n                    vec3 h = abs(x) - 0.5;\n                    vec3 ox = floor(x + 0.5);\n                    vec3 a0 = x - ox;\n                  \n                    m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n                  \n                  // Compute final noise value at P\n                    vec3 g;\n                    g.x  = a0.x  * x0.x  + h.x  * x0.y;\n                    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n                    return 130.0 * dot(m, g);\n                }\n\n                void main() {\n                    vec4 px = texture2D(texture, uv);\n                    \n                    float opacity = 0.0;\n\n                    if(amount == 0.0 || amount == 1.0) {\n                        opacity = amount;\n                    } \n                    else {\n                        if(center.x == 0.5) {\n                            float dist = distance(center, uv)- amount*exp(snoise(vec2(uv.x, 0.0)));\n                            float r = amount - rand(vec2(uv.x, 0.1));\n                            opacity = dist <= r ? 1.0 : (amount*amount*amount);\n                        }\n                        else {\n                            float dist = distance(center, uv)- amount*exp(snoise(vec2(0.0, uv.y)));\n                            float r = amount - rand(vec2(0.1, uv.y));\n                            opacity = dist <= r ? 1.0 : (amount*amount*amount);\n                        }   \n                    }\n                    gl_FragColor = vec4(px.rgb, px.a * (1.0 - opacity));\n                }";t=this.compileShader(e),this.compiledProgram.set("melt",t)}this.ctx.useProgram(t.program);let i=new s.Z(.5,.5);switch(e.direction){case"down":i.y=0;break;case"right":i.x=1;break;case"left":i.x=0;break;case"up":i.y=1}this.ctx.uniform2f(t.uniform.center,i.x,i.y),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}gooey(e){let t=this.compiledProgram.get("gooey");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                // http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\n                float random(vec2 co) {\n\n                    highp float a = 12.9898; //seed;\n                    highp float b = 78.233;\n                    highp float c = 43758.5453;\n                    highp float dt= dot(co.xy ,vec2(a,b));\n                    highp float sn= mod(dt,3.14);\n                    return fract(sin(sn) * c);\n                }\n\n                // 2D Noise based on Morgan McGuire @morgan3d\n                // https://www.shadertoy.com/view/4dS3Wd\n                float noise (in vec2 st) {\n\n                    vec2 i = floor(st);\n                    vec2 f = fract(st);\n\n                    // Four corners in 2D of a tile\n                    float a = random(i);\n                    float b = random(i + vec2(1.0, 0.0));\n                    float c = random(i + vec2(0.0, 1.0));\n                    float d = random(i + vec2(1.0, 1.0));\n\n                    // Cubic Hermine Curve.  Same as SmoothStep()\n                    vec2 u = f*f*(3.0-2.0*f);\n\n                    // Mix 4 coorners porcentages\n                    return mix(a, b, u.x) +\n                            (c - a)* u.y * (1.0 - u.x) +\n                            (d - b) * u.x * u.y;\n                }\n\n                void main() {\n\n                    vec4 col = texture2D(texture, uv);\n                    float n = noise(uv * 10.0); //scale\n                    \n                    float p = mix(-0.01, 1.0 + 0.01, amount);\n                    float lower = p - 0.01;\n                    float higher = p + 0.01;\n                    \n                    float opacity = smoothstep(lower, higher, n);\n                    \n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";t=this.compileShader(e),this.compiledProgram.set("gooey",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}block(e){let t=this.compiledProgram.get("block");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                float rand (vec2 co) {\n                    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n                }\n\n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                    \n                    float r = rand(floor(vec2(10.0) * uv)); //size\n                    float opacity = smoothstep(0.0, -0.5, r - (amount * (1.0 + 0.5)));\n                   \n                    gl_FragColor = vec4(col.rgb, col.a * (1.0 - opacity));\n                }";t=this.compileShader(e),this.compiledProgram.set("block",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}curtain(e){let t=this.compiledProgram.get("curtain-"+e.direction);if(!t){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec2 p = uv;\n                    vec4 col = vec4(0);\n                ";"horizontal"===e.direction?i+="                    \n                        if(2.0 * abs(p.x-0.5) - amount > 0.0) {\n                            p = p + (p.x > 0.5 ? -1.0 : 1.0) * vec2(0.5*amount, 0.0);\n                            col = texture2D(texture, p);\n                        }\n                    ":i+="\n                        if(2.0 * abs(p.y-0.5) - amount > 0.0) {\n                            p = p + (p.y > 0.5 ? -1.0 : 1.0) * vec2(0.0, 0.5*amount);\n                            col = texture2D(texture, p);\n                        }\n                    ",i+="\n                    gl_FragColor = col;\n                }",t=this.compileShader(i),this.compiledProgram.set("curtain-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}blinds(e){let t=this.compiledProgram.get("blinds-"+e.direction);if(!t){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                ";switch(e.direction){case"up":i+="float opacity = step(smoothstep(-0.5, 0.0, (1.0 - uv.y) - amount * (1.0 + 0.5)), fract(12.0 * uv.y));";break;case"right":i+="float opacity = step(smoothstep(-0.5, 0.0, (1.0 - uv.x) - amount * (1.0 + 0.5)), fract(12.0 * uv.x));";break;case"left":i+="float opacity = step(smoothstep(-0.5, 0.0, uv.x - amount * (1.0 + 0.5)), fract(12.0 * uv.x));";break;case"down":i+="float opacity = step(smoothstep(-0.5, 0.0, uv.y - amount * (1.0 + 0.5)), fract(12.0 * uv.y));"}i+="\n                    gl_FragColor = vec4(col.rgb, col.a * (1.0 - opacity));\n                }",t=this.compileShader(i),this.compiledProgram.set("blinds-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}wipe(e){let t=this.compiledProgram.get("wipe-"+e.direction);if(!t){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                ";switch(e.direction){case"down":i+="float opacity = 1.0 - step(uv.y, amount);";break;case"right":i+="float opacity = step(uv.x, 1.0 - amount);";break;case"left":i+="float opacity = 1.0 - step(uv.x, amount);";break;case"up":i+="float opacity = step(uv.y, 1.0 - amount);"}i+="\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }",t=this.compileShader(i),this.compiledProgram.set("wipe-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}swipe(e){let t=this.compiledProgram.get("swipe-"+e.direction);if(!t){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec4 color; \n              \n                void main() {\n\n                ";switch(e.direction){case"down":i+="\n                        if(amount > 0.5) gl_FragColor = vec4(color.rgb, 1.0 - step(1.0 + uv.y, amount*2.0));\n                        else gl_FragColor = step(uv.y, amount*2.0) == 1.0 ? color : texture2D(texture, uv);\n                    }";break;case"right":i+="\n                        if(amount > 0.5) gl_FragColor = vec4(color.rgb, 1.0 - step(2.0 - uv.x, amount*2.0));\n                        else gl_FragColor = step(1.0 - uv.x, amount*2.0) == 1.0 ? color : texture2D(texture, uv);\n                    }";break;case"left":i+="\n                        if(amount > 0.5) gl_FragColor = vec4(color.rgb, 1.0 - step(1.0 + uv.x, amount*2.0));\n                        else gl_FragColor = step(uv.x, amount*2.0) == 1.0 ? color : texture2D(texture, uv);\n                    }";break;case"up":i+="\n                        if(amount > 0.5) gl_FragColor = vec4(color.rgb, 1.0 - step(2.0 - uv.y, amount*2.0));\n                        else gl_FragColor = step(1.0 - uv.y, amount*2.0) == 1.0 ? color : texture2D(texture, uv);\n                    }"}t=this.compileShader(i),this.compiledProgram.set("swipe-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform4f(t.uniform.color,e.color.r/255,e.color.g/255,e.color.b/255,1),this.draw(t)}slot(e){let t=this.compiledProgram.get("slot");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 dir;\n\n                void main() {\n                   \n                    vec2 p = uv + amount * sign(dir);\n                    vec2 f = fract(p);\n                    float opacity = step(0.0, p.y) * step(p.y, 1.0) * step(0.0, p.x) * step(p.x, 1.0);\n                   \n                    vec4 col = texture2D(texture, p);\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";t=this.compileShader(e),this.compiledProgram.set("slot",t)}let i=new s.Z(0,0);switch(e.direction){case"down":i.y=-1;break;case"right":i.x=1;break;case"left":i.x=-1;break;case"up":i.y=1}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.dir,i.x,i.y),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}marquee(e){let t=this.compiledProgram.get("marquee");if(!t){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 dir;\n\n                void main() {\n                   \n                    vec2 p = uv + amount * sign(dir);\n                ";switch(e.direction){case"up":i+="if(p.y < 0.0) p.y += 1.0;";break;case"down":i+="if(p.y > 1.0) p.y -= 1.0;";break;case"right":i+="if(p.x < 0.0) p.x += 1.0;";break;case"left":i+="if(p.x > 1.0) p.x -= 1.0;"}i+="\n         \n                    gl_FragColor = texture2D(texture, p);\n                }",t=this.compileShader(i),this.compiledProgram.set("marquee",t)}let i=new s.Z(0,0);switch(e.direction){case"up":i.y+=-1;break;case"down":i.y+=1;break;case"right":i.x+=-1;break;case"left":i.x+=1}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.dir,i.x,i.y),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}split(e){let t=this.compiledProgram.get("split-"+e.direction);if(!t){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform float sections;\n\n                void main() {\n                    vec2 p = uv;\n                ";"horizontal"===e.direction?i+="float num = floor(uv.y*sections);\n                    float odd = num - (2.0 * floor(num/2.0));\n                    p.x = uv.x + amount*sign(odd-0.5);\n             \n                    float opacity = (p.x * (1.0-step(odd,0.5)*2.0) - sign(odd) > 0.0) ? 0.0 : 1.0;\n                    ":i+="float num = floor(uv.x*sections);\n                    float odd = num - (2.0 * floor(num/2.0));\n                    p.y = uv.y + amount*sign(odd-0.5);\n             \n                    float opacity = (p.y * (1.0-step(odd,0.5)*2.0) - sign(odd) > 0.0) ? 0.0 : 1.0;\n                    ",i+="vec4 col = texture2D(texture, p);\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }",t=this.compileShader(i),this.compiledProgram.set("split-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.sections,e.sections),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}circular(e){let t=this.compiledProgram.get("circular");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                const float PI = 3.141592653589;\n\n                void main() {\n                    vec4 col = texture2D(texture, uv);\n\n                    vec2 p = uv*2.-1.;\n                    float opacity = smoothstep(0.0, 0.5, atan(p.y,p.x) - (amount-.5) * PI * 2.5);\n                   \n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";t=this.compileShader(e),this.compiledProgram.set("circular",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}ripple(e){let t=this.compiledProgram.get("ripple");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    \n                    vec2 dir = uv - vec2(.5);\n                    float dist = length(dir);\n                    vec2 offset = dir * (sin(amount * dist * 100.0 - amount * 40.0) + 0.5) / 30.0; //100 amp 40 speed\n\n                    float opacity = smoothstep(0.2, 1.0, amount);\n\n                    vec4 px = texture2D(texture, uv + offset);                   \n                    gl_FragColor = vec4(px.rgb, px.a * (1.0 - opacity));\n                }";t=this.compileShader(e),this.compiledProgram.set("ripple",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}warp(e){let t=this.compiledProgram.get("warp-"+e.direction);if(!t){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n            ";switch(e.direction){case"up":i+="float x = smoothstep(0.0, 1.0, (amount*2.0 + uv.y-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(1.0-x)+0.5);";break;case"right":i+="float x = smoothstep(0.0, 1.0, (amount*2.0 + uv.x-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(1.0-x)+0.5);";break;case"left":i+="float x = smoothstep(0.0, 1.0, ((1.0-amount)*2.0 + uv.x-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(x)+0.5);";break;case"down":i+="float x = smoothstep(0.0, 1.0, ((1.0-amount)*2.0 + uv.y-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(x)+0.5);"}i+="\n                gl_FragColor = vec4(col.rgb, col.a * (1.0 - amount));\n            }",t=this.compileShader(i),this.compiledProgram.set("warp-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}}class m{constructor(e,t,i=!1){this.type=e,this.value=t,this.sidekick=i}}},82381:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(e){this.id=e,this.texture=null}createTexture(e,t,i){this.texture=e.createTexture(),this.width=t,this.height=i}uploadData(e,t,i=e.NEAREST){e.bindTexture(e.TEXTURE_2D,this.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,4),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)}setTexture(e){this.texture=e}destroy(e){e.deleteTexture(this.texture)}}},41721:(e,t,i)=>{i.d(t,{G:()=>d});var s=i(33655),n=i(99872),a=i(36817),r=i(43673),o=i(89679),h=i(78685),c=i(82282),l=i(51294);function d(e,t){var i,d,u,p;const g=new Date;switch(t.type){case"bitmapChange":{const e=t.layer,i=s.$E(t.layer.canvas,t.patchRect),n=e.rect?e.rect.clone():void 0;let r=s.dN(e.mask);if(t.patch){const i=t.rect,a=!!e.canvas;e.extendCanvas(i),a&&(t.patchRect.x+=n.x-e.rect.x,t.patchRect.y+=n.y-e.rect.y);if(e.canvas.getContext("2d").putImageData(t.patch,t.patchRect.x,t.patchRect.y),t.rect.width<e.rect.width||t.rect.height<e.rect.height){const n=s.vL(t.rect.width,t.rect.height);n.getContext("2d").drawImage(e.canvas,e.rect.x-t.rect.x,e.rect.y-t.rect.y),t.patchRect.x+=e.rect.x-i.x,t.patchRect.y+=e.rect.y-i.y,e.canvas=n,e.rect=i}}else e.canvas=null,e.rect=new a.Z(0,0,0,0);return t.mask&&(e.mask=t.mask),e.render(),t.layer.syncRequested=g,{type:"bitmapChange",layer:e,rect:n,kind:t.kind,patch:i,patchRect:t.patchRect.clone(),mask:r}}case"bitmapSwitch":{const e=t.layer,i=s.dN(t.layer.canvas),n=t.layer.trim?t.layer.trim.clone():t.layer.rect.clone();return e.switchCanvas(t.canvas,t.rect),e.render(),t.layer.syncRequested=g,{type:"bitmapSwitch",kind:t.kind,layer:e,rect:n,canvas:i}}case"selectionAndBitmapSwitch":{const n=t.layer,a=s.dN(t.layer.canvas),r=n.rect.clone();n.switchCanvas(t.canvas,t.rect),n.render(),t.layer.syncRequested=g;const o=s.dN(null===(i=null==e?void 0:e.selection)||void 0===i?void 0:i.mask);return t.selection?(e.addSelection(),e.selection.setMask(t.selection),{type:"selectionAndBitmapSwitch",kind:t.kind,selection:o,layer:n,rect:r,canvas:a}):(e.removeSelection(),{type:"selectionAndBitmapSwitch",kind:t.kind,selection:o,layer:n,rect:r,canvas:a})}case"addLayer":return e.layers.splice(t.order,0,t.layer),{type:"addLayer",kind:t.kind,layer:t.layer};case"deleteLayer":return e.deleteLayerById(t.layer.id),t;case"order":return e.changeLayerOrder(t.to,t.from),t;case"layerSettings":{const e=Object.assign({},t.layer.settings);return t.layer.settings=t.settings,t.layer.syncRequested=g,{type:"layerSettings",kind:t.kind,layer:t.layer,settings:e}}case"textChange":{const e=t.layer.text;return t.layer.setText(t.text),t.layer.syncRequested=g,{type:"textChange",layer:t.layer,text:e}}case"textSettings":{const e=t.layer.textSettings.clone();return t.layer.textSettings=t.settings,t.layer.textSettings.measureText(),t.layer.prepare(!0),t.layer.syncRequested=g,{type:"textSettings",kind:t.kind,layer:t.layer,settings:e}}case"background":{const i=e.color;return e.color=t.color,{type:"background",color:i}}case"mask":{let e;const i=t.layer.hasMask();if(!i&&t.patch&&t.layer.addMask(),t.patch){const n=t.layer.mask.getContext("2d");i&&(e=s.$E(t.layer.mask,new a.Z(t.rect.x,t.rect.y,t.patch.width,t.patch.height))),n.putImageData(t.patch,t.rect.x,t.rect.y)}else t.layer.removeMask();return t.layer.render(),t.layer.syncRequested=g,{type:"mask",layer:t.layer,rect:t.rect,patch:e}}case"maskInvert":return t.layer.invertMask(),t.layer.render(),t.layer.syncRequested=g,{type:"maskInvert",layer:t.layer};case"adjust":{const e=t.shaders.cloneChain();return t.shaders.chain=t.chain,{type:"adjust",layer:t.layer,kind:t.kind,chain:e,shaders:t.shaders}}case"glitch":{const e=t.shaders.cloneChain();return t.shaders.chain=t.chain,{type:"glitch",layer:t.layer,kind:t.kind,chain:e,shaders:t.shaders}}case"effect":{let e,i;return t.tool.marked&&(e=t.tool.marked.name,i=t.tool.marked.value),t.tool.shaders.reset(),t.name?(t.tool.shaders.addPreset(t.name,t.value),t.tool.marked=new o.Z(t.name,t.value)):t.tool.marked=void 0,{type:"effect",layer:t.layer,kind:t.kind,tool:t.tool,name:e,value:i}}case"arrange":switch(t.layer.syncRequested=g,t.action.type){case"rect":{const e=t.layer.rect.clone();return t.layer.rect=t.action.rect,t.layer instanceof h.Z&&(e.height=t.layer.textSettings.size,t.layer.rect.height!==t.layer.textSettings.size&&t.layer.setTextSize(t.layer.rect.height)),t.layer instanceof l.Z&&t.layer.trimOnResize(e),t.layer instanceof c.Z||t.layer.render(),{type:"arrange",layer:t.layer,kind:t.kind,action:{type:"rect",rect:e}}}case"trim":{const e=t.layer.trim.clone();return t.layer.trim=t.action.rect,t.layer.render(),{type:"arrange",layer:t.layer,kind:t.kind,action:{type:"trim",rect:e}}}case"trans":{const e=s.dN(t.layer.canvas),i=s.dN(t.layer.mask),n=t.layer.rect.clone();return t.layer.canvas=t.action.data,t.layer.mask=t.action.mask,t.layer.rect=t.action.rect,t.layer.render(),{type:"arrange",layer:t.layer,kind:t.kind,action:{type:"trans",data:e,mask:i,rect:n}}}}case"arrangeStack":{let e=t.stack,i=t.rects,s=new Array;for(let t=0;t<e.length;t++){let n=e[t],a=n.rect?n.rect.clone():void 0;n.rect=i[t],n instanceof h.Z&&(a.height=n.textSettings.size,n.rect.height!==n.textSettings.size&&n.setTextSize(n.rect.height)),n instanceof l.Z&&n.trimOnResize(a),s.push(a),n.syncRequested=g,n.render()}return{type:"arrangeStack",id:t.id,kind:"arrange",stack:t.stack,rects:s}}case"link":{let e=t.stack,i=new Array;for(let t=0;t<e.length;t++)i.push({layer:e[t].layer,link:null!==(d=e[t].layer.settings.link)&&void 0!==d?d:""}),e[t].layer.settings.link=e[t].link,e[t].layer.syncRequested=g;return{type:"link",kind:t.kind,stack:i}}case"flipLayer":return t.layer.flip(t.vertical),t.layer.render(),t.layer.syncRequested=g,{type:"flipLayer",layer:t.layer,vertical:t.vertical};case"rotateLayer":return t.layer.rotate(!t.counterClock),t.layer.render(),t.layer.syncRequested=g,{type:"rotateLayer",layer:t.layer,counterClock:!t.counterClock};case"crop":{const i=new r.Z(-t.offset.x,-t.offset.y),o=new n.Z(e.width,e.height);let h;if(e.crop(new a.Z(t.offset.x,t.offset.y,t.size.width,t.size.height)),t.straighten){const i=e.layers[0];h=s.dN(i.canvas),i.syncRequested=g,i.canvas=t.straighten,i.rect=new a.Z(0,0,i.canvas.width,i.canvas.height),e.width=i.rect.width,e.height=i.rect.height}return e.layers.forEach((e=>e.syncRequested=g)),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"crop",offset:i,size:o,straighten:h}}case"pageSize":{const i=new n.Z(e.width,e.height);return e.size(t.size.width,t.size.height,!1,t.anchor),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageSize",anchor:t.anchor,size:i}}case"pageResize":{const i=new n.Z(e.width,e.height),s=e.layers.map((e=>e.clone(!0)));e.width=t.size.width,e.height=t.size.height;for(let n=0;n<t.layers.length;n++){const i=t.layers[n];i.syncRequested=g,e.replaceLayer(i),i.render()}return e.selection&&e.selection.resize(e.width,e.height),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageResize",size:i,layers:s}}case"flip":return e.flip(t.vertical),e.layers.forEach((e=>e.syncRequested=g)),{type:"flip",vertical:t.vertical};case"rotate":return e.rotate(t.counterClock),document.dispatchEvent(new CustomEvent("reset-viewport")),e.layers.forEach((e=>e.syncRequested=g)),{type:"rotate",counterClock:t.counterClock};case"selectionChange":{const i=e.selection?s.dN(e.selection.mask):void 0;return t.selection?(e.addSelection(),e.selection.setMask(t.selection),Object.assign(Object.assign({},t),{selection:i})):(e.removeSelection(),Object.assign(Object.assign({},t),{selection:i}))}case"merge":{const i=t.from.map((t=>e.layers.find((e=>e.id===t.id)))),s=t.from,n=e.layers.map((e=>e.id));return e.layers=e.layers.filter((e=>!s.includes(e))),e.layers.splice(t.order,0,t.target),e.getSelected()&&!e.hasLayer(e.getSelected())&&e.selectLayerById(t.target.id),{type:"merge",kind:t.kind,target:t.target,order:n,layers:i}}case"rasterize":{const i=e.layers.findIndex((e=>e.id===t.newId));if(i<0)return;const[s]=e.layers.splice(i,1,t.layer);return(null===(u=null==e?void 0:e.getSelected())||void 0===u?void 0:u.id)===s.id&&e.selectLayerById(t.layer.id),{type:"rasterize",layer:s,kind:t.kind,newId:t.layer.id}}case"convertSelectionToMask":{const i=e.selection.mask;return t.layer.addMask(),t.layer.mask.getContext("2d").drawImage(e.selection.mask,-t.layer.rect.x,-t.layer.rect.y),t.layer.render(),e.removeSelection(),t.layer.syncRequested=g,{type:"convertSelectionToMask",layer:t.layer,selection:i}}case"convertMaskToSelection":{const i=t.layer.mask;return t.layer.removeMask(),e.addSelection(),e.selection.setMask(t.selection),t.layer.syncRequested=g,{type:"convertMaskToSelection",layer:t.layer,mask:i}}case"applyMask":{const e=t.layer.canvas,i=t.layer.mask;let s=t.layer.rect.clone();return t.layer.render(),t.layer.canvas=t.layer.baked,t.layer.removeMask(),t.layer.shrinkWrap(),t.layer.syncRequested=g,{type:"applyMask",layer:t.layer,canvas:e,mask:i,rect:s}}case"frameContent":{let e,i;return t.layer.canvas&&(e=s.dN(t.layer.canvas),i=null===(p=t.layer.trim)||void 0===p?void 0:p.clone()),t.layer.canvas=t.canvas,t.layer.trim=t.trim,t.layer instanceof l.Z&&t.layer.render(),{type:"frameContent",kind:t.kind,layer:t.layer,canvas:e,trim:i}}case"frameSettings":{const e=t.layer.frameSettings.clone();return t.layer.frameSettings=t.settings,t.layer.prepare(),t.layer.syncRequested=g,{type:"frameSettings",kind:t.kind,layer:t.layer,settings:e}}case"shapeSettings":{const e=t.layer.shapeSettings.clone();return t.layer.shapeSettings=t.settings,t.layer.prepare(),t.layer.syncRequested=g,{type:"shapeSettings",kind:t.kind,layer:t.layer,settings:e}}case"groupSettings":{const e=t.layer.groupSettings.clone();return t.layer.groupSettings=t.settings,t.layer.syncRequested=g,{type:"groupSettings",kind:t.kind,layer:t.layer,settings:e}}case"pageAnimation":{const i=e.animation?e.animation:void 0;return e.animation=t.animation,{type:"pageAnimation",kind:t.kind,animation:i}}case"layerAnimation":{const e=t.layer.animation?t.layer.animation:void 0;return t.layer.animation=t.animation,t.layer.syncRequested=g,{type:"layerAnimation",kind:t.kind,layer:t.layer,animation:e}}default:throw new Error("No handler for this redo type")}}},45453:(e,t,i)=>{i.d(t,{N:()=>d});var s=i(96548),n=i(33655),a=i(71030),r=i(74820),o=i(93402),h=i(41721),c=i(72209),l=i(82282);class d{constructor(e,t,i=!1){this.fresco=e,this.undoStack=[],this.redoStack=[],this.ignore=!1,this.disable=()=>{this.ignore=!0},this.enable=()=>{this.ignore=!1},this.dispatchHistoryStatus=()=>{document.dispatchEvent(new CustomEvent("history-update",{detail:{atStart:this.undoStack.length<=1,atEnd:0===this.redoStack.length}}))},this.undo=()=>{if(!this.ignore&&0!==this.undoStack.length&&"open"!==this.undoStack[this.undoStack.length-1].data.type)try{this.ignore=!0;const{local:e,data:t}=this.undoStack.pop(),i=(0,o.c)(this.fresco,t);i&&(this.redoStack.push({local:e,data:i}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),(0,a.Z)("undo")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("titleUndo")})),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),this.dispatchHistoryStatus()}finally{this.ignore=!1}},this.redo=()=>{if(!this.ignore&&0!==this.redoStack.length)try{this.ignore=!0;const{local:e,data:t}=this.redoStack.pop(),i=(0,h.G)(this.fresco,t);i&&(this.undoStack.push({local:e,data:i}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),(0,a.Z)("redo")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("titleRedo")})),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco}))}finally{this.ignore=!1,this.dispatchHistoryStatus()}},this.hasChanges=()=>this.undoStack.length>1||this.redoStack.length>0,this.getActiveTransaction=()=>this.transaction,this.redos=e=>this.redoStack.filter((t=>t.local===e)).reverse().map((e=>e.data)),this.undos=e=>this.undoStack.filter((t=>t.local===e)).map((e=>e.data)),this.add=e=>{if(this.ignore)return;if(!(0,c.g)(this.fresco,e))return;this.validateTransaction(e);const t=r.ZP.maxHistoryUndos;!this.transaction&&this.undoStack.length>=t&&(this.undoStack=this.undoStack.slice(this.undoStack.length+1-t)),this.undoStack.push({local:!!this.transaction,data:e}),this.redoStack=[],this.dispatchHistoryStatus(),"open"!==e.type&&document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),(this.undoStack.length<1||!this.undoStack[this.undoStack.length-1].local)&&document.dispatchEvent(new CustomEvent("layer-list-render"))},this.validateTransaction=e=>{if("arrange"===e.type||"arrangeStack"===e.type||"adjust"===e.type||"glitch"===e.type||"effect"===e.type||"textSettings"===e.type||"frameSettings"===e.type||"shapeSettings"===e.type||"pageAnimation"===e.type||"layerAnimation"===e.type){const t="pageAnimation"===e.type?"page":"arrangeStack"===e.type?e.id:e.layer.id;this.transaction&&this.transaction.id!==e.type+"-"+t&&this.commitTransaction(!0),this.transaction||(this.transaction={id:e.type+"-"+t,type:e.type})}else this.commitTransaction(!0)},this.abortTransaction=()=>{this.transaction&&(this.transaction=void 0,this.redoStack=this.redoStack.filter((e=>!e.local)),this.undoStack=this.undoStack.filter((e=>!e.local)),this.dispatchHistoryStatus())},this.commitTransaction=(e=!1)=>{if(!this.transaction)return;const t=new Date;this.transaction=void 0;const i=this.undoStack.filter((e=>e.local));if(0===i.length)return;this.undoStack=this.undoStack.filter((e=>!e.local)),this.redoStack=[];let s=i[0].data,a=!1;switch(s.type){case"arrange":{const e=s.layer,i=s.action.rect;if(e instanceof l.Z&&e.wouldApplyTransform()){const t=n.dN(e.canvas),s=n.dN(e.mask);e.applyTransform(r.ZP.smoothScaling),this.undoStack.push({local:!1,data:{type:"arrange",kind:"transform",layer:e,action:{type:"trans",data:t,mask:s,rect:i}}})}else this.undoStack.push({local:!1,data:{type:"arrange",kind:"arrange",layer:e,action:{type:"rect",rect:i}}});e.syncRequested=t,a=!0;break}case"arrangeStack":{let e=s.stack,i=s.rects,o=Array(),h=Array();for(let s=0;s<e.length;s++){let a=e[s],c=i[s];if(a instanceof l.Z&&a.wouldApplyTransform()){const e=n.dN(a.canvas),t=n.dN(a.mask);a.applyTransform(r.ZP.smoothScaling),this.undoStack.push({local:!1,data:{type:"arrange",kind:"transform",layer:a,action:{type:"trans",data:e,mask:t,rect:c}}})}else o.push(a),h.push(c);a.syncRequested=t}o.length>1?this.undoStack.push({local:!1,data:{type:"arrangeStack",id:s.id,kind:"arrange",stack:o,rects:h}}):1===o.length&&this.undoStack.push({local:!1,data:{type:"arrange",kind:"arrange",layer:o[0],action:{type:"rect",rect:h[0]}}}),a=!0;break}case"glitch":case"effect":case"adjust":break;case"textSettings":{const e=s.layer,i=s.settings;this.undoStack.push({local:!1,data:{type:"textSettings",kind:"settings",layer:e,settings:i}}),e.syncRequested=t,a=!0;break}case"frameSettings":{const e=s.layer,i=s.settings;this.undoStack.push({local:!1,data:{type:"frameSettings",kind:"settings",layer:e,settings:i}}),e.syncRequested=t,a=!0;break}case"shapeSettings":{const e=s.layer,i=s.settings;this.undoStack.push({local:!1,data:{type:"shapeSettings",kind:"settings",layer:e,settings:i}}),e.syncRequested=t,a=!0;break}case"pageAnimation":{const e=s.animation;this.undoStack.push({local:!1,data:{type:"pageAnimation",kind:"",animation:e}}),a=!0;break}case"layerAnimation":{const e=s.layer,i=s.animation;this.undoStack.push({local:!1,data:{type:"layerAnimation",kind:"",layer:e,animation:i}}),e.syncRequested=t,a=!0;break}}a&&!e&&(document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),document.dispatchEvent(new CustomEvent("layer-list-render"))),this.dispatchHistoryStatus()},i?this.ignore=!0:(this.add({type:"open",kind:t}),this.dispatchHistoryStatus())}jump(e){if(!this.ignore&&0!==e)try{if(this.ignore=!0,document.dispatchEvent(new CustomEvent("render-enabled",{detail:!1})),e<0){const t=Math.min(this.undoStack.length,Math.abs(e));for(let e=0;e<t;e++){const{local:e,data:t}=this.undoStack.pop(),i=(0,o.c)(this.fresco,t);i&&this.redoStack.push({local:e,data:i})}t>0&&((0,a.Z)("undo"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("titleUndo")})))}else{const t=Math.min(this.redoStack.length,e);for(let e=0;e<t;e++){const{local:e,data:t}=this.redoStack.pop(),i=(0,h.G)(this.fresco,t);i&&this.undoStack.push({local:e,data:i})}t>0&&((0,a.Z)("redo"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("titleRedo")})))}document.dispatchEvent(new CustomEvent("render-enabled",{detail:!0})),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco}))}finally{this.ignore=!1,document.dispatchEvent(new CustomEvent("render-enabled",{detail:!0})),this.dispatchHistoryStatus()}}}},93402:(e,t,i)=>{i.d(t,{c:()=>d});var s=i(33655),n=i(99872),a=i(36817),r=i(43673),o=i(89679),h=i(78685),c=i(82282),l=i(51294);function d(e,t){var i,d,u,p,g;const m=new Date;switch(t.type){case"bitmapChange":{if(!e.hasLayer(t.layer))return;const i=t.layer,n=i.rect?i.rect.clone():void 0;let r,o=s.dN(i.mask);if(i.canvas){r=i.canvas.getContext("2d").getImageData(t.patchRect.x,t.patchRect.y,t.patchRect.width,t.patchRect.height)}if(t.patch){const e=t.rect,a=!!i.canvas;i.extendCanvas(e);const r=i.canvas.getContext("2d");if(a&&(t.patchRect.x+=n.x-i.rect.x,t.patchRect.y+=n.y-i.rect.y),r.putImageData(t.patch,t.patchRect.x,t.patchRect.y),t.rect.width<i.rect.width||t.rect.height<i.rect.height){const n=s.vL(t.rect.width,t.rect.height);n.getContext("2d").drawImage(i.canvas,i.rect.x-t.rect.x,i.rect.y-t.rect.y),t.patchRect.x+=i.rect.x-e.x,t.patchRect.y+=i.rect.y-e.y,i.canvas=n,i.rect=e}}else i.canvas=null,i.rect=new a.Z(0,0,0,0);return t.mask&&(i.mask=t.mask),i.render(),t.layer.syncRequested=m,{type:"bitmapChange",kind:t.kind,layer:i,rect:n,patch:r,patchRect:t.patchRect.clone(),mask:o}}case"bitmapSwitch":{const e=s.dN(t.layer.canvas),i=t.layer.trim?t.layer.trim.clone():t.layer.rect.clone();return t.layer.switchCanvas(t.canvas,t.rect),t.layer.render(),t.layer.syncRequested=m,{type:"bitmapSwitch",kind:t.kind,layer:t.layer,rect:i,canvas:e}}case"selectionAndBitmapSwitch":{const n=s.dN(t.layer.canvas),a=t.layer.rect.clone();t.layer.switchCanvas(t.canvas,t.rect),t.layer.render(),t.layer.syncRequested=m;const r=s.dN(null===(i=null==e?void 0:e.selection)||void 0===i?void 0:i.mask);return e.addSelection(),e.selection.setMask(t.selection),{type:"selectionAndBitmapSwitch",kind:t.kind,selection:r,layer:t.layer,rect:a,canvas:n}}case"addLayer":{const i=e.layerNr(t.layer.id),s=e.deleteLayerById(t.layer.id);return{type:"addLayer",kind:t.kind,layer:s,order:i}}case"deleteLayer":return e.layers.splice(t.index,0,t.layer),t;case"order":return e.changeLayerOrder(t.to,t.from),t;case"layerSettings":{const e=Object.assign({},t.layer.settings);return t.layer.settings=t.settings,t.layer.syncRequested=m,{type:"layerSettings",kind:t.kind,layer:t.layer,settings:e}}case"textChange":{const e=t.layer.text;return t.layer.setText(t.text),t.layer.syncRequested=m,{type:"textChange",layer:t.layer,text:e}}case"textSettings":{const e=t.layer.textSettings.clone();return t.layer.textSettings=t.settings,t.layer.textSettings.measureText(),t.layer.prepare(!0),t.layer.syncRequested=m,{type:"textSettings",kind:t.kind,layer:t.layer,settings:e}}case"background":{const i=e.color;return e.color=t.color,{type:"background",color:i}}case"mask":{const e=t.layer;let i;const s=e.hasMask();if(!s&&t.patch&&t.layer.addMask(),t.patch){const n=t.patch,a=e.mask.getContext("2d");s&&(i=a.getImageData(t.rect.x,t.rect.y,t.rect.width,t.rect.height)),a.putImageData(n,t.rect.x,t.rect.y)}else{if(s){i=e.mask.getContext("2d").getImageData(0,0,e.mask.width,e.mask.height)}t.layer.removeMask()}return e.render(),t.layer.syncRequested=m,{type:"mask",layer:e,rect:t.patch&&t.rect?t.rect:new a.Z(0,0,e.canvas.width,e.canvas.height),patch:i}}case"maskInvert":return t.layer.invertMask(),t.layer.render(),t.layer.syncRequested=m,{type:"maskInvert",layer:t.layer};case"adjust":{const e=t.shaders.cloneChain();return t.shaders.chain=t.chain,{type:"adjust",layer:t.layer,kind:t.kind,chain:e,shaders:t.shaders}}case"glitch":{const e=t.shaders.cloneChain();return t.shaders.chain=t.chain,{type:"glitch",layer:t.layer,kind:t.kind,chain:e,shaders:t.shaders}}case"effect":{let e,i;return t.tool.marked&&(e=t.tool.marked.name,i=t.tool.marked.value),t.tool.shaders.reset(),t.name?(t.tool.shaders.addPreset(t.name,t.value),t.tool.marked=new o.Z(t.name,t.value)):t.tool.marked=void 0,{type:"effect",layer:t.layer,kind:t.kind,tool:t.tool,name:e,value:i}}case"arrange":switch(t.layer.syncRequested=m,t.action.type){case"rect":{const e=t.layer.rect.clone();return t.layer.rect=t.action.rect,t.layer instanceof h.Z&&(e.height=t.layer.textSettings.size,t.layer.rect.height!==t.layer.textSettings.size&&t.layer.setTextSize(t.layer.rect.height)),t.layer instanceof l.Z&&t.layer.trimOnResize(e),t.layer instanceof c.Z||t.layer.render(),{type:"arrange",kind:t.kind,action:{type:"rect",rect:e},layer:t.layer}}case"trim":{const e=t.layer.trim.clone();return t.layer.trim=t.action.rect,t.layer.render(),{type:"arrange",kind:t.kind,action:{type:"trim",rect:e},layer:t.layer}}case"trans":{const e=s.dN(t.layer.canvas),i=s.dN(t.layer.mask),n=t.layer.rect.clone();return t.layer.canvas=t.action.data,t.layer.mask=t.action.mask,t.layer.rect=t.action.rect,t.layer.render(),{type:"arrange",layer:t.layer,kind:t.kind,action:{type:"trans",data:e,mask:i,rect:n}}}}case"arrangeStack":{let e=t.stack,i=t.rects,s=new Array;for(let t=0;t<e.length;t++){let n=e[t],a=n.rect?n.rect.clone():void 0;n.rect=i[t],n instanceof h.Z&&(a.height=n.textSettings.size,n.rect.height!==n.textSettings.size&&n.setTextSize(n.rect.height)),n instanceof l.Z&&n.trimOnResize(a),s.push(a),n.syncRequested=m,n.render()}return{type:"arrangeStack",id:t.id,kind:"arrange",stack:t.stack,rects:s}}case"link":{let e=t.stack,i=new Array;for(let t=0;t<e.length;t++)i.push({layer:e[t].layer,link:null!==(d=e[t].layer.settings.link)&&void 0!==d?d:""}),e[t].layer.settings.link=e[t].link,e[t].layer.syncRequested=m;return{type:"link",kind:t.kind,stack:i}}case"flipLayer":return t.layer.flip(t.vertical),t.layer.render(),t.layer.syncRequested=m,{type:"flipLayer",layer:t.layer,vertical:t.vertical};case"rotateLayer":return t.layer.rotate(!t.counterClock),t.layer.render(),t.layer.syncRequested=m,{type:"rotateLayer",layer:t.layer,counterClock:!t.counterClock};case"crop":{const i=new r.Z(-t.offset.x,-t.offset.y),o=new n.Z(e.width,e.height);let h;if(e.crop(new a.Z(t.offset.x,t.offset.y,t.size.width,t.size.height)),t.straighten){const i=e.layers[0];h=s.dN(i.canvas),i.syncRequested=m,i.canvas=t.straighten,i.rect=new a.Z(0,0,i.canvas.width,i.canvas.height),e.width=i.rect.width,e.height=i.rect.height}return e.layers.forEach((e=>e.syncRequested=m)),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"crop",offset:i,size:o,straighten:h}}case"pageSize":{const i=new n.Z(e.width,e.height);return e.size(t.size.width,t.size.height,!1,t.anchor),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageSize",anchor:t.anchor,size:i}}case"pageResize":{const i=new n.Z(e.width,e.height),s=e.layers.map((e=>e.clone(!0)));e.width=t.size.width,e.height=t.size.height;for(let n=0;n<t.layers.length;n++){const i=t.layers[n];i.syncRequested=m,e.replaceLayer(i),i.render()}return e.selection&&e.selection.resize(e.width,e.height),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageResize",size:i,layers:s}}case"flip":return e.flip(t.vertical),e.layers.forEach((e=>e.syncRequested=m)),{type:"flip",vertical:t.vertical};case"rotate":return e.rotate(!t.counterClock),document.dispatchEvent(new CustomEvent("reset-viewport")),e.layers.forEach((e=>e.syncRequested=m)),{type:"rotate",counterClock:t.counterClock};case"selectionChange":{const i=e.selection?s.dN(e.selection.mask):void 0;return t.selection?(e.addSelection(),e.selection.setMask(t.selection),Object.assign(Object.assign({},t),{selection:i})):(e.removeSelection(),Object.assign(Object.assign({},t),{selection:i}))}case"merge":{const i=e.layers.findIndex((e=>e===t.target));if(i<0)return;const[s]=e.layers.splice(i,1);return t.layers.forEach((i=>{const s=t.order.findIndex((e=>e===i.id));s<0?e.layers.push(i):e.layers.splice(s,0,i)})),e.getSelected()&&!e.hasLayer(e.getSelected())&&e.selectLayerById(t.layers[0].id),{type:"merge",kind:t.kind,target:s,from:t.layers,order:i}}case"rasterize":{const i=e.layers.findIndex((e=>e.id===t.newId));if(i<0)return;const[s]=e.layers.splice(i,1,t.layer);return(null===(u=null==e?void 0:e.getSelected())||void 0===u?void 0:u.id)===s.id&&e.selectLayerById(t.layer.id),{type:"rasterize",layer:s,kind:t.kind,newId:t.layer.id}}case"convertSelectionToMask":{const i=t.layer.mask;return t.layer.removeMask(),t.layer.syncRequested=m,e.addSelection(),e.selection.mask=t.selection,e.selection.ctx=t.selection.getContext("2d"),e.selection.createOutline(),{type:"convertSelectionToMask",layer:t.layer,mask:i}}case"convertMaskToSelection":{const i=e.selection.mask;return e.removeSelection(),t.layer.mask=t.mask,t.layer.render(),t.layer.syncRequested=m,{type:"convertMaskToSelection",layer:t.layer,selection:i}}case"applyMask":return t.layer.canvas=t.canvas,t.layer.mask=t.mask,t.layer.rect=null===(p=t.rect)||void 0===p?void 0:p.clone(),t.layer.render(),t.layer.syncRequested=m,{type:"applyMask",layer:t.layer};case"frameContent":{let e,i;return t.layer.canvas&&(e=s.dN(t.layer.canvas),i=null===(g=t.layer.trim)||void 0===g?void 0:g.clone()),t.layer.canvas=t.canvas,t.layer.trim=t.trim,t.layer.render(),{type:"frameContent",kind:t.kind,layer:t.layer,canvas:e,trim:i}}case"frameSettings":{const e=t.layer.frameSettings.clone();return t.layer.frameSettings=t.settings,t.layer.prepare(),t.layer.syncRequested=m,{type:"frameSettings",kind:t.kind,layer:t.layer,settings:e}}case"shapeSettings":{const e=t.layer.shapeSettings.clone();return t.layer.shapeSettings=t.settings,t.layer.prepare(),t.layer.syncRequested=m,{type:"shapeSettings",kind:t.kind,layer:t.layer,settings:e}}case"groupSettings":{const e=t.layer.groupSettings.clone();return t.layer.groupSettings=t.settings,t.layer.syncRequested=m,{type:"groupSettings",kind:t.kind,layer:t.layer,settings:e}}case"pageAnimation":{const i=e.animation?e.animation:void 0;return e.animation=t.animation,{type:"pageAnimation",kind:t.kind,animation:i}}case"layerAnimation":{const e=t.layer.animation?t.layer.animation:void 0;return t.layer.animation=t.animation,t.layer.syncRequested=m,{type:"layerAnimation",kind:t.kind,layer:t.layer,animation:e}}default:throw new Error("No handler for this undo type")}}},72209:(e,t,i)=>{i.d(t,{g:()=>h});var s=i(71030),n=i(78685),a=i(51294),r=i(87108),o=i(77664);function h(e,t){const i=new Date;switch(t.type){case"open":return(0,s.Z)("open",t.kind),!0;case"addLayer":return(0,s.Z)("layer-add",t.layer.type),!0;case"bitmapSwitch":case"bitmapChange":return(0,s.Z)(t.kind),t.layer.syncRequested=i,!0;case"flipLayer":return(0,s.Z)("layer-flip"),t.layer.syncRequested=i,!0;case"rotateLayer":return(0,s.Z)("layer-rotate"),t.layer.syncRequested=i,!0;case"frameContent":return(0,s.Z)("frame-content"),t.layer.syncRequested=i,!0;case"frameSettings":return!t.layer.frameSettings.equalTo(t.settings)&&((0,s.Z)("frame-settings"),t.layer.syncRequested=i,!0);case"order":return(0,s.Z)("layer-order"),!0;case"layerSettings":return(0,s.Z)("layer-settings",t.kind),t.layer.syncRequested=i,!0;case"deleteLayer":return(0,s.Z)(t.layer.type+"-delete"),!0;case"textChange":return t.layer.text!==t.text&&((0,s.Z)("text-change"),t.layer.syncRequested=i,!0);case"textSettings":return!t.layer.textSettings.equalTo(t.settings)&&((0,s.Z)("text-settings"),t.layer.syncRequested=i,!0);case"shapeSettings":return!t.layer.shapeSettings.equalTo(t.settings)&&((0,s.Z)("shape-settings"),t.layer.syncRequested=i,!0);case"groupSettings":return!t.layer.groupSettings.equalTo(t.settings)&&((0,s.Z)("group-settings"),t.layer.syncRequested=i,!0);case"pageAnimation":return e.animation!==t.animation;case"layerAnimation":return t.layer.animation!==t.animation&&(t.layer.syncRequested=i,!0);case"mask":return(0,s.Z)("mask"),t.layer.syncRequested=i,!0;case"crop":return(0,s.Z)("crop"),e.layers.forEach((e=>e.syncRequested=i)),!0;case"background":return(0,s.Z)("background"),!0;case"maskInvert":return(0,s.Z)("mask-invert"),t.layer.syncRequested=i,!0;case"arrange":switch(t.action.type){case"rect":if(t.layer.rect.equalTo(t.action.rect))return!1;break;case"trim":if(t.layer.trim.equalTo(t.action.rect))return!1}return(0,s.Z)("arrange"),!0;case"arrangeStack":{let e=!1;for(let i=0;i<t.stack.length;i++)t.stack[i].rect&&!t.stack[i].rect.equalTo(t.rects[i])&&(e=!0);return(0,s.Z)("arrangeStack"),e}case"link":(0,s.Z)("link");for(let e=0;e<t.stack.length;e++)t.stack[e].layer.syncRequested=i;return!0;case"pageSize":return(0,s.Z)("page-size"),e.layers.forEach((e=>e.syncRequested=i)),!0;case"pageResize":return(0,s.Z)("page-resize"),t.layers.forEach((e=>e.syncRequested=i)),!0;case"flip":return(0,s.Z)("flip",t.vertical?"vertical":"horizontal"),e.layers.forEach((e=>e.syncRequested=i)),!0;case"rotate":return(0,s.Z)("rotate",t.counterClock?"left":"right"),e.layers.forEach((e=>e.syncRequested=i)),!0;case"merge":return(0,s.Z)("merge-layers",t.kind),!0;case"adjust":return(0,s.Z)("adjust",t.kind),!0;case"effect":return(0,s.Z)("effect",t.name),!0;case"glitch":return(0,s.Z)("glitch",t.kind),!0;case"selectionChange":case"selectionAndBitmapSwitch":return(0,s.Z)("selection",t.kind),!0;case"rasterize":return(0,s.Z)("rasterize",t.layer.type),t.layer instanceof o.Z||(t.layer instanceof n.Z||(t.layer instanceof a.Z||(t.layer instanceof r.Z||(console.warn("Tried to rasterize an unknown layer type"),!1))));case"convertSelectionToMask":return(0,s.Z)("selection-to-mask"),t.layer.syncRequested=i,!0;case"convertMaskToSelection":return(0,s.Z)("mask-to-selection"),t.layer.syncRequested=i,!0;case"applyMask":return(0,s.Z)("apply-mask"),t.layer.syncRequested=i,!0;default:return!1}}},78366:(e,t,i)=>{i.d(t,{Z:()=>D});var s=i(96548),n=i(93947),a=i(33655),r=i(71030),o=i(43673),h=i(74820),c=i(75934);class l{constructor(e){this.grid=e,this.gridItems=[].slice.call(this.grid.children),window.onload=()=>{this.resizeAllGridItems()},window.addEventListener("resize",(()=>{this.resizeAllGridItems()}))}resizeGridItem(e){let t=parseInt(window.getComputedStyle(this.grid).getPropertyValue("gap")),i=Math.ceil((e.clientHeight+t)/(1+t));e.style.gridRowEnd="span "+i}resizeAllGridItems(){this.grid.style.alignItems="start",this.gridItems.forEach((e=>this.resizeGridItem(e))),this.grid.style.alignItems="stretch"}addChild(e){this.grid.appendChild(e),this.gridItems=[].slice.call(this.grid.children),this.resizeAllGridItems()}getContent(){return this.grid}}class d{constructor(e,t,i,s,n){this.id=e,this.urls=t,this.description=i,this.downloadLink=s,this.credits=n,this.downloadUrl=()=>fetch(this.downloadLink+"&client_id=0fded05dc29e00f3a22e79c451bbbf4905f3d17d9ba2d5348398c648bd1603ca").then((e=>e.json())).then((e=>e.url)),this.source="unsplash",this.thumbnail=t.thumb}}class u{}u.backends=[{name:"unsplashed",query:e=>function e(t,i){return fetch(`https://api.unsplash.com/search/photos?content_filter=high&page=${i}&query=${t}&per_page=50`,{headers:{Authorization:"Client-ID 0fded05dc29e00f3a22e79c451bbbf4905f3d17d9ba2d5348398c648bd1603ca"}}).then((e=>e.json())).then((e=>e)).then((s=>{const n=s.total_pages===i;return{items:s.results.map((e=>new d(e.id,e.urls,e.description,e.links.download_location,{name:e.user.name,profile:e.user.links.html}))),nextPage:n?void 0:()=>e(t,i+1)}}))}(e,1)}],u.randomDefault=()=>{const e=["candy","cake","cookies","nature","spring","winter","forest","architecture","park","new york","flower","london","tokyo","kyoto","cherry blossom","waterfall","jungle","italy","food","garden","lion","reef","river","mountain","boats"];return e[Math.floor(Math.random()*e.length)]},u.queryAll=e=>{const t=e=>{const t=e.filter((e=>!!e.nextPage)).map((e=>e.nextPage()));if(0!==t.length)return()=>Promise.all(t).then(i)},i=e=>{let i=[];return e.forEach((e=>{i=i.concat(e.items)})),{items:i.sort(((e,t)=>Math.random()>.5?-1:1)),nextPage:t(e)}};return Promise.all(u.backends.map((t=>t.query(e)))).then(i)},u.query=(e,t)=>{const i=u.backends.find((t=>t.name===e));return i?Promise.reject(`No such backend: ${e}`):i.query(t)};const p=u;var g=i(58027),m=i(4375);class v{constructor(e){if(this.numSections=0,this.outerWidth=0,this.contentWidth=0,this.bind=a.d4(50,(()=>{if(this.outerWidth=this.outer.clientWidth,this.contentWidth=this.content.scrollWidth,this.contentWidth>this.outerWidth&&(this.forward.style.display="block"),this.numSections=Math.floor(this.contentWidth/this.outerWidth),this.indicator.innerHTML="",this.numSections>0)for(let e=0;e<=this.numSections;e++){const t=(0,n.T)("li");t.setAttribute("data",e.toString()),t.addEventListener("click",this.sectionClick),0===e&&t.classList.add("active"),this.indicator.append(t)}this.scoll()})),this.sectionClick=e=>{const t=Number(e.currentTarget.getAttribute("data"));this.outer.scrollTo(this.outerWidth*t,0)},this.forwardClick=()=>{this.outer.scrollBy(this.outerWidth,0)},this.backClick=()=>{this.outer.scrollBy(-this.outerWidth,0)},this.scoll=a.d4(50,(()=>{const e=Math.ceil(this.outer.scrollLeft/this.outerWidth);if(this.forward.style.display=e===this.numSections?"none":"block",this.back.style.display=this.outer.scrollLeft>0?"block":"none",this.numSections>0)for(let t=0;t<=this.numSections;t++)t===e?this.indicator.children[t].classList.add("active"):this.indicator.children[t].classList.remove("active")})),this.numItems=()=>this.content.children.length,this.addItem=e=>{this.content.appendChild(e)},this.clearItem=()=>{this.content.innerHTML=""},this.container=(0,n.ZP)(e),this.container.classList.add("carousel"),this.content=(0,n.T)("div",{id:e+"-content",className:"content"}),this.container.hasChildNodes())for(;this.container.firstChild;)this.content.appendChild(this.container.firstChild);this.outer=(0,n.T)("div",{id:e+"-outer",className:"outer"},this.content),this.indicator=(0,n.T)("ul",{id:e+"-indicator"}),this.back=(0,n.T)("div",{id:e+"-back",className:"back ic"}),this.forward=(0,n.T)("div",{id:e+"-forward",className:"forward ic"}),this.container.append(this.outer,this.indicator,this.back,this.forward),this.forward.addEventListener("click",this.forwardClick,!0),this.back.addEventListener("click",this.backClick,!0),this.outer.addEventListener("scroll",this.scoll,!0),this.forward.style.display="none",this.back.style.display="none",new ResizeObserver(this.bind).observe(this.content)}}var f=i(23868),y=i(33506),w=i(94178),x=i(92397);class b extends f.Z{constructor(e){super((0,s.Z)("createNew"),!0,!0),this.selectType=e=>{let t=e.currentTarget;this.setType(t.id.replace("tab-",""))},this.setType=e=>{switch(this.type&&(this.holder.innerHTML="",(0,n.ZP)("tab-"+this.type).classList.remove("selected")),(0,n.ZP)("tab-"+e).classList.add("selected"),this.type=e,this.type){case"recommended":if(this.stage.clipboardSize){let e=this.stage.clipboardSize;this.addBox((0,s.Z)("clipboard"),e.width,e.height,"/img/icon/new-cutout.svg")}this.addBox((0,s.Z)("social-media-post"),1080,1080,"/img/icon/category/social.svg"),this.addBox((0,s.Z)("social-media-story"),1080,1920,"/img/icon/category/social.svg"),this.addBox("Web med",1600,900,"/img/icon/category/web.svg"),this.addBox("Thumb 720p",1280,720,"/img/icon/category/video.svg"),this.addBox("Wide 1080p",1920,1080,"/img/icon/category/video.svg"),this.addBox("Art grid",1e3,1e3,"/img/icon/category/art.svg"),this.addBox("12 mpx 4:3",4032,3024,"/img/icon/category/landscape.svg"),this.addBox("8 mpx 4:3",3264,2448,"/img/icon/category/landscape.svg");break;case"photo":this.addBox("12 mpx 4:3",4032,3024,"/img/icon/category/landscape.svg"),this.addBox("8 mpx 4:3",3264,2448,"/img/icon/category/landscape.svg"),this.addBox("Landscape 3x2 in",900,600,"/img/icon/category/landscape.svg"),this.addBox("Landscape 6x4 in",1800,1200,"/img/icon/category/landscape.svg"),this.addBox("Landscape 7x5 in",2100,1500,"/img/icon/category/landscape.svg"),this.addBox("Landscape 10x8 in",3e3,2400,"/img/icon/category/landscape.svg"),this.addBox("Portrait 2x3 in",600,900,"/img/icon/category/portrait.svg"),this.addBox("Portrait 4x6 in",1200,1800,"/img/icon/category/portrait.svg"),this.addBox("Portrait 5x7 in",1500,2100,"/img/icon/category/portrait.svg"),this.addBox("Portrait 8x10 in",2400,3e3,"/img/icon/category/portrait.svg");break;case"social":this.addBox((0,s.Z)("instagram-square"),1080,1080,"/img/icon/category/instagram.svg"),this.addBox((0,s.Z)("instagram-post"),1080,1350,"/img/icon/category/instagram.svg"),this.addBox((0,s.Z)("instagram-story"),1080,1920,"/img/icon/category/instagram.svg"),this.addBox((0,s.Z)("facebook-post"),1200,630,"/img/icon/category/facebook.svg"),this.addBox((0,s.Z)("facebook-story"),1080,1920,"/img/icon/category/facebook.svg"),this.addBox((0,s.Z)("facebook-cover"),851,315,"/img/icon/category/facebook.svg"),this.addBox((0,s.Z)("facebook-profile"),850,850,"/img/icon/category/facebook.svg"),this.addBox((0,s.Z)("twitter-post"),1600,900,"/img/icon/category/twitter.svg"),this.addBox((0,s.Z)("twitter-cover"),1500,500,"/img/icon/category/twitter.svg"),this.addBox((0,s.Z)("twitter-profile"),400,400,"/img/icon/category/twitter.svg"),this.addBox((0,s.Z)("youtube-profile"),800,800,"/img/icon/category/youtube.svg"),this.addBox((0,s.Z)("youtube-thumbnail"),1280,720,"/img/icon/category/youtube.svg"),this.addBox((0,s.Z)("youtube-channel-art"),2048,1152,"/img/icon/category/youtube.svg"),this.addBox((0,s.Z)("pinterest-pin"),1e3,1500,"/img/icon/category/pinterest.svg"),this.addBox((0,s.Z)("pinterest-square-pin"),1e3,1e3,"/img/icon/category/pinterest.svg"),this.addBox((0,s.Z)("pinterest-long-pin"),1e3,2100,"/img/icon/category/pinterest.svg");break;case"print":this.addBox("Letter 8 x 11 in",2400,3300,"/img/icon/category/paper.svg"),this.addBox("Legal 8 x 14 in",2400,4200,"/img/icon/category/paper.svg",!0),this.addBox("Tabloid 11 x 17 in",3300,5100,"/img/icon/category/paper.svg",!0),this.addBox("A3 297 x 420 mm",3508,4961,"/img/icon/category/paper.svg",!0),this.addBox("A4 210 x 297 mm",2480,3508,"/img/icon/category/paper.svg"),this.addBox("A5 148 x 210 mm",1748,2480,"/img/icon/category/paper.svg"),this.addBox("A6 105 x 148 mm",1240,1748,"/img/icon/category/paper.svg"),this.addBox((0,s.Z)("business-card"),1050,600,"/img/icon/category/business-card.svg"),this.addBox((0,s.Z)("flyer")+" 4.25 x 5.5 in",1275,1650,"/img/icon/category/flyer.svg"),this.addBox((0,s.Z)("flyer")+" 5.5 x 8.5 in",1650,2550,"/img/icon/category/flyer.svg"),this.addBox((0,s.Z)("flyer")+" 8.5 x 11 in",2550,3300,"/img/icon/category/flyer.svg"),this.addBox((0,s.Z)("brochure")+" 8.5 x 11 in",2550,3300,"/img/icon/category/flyer.svg"),this.addBox((0,s.Z)("brochure")+" 8.5 x 14 in",2550,4200,"/img/icon/category/flyer.svg",!0),this.addBox((0,s.Z)("brochure")+" 11 x 17 in",3300,5100,"/img/icon/category/flyer.svg",!0),this.addBox((0,s.Z)("invitation")+" 4 x 6 in",384,576,"/img/icon/category/invitation.svg"),this.addBox((0,s.Z)("invitation")+" 5 x 7 in",480,672,"/img/icon/category/invitation.svg");break;case"web":this.addBox("Web 1994",800,600,"/img/icon/category/web.svg"),this.addBox("Web 2004",1280,720,"/img/icon/category/web.svg"),this.addBox("Web 2012",1366,768,"/img/icon/category/web.svg"),this.addBox("Web 2016",1440,900,"/img/icon/category/web.svg"),this.addBox("Web 2020",1920,1200,"/img/icon/category/web.svg"),this.addBox("Icon 16",16,16,"/img/icon/category/icon.svg"),this.addBox("Icon 32",32,32,"/img/icon/category/icon.svg"),this.addBox("Icon 64",64,64,"/img/icon/category/icon.svg"),this.addBox("Icon 512",512,512,"/img/icon/category/icon.svg"),this.addBox("Icon 1024",1024,1024,"/img/icon/category/icon.svg");break;case"video":this.addBox("360p",640,360,"/img/icon/category/video.svg"),this.addBox("480p",854,480,"/img/icon/category/video.svg"),this.addBox("720p",1280,720,"/img/icon/category/video.svg"),this.addBox("1080p HD",1920,1080,"/img/icon/category/video.svg"),this.addBox("1440p 2K",2560,1440,"/img/icon/category/video.svg"),this.addBox("4K UHD",3840,2160,"/img/icon/category/video.svg")}},this.presetChange=e=>{let t=e.currentTarget,i=(0,n.ZP)("ceate-new-outer").getElementsByClassName("new-box");for(var s=0;s<i.length;s++)i[s].classList.remove("selected");t.classList.add("selected");let a=t.getAttribute("data").split(":");(0,n.ZP)("new-canvas-width").value=a[0],(0,n.ZP)("new-canvas-height").value=a[1]},this.addBox=(e,t,i,s,a=!1)=>{let r=(0,n.T)("div",{className:"new-box",style:"width:"+this.boxSize+"px"},(0,n.T)("div",{className:"holder"},(0,n.T)("img",{src:s})),(0,n.T)("span",{},e),(0,n.T)("small",{},t+"x"+i+" px"));a&&r.classList.add("premium"),r.addEventListener("click",this.presetChange,!1),r.setAttribute("data",t+":"+i),this.holder.appendChild(r)},this.apply=async()=>{let e=(0,n.ZP)("new-canvas-width").value,t=(0,n.ZP)("new-canvas-height").value,i=Number.isNaN(Number(e))?600:Number(e),s=Number.isNaN(Number(t))?600:Number(t),a="premium"===(null===y.a||void 0===y.a?void 0:y.a.subscriptionAccess)?8192:4096;i>a&&(i=a),s>a&&(s=a);let r=(0,n.ZP)("new-canvas-name").value,o=!(0,n.ZP)("new-canvas-background").checked;this.stage.createNew(r,i,s,o?void 0:this.backgroundColor.getHex()),this.cleanUp()},this.stage=e,(0,n.ZP)("dialog-apply"+this.mid).innerText=(0,s.Z)("create"),(0,n.ZP)("dialog-buttons"+this.mid).style.marginTop="0px",this.dialog.style.width="90%",this.dialog.style.maxWidth="1200px",this.dialog.style.height=document.body.offsetHeight-300+"px",this.content.style.padding="0",this.content.style.height="1vh",this.content.style.display="flex",this.content.style.position="relative",this.content.style.flexDirection="column",this.setContent(`\n\n            <ul id="preset-type" class="tab-list pad-10" style="flex: 0 1 auto;padding-left:20px; margin-left:20px;margin-right:20px;margin-bottom:10px">\n                <li id="tab-recommended">${(0,s.Z)("recommended")}</li>\n                <li id="tab-photo">${(0,s.Z)("photo")}</li>\n                <li id="tab-social">${(0,s.Z)("social")}</li>\n                <li id="tab-web">${(0,s.Z)("web")}</li>\n                <li id="tab-print">${(0,s.Z)("print")}</li>\n                <li id="tab-video">${(0,s.Z)("video")}</li>\n            </ul>\n            <div class="flex" style="position:relative;height:calc(100% - 58px);margin:0px 20px;">\n\n                <div id="ceate-new-outer" style="flex-grow:2">\n                    <div id="create-new-content" class="new-holder">\n\n                    </div>\n                </div>\n                <div style="flex: 0 0 auto;flex-basis:220px;width:220px;min-width:220px;margin-left:10px;overflow:hidden;">\n                    <label for="new-canvas-name">${(0,s.Z)("name")}</label>\n                    <input type="text" style="width: 100%;" id="new-canvas-name" value="${(0,s.Z)("untitled")}" />\n\n                    <label class="split pad-20">${(0,s.Z)("width")} <input type="number" id="new-canvas-width" value="1920"/></label>\n                    <label class="split">${(0,s.Z)("height")} <input type="number" id="new-canvas-height" value="1080"/></label>\n                    <label class="pad-10" style="text-align:right;font-size:10px;float:none;clear: both;">${(0,s.Z)("max")}<span id="new-max-size">4096 x 4096 px</span></label>\n\n                    <input type="checkbox" class="toggle-check" id="new-canvas-background" />\n                    <label class="switch subline pad-20" for="new-canvas-background">${(0,s.Z)("background")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <div id="new-canvas-background-color-picker" class="color-picker pad-0"></div>\n                    </div>\n                </div>\n            <div>\n            \n        `),this.holder=(0,n.ZP)("create-new-content"),"premium"===(null===y.a||void 0===y.a?void 0:y.a.subscriptionAccess)&&((0,n.ZP)("new-max-size").innerText="8192 x 8192 px"),this.backgroundColor=new x.Z((0,n.ZP)("new-canvas-background-color-picker"),void 0,void 0,!1);let t=(0,n.ZP)("preset-type").getElementsByTagName("li");for(var i=0;i<t.length;i++)t[i].addEventListener("click",this.selectType,!1);let a=this.holder.clientWidth,r=Math.floor(a/125);this.boxSize=Math.floor(125+(a-125*r)/r),new w.Z((0,n.ZP)("ceate-new-outer")),this.setType("recommended"),this.position()}}var Z=i(43747),k=i(32804),E=i(94699),P=i(7976),S=i(47630),C=i(57909);class L extends C.Z{constructor(e,t){var i;super(!0),this.loadTemplate=async()=>{this.cleanUp(),await c.$k(this.stage,this.template)},this.close=()=>{history.pushState(null,null,window.location.hash.substring(0,window.location.hash.lastIndexOf("&id="))),this.cleanUp()},(0,r.Z)("template-preview",t.id),this.stage=e,this.template=t;let a=0,o="";for(let s of this.template.keywords)if(o+='<a href="#template&keyword='+s+'" class="tag">'+s+"</a> ",a++>19)break;if(this.setContent(`\n            <div id="template-preview-holder" style="width:500px;height:550px;padding:20px;background: linear-gradient(43deg, #282828 0%, #424242 100%);background-color: #333333;" class="centercenter">\n                \n            </div>\n            <div class="center" style="width:340px;display:flex;flex-direction:column;padding:20px;background-color:rgba(0,0,0,0.05);"> \n                <div style="flex-grow:2">\n                    <h2 class="pad-30">${this.template.name}</h2>\n                    <h3><a id="template-preview-category" href="#template&category=${this.template.category}" style="color:#444;">${(0,s.Z)(this.template.category)}</a></h3>\n                    <h4>${this.template.ratio.width} x ${this.template.ratio.height} px</h4>\n                    <p class="pad-20">${o}</p>\n                </div>\n                <div id="load-template-preview" class="button big green pad-50">${(0,s.Z)("useTemplate")}</div>\n                <div class="pad-20"><a class="link" id="close-template-preview" style="font-weight:bold;"> ${(0,s.Z)("close")}</a></div>\n            </div>\n        `),t.premium?this.setContent('<div class="premium-tag" title="premium"><img src="/img/icon/premium.svg"></div>'):this.setContent('<div class="free-tag" title="free">'+(0,s.Z)("free")+"</div>"),t.animated){let e=(0,n.T)("video",{autoplay:!0,muted:!0,loop:!0,style:"max-height:100%; max-width:100%; box-shadow: 6px 6px 12px rgb(0 0 0 / 30%);"},(0,n.T)("source",{src:null!==(i=t.previewLargeVideo)&&void 0!==i?i:t.previewVideo,type:"video/mp4"}));e.title=t.name,(0,n.ZP)("template-preview-holder").appendChild(e),(0,n.ZP)("template-preview-category").innerHTML+=" "+(0,s.Z)("animated")}else{let e=(0,n.T)("img",{src:t.preview,style:"max-height:100%; max-width:100%; box-shadow: 6px 6px 12px rgb(0 0 0 / 30%);"});e.alt=t.name,(0,n.ZP)("template-preview-holder").appendChild(e)}(0,n.ZP)("load-template-preview").addEventListener("click",this.loadTemplate,!0),(0,n.ZP)("close-template-preview").addEventListener("click",this.close,!0),(0,n.ZP)("announce-close"+this.mid).onclick=this.close}}var T=i(99924),M=i(92409),A=i(27969),I=i(21951);function R(){var e;const t=JSON.parse(null!==(e=window.localStorage.getItem("generator-history"))&&void 0!==e?e:"[]"),i=new Date;i.setDate(i.getDate()-1);const s=t.map((e=>new Date(e))).filter((e=>e>i));return s.length!==t.length&&window.localStorage.setItem("generator-history",JSON.stringify(s)),s.length}class _{constructor(e){this.web=e,this.exp=[{prompt:"Robot standing in front of the window, sitting robot close-up, human-faced robot, close-up humanoid robot, futuristic robot portrait, strong artificial intelligence, detailed humanoid, coming AI singularity, android portrait, robot portrait, humanoid robot, artificial intelligence",negative:""},{prompt:"a futuristic space ship floating in the sky, a matte painting by Christopher Balaskas, cgsociety, space art, toonami, sci-fi, reimagined by industrial light and magic",negative:"worstquality, low quality, normal quality, jpegartifacts, signature, watermark, username, blurry, text, error"},{prompt:"Iron Man, (Arnold Tsang, Toru Nakayama), Masterpiece, Studio Quality, 6k , toa, toaair, 1boy, glowing, axe, mecha, science_fiction, solo, weapon, jungle , green_background, nature, outdoors, solo, tree, weapon, mask, dynamic lighting, detailed shading, digital texture painting",negative:""},{prompt:"Cute small cat sitting in a movie theater eating chicken wiggs watching a movie ,unreal engine, cozy indoor lighting, artstation, detailed, digital painting,cinematic,character design by mark ryden and pixar and hayao miyazaki, unreal 5, daz, hyperrealistic, octane render",negative:"ugly, ugly arms, ugly hands,"},{prompt:"houses in front, houses background, straight houses, digital art, smooth, sharp focus, gravity falls style, doraemon style, shinchan style, anime style",negative:"blurry image, watermark, messy"},{prompt:"Amazing breathtaking picture, THX Sound, God polished pixels, I Can’t believe how beautiful this is!!! Hyper ultra intricate 64k resolution, 35mm, Unreal Engine, UHD, I SAID ULTRA!! Hyperphotosensitivity, utterly melts hearts, win friends and influences people, Phase One XF IQ4 150MP with",negative:"blurry image, watermark, messy"},{prompt:"Banksy with friends and the boat with the red balloon",negative:"blurry image, watermark, messy"},{prompt:"cute girl, crop-top, blond hair, black glasses, stretching, with background by greg rutkowski makoto shinkai kyoto animation key art feminine mid shot",negative:"Deformed, blurry, bad anatomy, disfigured, poorly drawn face, mutation, mutated, extra limb, ugly, poorly drawn hands, missing limb, blurry, floating limbs, disconnected limbs, malformed hands, blur, out of focus, long neck, long body, ((((mutated hands and fingers)))), (((out of frame)))"},{prompt:"Isometric Atlantis city,great architecture with columns, great details, ornaments,seaweed, blue ambiance, 3D cartoon style, soft light, 45° view",negative:"blurry image, watermark, messy"},{prompt:"the street of amedieval fantasy town, at dawn, dark, 4k, highly detailed",negative:""},{prompt:"a highly detailed matte painting of a man on a hill watching a rocket launch in the distance by studio ghibli, makoto shinkai, by artgerm, by wlop, by greg rutkowski, volumetric lighting, octane render, 4 k resolution, trending on artstation, masterpiece | hyperrealism| highly detailed| insanely detailed| intricate| cinematic lighting| depth of field",negative:"blurry image, watermark, messy"},{prompt:"futuristic lighthouse, flash light, hyper realistic, epic composition, cinematic, landscape vista photography, landscape veduta photo & tdraw, detailed landscape painting rendered in enscape, miyazaki, 4k detailed post processing, unreal engineered",negative:""},{prompt:"futuristic tree house, hyper realistic, epic composition, cinematic, landscape vista photography by Carr Clifton & Galen Rowell, Landscape veduta photo by Dustin Lefevre & tdraw, detailed landscape painting by Ivan Shishkin, rendered in Enscape, Miyazaki, Nausicaa Ghibli, 4k detailed post processing, unreal engine",negative:""},{prompt:"a full page design of spaceship engine, black and bronze paper, intricate, highly detailed, epic, infographic, marginalia",negative:""},{prompt:"Black adventure van, geared out, apocalyptic, dystopian van, realistic, roof rack, in dark abandoned neighborhood, van geared out",negative:""},{prompt:"highly detailed albert einstein playing minecraft, epic laboratory office, shelves with detailed items in background, ((long shot)), highly detailed realistic painting by grandmaster, unreal engine, octane render, 4k, by artgerm and Drew Struzan and Krenz Cushart, trending on artstation",negative:""},{prompt:"street shot, back to the future, wearing psychedelic xray layers",negative:""},{prompt:"We can use technology to help people like Kevin. ‘ thomaswievegg by Pinturas-de-robots-solitarios-contemplando-el-mundo (1) matt dixon surrealista triste Character Concept, Concept Art, Character Design, 3d Character, Arte Cyberpunk, Arte Robot, Steampunk, Sci Fi Art, Whimsical Art",negative:"nsfw, deformed bodies, deformed faces, deformed limbs, watermarks, artist signature,"},{prompt:"city made out of glass : : close shot : : 3 5 mm, realism, octane render, 8 k, exploration, cinematic, trending on artstation, realistic, 3 5 mm camera, unreal engine, hyper detailed, photo – realistic maximum detail, volumetric light, moody cinematic epic concept art, realistic matte painting, hyper photorealistic, concept art, volumetric light, cinematic epic, octane render, 8 k, corona render, movie concept art, octane render, 8 k, corona render, cinematic, trending on artstation, movie concept art, cinematic composition, ultra – detailed, realistic, hyper – realistic, volumetric lighting, 8 k",negative:"blurry image, watermark, messy"},{prompt:"a landscape by simon stalenhag of a very large realistic highly detailed imposing robotic mechanical cat, stranded alone and roaming in the chaos across a depressing abandoned post – apocalyptic landscape, post – apocalyptic corrupted themes, artstation trending, beautiful art landscape, detailed simon stalenhag landscape",negative:""},{prompt:"a highly detailed epic cinematic concept art an alien pyramid landscape , art station, landscape, concept art, illustration, highly detailed artwork cinematic, hyper realistic painting",negative:""},{prompt:"portrait photo of a old man crying, Tattles, sitting on bed, guages in ears, looking away, serious eyes, 50mm portrait photography, hard rim lighting photography–beta",negative:""},{prompt:"futuristic city, neon lights, centered shot, wide angle, full body, dd, fantasy, highly detailed, digital painting, artstation, smooth, sharp focus, digital art",negative:"missing legs, missing feet, worst quality, low quality, jpeg artifacts, signature, logo, watermark, text, realistic, hyper-realistic, ultra-detailed, RAW photo"},{prompt:"Paint a portrait of a woman that showcases her beauty and artistry through a unique combination of vibrant colors and geometric shapes, capturing her essence and individuality in an imaginative and captivating composition.",negative:""},{prompt:"The green idyllic Arcadian prairie with sheep by Thomas Cole, Breath-taking digital painting with placid colors, amazing art, artstation 3, cottagecore.",negative:""},{prompt:"Create an image that represents the themes of managing anxiety, self-fulfillment, and personal growth for a young adult audience. The image should be bright, colorful, and evoke a sense of hope and optimism. Consider including imagery related to nature, growth, journeys, or overcoming challenges",negative:""}],this.didOne=!1,this.selectedAspect="square",this.selectAspect=e=>{(0,n.ZP)("aspect-"+this.selectedAspect).classList.remove("selected"),(0,n.ZP)("aspect-type").classList.remove("aspect-"+this.selectedAspect),this.selectedAspect=e.currentTarget.getAttribute("data"),(0,n.ZP)("aspect-"+this.selectedAspect).classList.add("selected"),(0,n.ZP)("aspect-type").classList.add("aspect-"+this.selectedAspect),(0,n.ZP)("aspect-type").innerText=this.selectedAspect+" aspect"},this.selectedStyle="none",this.selectStyle=e=>{var t;if((0,n.ZP)("style-"+this.selectedStyle).classList.remove("selected"),null===(t=(0,n.ZP)("style-type"))||void 0===t||t.remove(),this.selectedStyle=e.currentTarget.getAttribute("data"),(0,n.ZP)("style-"+this.selectedStyle).classList.add("selected"),"none"!==this.selectedStyle){const e=(0,n.T)("img",{className:"close",src:"/img/icon/close.svg"}),t=(0,n.T)("div",{id:"style-type",className:"button outline med"},(0,n.T)("img",{src:"/img/preset/"+this.selectedStyle+".webp"}),this.selectedStyle.replace(/-/g," "),e);e.onclick=e=>{e.preventDefault(),(0,n.ZP)("style-type").remove(),(0,n.ZP)("style-"+this.selectedStyle).classList.remove("selected"),(0,n.ZP)("style-none").classList.add("selected"),this.selectedStyle="none"},(0,n.ZP)("generator-prop-list").prepend(t)}},this.selectedColor="none",this.selectColor=e=>{var t;if((0,n.ZP)("color-"+this.selectedColor).classList.remove("selected"),null===(t=(0,n.ZP)("color-type"))||void 0===t||t.remove(),this.selectedColor=e.currentTarget.getAttribute("data"),(0,n.ZP)("color-"+this.selectedColor).classList.add("selected"),"none"!==this.selectedColor){const e=(0,n.T)("img",{className:"close",src:"/img/icon/close.svg"}),t=(0,n.T)("div",{id:"color-type",className:"button outline med"},(0,n.T)("img",{src:"/img/preset/"+this.selectedColor+".webp"}),this.selectedColor.replace(/-/g," "),e);e.onclick=e=>{e.preventDefault(),(0,n.ZP)("color-type").remove(),(0,n.ZP)("color-"+this.selectedColor).classList.remove("selected"),(0,n.ZP)("color-none").classList.add("selected"),this.selectedColor="none"},(0,n.ZP)("generator-prop-list").append(t)}},this.selectedLighting="none",this.selectLighting=e=>{var t;if((0,n.ZP)("lighting-"+this.selectedLighting).classList.remove("selected"),null===(t=(0,n.ZP)("lighting-type"))||void 0===t||t.remove(),this.selectedLighting=e.currentTarget.getAttribute("data"),(0,n.ZP)("lighting-"+this.selectedLighting).classList.add("selected"),"none"!==this.selectedLighting){const e=(0,n.T)("img",{className:"close",src:"/img/icon/close.svg"}),t=(0,n.T)("div",{id:"lighting-type",className:"button outline med"},(0,n.T)("img",{src:"/img/preset/"+this.selectedLighting+".webp"}),this.selectedLighting.replace(/-/g," "),e);e.onclick=e=>{e.preventDefault(),(0,n.ZP)("lighting-type").remove(),(0,n.ZP)("lighting-"+this.selectedLighting).classList.remove("selected"),(0,n.ZP)("lighting-none").classList.add("selected"),this.selectedLighting="none"},(0,n.ZP)("generator-prop-list").append(t)}},this.selectedComposition="none",this.selectComposition=e=>{var t;if((0,n.ZP)("composition-"+this.selectedComposition).classList.remove("selected"),null===(t=(0,n.ZP)("composition-type"))||void 0===t||t.remove(),this.selectedComposition=e.currentTarget.getAttribute("data"),(0,n.ZP)("composition-"+this.selectedComposition).classList.add("selected"),"none"!==this.selectedComposition){const e=(0,n.T)("img",{className:"close",src:"/img/icon/close.svg"}),t=(0,n.T)("div",{id:"composition-type",className:"button outline med"},(0,n.T)("img",{src:"/img/preset/"+this.selectedComposition+".webp"}),this.selectedComposition.replace(/-/g," "),e);e.onclick=e=>{e.preventDefault(),(0,n.ZP)("composition-type").remove(),(0,n.ZP)("composition-"+this.selectedComposition).classList.remove("selected"),(0,n.ZP)("composition-none").classList.add("selected"),this.selectedComposition="none"},(0,n.ZP)("generator-prop-list").append(t)}},this.random=()=>{const e=(0,n.ZP)("generator-prompt"),t=(0,n.ZP)("generator-negative"),i=a.sD(this.exp);e.value=i.prompt,t.value=i.negative,this.resizeTextInput((0,n.ZP)("generator-prompt")),this.resizeTextInput((0,n.ZP)("generator-negative"))},this.clear=()=>{var e,t,i,s;(0,n.ZP)("generator-prompt").value="",(0,n.ZP)("generator-negative").value="",(0,n.ZP)("style-"+this.selectedStyle).classList.remove("selected"),(0,n.ZP)("style-none").classList.add("selected"),this.selectedStyle="none",null===(e=(0,n.ZP)("style-type"))||void 0===e||e.remove(),(0,n.ZP)("color-"+this.selectedColor).classList.remove("selected"),(0,n.ZP)("color-none").classList.add("selected"),this.selectedColor="none",null===(t=(0,n.ZP)("color-type"))||void 0===t||t.remove(),(0,n.ZP)("lighting-"+this.selectedLighting).classList.remove("selected"),(0,n.ZP)("lighting-none").classList.add("selected"),this.selectedLighting="none",null===(i=(0,n.ZP)("lighting-type"))||void 0===i||i.remove(),(0,n.ZP)("composition-"+this.selectedComposition).classList.remove("selected"),(0,n.ZP)("composition-none").classList.add("selected"),this.selectedComposition="none",null===(s=(0,n.ZP)("composition-type"))||void 0===s||s.remove(),this.resizeTextInput((0,n.ZP)("generator-prompt")),this.resizeTextInput((0,n.ZP)("generator-negative"))},this.resizeTextInput=e=>{window.setTimeout((()=>{let t=e.cloneNode();t.style.visibility="false",e.parentNode.insertBefore(t,e),t.style.height="auto",t.value=e.value,e.style.height=t.scrollTop+t.scrollHeight+2+"px",console.log(t.scrollTop,t.scrollHeight),e.parentNode.removeChild(t)}),0)},this.doGenerate=async(e,t,i)=>{if((0,r.Z)("generate"),(null===(s=null===y.a||void 0===y.a?void 0:y.a.subscription)||void 0===s||!s)&&R()>=5)return void new I.Z("IMAGEGEN",{platform:"x"});var s;if(function(){var e;return(null===(e=null===y.a||void 0===y.a?void 0:y.a.subscription)||void 0===e||!e)&&(R()>=1&&!y.a)}())return void new A.ZP;const a=(0,n.ZP)("generator-legend"),o=(0,n.ZP)("generator-generate"),h=(0,n.ZP)("generator-result");let c,l,d=(0,n.T)("span",{});if(e)d.innerHTML="<b>Generating variations of:</b> "+t[0].text;else{if(c=(0,n.ZP)("generator-prompt").value,l=(0,n.ZP)("generator-negative").value,c.length<4||o.classList.contains("disabled"))return;"none"!==this.selectedColor&&(c+=" ("+this.selectedColor.replace(/-/g," ")+")"),"none"!==this.selectedLighting&&(c+=" ("+this.selectedLighting.replace(/-/g," ")+")"),"none"!==this.selectedComposition&&(c+=" ("+this.selectedComposition.replace(/-/g," ")+")"),t=[{text:c,weight:.5}],""!==l&&t.push({text:l,weight:-1}),i={width:512,height:512},"tall"===this.selectedAspect&&(i.height=768),"wide"===this.selectedAspect&&(i.width=768),"none"!==this.selectedStyle&&(i.style=this.selectedStyle),d.innerHTML="<b>Generate:</b> "+c+(""!==l?" <b>Remove:</b> "+l:"")}a.classList.add("working"),o.classList.add("disabled");const u=(h.clientWidth-30)/2,p=i.height===i.width?u:i.height<i.width?Math.round(u/3*2):Math.round(u/2*3);let g=(0,n.T)("div",{style:"width:"+u+"px;height:"+p+"px;",className:"pane-preview is-loading"}),m=(0,n.T)("div",{style:"width:"+u+"px;height:"+p+"px;",className:"pane-preview is-loading"}),v=(0,n.T)("div",{className:"pane"},(0,n.T)("div",{className:"pane-message"},(0,n.T)("img",{src:"/img/icon/ai-small.svg"}),d),(0,n.T)("div",{className:"pane-preview-holder"},g,m));h.prepend(v);try{const s=e?await async function(e,t,i){const s=new FormData;Array.isArray(e)?e.forEach(((e,t)=>{s.append(`prompt[${t}][text]`,e.text),s.append(`prompt[${t}][weight]`,e.weight.toString())})):s.append("prompt[0][text]",e),i&&s.append("style",i),s.set("image",t),s.set("amount","2");const n=fetch("/api/openai/alternatives",{method:"post",body:s});return await(await n).json()}(t,e,i.style):await async function(e,t){const i=fetch("/api/openai/generate",{method:"post",body:JSON.stringify(Object.assign(Object.assign({},t),{amount:2,prompt:e})),headers:{"Content-Type":"application/json"}});return await(await i).json()}(t,i);if(!1===s.status){v.remove();let e=(0,n.T)("div",{className:"pane"},(0,n.T)("div",{className:"pane-message"},(0,n.T)("img",{src:"/img/icon/error_alert.png"}),(0,n.T)("span",{},"Ops, something went wrong, either a bad prompt or the servers did not respond :/")));return void h.prepend(e)}const a=(0,n.T)("img",{src:s.data[0],className:"result rotate-in",oncontextmenu:()=>!1}),r=(0,n.T)("img",{src:s.data[1],className:"result rotate-in",oncontextmenu:()=>!1});g.classList.remove("is-loading"),this.addOverlay(g,s.data[0],t,i),g.append(a),m.classList.remove("is-loading"),this.addOverlay(m,s.data[1],t,i),m.append(r),function(){var e,t;if(null!==(e=null===y.a||void 0===y.a?void 0:y.a.subscription)&&void 0!==e&&e)return;const i=JSON.parse(null!==(t=window.localStorage.getItem("generator-history"))&&void 0!==t?t:"[]");i.push((new Date).toISOString()),window.localStorage.setItem("generator-history",JSON.stringify(i))}()}finally{a.classList.remove("working"),o.classList.remove("disabled"),this.renderGenerateCount()}},this.addOverlay=(e,t,i,o)=>{const h=async e=>{(0,r.Z)("open-generated");const t=await a.Bm(e);c.Av(this.web.stage,t,"ai",!0,"add")},l=async e=>{(0,r.Z)("generated-alt");const t=await a.Bm(e),s=await a.$N(t,"image/png");this.doGenerate(s,i,o)},d=(0,n.T)("div",{className:"overlay"},(0,n.T)("div",{className:"choice"},(0,n.T)("div",{className:"button med positive",style:"min-width:200px",onclick:()=>h(t)},(0,n.T)("img",{src:"/img/tool/thick/draw.svg"}),(0,s.Z)("open")),(0,n.T)("div",{className:"button med green",style:"min-width:200px",onclick:()=>l(t)},(0,n.T)("img",{src:"/img/icon/reset.svg"}),(0,s.Z)("variations"))),(0,n.T)("div",{className:"loading",hidden:!0}));e.addEventListener("mouseover",(()=>{d.style.opacity="1.0"})),e.addEventListener("mouseleave",(()=>{d.style.opacity="0.0"})),e.append(d)},this.renderGenerateCount=()=>{var e;if(null!==(e=null===y.a||void 0===y.a?void 0:y.a.subscription)&&void 0!==e&&e)return;const t=R(),i=t>=1&&!y.a,a=t>=5;if((0,n.ZP)("generator-count").innerHTML=`${t} / 5`,i){let e=(0,n.T)("div",{className:"pane",style:"cursor:pointer"},(0,n.T)("div",{className:"pane-message"},(0,n.T)("img",{src:"/img/icon/user.svg"}),(0,n.T)("span",{},(0,s.Z)("imageGeneratorLogin"))));e.addEventListener("click",(()=>new A.ZP)),(0,n.ZP)("generator-result").prepend(e),(0,n.ZP)("generator-generate").innerText=(0,s.Z)("headerSignUpLogIn")}else if(a){let e=(0,n.T)("div",{className:"pane",style:"cursor:pointer"},(0,n.T)("div",{className:"pane-message"},(0,n.T)("img",{src:"/img/icon/premium-tick.svg"}),(0,n.T)("span",{},(0,s.Z)("imageGeneratorMaxiumum"))));e.addEventListener("click",(()=>new I.Z("IMAGEGEN",{platform:"x"}))),(0,n.ZP)("generator-result").prepend(e),(0,n.ZP)("generator-generate").innerText=(0,s.Z)("headerTryPremium")}};const t=(0,n.ZP)("generator-prompt"),i=(0,n.ZP)("generator-negative"),o=(0,n.ZP)("prompt-fragments");[{text:(0,s.Z)("portrait"),fragment:"portrait"},{text:(0,s.Z)("landscape"),fragment:"landscape"},{text:(0,s.Z)("digitalPainting"),fragment:"digital painting"},{text:(0,s.Z)("photo"),fragment:"photo"},{text:(0,s.Z)("illustration"),fragment:"illustration"},{text:(0,s.Z)("oilPainting"),fragment:"oil painting"},{text:(0,s.Z)("render"),fragment:"vray render, octane render"},{text:(0,s.Z)("hyperRealistic"),fragment:"hyper realistic"},{text:(0,s.Z)("conceptArt"),fragment:"concept art"},{text:(0,s.Z)("popArt"),fragment:"pop-art"},{text:(0,s.Z)("modernist"),fragment:"modernist"},{text:(0,s.Z)("artNouveau"),fragment:"art nouveau"},{text:(0,s.Z)("sketch"),fragment:"sketch"},{text:(0,s.Z)("steampunk"),fragment:"steampunk"},{text:(0,s.Z)("cyberpunk"),fragment:"cyberpunk"},{text:(0,s.Z)("smooth"),fragment:"smooth"},{text:"Studio Ghibli",fragment:"studio ghibli"},{text:(0,s.Z)("postGrunge"),fragment:"post grunge"},{text:(0,s.Z)("keyArt"),fragment:"key art"},{text:(0,s.Z)("doodle"),fragment:"oil painting"},{text:(0,s.Z)("anime"),fragment:"anime"},{text:(0,s.Z)("gameGraphics"),fragment:"unreal engine"},{text:(0,s.Z)("cinematicShot"),fragment:"cinematic shot"},{text:(0,s.Z)("highlyDetailed"),fragment:"highly detailed"},{text:(0,s.Z)("sharpFocus"),fragment:"sharp focus"},{text:(0,s.Z)("highResolution"),fragment:"4k, 8k, 128k"},{text:(0,s.Z)("matte"),fragment:"matte"},{text:(0,s.Z)("dramatic"),fragment:"dramatic"},{text:(0,s.Z)("silk"),fragment:"silk"},{text:(0,s.Z)("expansive"),fragment:"expansive"},{text:(0,s.Z)("lowAngleShot"),fragment:"low angle show"},{text:(0,s.Z)("psychedelic"),fragment:"psychedelic"},{text:(0,s.Z)("centeredClose"),fragment:"centered close"},{text:(0,s.Z)("saturated"),fragment:"saturated"},{text:(0,s.Z)("symmetry"),fragment:"(symmetry)"}].forEach((e=>{o.append((0,n.T)("div",{className:"link",onclick:()=>{t.value+=`, ${e.fragment}`,this.resizeTextInput((0,n.ZP)("generator-prompt"))}},e.text))})),(0,n.ZP)("generator-generate").onclick=()=>this.doGenerate(),(0,n.ZP)("generator-clear").onclick=()=>this.clear(),(0,n.ZP)("generator-random").onclick=()=>this.random(),t.oninput=e=>{this.resizeTextInput((0,n.ZP)("generator-prompt")),"Enter"!==e.key||(0,n.ZP)("generator-generate").classList.contains("disabled")||(e.preventDefault(),this.doGenerate())},i.oninput=e=>{this.resizeTextInput((0,n.ZP)("generator-negative")),"Enter"!==e.key||(0,n.ZP)("generator-generate").classList.contains("disabled")||(e.preventDefault(),this.doGenerate())};let h=(0,n.ZP)("generator-aspect-selector").getElementsByTagName("li");for(var l=0;l<h.length;l++)h[l].addEventListener("click",this.selectAspect,!1);let d=(0,n.ZP)("generator-style-selector").getElementsByTagName("li");for(l=0;l<d.length;l++)d[l].addEventListener("click",this.selectStyle,!1);let u=(0,n.ZP)("generator-color-selector").getElementsByTagName("li");for(l=0;l<u.length;l++)u[l].addEventListener("click",this.selectColor,!1);let p=(0,n.ZP)("generator-lighting-selector").getElementsByTagName("li");for(l=0;l<p.length;l++)p[l].addEventListener("click",this.selectLighting,!1);let g=(0,n.ZP)("generator-composition-selector").getElementsByTagName("li");for(l=0;l<g.length;l++)g[l].addEventListener("click",this.selectComposition,!1);this.random(),this.renderGenerateCount()}}class D{constructor(e,t){var i,d,u,f,w,x,C;this.section="home",this.urlClick=e=>{(0,r.Z)("open-url"),new Z.Z(this.web.stage)},this.newClick=e=>{(0,r.Z)("open-new"),new b(this.web.stage)},this.openClick=async e=>{(0,r.Z)("open-browse"),await c.Q0("e"===h.ZP.product).then((async e=>{for(let t=0;t<e.length;t++)await c.ZB(this.web.stage,e[t])}))},this.menuClick=e=>{const t=e.currentTarget.getAttribute("data");t!==this.section&&this.web.navigate(t)},this.activate=e=>{try{this.section&&this.section!==e&&((0,n.ZP)(this.section+"-content").style.display="none",(0,n.ZP)(this.section+"-tab").classList.remove("selected")),this.section=e||"home",(0,n.ZP)(this.section+"-content").style.display="block",(0,n.ZP)(this.section+"-tab").classList.add("selected")}catch(t){this.section="home",(0,n.ZP)(this.section+"-content").style.display="block",(0,n.ZP)(this.section+"-tab").classList.add("selected"),history.replaceState(null,null," ")}switch(this.section){case"home":this.setHome();break;case"history":this.setHistory();break;case"template":this.setTemplate();break;case"search":this.setSearch();break;case"generator":this.generator||(this.generator=new _(this.web))}},this.showOrHideBackToEditor=()=>{(0,n.ZP)("editor-tab")&&((0,n.ZP)("editor-tab").style.display=this.web.stage&&this.web.stage.fresco?"flex":"none",(0,n.ZP)("editor-open-count").innerHTML=this.web.stage?this.web.stage.tabs.length.toString():"0")},this.setHome=async()=>{if((0,n.ZP)("history-carousel")){this.historyCarousel||(this.historyCarousel=new v("history-carousel")),this.historyCarousel.clearItem();const e=await E.q.history();(0,n.ZP)("home-history").style.display=0===e.length?"none":"block";for(let t=0;t<e.length&&(this.historyCarousel.addItem(this.createHistoryBox(e[t],"home")),!(t>14));t++);}if((0,n.ZP)("favourite-carousel")){this.favoriteCarousel||(this.favoriteCarousel=new v("favourite-carousel")),this.favoriteCarousel.clearItem();const{templates:e}=await k.Pi();(0,n.ZP)("home-favourites").style.display=0===e.length?"none":"block";for(let t=0;t<e.length&&!(t>14);t++){const i=e[t],a=(0,n.T)("div",{id:i.id,className:"template-box favourite-box"});if(i.premium?a.appendChild((0,n.T)("div",{className:"premium"})):a.appendChild((0,n.T)("div",{className:"free"},(0,s.Z)("free"))),Date.parse(i.createdAt)>Date.now()-26298e5&&a.append((0,n.T)("div",{className:"new"},(0,s.Z)("new"))),a.title=i.name,a.addEventListener("click",(()=>this.previewTemplate(i)),!0),i.animated){let e=(0,n.T)("video",{autoplay:!0,muted:!0,loop:!0},(0,n.T)("source",{src:i.previewVideo,type:"video/mp4"}));e.height=180,e.width=Math.round(Number(i.ratio.width)/Number(i.ratio.height)*180),e.title=i.name,a.appendChild(e)}else{let e=(0,n.T)("img",{src:i.thumbnailSmall});e.height=180,e.width=Math.round(Number(i.ratio.width)/Number(i.ratio.height)*180),e.loading="lazy",e.alt=i.name,a.appendChild(e)}this.favoriteCarousel.addItem(a)}}if((0,n.ZP)("template-carousel")&&!this.templateCarousel){const e="e"===h.ZP.product?"604a0d511881596a2f2416fb":"604a0d5f082c442ccad3df8a";let t=await k.RH(e,40);if(t&&t.templates){this.templateCarousel=new v("template-carousel");const e=a.Sy(t.templates);for(let t=0;t<e.length&&!(t>20);t++){const i=e[t],a=(0,n.T)("div",{id:i.id,className:"template-box"});if(i.isFavorite&&a.classList.add("favourite-box"),i.premium?a.appendChild((0,n.T)("div",{className:"premium"})):a.appendChild((0,n.T)("div",{className:"free"},(0,s.Z)("free"))),Date.parse(i.createdAt)>Date.now()-26298e5&&a.append((0,n.T)("div",{className:"new"},(0,s.Z)("new"))),a.title=i.name,a.addEventListener("click",(()=>this.previewTemplate(i)),!0),i.animated){let e=(0,n.T)("video",{autoplay:!0,muted:!0,loop:!0},(0,n.T)("source",{src:i.previewVideo,type:"video/mp4"}));e.height=180,e.width=Math.round(Number(i.ratio.width)/Number(i.ratio.height)*180),e.title=i.name,a.appendChild(e)}else{let e=(0,n.T)("img",{src:i.thumbnailSmall});e.height=180,e.width=Math.round(Number(i.ratio.width)/Number(i.ratio.height)*180),e.loading="lazy",e.alt=i.name,a.appendChild(e)}this.templateCarousel.addItem(a)}}}},this.setHistory=async()=>{const e=(0,n.ZP)("history-latest"),t=(0,n.ZP)("history-pinned");e.innerHTML="",t.innerHTML="";const i=await E.q.history();if(0==i.length)return(0,n.ZP)("history-latest").style.display="none",void((0,n.ZP)("history-no-content").style.display="block");const a=(0,n.ZP)("history-controls"),r=(0,n.ZP)("history-clear"),o=(0,n.ZP)("history-no-content");r.onclick=async()=>{await new P.Z("Confirm",(0,s.Z)("historyClearConfirm"),(0,s.Z)("clear")).init()&&(await E.q.deleteAll(),await this.setHistory(),this.web.stage&&this.web.stage.fresco&&(this.web.stage.close(),(0,n.ZP)("toggle-editor").style.display="none"))},i.forEach((i=>{let s=this.createHistoryBox(i,"hist");i.pinned?t.appendChild(s):e.appendChild(s)})),e.children.length>0?(e.style.display="flex",a.style.display="block",o.style.display="none"):(e.style.display="none",a.style.display="none",o.style.display="block"),t.children.length>0?((0,n.ZP)("history-pinned-divider").style.display="block",t.style.display="flex"):((0,n.ZP)("history-pinned-divider").style.display="none",t.style.display="none")},this.createHistoryBox=(e,t)=>{const i=this.web.stage&&this.web.stage.tabs.some((t=>t.fresco.id===e.id)),c=i&&e.id===this.web.stage.fresco.id;let l,d=(0,n.T)("div",{id:t+"-"+e.id,className:"image-box"}),u=(0,n.T)("div",{className:"holder"});d.appendChild(u),i&&(d.classList.add("selected"),d.appendChild((0,n.T)("div",{id:t+"-"+e.id+"-active",className:"active-image"},c?"active":"open"))),e.getThumbnail().then((t=>{t&&(l=t,t.alt=e.name,t.width=Math.round(t.width*(180/t.height)),t.height=180,u.appendChild(t))}));const p=async t=>{null==t||t.preventDefault(),null==t||t.stopPropagation();const i=(0,n.T)("div",{className:"modal dim"});(0,n.ZP)("home").append(i),document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));const a="pxz",o=e.name||"Untitled";let c;if(!(h.ZP.useLegacySave||!(0,S.Zp)())&&(c=await(0,S.f1)(o,a,"Pixlr document","application/pxz"),!1===c))return document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),void i.remove();const l=new g.Z(e.id,e.name,e.width,e.height,e.transparent?void 0:e.color,e.animation,e.templateMeta);await e.restore(l);const d=await(0,S.iM)(this.web.stage,{id:l.id,name:o,quality:"100",nonDestructive:!1,type:"document",unit:"pixel"},l);if(d)if(c){await(0,S.BI)(c,new File([d],o+"."+a))||(0,S.vV)(new File([d],o+"."+a),o,a)}else(0,S.vV)(new File([d],o+"."+a),o,a);i.remove(),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("fileSaved")})),(0,r.Z)("save-file","pxz-home")},m=async i=>{null==i||i.preventDefault(),null==i||i.stopPropagation(),await E.q.duplicate(e.id),"home"===t?this.setHome():this.setHistory()},v=async a=>{var r,o,h;null==a||a.preventDefault(),null==a||a.stopPropagation(),await e.pendingRemove(((s,a)=>{var r,o;s&&console.log(s),a&&(i&&this.web.tabClose(e.id,!0),c&&((0,n.ZP)(t+"-"+e.id).classList.remove("selected"),null===(r=(0,n.ZP)(t+"-"+e.id+"-active"))||void 0===r||r.remove(),this.showOrHideBackToEditor()),null===(o=(0,n.ZP)(t+"-"+e.id))||void 0===o||o.remove())})),i&&this.web.tabClose(e.id,!0),c&&((0,n.ZP)(t+"-"+e.id).classList.remove("selected"),null===(r=(0,n.ZP)(t+"-"+e.id+"-active"))||void 0===r||r.remove(),this.showOrHideBackToEditor());let l=(0,n.T)("div",{className:"pending-remove"}),d=(0,n.T)("span",{},(0,s.Z)("historyPendingDelete")),u=(0,n.T)("a",{},`↺ ${(0,s.Z)("historyUndo")}`);u.addEventListener("click",(async i=>{null==i||i.preventDefault(),null==i||i.stopPropagation(),await e.undoRemove(),(0,n.ZP)(t+"-"+e.id).classList.remove("pending"),l.remove()})),l.append(d,u),null===(o=(0,n.ZP)(t+"-"+e.id))||void 0===o||o.classList.add("pending"),null===(h=(0,n.ZP)(t+"-"+e.id))||void 0===h||h.append(l)},f=(0,n.T)("div",{className:"top"});d.appendChild(f);const y=document.createElement("img");y.classList.add("close"),y.src="/img/icon/close.svg",y.title=`${(0,s.Z)("historyDelete")} ${e.name}`,y.alt=y.title,y.addEventListener("click",v),f.appendChild(y);const w=async i=>{null==i||i.preventDefault(),null==i||i.stopPropagation(),await(e.pinned?e.unpin():e.pin()),"home"===t?this.setHome():this.setHistory()},x=document.createElement("img");x.classList.add("pin"),x.src=e.pinned?"/img/icon/unpin.svg":"/img/icon/pin.svg",x.title=e.pinned?`${(0,s.Z)("historyUnpin")} ${e.name}`:`${(0,s.Z)("historyPin")} ${e.name}`,x.alt=x.title,x.addEventListener("click",w),f.appendChild(x);const b=document.createElement("img");b.classList.add("more"),b.src="/img/icon/three-dot.svg",b.title=(0,s.Z)("documentActions"),b.alt=(0,s.Z)("documentActions"),b.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();const i=t.currentTarget.getBoundingClientRect();new T.C(new o.Z(i.x+(0,n.ZP)("home").scrollLeft+10,i.y+(0,n.ZP)("home").scrollTop+10),[new T.Z((0,s.Z)("historyDownloadPXZ"),p),new T.Z,new T.Z(e.pinned?(0,s.Z)("historyUnpin"):(0,s.Z)("historyPin"),w),new T.Z,new T.Z((0,s.Z)("historyDuplicate"),m),new T.Z((0,s.Z)("historyDelete"),v)])})),f.appendChild(b);let Z=document.createElement("input");Z.value=e.name?e.name.toLowerCase():"Untitled",Z.className="name",Z.addEventListener("click",(e=>(e.stopPropagation(),!1))),Z.addEventListener("keyup",a.d4(500,(()=>{e.name=Z.value,e.save()}))),d.appendChild(Z);let k=document.createElement("span");return k.innerText=a.ly(e.lastModified),k.className="since",d.appendChild(k),d.addEventListener("click",(()=>{d.classList.contains("pending")||(this.web.stage&&this.web.stage.tabs.some((t=>t.fresco.id===e.id))?(this.web.navigate("editor"),this.web.tabSelect(e.id)):this.web.stage.openFromHistory(e,l).catch((e=>{alert("Error restoring document"),console.error(e)})))}),!1),d},this.setTemplate=async()=>{this.categoryCarousel||(this.categoryCarousel=new v("category-carousel")),await this.getTemplates(!0),window.onhashchange=()=>{this.getTemplates(!1)}},this.getTemplates=async e=>{var t,i,a;(0,n.ZP)("template-more").style.display="none",(0,n.ZP)("template-loading").style.display="block";var r=window.location.hash.replace("#","").split("&").reduce(((e,t)=>{var i=t.split("=");return e[i[0]]=i[1],e}),{});if(this.category&&(null===(t=(0,n.ZP)(this.category))||void 0===t||t.classList.remove("selected")),!r.page||e){let e=(0,n.ZP)("template-holder");e.innerHTML="",e.classList.value="template-holder",r.category&&e.classList.add(r.category)}if(r.keyword||r.category||r.categoryId){let e={limit:50};e.page=Number(null!==(i=r.page)&&void 0!==i?i:1),r.category&&(e.category=r.category),r.categoryId&&(e.categoryId=r.categoryId),r.keyword&&(e.keywords=r.keyword),r.sort&&(e.sort=r.sort),e.category?((0,n.ZP)("template-holder-title").innerHTML=(0,s.Z)(e.category),null===(a=(0,n.ZP)(e.category))||void 0===a||a.classList.add("selected"),this.category=e.category,"facebook-post"!==e.category&&"instagram-post"!==e.category||(e.category="social-media-post"),"facebook-story"!==e.category&&"instagram-story"!==e.category||(e.category="social-media-story")):(0,n.ZP)("template-holder-title").innerHTML=(0,s.Z)("keyword")+": "+e.keywords;const t=await k.Qz(e);if(t.page!==t.pages){const t=(0,n.ZP)("template-more");t.style.display="block",t.onclick=async()=>{let t="#template";r.category&&(t+="&category="+r.category),r.keyword&&(t+="&keyword="+r.keyword),r.sort&&(t+="&sort="+r.sort),t+="&page="+(e.page+1),window.location.hash=t,(0,n.ZP)("home").scrollBy(0,220)}}await this.renderTemplateResult(t.templates)}else if(r.favourite){if((0,n.ZP)("template-holder-title").innerHTML=(0,s.Z)("favourite"),(0,n.ZP)("favourite").classList.add("selected"),this.category="favourite",!y.a)return(0,n.ZP)("template-loading").style.display="none",void((0,n.ZP)("template-holder").innerHTML='<div class="no-content">'+(0,s.Z)("favouriteLoginRequired")+"</div>");const{templates:e}=await k.Pi({limit:100,page:1});await this.renderTemplateResult(e)}else{(0,n.ZP)("template-holder-title").innerHTML=(0,s.Z)("recommended"),(0,n.ZP)("curated").classList.add("selected"),this.category="curated";const e="e"===h.ZP.product?"604a0d511881596a2f2416fb":"604a0d5f082c442ccad3df8a",t=await k.RH(e,50);await this.renderTemplateResult(t.templates)}r.id&&this.loadPreviewTemplate(r.id)},this.renderTemplateResult=async e=>{if(!e||0===e.length)return;let t=(0,n.ZP)("template-holder");e.forEach((e=>{const i=(0,n.T)("div",{id:e.id,className:"template-box large"});if(e.isFavorite&&i.classList.add("favourite-box"),e.premium?i.appendChild((0,n.T)("div",{className:"premium"})):i.appendChild((0,n.T)("div",{className:"free"},(0,s.Z)("free"))),i.title=e.name,i.addEventListener("click",(()=>this.previewTemplate(e)),!0),Date.parse(e.createdAt)>Date.now()-26298e5&&i.append((0,n.T)("div",{className:"new"},(0,s.Z)("new"))),e.animated){let t=(0,n.T)("video",{autoplay:!0,muted:!0,loop:!0},(0,n.T)("source",{src:e.previewVideo,type:"video/mp4"}));t.height=250,t.width=Math.round(Number(e.ratio.width)/Number(e.ratio.height)*250),t.title=e.name,i.appendChild(t)}else{let t=(0,n.T)("img",{src:e.thumbnailMedium});t.height=250,t.width=Math.round(Number(e.ratio.width)/Number(e.ratio.height)*250),t.loading="lazy",t.alt=e.name,i.appendChild(t)}t.append(i)})),(0,n.ZP)("template-loading").style.display="none"},this.loadPreviewTemplate=async e=>{const t=await k._y(e);this.previewTemplate(t)},this.previewTemplate=e=>{-1===window.location.hash.indexOf("&id")&&history.pushState(null,null,(""===window.location.hash?"#home":window.location.hash)+"&id="+e.id),new L(this.web.stage,e)},this.setSearch=async()=>{const e=(0,n.ZP)("search-content-result"),t=(0,n.ZP)("search-input");t.value=p.randomDefault(),t.focus(),t.onkeyup=i=>{switch(i.key){case"Down":case"ArrowDown":case"Up":case"ArrowUp":case"Left":case"ArrowLeft":case"Right":case"ArrowRight":case"Meta":return}let s=t.value;s.length<=2||(e.innerHTML="",(0,n.ZP)("search-more").style.display="none",(0,n.ZP)("search-loading").style.display="block",(0,n.ZP)("search-error").style.display="none",(0,n.ZP)("search-offline").style.display="none",a.Ds("search-input",800,(()=>{this.doSearch(s,e)})))},(0,n.ZP)("search-loading").style.display="block",(0,n.ZP)("search-error").style.display="none",(0,n.ZP)("search-offline").style.display="none",this.doSearch(t.value,e)},this.doSearch=async(e,t)=>{t.innerHTML="",(0,n.ZP)("search-more").style.display="none";try{const i=await p.queryAll(e);this.renderResult(i,t)}catch(i){(0,n.ZP)("search-loading").style.display="none",window.navigator.onLine?(0,n.ZP)("search-error").style.display="block":(0,n.ZP)("search-offline").style.display="block"}},this.renderResult=(e,t)=>{let i=new l(t);e.items.forEach((e=>{let t=document.createElement("div");t.classList.add("box");let s=document.createElement("img");if(s.src=e.thumbnail,s.title=e.description,s.onload=()=>i.resizeAllGridItems(),t.appendChild(s),e.credits){let i=document.createElement("a");i.className="meta",i.target="_blank",i.innerText=e.credits.name,i.title=`${e.credits.name} on ${e.source}`,i.href=e.credits.profile,t.appendChild(i)}t.onclick=()=>this.searchOpen(e),i.addChild(t)}));const s=(0,n.ZP)("search-more");s.style.display=e.nextPage&&e.items.length>0?"block":"none",(0,n.ZP)("search-loading").style.display="none",(0,n.ZP)("search-no-result").style.display=0===e.items.length?"block":"none",s.onclick=async()=>{const t=await e.nextPage();this.renderResult(t,i.getContent())}},this.searchOpen=async e=>{(0,r.Z)("open-stock");const t=new m.Z({title:e.id,referrer:e.source}),i=await e.downloadUrl();let s=await t.load(i);c.ZB(this.web.stage,s)},this.web=e,null===(i=(0,n.ZP)("welcome-open-image"))||void 0===i||i.addEventListener("mousedown",this.openClick,!0),null===(d=(0,n.ZP)("welcome-start-design"))||void 0===d||d.addEventListener("mousedown",(()=>this.web.navigate("template",!0)),!0),null===(u=(0,n.ZP)("home-open-new"))||void 0===u||u.addEventListener("mousedown",this.newClick,!0),null===(f=(0,n.ZP)("home-open-url"))||void 0===f||f.addEventListener("mousedown",this.urlClick,!0),(0,n.ZP)("home-tab").addEventListener("click",this.menuClick,!1),(0,n.ZP)("editor-tab").addEventListener("click",this.menuClick,!1),(0,n.ZP)("history-tab").addEventListener("click",this.menuClick,!1),(0,n.ZP)("template-tab").addEventListener("click",this.menuClick,!1),(0,n.ZP)("search-tab").addEventListener("click",this.menuClick,!1),null===(w=(0,n.ZP)("generator-tab"))||void 0===w||w.addEventListener("click",this.menuClick,!1),null===(x=(0,n.ZP)("mobile-ignore"))||void 0===x||x.addEventListener("click",(()=>{(0,n.ZP)("mobile-variant").remove()}),!0),(0,n.ZP)("history-view-all").addEventListener("click",(()=>this.web.navigate("history",!0)),!0),null===(C=(0,n.ZP)("recommended-view-more"))||void 0===C||C.addEventListener("click",(()=>this.web.navigate("template",!0)),!0),"editor"!==t&&this.activate(t),"getDigitalGoodsService"in window&&(0,M.ZF)()}}},96548:(e,t,i)=>{function s(e,...t){if(!I18N_STRINGS)return e;let i=I18N_STRINGS[e];if(i||(console.log("No translation for key",e),i=e),!t||0===t.length)return i;let s=0;return i.replace(/%(\d+\$)?(s|d|f){1}/gm,((e,...i)=>{const[n,a]=i,r=n?parseInt(n.slice(0,-1),10):s++;switch(a){case"d":const i=t[r];return"number"!=typeof i?"NaN":i.toFixed(0);case"s":const s=t[r];return s?s.toString():e;default:return e}}))}i.d(t,{Z:()=>s})},92672:(e,t,i)=>{i.d(t,{Z:()=>c});var s=i(98776),n=i(89679),a=i(94084),r=i(9389),o=i(71662),h=i(60134);class c{static init(){c.presets||(c.grouping={"black-white":["agnes","conny","gordon","harrison","henry","logan","olay","porter","sampi","tom","vinny"],friends:["aladin","alex","amber","anne","antonio","bob","greg","hagrid","harry","ivan","jean","josh","karen","lucas","melissa","peter","salomon","sara","sophia","tony"],instage:["borg","carl","coco","doris","doug","earl","sun","blues","country","lemonpell","tiny dc","minker"],retro:["vib","ranguit","rangeen","creamlow","sven","yenely","ragwarm","greered","danligter","garage"],tuning:["punch","bright","contrast","vivid","clairify"],portrait:["matte","deep","film","sunny","gritty"],food:["berry","ensalat","morning","corn","sharp"],urban:["cement","style","mold","shimmer","stalker","sham"],nature:["beach","flower","forest"],colors:["strawberry","clementine","pear","apple","blueberry","grapes","dragon","superone","tonola","reddish","fellowing","grassland","springs","justblues","bluesteel","flowerpot","stinker","violiin","blupur","beyllo","wifortress"],artzy:["poster","glitch","mozak","frank","pinvet","night vision","darkstreet","blomberg","lolita","atonic"]},c.presets={flower:[new n.Z("vibrance",.2),new n.Z("saturation",.1),new n.Z("temperature",.1)],forest:[new n.Z("saturation",-.2),new n.Z("vibrance",1),new n.Z("clarity",.2),new n.Z("temperature",.16),new n.Z("tint",.2),new n.Z("curves",new h.z([[0,0,65,52,173,190,236,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]]))],beach:[new n.Z("saturation",.2),new n.Z("vibrance",.2),new n.Z("curves",new h.z([[0,0,68,56,199,208,255,255],[0,0,255,255],[0,0,98,97,196,201,255,255],[0,0,87,85,201,182,255,255]])),new n.Z("temperature",.1)],sham:[new n.Z("saturation",-.3),new n.Z("fill",new a.Z(new s.Z(153,221,255),"overlay",.3)),new n.Z("curves",new h.z([[60,31,191,217],[0,0,120,134,255,255],[0,0,255,255],[0,0,120,144,255,255]]))],stalker:[new n.Z("curves",new h.z([[62,64,190,191],[0,0,133,125,255,255],[0,0,54,65,209,208,255,255],[60,62,96,99,240,230,255,255]])),new n.Z("contrast",.1),new n.Z("saturation",-.2)],shimmer:[new n.Z("temperature",-.2),new n.Z("tint",-.12),new n.Z("fill",new a.Z(new s.Z(190,11,255),"screen",.12)),new n.Z("curves",new h.z([[8,23,244,227],[0,0,255,255],[0,0,131,124,255,255],[0,0,149,112,255,255]]))],mold:[new n.Z("curves",new h.z([[65,64,233,233],[0,0,138,121,255,255],[0,0,60,75,184,184,255,255],[0,0,64,75,181,176,255,255]])),new n.Z("contrast",.1),new n.Z("saturation",-.12)],style:[new n.Z("curves",new h.z([[0,0,73,74,191,177,235,221,255,255],[0,26,89,64,121,126,180,213,255,255],[0,0,71,50,190,210,255,255],[61,64,112,97,199,198,255,255]])),new n.Z("vibrance",-.1),new n.Z("saturation",-.4),new n.Z("temperature",.1)],cement:[new n.Z("curves",new h.z([[0,0,73,74,191,177,235,221,255,255],[0,0,255,255],[0,0,60,54,198,210,255,255],[0,0,73,37,150,149,199,198,255,255]])),new n.Z("vibrance",-.1),new n.Z("saturation",-.1)],sharp:[new n.Z("curves",new h.z([[0,0,42,20,199,218,224,246,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("vibrance",.1),new n.Z("sharpen",.1),new n.Z("clarity",.1)],corn:[new n.Z("temperature",.1),new n.Z("vibrance",.3),new n.Z("contrast",.1),new n.Z("curves",new h.z([[0,0,66,78,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]]))],morning:[new n.Z("tint",.18),new n.Z("temperature",.1),new n.Z("highlights",.08),new n.Z("levels",new o.Z(0,245,0,255)),new n.Z("curves",new h.z([[64,64,150,181,254,255],[0,0,122,138,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("fill",new a.Z(new s.Z(194,120,41),"overlay",.2))],ensalat:[new n.Z("highlights",.2),new n.Z("shadows",-.2),new n.Z("brightness",.1),new n.Z("levels",new o.Z(10,245,0,255)),new n.Z("curves",new h.z([[0,0,135,119,191,193,255,255],[0,0,255,255],[0,0,129,121,255,255],[0,0,255,255]])),new n.Z("clarity",.2),new n.Z("sharpen",.15)],berry:[new n.Z("vibrance",.44),new n.Z("curves",new h.z([[0,0,62,66,121,135,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("contrast",.2),new n.Z("highlights",.4),new n.Z("shadows",-.2),new n.Z("levels",new o.Z(20,255,0,255))],gritty:[new n.Z("saturation",-.4),new n.Z("levels",new o.Z(20,255,0,255)),new n.Z("curves",new h.z([[0,0,50,33,128,112,190,215,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("clarity",1),new n.Z("grain",.3)],sunny:[new n.Z("fill",new a.Z(new s.Z(255,194,96),"overlay",.2)),new n.Z("temperature",.1),new n.Z("glamour",.4),new n.Z("clarity",.3)],film:[new n.Z("sharpen",.2),new n.Z("glamour",.5),new n.Z("grain",.5),new n.Z("highlights",-.2),new n.Z("shadows",-.2),new n.Z("saturation",-.2)],matte:[new n.Z("curves",new h.z([[0,50,38,56,79,82,152,153,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("contrast",.12),new n.Z("saturation",-.1)],deep:[new n.Z("curves",new h.z([[0,0,117,99,191,198,255,255],[0,0,71,38,177,209,255,255],[0,0,236,255],[0,28,75,101,190,171,254,233]])),new n.Z("saturation",-.3)],aladin:[new n.Z("curves",new h.z([[0,0,255,255],[0,52,87,99,255,255],[0,0,106,107,194,190,254,212],[0,0,166,129,254,142]]))],amber:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,98,150,255,255],[0,0,138,117,255,255],[0,128,254,129]])),new n.Z("saturation",-.3),new n.Z("levels",new o.Z(20,235,0,255))],anne:[new n.Z("contrast",.25),new n.Z("curves",new h.z([[0,0,255,255],[0,0,78,66,135,171,255,255],[0,0,99,87,180,208,255,255],[0,0,94,93,171,161,255,255]]))],antonio:[new n.Z("glamour",.8)],alex:[new n.Z("glamour",.6)],bob:[new n.Z("saturation",-.6),new n.Z("highlights",.5)],greg:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,74,50,181,198,255,255],[0,0,61,41,108,170,158,207,254,208],[0,0,83,56,168,204,255,255]]))],hagrid:[new n.Z("vibrance",.9),new n.Z("saturation",.1),new n.Z("clarity",.5),new n.Z("shadows",-.3)],harry:[new n.Z("fill",new a.Z(new s.Z(214,178,119),"overlay",.7)),new n.Z("grain",.5)],ivan:[new n.Z("fill",new a.Z(new s.Z(255,0,68),"overlay",.4)),new n.Z("shadows",.15),new n.Z("levels",new o.Z(6,255,0,255))],jean:[new n.Z("levels",new o.Z(56,233,0,255)),new n.Z("saturation",-1),new n.Z("tint",.1),new n.Z("exposure",.78),new n.Z("bloom",.1)],josh:[new n.Z("curves",new h.z([[0,0,78,52,175,207,255,255],[0,0,255,255],[0,0,255,255],[0,64,87,129,254,193]]))],karen:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,89,144,255,255],[0,0,138,112,255,255],[0,0,162,88,255,255]]))],lucas:[new n.Z("tint",1),new n.Z("saturation",-.85),new n.Z("contrast",.4),new n.Z("shadows",1),new n.Z("temperature",.1)],melissa:[new n.Z("curves",new h.z([[0,0,255,255],[0,62,255,255],[0,0,255,255],[0,61,254,193]]))],peter:[new n.Z("curves",new h.z([[0,0,255,255],[0,6,31,20,65,26,87,51,195,190,254,230],[0,11,24,27,102,131,189,195,255,255],[0,40,126,148,254,177]]))],salomon:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,83,50,177,213,255,255],[0,0,69,55,186,205,255,255],[11,56,254,212]])),new n.Z("contrast",-.2)],sara:[new n.Z("vibrance",1),new n.Z("contrast",.1),new n.Z("highlights",.3)],sophia:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,140,116,222,254],[0,0,70,59,182,201,255,255],[0,29,252,227]])),new n.Z("saturation",.3)],tony:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,92,42,218,252],[0,0,73,75,157,194,255,255],[0,27,254,227]]))],agnes:[new n.Z("desaturate",1),new n.Z("contrast",.4)],conny:[new n.Z("saturation",-.55),new n.Z("temperature",.25),new n.Z("brightness",-.25),new n.Z("levels",new o.Z(14,233,0,255)),new n.Z("exposure",.35),new n.Z("highlights",-.9)],gordon:[new n.Z("desaturate",1),new n.Z("temperature",.7),new n.Z("tint",.3),new n.Z("saturation",-.2)],harrison:[new n.Z("toning",new r.Z(new s.Z(255,240,215),void 0,new s.Z(48,26,24),1)),new n.Z("grain",.2)],henry:[new n.Z("toning",new r.Z(new s.Z(255,240,215),void 0,new s.Z(48,26,24),1)),new n.Z("saturation",-.5)],logan:[new n.Z("glamour",.5),new n.Z("tint",.4),new n.Z("saturation",-.35),new n.Z("toning",new r.Z(new s.Z(255,240,215),void 0,new s.Z(48,26,24),.8))],olay:[new n.Z("saturation",-1),new n.Z("grain",.5),new n.Z("vignette",.5)],porter:[new n.Z("saturation",-1),new n.Z("vignette",.4),new n.Z("levels",new o.Z(50,205))],tom:[new n.Z("desaturate",1)],sampi:[new n.Z("toning",new r.Z(new s.Z(255,228,196),void 0,new s.Z(0,0,0),1)),new n.Z("levels",new o.Z(0,217,0,255)),new n.Z("temperature",.3)],vinny:[new n.Z("curves",new h.z([[0,0,133,111,255,255],[0,0,255,255],[0,0,255,255],[0,0,133,138,255,255]])),new n.Z("vibrance",-1),new n.Z("saturation",1),new n.Z("temperature",.8),new n.Z("contrast",-.1),new n.Z("highlights",.1)],borg:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,94,66,227,255],[0,0,93,94,179,198,255,255],[0,19,254,228]])),new n.Z("fill",new a.Z(new s.Z(204,255,0),"",.1))],carl:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,93,64,227,255],[0,0,93,94,181,189,255,255],[0,19,254,228]])),new n.Z("vignette",.3),new n.Z("contrast",.15),new n.Z("saturation",-.3)],coco:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,64,97,255,255],[0,0,142,122,255,255],[0,0,144,112,255,255]]))],doris:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,78,48,177,209,255,255],[0,0,92,94,179,208,255,255],[0,52,254,215]])),new n.Z("saturation",-.2)],doug:[new n.Z("curves",new h.z([[0,0,255,255],[0,64,255,255],[0,0,255,255],[1,64,252,193]])),new n.Z("highlights",.5),new n.Z("shadows",-.3)],earl:[new n.Z("vignette",.4),new n.Z("curves",new h.z([[0,0,255,255],[0,0,222,254],[0,47,223,254],[0,129,222,255]])),new n.Z("fill",new a.Z(new s.Z(247,218,174),"multiply",.8))],sun:[new n.Z("fill",new a.Z(new s.Z(251,242,163),"multiply",.8)),new n.Z("vignette",-.25)],blues:[new n.Z("curves",new h.z([[0,0,255,255],[0,0,77,54,181,207,255,255],[0,0,73,51,180,209,255,255],[0,0,54,75,201,185,255,255]]))],country:[new n.Z("curves",new h.z([[0,0,84,74,115,105,255,255],[0,0,73,80,93,124,255,255],[0,0,50,34,93,105,119,142,255,255],[0,0,85,85,125,112,255,255]]))],lemonpell:[new n.Z("curves",new h.z([[0,36,80,84,156,190,255,255],[0,0,255,255],[0,0,103,105,158,176,255,255],[0,19,107,83,198,196,255,255]]))],"tiny dc":[new n.Z("curves",new h.z([[0,0,255,255],[0,0,79,46,199,217,255,255],[9,1,110,126,254,232],[0,46,92,103,191,158,254,205]])),new n.Z("grain",.3)],minker:[new n.Z("toning",new r.Z(new s.Z(255,216,153),void 0,new s.Z(26,0,77),.8)),new n.Z("levels",new o.Z(0,247,8,255)),new n.Z("brightness",.14),new n.Z("contrast",.4),new n.Z("vibrance",.5)],superone:[new n.Z("toning",new r.Z(new s.Z(255,216,153),void 0,new s.Z(77,0,51),.8)),new n.Z("levels",new o.Z(50,175,0,255))],tonola:[new n.Z("toning",new r.Z(new s.Z(221,255,153),void 0,new s.Z(77,0,51),.8)),new n.Z("levels",new o.Z(26,213,0,255)),new n.Z("saturation",.36),new n.Z("temperature",.22)],reddish:[new n.Z("toning",new r.Z(new s.Z(255,214,147),void 0,new s.Z(110,37,0),.8)),new n.Z("contrast",.3),new n.Z("highlights",1)],fellowing:[new n.Z("toning",new r.Z(new s.Z(255,216,153),void 0,new s.Z(77,47,0),.8)),new n.Z("levels",new o.Z(24,203,0,255)),new n.Z("contrast",.14),new n.Z("saturation",.3),new n.Z("temperature",.18)],grassland:[new n.Z("toning",new r.Z(new s.Z(221,255,153),void 0,new s.Z(0,77,25),.7)),new n.Z("levels",new o.Z(18,227,0,255)),new n.Z("contrast",.16)],springs:[new n.Z("toning",new r.Z(new s.Z(221,255,153),void 0,new s.Z(0,26,38),1)),new n.Z("highlights",1),new n.Z("levels",new o.Z(40,155,0,255)),new n.Z("shadows",1)],justblues:[new n.Z("toning",new r.Z(new s.Z(198,236,255),void 0,new s.Z(26,0,77),.79)),new n.Z("levels",new o.Z(16,189,0,255)),new n.Z("saturation",.2),new n.Z("contrast",.2)],bluesteel:[new n.Z("toning",new r.Z(new s.Z(255,216,153),void 0,new s.Z(26,0,77),.8)),new n.Z("levels",new o.Z(0,215,12,255))],flowerpot:[new n.Z("toning",new r.Z(new s.Z(255,153,221),void 0,new s.Z(51,77,0),.8)),new n.Z("levels",new o.Z(22,215,0,255)),new n.Z("vignette",-.2)],stinker:[new n.Z("toning",new r.Z(new s.Z(255,216,153),void 0,new s.Z(26,0,77),.8)),new n.Z("levels",new o.Z(0,247,8,255)),new n.Z("brightness",.14),new n.Z("contrast",.4)],violiin:[new n.Z("contrast",.32),new n.Z("toning",new r.Z(new s.Z(195,166,255),void 0,new s.Z(33,0,0),1)),new n.Z("levels",new o.Z(22,223,0,255)),new n.Z("exposure",.22),new n.Z("brightness",.12)],blupur:[new n.Z("toning",new r.Z(new s.Z(255,153,221),void 0,new s.Z(7,68,97),.8)),new n.Z("vibrance",.7),new n.Z("contrast",.3)],beyllo:[new n.Z("vibrance",1),new n.Z("saturation",1),new n.Z("temperature",-.55),new n.Z("tint",.1),new n.Z("levels",new o.Z(0,255,24,249)),new n.Z("toning",new r.Z(new s.Z(255,213,0),void 0,new s.Z(125,3,84),.76)),new n.Z("curves",new h.z([[0,0,255,255],[0,0,131,115,255,255],[0,0,136,128,255,255],[0,0,122,145,255,255]])),new n.Z("vignette",.28)],wifortress:[new n.Z("toning",new r.Z(new s.Z(108,206,255),void 0,new s.Z(0,26,38),1)),new n.Z("highlights",1),new n.Z("levels",new o.Z(40,155,0,255)),new n.Z("shadows",1)],vib:[new n.Z("vibrance",.1),new n.Z("saturation",.5),new n.Z("brightness",.1),new n.Z("temperature",.5),new n.Z("levels",new o.Z(12,253,0,255)),new n.Z("highlights",.2),new n.Z("curves",new h.z([[0,0,255,255],[0,0,70,80,198,181,255,255],[0,0,140,135,255,255],[0,0,74,96,200,172,255,255]])),new n.Z("toning",new r.Z(new s.Z(255,238,210),void 0,new s.Z(54,6,6),.07)),new n.Z("contrast",-.1)],ranguit:[new n.Z("saturation",.22),new n.Z("temperature",.96),new n.Z("tint",-.28),new n.Z("contrast",.14),new n.Z("brightness",-.2),new n.Z("levels",new o.Z(0,237,56,255)),new n.Z("toning",new r.Z(new s.Z(221,255,153),void 0,new s.Z(41,35,33),.26))],rangeen:[new n.Z("vibrance",1),new n.Z("saturation",.46),new n.Z("temperature",.36),new n.Z("levels",new o.Z(0,251,14,255)),new n.Z("shadows",.34),new n.Z("highlights",.12),new n.Z("toning",new r.Z(new s.Z(121,255,224),void 0,new s.Z(245,22,107),.12)),new n.Z("contrast",-.1),new n.Z("curves",new h.z([[0,0,144,152,255,255],[0,0,136,107,255,255],[0,0,115,102,255,255],[0,0,106,91,255,255]]))],creamlow:[new n.Z("vibrance",.82),new n.Z("saturation",-.24),new n.Z("temperature",1),new n.Z("tint",.78),new n.Z("contrast",-.3),new n.Z("levels",new o.Z(40,247,0,255)),new n.Z("highlights",.64),new n.Z("toning",new r.Z(new s.Z(221,255,153),void 0,new s.Z(145,39,9),.29)),new n.Z("curves",new h.z([[0,0,5,13,78,83,172,162,255,255],[0,0,255,255],[0,0,131,120,255,255],[0,0,68,61,175,184,255,255]]))],sven:[new n.Z("vibrance",.7),new n.Z("temperature",.5),new n.Z("tint",.3),new n.Z("exposure",.2),new n.Z("contrast",-.2),new n.Z("levels",new o.Z(4,255,0,235)),new n.Z("highlights",-.3),new n.Z("shadows",.3),new n.Z("grain",.3),new n.Z("vignette",.45)],yenely:[new n.Z("tint",.5),new n.Z("levels",new o.Z(0,235,20,255)),new n.Z("saturation",-.62),new n.Z("contrast",-.3),new n.Z("shadows",-.6),new n.Z("curves",new h.z([[0,0,148,105,255,255],[0,0,92,79,128,227,255,255],[0,0,74,103,119,172,255,255],[0,0,111,148,255,255]])),new n.Z("highlights",1),new n.Z("brightness",.14),new n.Z("temperature",.3),new n.Z("vibrance",1),new n.Z("exposure",-.1)],ragwarm:[new n.Z("temperature",.62),new n.Z("levels",new o.Z(32,255,0,243)),new n.Z("highlights",-.14),new n.Z("vignette",.28),new n.Z("toning",new r.Z(new s.Z(153,255,187),void 0,new s.Z(21,55,143),.07)),new n.Z("curves",new h.z([[0,0,126,125,255,255],[0,0,255,255],[0,0,130,121,255,255],[0,0,138,124,255,255]]))],greered:[new n.Z("vibrance",.32),new n.Z("temperature",.4),new n.Z("tint",-.5),new n.Z("brightness",.24),new n.Z("contrast",-.1),new n.Z("vignette",.31),new n.Z("shadows",.38)],danligter:[new n.Z("saturation",.86),new n.Z("temperature",-1),new n.Z("tint",-.92),new n.Z("brightness",.22),new n.Z("exposure",.22),new n.Z("contrast",.1),new n.Z("levels",new o.Z(0,239,0,255)),new n.Z("highlights",-.12),new n.Z("dehaze",-.12),new n.Z("toning",new r.Z(new s.Z(255,216,153),void 0,new s.Z(0,52,77),.14)),new n.Z("curves",new h.z([[0,0,255,255],[0,0,96,115,162,194,255,255],[0,0,101,97,185,189,255,255],[0,0,144,130,222,228,255,255]]))],garage:[new n.Z("tint",.6),new n.Z("saturation",-.04),new n.Z("shadows",-1),new n.Z("grain",.42),new n.Z("glamour",.3)],strawberry:[new n.Z("fill",new a.Z(new s.Z(255,0,0),"soft-light",.5))],clementine:[new n.Z("fill",new a.Z(new s.Z(255,158,0),"soft-light",.5))],pear:[new n.Z("fill",new a.Z(new s.Z(170,255,0),"soft-light",.5))],apple:[new n.Z("fill",new a.Z(new s.Z(0,255,85),"soft-light",.5))],blueberry:[new n.Z("fill",new a.Z(new s.Z(0,170,255),"soft-light",.5))],grapes:[new n.Z("fill",new a.Z(new s.Z(85,0,255),"soft-light",.5))],dragon:[new n.Z("fill",new a.Z(new s.Z(255,0,170),"soft-light",.5))],punch:[new n.Z("curves",new h.z([[0,0,80,64,173,193,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("vibrance",.5)],bright:[new n.Z("highlights",-.3),new n.Z("shadows",.5),new n.Z("levels",new o.Z(0,215,10,255))],contrast:[new n.Z("contrast",.2),new n.Z("highlights",.2),new n.Z("levels",new o.Z(20,215,0,255)),new n.Z("shadows",.4)],vivid:[new n.Z("vibrance",.4),new n.Z("shadows",.25)],clairify:[new n.Z("clarity",.6),new n.Z("sharpen",.1),new n.Z("glamour",.2)],poster:[new n.Z("posterize",.08)],glitch:[new n.Z("scanlines",{size:.03,amount:.05,colorize:!1,direction:!1}),new n.Z("slice",{seed:86,amount:4,distance:.12,line:!0}),new n.Z("bleed",{seed:58,amplitude:.05,block:1.2})],mozak:[new n.Z("mosaic",.5),new n.Z("fringe",.2)],frank:[new n.Z("fringe",.4)],pinvet:[new n.Z("bloom",.33),new n.Z("invert",1),new n.Z("pixelate",.7)],blomberg:[new n.Z("bloom",.33),new n.Z("invert",1),new n.Z("tint",1),new n.Z("temperature",-.8),new n.Z("saturation",-.5)],lolita:[new n.Z("fill",new a.Z(new s.Z(255,153,153),"vivid-light",1))],atonic:[new n.Z("curves",new h.z([[0,0,255,255],[6,235,246,4],[131,3,138,255],[1,42,251,213]]))],"night vision":[new n.Z("fill",new a.Z(new s.Z(30,255,0),"multiply",1)),new n.Z("levels",new o.Z(0,183,0,255)),new n.Z("vignette",.85),new n.Z("grain",.6)],darkstreet:[new n.Z("temperature",-1),new n.Z("highlights",.58),new n.Z("shadows",-1),new n.Z("levels",new o.Z(100,249,0,255)),new n.Z("grain",1),new n.Z("exposure",-1)]})}static named(e){return c.init(),this.presets[e]}static firstInGroup(e){return c.init(),c.grouping[e][0]}static groupLength(e){return c.grouping[e].length}static groups(){c.init();const e=[];for(const t in c.grouping)e.push(t);return e}static names(e){c.init();const t=[];for(const i in c.grouping[e])t.push(c.grouping[e][i]);return t}}},12257:(e,t,i)=>{i.d(t,{Z:()=>h});var s=i(93947),n=i(33655),a=i(98776),r=i(43673),o=i(50972);class h{constructor(e){this.getSettingsString=()=>JSON.stringify(this.settings),this.setSettingsString=e=>{this.settings=n.mS(o.Z,JSON.parse(e)),this.generate()},this.getStep=()=>Math.round(this.settings.distance*this.settings.size),this.getCursorImage=(e,t=new a.Z(255,255,255,255))=>{if(!(this.canvas.width*e>512||this.canvas.height*e>512))return this.generatetOutline(e,t)},this.generateBasic=(e,t)=>{let i=this.settings.softness;if(this.settings.size<3){if(1===this.settings.size||i<.25)return this.canvas.width=this.settings.size,this.canvas.height=this.settings.size,this.context.fillStyle=e.toRGBA(),void this.context.fillRect(0,0,this.canvas.width,this.canvas.height);i-=.25}const s=this.settings.size,n=(s%2?s:s+1)/2;let a,o,h,c,l,d,u,p,g,m=0,v=0,f=new r.Z(0,0),y=new r.Z(0,0);switch(d=Math.sin(this.settings.angle*Math.PI/180),l=Math.cos(this.settings.angle*Math.PI/180),g=n*this.settings.aspect,f.x=l*n,f.y=d*n*-1,y.x=d*g,y.y=l*g,this.settings.type){case"circle":m=Math.ceil(Math.sqrt(f.x*f.x+y.x*y.x)),v=Math.ceil(Math.sqrt(f.y*f.y+y.y*y.y));break;case"square":m=Math.ceil(Math.abs(f.x)+Math.abs(y.x)),v=Math.ceil(Math.abs(f.y)+Math.abs(y.y));break;case"diamond":m=Math.ceil(Math.max(Math.abs(f.x),Math.abs(y.x))),v=Math.ceil(Math.max(Math.abs(f.y),Math.abs(y.y)))}this.settings.spikes>2&&(m=v=Math.ceil(Math.sqrt(n*n+g*g)),y.x=d*n,y.y=l*n),this.canvas.width=2*m+1,this.canvas.height=2*v+1;const w=this.lookupTable(n,i);u=Math.cos(-2*Math.PI/this.settings.spikes),p=Math.sin(-2*Math.PI/this.settings.spikes);const x=this.context.canvas.width,b=this.context.getImageData(0,0,x,this.context.canvas.height);for(h=-v;h<=v;++h)for(o=-m;o<=m;++o){let i=0,s=l*o-d*h,r=Math.abs(d*o+l*h);if(this.settings.spikes>2){let e,t,i=Math.atan2(r,s);for(;i>Math.PI/this.settings.spikes;)t=s,e=r,s=u*t-p*e,r=p*t+u*e,i-=2*Math.PI/this.settings.spikes}switch(r/=this.settings.aspect,this.settings.type){case"circle":i=Math.sqrt(s*s+r*r);break;case"square":i=Math.max(Math.abs(s),Math.abs(r));break;case"diamond":i=Math.abs(s)+Math.abs(r)}a=i<n+1?w[Math.floor(4*i)]:0,t&&(a=a<64?0:255),c=4*((h+v)*x+(o+m)),b.data[c]=e.r,b.data[c+1]=e.g,b.data[c+2]=e.b,b.data[c+3]=a}this.context.putImageData(b,0,0)},this.generateCustom=(e,t)=>{},this.canvas=(0,s.T)("canvas"),this.settings=e,this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this.generate()}generate(e=new a.Z,t=!1){"custom"===this.settings.type?this.generateCustom(e,t):this.generateBasic(e,t)}generatetOutline(e=1,t=new a.Z(255,255,255,255)){const i=Math.round(this.canvas.width*e)||1,s=Math.round(this.canvas.height*e)||1;let r=n.vL(i+2,s+2);const o=r.getContext("2d");o.fillStyle=t.toRGBA(),o.shadowColor=new a.Z(0,0,0).toRGBA(),o.shadowBlur=1,i>20&&s>20&&(o.fillRect(~~(i/2)-3,~~(s/2),8,2),o.fillRect(~~(i/2),~~(s/2)-3,2,8));let h,c,l,d,u,p=1!=e?n.eY(this.canvas,i,s,!1).getContext("2d").getImageData(0,0,i,s):this.context.getImageData(0,0,i,s);for(let n=0;n<s;++n){c=!0,l=Boolean(p.data[n*i*4+3]<64);for(let e=0;e<i;++e)h=c,c=l,l=e+1===i||p.data[4*(n*i+e+1)+3]<64,c||(d=n-1<0||p.data[4*((n-1)*i+e)+3]<64,u=n+1===s||p.data[4*((n+1)*i+e)+3]<64,(h||d||l||u)&&o.fillRect(e+1,n+1,1,1))}if(i<=20&&s<=20){const e=n.vL(33,33),i=e.getContext("2d");i.drawImage(r,Math.floor((33-r.width)/2),Math.floor((33-r.height)/2)),i.fillStyle=t.toRGBA(),i.shadowColor=new a.Z(0,0,0).toRGBA(),i.shadowBlur=1,i.fillRect(2,15,4,2),i.fillRect(26,15,4,2),i.fillRect(15,2,2,4),i.fillRect(15,26,2,4),r=e}return r}lookupTable(e,t){const i=new Array;let s,n,a=0;const r=new Array(4),o=Math.round(e+1),h=4*Math.ceil(1+Math.sqrt(o*o*2));let c;for(n=t<4e-7?1e6:.4/t,c=0;c<4;c++)s=Math.abs((c+.5)/4-.5),r[c]=s>e?0:this.gaussian(Math.pow(s/e,n)),a+=r[c];for(c=0;s<e||a>1e-5;s+=1/4){a-=r[c%4],r[c%4]=s>e?0:this.gaussian(Math.pow(s/e,n)),a+=r[c%4];let t=Math.floor(63.75*a);i[c++]=Math.max(0,t)}for(;c<h;)i[c++]=0;return i}gaussian(e){return e<-.5?2*(e=-1-e)*e:e<.5?1-2*e*e:2*(e=1-e)*e}}},50972:(e,t,i)=>{i.d(t,{Z:()=>n});class s{constructor(e="circle",t=40,i=.2,s=1,n=0,a=1,r=2,o=.2,h=void 0){this.type=e,this.size=t,this.softness=i,this.opacity=s,this.angle=n,this.aspect=a,this.spikes=r,this.distance=o,this.source=h}}s.isEqual=(e,t)=>!(!e||!t)&&(e.type===t.type&&e.size===t.size&&e.softness===t.softness&&e.angle===t.angle&&e.aspect===t.aspect&&e.spikes===t.spikes&&e.source===t.source);const n=s},71662:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(e=0,t=255,i=0,s=255,n=1,a=.5){this.minin=e,this.maxin=t,this.minout=i,this.maxout=s,this.midin=n,this.mid=a,this.map=e=>(e=(e-this.minin)/(this.maxin-this.minin),e=Math.pow(e,this.midin),(e=this.minout+e*(this.maxout-this.minout))>this.maxout?e=this.maxout:e<this.minout&&(e=this.minout),Math.round(e))}reset(){this.minout=0,this.maxout=255,this.midin=1,this.minin=0,this.maxin=255,this.mid=.5}isFlat(){return Boolean(0==this.minout&&255==this.maxout&&.5==this.mid&&0==this.minin&&255==this.maxin)}setMid(e){this.mid=(e-this.minin)/(this.maxin-this.minin),this.midin=this.midToIn(this.mid)}midToIn(e){return Math.min(Math.max(Math.pow(9.99,2*e-1),.1),9.99)}static fillPaletteMap(e,t){for(let i=0;i<256;++i){let s=e.map(i);t.data[4*i]=s,t.data[4*i+1]=s,t.data[4*i+2]=s}}static fillRGBPaletteMap(e,t,i,s){for(let n=0;n<256;++n)s.data[4*n]=e?e.map(n):n,s.data[4*n+1]=t?t.map(n):n,s.data[4*n+2]=i?i.map(n):n}}},82468:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(e,t){var i,s,n,a,r,o,h,c,l,d,u,p,g;if(null!=e&&null!=t){for(c=e.length-1,a=[],u=[],h=[],d=[],p=[],s=[],i=[],n=[],o=[],l=[],r=0;0<=c?r<c:r>c;0<=c?r+=1:r-=1)a[r]=e[r+1]-e[r],o[r]=t[r+1]-t[r],l[r]=o[r]/a[r];for(r=1;1<=c?r<c:r>c;1<=c?r+=1:r-=1)u[r]=3/a[r]*(t[r+1]-t[r])-3/a[r-1]*(t[r]-t[r-1]);for(h[0]=1,d[0]=0,p[0]=0,r=1;1<=c?r<c:r>c;1<=c?r+=1:r-=1)h[r]=2*(e[r+1]-e[r-1])-a[r-1]*d[r-1],d[r]=a[r]/h[r],p[r]=(u[r]-a[r-1]*p[r-1])/h[r];for(h[c]=1,p[c]=0,s[c]=0,r=g=c-1;g<=0?r<=0:r>=0;g<=0?r+=1:r-=1)s[r]=p[r]-d[r]*s[r+1],i[r]=(t[r+1]-t[r])/a[r]-a[r]*(s[r+1]+2*s[r])/3,n[r]=(s[r+1]-s[r])/(3*a[r]);this.x=e.slice(0,c+1),this.a=t.slice(0,c),this.b=i,this.c=s.slice(0,c),this.d=n}}interpolate(e){var t,i,s;for(i=s=this.x.length-1;(s<=0?i<=0:i>=0)&&!(this.x[i]<=e);s<=0?i+=1:i-=1);return t=e-this.x[i],this.a[i]+this.b[i]*t+this.c[i]*Math.pow(t,2)+this.d[i]*Math.pow(t,3)}}},60134:(e,t,i)=>{i.d(t,{Z:()=>r,z:()=>a});var s=i(43673),n=i(82468);class a{constructor(e){this.preset=e}static createCurveSet(e){const t=new Array,i=new Array,n=new Array,a=new Array;for(let r=0;r<e.preset[0].length;r+=2)t.push(new s.Z(e.preset[0][r],e.preset[0][r+1]));for(let r=0;r<e.preset[1].length;r+=2)i.push(new s.Z(e.preset[1][r],e.preset[1][r+1]));for(let r=0;r<e.preset[2].length;r+=2)n.push(new s.Z(e.preset[2][r],e.preset[2][r+1]));for(let r=0;r<e.preset[3].length;r+=2)a.push(new s.Z(e.preset[3][r],e.preset[3][r+1]));return new r(1,t,i,n,a)}}class r{constructor(e=255,t=[],i=[],s=[],n=[]){this.scale=e,this.rgb=t,this.red=i,this.green=s,this.blue=n,this.percent=1}static getInterpolation(e,t){let i=[],s=[],a=new Float32Array(256);for(var r=0;r<t.length;r++)i.push(t[r].x*e),s.push(t[r].y*e);let o=new n.Z(i,s);for(var h=0;h<Math.ceil(i[0]);h++)a[h]=s[0];for(h=Math.ceil(i[0]);h<Math.ceil(i[i.length-1]);h++)a[h]=o.interpolate(h);for(h=Math.ceil(i[i.length-1]);h<256;h++)a[h]=s[s.length-1];return a}static fillPaletteMap(e,t){let i=r.getInterpolation(e.scale,e.rgb),s=r.getInterpolation(e.scale,e.red),n=r.getInterpolation(e.scale,e.green),a=r.getInterpolation(e.scale,e.blue);for(let r=0;r<256;++r){let o=r-i[r];t.data[4*r]=r-Math.round((r-(s[r]-o))*e.percent),t.data[4*r+1]=r-Math.round((r-(n[r]-o))*e.percent),t.data[4*r+2]=r-Math.round((r-(a[r]-o))*e.percent)}}}},94084:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(e,t,i){this.color=e,this.blend=t,this.amount=i}}},22817:(e,t,i)=>{i.d(t,{Z:()=>f});var s=i(93947),n=i(96548),a=i(33655),r=i(99872),o=i(36817),h=i(63646),c=i(43673),l=i(74820),d=i(44170),u=i(11726),p=i(78685),g=i(51294),m=i(82282),v=i(99924);class f{constructor(e,t){this.addPointer=e=>{this.pointers.push(e),this.stage.raster.setPointerCapture(e)},this.removePointer=e=>{for(let t=0;t<this.pointers.length;t++)if(this.pointers[t]===e){this.pointers.splice(t,1);break}this.stage.raster.releasePointerCapture(e)},this.addListener=()=>{this.stage.raster.addEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.addEventListener("pointermove",this.pointerMove,!1),this.stage.raster.addEventListener("pointerup",this.pointerUp,!1),this.raster.addEventListener("dblclick",this.dblClick,!1),this.raster.addEventListener("contextmenu",this.contextMenu,!0),document.addEventListener("viewport-render",this.render,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1)},this.removeListener=()=>{this.ctx.clearRect(0,0,this.raster.width,this.raster.width),this.stage.raster.removeEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.removeEventListener("pointermove",this.pointerMove,!1),this.stage.raster.removeEventListener("pointerup",this.pointerUp,!1),this.raster.removeEventListener("dblclick",this.dblClick,!1),this.raster.removeEventListener("contextmenu",this.contextMenu,!0),document.removeEventListener("viewport-render",this.render,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)},this.pointerDown=e=>{if(e.stopPropagation(),!this.stage.coating.override&&1===e.button)return this.stage.coating.setPan(this.stage.coating.raster,!0),this.stage.coating.panDown(e),!1;this.stage.coating.override||e.button>0||(this.isShiftDown=e.shiftKey,this.addPointer(e.pointerId),1===this.pointers.length&&this.down(new c.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.shiftKey||e.ctrlKey,e.altKey,e.ctrlKey,e.pointerType))},this.pointerMove=e=>{e.stopPropagation(),this.isShiftDown=e.shiftKey,this.pointers.length<2&&this.move(new c.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType)},this.pointerUp=e=>{e.stopPropagation(),this.removePointer(e.pointerId),this.up(new c.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType)},this.supress=e=>{e&&!this.supressed?(this.raster.style.cursor="unset",this.supressed=!0,this.removeListener()):!e&&this.supressed&&(this.supressed=!1,this.addListener())},this.keyDown=e=>{if(!(document.getElementsByClassName("modal").length>0||"INPUT"===document.activeElement.nodeName||"TEXTAREA"===document.activeElement.nodeName||"SELECT"===document.activeElement.nodeName||"ArrowUp"!==e.key&&"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key)){let t=e.shiftKey?10:1,i="ArrowLeft"===e.key||"ArrowRight"===e.key?"ArrowLeft"===e.key?-t:t:0,s="ArrowUp"===e.key||"ArrowDown"===e.key?"ArrowUp"===e.key?-t:t:0;this.step(i,s)}},this.keyUp=e=>{},this.contextMenu=e=>{if(e.preventDefault(),e.stopPropagation(),"SIMPLE"===this.mode)return;const t=new c.Z(e.clientX-this.raster.offsetLeft,e.clientY-this.raster.offsetTop),i=this.stage.fresco.getSelectedStack();if(0===i.length)return;const s=new Array;if(1===i.length){const e=i[0];e.type===d.Z.TYPE_TEXT&&s.push(new v.Z((0,n.Z)("titleEditText"),(()=>this.dblClick())),new v.Z((0,n.Z)("titleRasterizeLayer"),(()=>this.stage.rasterize())),new v.Z),e.type!==d.Z.TYPE_SHAPE&&e.type!==d.Z.TYPE_ELEMENT||s.push(new v.Z((0,n.Z)("titleRasterizeLayer"),(()=>this.stage.rasterize())),new v.Z),e.type===d.Z.TYPE_FRAME&&s.push(new v.Z(e.canvas?(0,n.Z)("titleChangeImage"):(0,n.Z)("titleAddImage"),(()=>this.stage.browseFrameImage())),new v.Z(e.editMode?(0,n.Z)("titlePositionFrame"):(0,n.Z)("titlePositionContent"),e.canvas?this.dblClick:void 0),new v.Z((0,n.Z)("titleAutoFitContent"),e.canvas?()=>this.stage.fitFrameContent():void 0),new v.Z((0,n.Z)("titleRasterizeLayer"),e.canvas?()=>this.stage.rasterize():void 0),new v.Z((0,n.Z)("titleRemoveFrameImage"),e.canvas?()=>this.stage.deleteLayer(!0):void 0),new v.Z),s.push(new v.Z((0,n.Z)("titleHideLayer"),(()=>this.stage.changeVisible(e,!1))),new v.Z((0,n.Z)("titleLockLayer"),(()=>this.stage.changeLocked(e,!0)))),e.hasLink()&&s.push(new v.Z((0,n.Z)("titleUnlinkLayer"),(()=>this.stage.linkLayer()))),s.push(new v.Z,new v.Z((0,n.Z)("titleCutLayer"),(()=>this.stage.cutLayer()),"Ctrl + X"),new v.Z((0,n.Z)("titleCopyLayer"),(()=>this.stage.copyLayer()),"Ctrl + C"),new v.Z((0,n.Z)("titlePasteLayer"),(()=>document.dispatchEvent(new CustomEvent("paste-menu"))),"Ctrl + V"),new v.Z((0,n.Z)("titleDuplicateLayer"),(()=>this.stage.duplicateLayer()),"Ctrl + D"),new v.Z((0,n.Z)("titleDeleteLayer"),(()=>this.stage.deleteLayer()),"DEL")),e instanceof m.Z&&e.hasMask()&&s.push(new v.Z,new v.Z((0,n.Z)("titleLayerApplyMask"),(()=>this.stage.maskApply())),new v.Z((0,n.Z)("titleLayerDeleteMask"),(()=>this.stage.maskDelete())))}else s.push(new v.Z(this.stage.fresco.isSelectedLinked()?(0,n.Z)("titleUnlinkLayers"):(0,n.Z)("titleLinkLayers"),(()=>this.stage.linkLayer())),new v.Z,new v.Z((0,n.Z)("titleCutLayers"),(()=>this.stage.cutLayer()),"Ctrl + X"),new v.Z((0,n.Z)("titleCopyLayers"),(()=>this.stage.copyLayer()),"Ctrl + C"),new v.Z((0,n.Z)("titlePasteLayers"),Array.isArray(this.stage.clipboard)?()=>this.stage.pasteLayer():void 0,"Ctrl + V"),new v.Z((0,n.Z)("titleDuplicateLayers"),(()=>this.stage.duplicateLayer()),"Ctrl + D"),new v.Z((0,n.Z)("titleDeleteLayers"),(()=>this.stage.deleteLayer()),"DEL"));const a=this.getLayersAt(t);if(a.length>1){const e=new Array;a.forEach((t=>{e.push(new v.Z(t.settings.name,(()=>this.stage.selectLayerById(t.id))))})),s.push(new v.Z,new v.Z((0,n.Z)("titleSelectLayer"),void 0,void 0,void 0,e))}new v.C(new c.Z(e.clientX,e.clientY),s)},this.setMode=e=>{this.mode=e,"ARRANGE"===this.mode||"SIMPLE"===this.mode?this.defaultCursor="unset":"TEXT"===this.mode?this.defaultCursor="text":this.defaultCursor="crosshair",this.render()},this.down=async(e,t,i,s,n)=>{if("INPUT"===document.activeElement.nodeName&&"radio"!==document.activeElement.getAttribute("type")||"SELECT"===document.activeElement.nodeName)return;"mouse"!==n&&this.move(e,n),this.isDown=!0,this.layerOver=void 0,this.downPoint=this.stage.translateRasterToFresco(e,void 0,!1);let a=this.stage.fresco.getSelectedLinkedStack();const r=a.length>1||1===a.length&&("TEXT"===this.mode&&a[0].type===d.Z.TYPE_TEXT||"FRAME"===this.mode&&a[0].type===d.Z.TYPE_FRAME||"SHAPE"===this.mode&&a[0].type===d.Z.TYPE_SHAPE);if(!this.isControl(a,e)&&l.ZP.autoSelect){let i=this.getLayerAt(e);!this.stage.fresco.isSelectedById(null==i?void 0:i.id)||s?(this.stage.selectLayer(i,t,s,!0),a=this.stage.fresco.getSelectedLinkedStack(),this.method="move"):window.requestAnimationFrame(this.render)}if(a.length>0){i&&(await this.stage.duplicateLayer(!1),a=this.stage.fresco.getSelectedLinkedStack());let e=1===a.length;if(!e||this.shouldReformLayer(a[0])){let t,i;if(e&&a[0].editMode&&a[0]instanceof g.Z?(this.anchorAlt=this.getAnchor(a[0].trim,a[0].trim.center(),0),this.downRect=[a[0].trim.clone()]):this.downRect=this.stage.fresco.getStackRect(a),e)i=a[0].rect.center(),t=a[0].editMode?a[0].trim:a[0].rect,t.rotation=a[0].rect.rotation;else{for(let e of a)e.rect&&(t=o.Z.merge(t,e.rect.getRotatedBounds()));i=t?t.center():void 0}if("rotate"===this.method)this.raster.style.cursor="grabbing",this.downRotation=180/Math.PI*Math.atan2(this.downPoint.y-i.y,this.downPoint.x-i.x)-t.rotation;else if("move"!==this.method){let e,s;switch(this.method){case"nw-resize":s=t.topLeft(),e=t.bottomRight();break;case"n-resize":s=new c.Z(i.x,t.y),e=new c.Z(i.x,t.bottom());break;case"ne-resize":s=t.topRight(),e=t.bottomLeft();break;case"e-resize":s=new c.Z(t.right(),i.y),e=new c.Z(t.x,i.y);break;case"se-resize":s=t.bottomRight(),e=t.topLeft();break;case"s-resize":case"t-resize":s=new c.Z(i.x,t.bottom()),e=new c.Z(i.x,t.y);break;case"sw-resize":s=t.bottomLeft(),e=t.topRight();break;case"w-resize":s=new c.Z(t.x,i.y),e=new c.Z(t.right(),i.y)}this.downControl=this.rotatePoint(s,i,360-t.rotation),this.downAnchor=this.rotatePoint(e,i,360-t.rotation)}else this.downControl=t.topLeft()}}this.proxy&&(0===a.length||1===a.length&&!this.shouldReformLayer(a[0]))?this.proxy(e,r):(0===a.length||1===a.length&&a[0].settings.locked)&&(this.downPoint=e,this.method="select")},this.move=(e,t)=>{if(this.stage.fresco)if(this.isDown)this.stage.fresco.isSelectedLinkedStack()&&this.downRect.length>0?this.moveStack(e):this.stage.fresco.hasSelected()&&this.downRect.length>0?this.moveSingle(e):"select"===this.method&&(this.stage.coating.ctx.lineWidth=2,this.stage.coating.ctx.strokeStyle=a.xZ,this.stage.coating.ctx.clearRect(0,0,this.stage.coating.ctx.canvas.width,this.stage.coating.ctx.canvas.height),this.stage.coating.ctx.strokeRect(this.downPoint.x,this.downPoint.y,e.x-this.downPoint.x,e.y-this.downPoint.y));else{if("INPUT"===document.activeElement.nodeName||"TEXTAREA"===document.activeElement.nodeName||"SELECT"===document.activeElement.nodeName)return void(this.raster.style.cursor="unset");let t=this.stage.fresco.getSelectedLinkedStack();if(this.isControl(t,e))this.layerOver&&(this.layerOver=void 0,window.requestAnimationFrame(this.render));else if(l.ZP.autoSelect){let t=this.getLayerAt(e);if(this.layerOver&&this.layerOver===t)return;this.raster.style.cursor=this.method=t?"move":"ARRANGE"===this.mode||"SIMPLE"===this.mode?"unset":this.defaultCursor,t&&!this.stage.fresco.isSelectedLinkedById(t.id)?(this.layerOver=t,window.requestAnimationFrame(this.render)):this.layerOver&&(this.layerOver=void 0,window.requestAnimationFrame(this.render))}else 1!==t.length||t[0].settings.locked?this.raster.style.cursor=this.method=this.defaultCursor:this.raster.style.cursor=this.method="move"}},this.moveSingle=e=>{const t=this.stage.translateRasterToFresco(e,void 0,!1),i=this.stage.fresco.getSelected();if(this.shouldReformLayer(i)){if("move"===this.method){if(i instanceof g.Z)if(i.editMode&&i.trim){const e=this.rotatePoint(t,i.rect.center(),i.rect.rotation),s=this.rotatePoint(this.downPoint,i.rect.center(),i.rect.rotation);i.position(Math.round(this.downControl.x+(e.x-s.x)),Math.round(this.downControl.y+(e.y-s.y)))}else i.position(Math.round(this.downControl.x+(t.x-this.downPoint.x)),Math.round(this.downControl.y+(t.y-this.downPoint.y)));else{if(this.isShiftDown){const e=Math.abs(this.downPoint.x-t.x),i=Math.abs(this.downPoint.y-t.y);(e>4||i>4)&&(e<i?(t.x=this.downPoint.x,this.method="vertical"):(t.y=this.downPoint.y,this.method="horizontal"))}i.position(Math.round(this.downControl.x+(t.x-this.downPoint.x)),Math.round(this.downControl.y+(t.y-this.downPoint.y)))}this.checkMoveGuides()}else if("vertical"===this.method)this.isShiftDown||(this.method="move"),i.position(void 0,Math.round(this.downControl.y+(t.y-this.downPoint.y))),this.checkMoveGuides();else if("horizontal"===this.method)this.isShiftDown||(this.method="move"),i.position(Math.round(this.downControl.x+(t.x-this.downPoint.x)),void 0),this.checkMoveGuides();else if("rotate"===this.method){const e=i.rect.center();let s=180/Math.PI*Math.atan2(t.y-e.y,t.x-e.x)-this.downRotation;this.isShiftDown&&(s=11.25*Math.round(s/11.25)),s<0?s+=360:s>=360&&(s-=360),i.rect.rotation=s}else{let e=t.neg(this.downPoint),s=this.downAnchor,n=this.downControl.add(e);if(n=this.checkReformGuides(n),0!==i.rect.rotation){const e=new c.Z((s.x+n.x)/2,(s.y+n.y)/2);n=this.rotatePoint(n,e,i.rect.rotation),s=this.rotatePoint(s,e,i.rect.rotation)}let a=(void 0!==this.constrain?this.constrain:!this.isShiftDown)?this.downRect[0].getAspect():0;switch(this.method){case"nw-resize":case"w-resize":i.calculate(n,s,a);break;case"ne-resize":i.calculate(new c.Z(s.x,n.y),new c.Z(n.x,s.y),a);break;case"sw-resize":i.calculate(new c.Z(n.x,s.y),new c.Z(s.x,n.y),a);break;case"se-resize":case"e-resize":i.calculate(s,n,a);break;case"t-resize":let e=n.y-s.y;i.rect.height=Math.round(e),i.rect.width=Math.round(this.downRect[0].width*(e/this.downRect[0].height))}if(i.editMode&&i instanceof g.Z){let e=this.anchorAlt.neg(this.getAnchor(i.trim,i.trim.center(),0));i.trim.x=Math.round(i.trim.x+e.x),i.trim.y=Math.round(i.trim.y+e.y)}else{let e=this.downAnchor.neg(this.getAnchor(i.rect,i.rect.center(),i.rect.rotation));i.rect.x=Math.round(i.rect.x+e.x),i.rect.y=Math.round(i.rect.y+e.y)}"t-resize"===this.method&&i instanceof p.Z?i.scaleBect(i.rect.height/this.downRect[0].height):!i.editMode&&i instanceof g.Z?i.scaleTrim(i.rect.width/this.downRect[0].width,i.rect.height/this.downRect[0].height):i.render()}window.requestAnimationFrame((()=>{this.stage.render(),this.render()})),document.dispatchEvent(new CustomEvent("layer-arrange"))}},this.moveStack=e=>{const t=this.stage.translateRasterToFresco(e,void 0,!1),i=this.stage.fresco.getSelectedLinkedStack();if("move"===this.method){if(this.isShiftDown){const e=Math.abs(this.downPoint.x-t.x),i=Math.abs(this.downPoint.y-t.y);(e>4||i>4)&&(e<i?(t.x=this.downPoint.x,this.method="vertical"):(t.y=this.downPoint.y,this.method="horizontal"))}for(let e=0;e<i.length;e++)this.downRect[e]&&i[e].position(Math.round(this.downRect[e].x+(t.x-this.downPoint.x)),Math.round(this.downRect[e].y+(t.y-this.downPoint.y)));this.checkMoveGuides()}else if("vertical"===this.method){this.isShiftDown||(this.method="move");for(let e=0;e<i.length;e++)this.downRect[e]&&i[e].position(void 0,Math.round(this.downRect[e].y+(t.y-this.downPoint.y)));this.checkMoveGuides()}else if("horizontal"===this.method){this.isShiftDown||(this.method="move");for(let e=0;e<i.length;e++)this.downRect[e]&&i[e].position(Math.round(this.downRect[e].x+(t.x-this.downPoint.x)),void 0);this.checkMoveGuides()}else{let e=t.neg(this.downPoint),s=this.downControl.add(e);s=this.checkReformGuides(s);let n=o.Z.calculate(this.downAnchor,this.downControl),a=o.Z.calculate(this.downAnchor,s,n.getAspect());a.width<4&&(a.width=4);let r=a.getComparedScale(n),h=this.downAnchor.neg(this.getAnchor(a,a.center(),0));a.x+=h.x,a.y+=h.y;for(let t=0;t<i.length;t++){let e=this.downRect[t];if(e){let s=i[t];s.rect.x=Math.round(a.x+(e.x-n.x)*r.width),s.rect.y=Math.round(a.y+(e.y-n.y)*r.height),s.rect.width=Math.round(e.width*r.width),s.rect.height=Math.round(e.height*r.height),s.rect.width<1&&(s.rect.width=1),s.rect.height<1&&(s.rect.height=1),s instanceof p.Z?s.scaleBect(r.width):s instanceof g.Z?s.scaleTrim(r.width,r.height):s.render()}}}window.requestAnimationFrame((()=>{this.stage.render(),this.render()})),document.dispatchEvent(new CustomEvent("layer-arrange"))},this.getAnchor=(e,t,i)=>{let s;switch(this.method){case"nw-resize":s=e.bottomRight();break;case"n-resize":s=new c.Z(t.x,e.bottom());break;case"ne-resize":s=e.bottomLeft();break;case"e-resize":s=new c.Z(e.x,t.y);break;case"se-resize":default:s=e.topLeft();break;case"s-resize":case"t-resize":s=new c.Z(t.x,e.y);break;case"sw-resize":s=e.topRight();break;case"w-resize":s=new c.Z(e.right(),t.y)}return this.rotatePoint(s,t,360-i)},this.rotatePoint=(e,t,i)=>0!==i&&360!==i&&t?(this.matrix.reset(),this.matrix.translate(t),this.matrix.rotateDegree(i),this.matrix.invert(),this.matrix.transformPoint(e).add(t)):e,this.up=(e,t)=>{if(this.isDown)if(this.downRect.length>0)this.downPoint.equalTo(this.stage.translateRasterToFresco(e,void 0,!1))||this.commitHistory();else if("select"===this.method){const t=this.stage.translateToRect(this.downPoint,e,!1,!0),i=this.getLayersInside(t);i.length>0&&this.stage.selectLayerStack(i,this.isShiftDown,!0)}"rotate"===this.method&&(this.raster.style.cursor="grab"),this.isDown=!1,this.layerOver=void 0,this.downPoint=void 0,this.downControl=void 0,this.downAnchor=void 0,this.downRect=[],this.guides=[],window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))},this.commitHistory=(e=this.method)=>{const t=this.stage.fresco.getSelectedStack();if(this.historyRect){let e;1===t.length?e=t[0].editMode&&t[0]instanceof g.Z?t[0].trim:t[0].rect:t.forEach((t=>{t.rect&&(e=o.Z.merge(e,t.rect.getRotatedBounds()))}));const i=e.equalTo(this.historyRect);if(this.historyRect=void 0,i)return}for(let i=0;i<t.length;i++){let s=t[i];if(s instanceof p.Z&&this.downRect[i]){let e=s.rect.height/this.downRect[i].height;this.downRect[i].height=s.textSettings.size,"w-resize"!==this.method&&"e-resize"!==this.method&&1!==e&&s.setHeightScale(e)}else"move"!==e&&s instanceof g.Z&&!s.editMode&&s.trimOnResize(this.downRect[i])}t.length>0&&(1===t.length?this.stage.history.add({type:"arrange",kind:"rotate"===e?"rotate":"move"===e||"vertical"===e||"horizontal"===e?"move":"resize",layer:t[0],action:{type:t[0].editMode?"trim":"rect",rect:this.downRect[0]}}):this.stage.history.add({type:"arrangeStack",id:this.stage.fresco.getStackHashId(),kind:"rotate"===e?"rotate":"move"===e||"vertical"===e||"horizontal"===e?"move":"resize",stack:Array.from(t),rects:this.downRect})),"move"!==e&&this.stage.fresco.getSelectedStack().forEach((e=>{e.render()})),document.dispatchEvent(new CustomEvent("layer-arrange"))},this.beginHistory=()=>{let e=this.stage.fresco.getSelectedLinkedStack();if(1===e.length)this.downRect=[e[0].editMode&&e[0]instanceof g.Z?e[0].trim.clone():e[0].rect.clone()],this.historyRect=this.downRect[0];else{this.downRect=this.stage.fresco.getStackRect(e);for(let t of e)t.rect&&(this.historyRect=o.Z.merge(this.historyRect,t.rect.getRotatedBounds()))}},this.inputRotation=e=>{const t=this.stage.fresco.getSelected();t&&t.rect&&(t.rect.rotation=e,window.requestAnimationFrame((()=>{this.stage.render(),this.render()})))},this.inputSize=(e,t)=>{let i=new r.Z;if(!this.historyRect)return i;e&&(e=Math.min(e,9999)),t&&(t=Math.min(t,9999));let s=this.stage.fresco.getSelectedLinkedStack();if(1===s.length){let n=s[0];e&&n.setWidth(e,this.constrain?this.historyRect.getAspect():0),t&&n.setHeight(t,this.constrain?this.historyRect.getAspect():0),i=n.editMode?n.trim.size():n.rect.size();let a=new r.Z(n.rect.width/this.historyRect.width,n.rect.height/this.historyRect.height);t&&n instanceof p.Z?n.scaleBect(a.height):n instanceof g.Z&&!n.editMode?n.scaleTrim(a.width,a.height):n.render()}else{let n=this.historyRect,a=this.historyRect.clone();e&&(a.width=e,a.height=Math.round(a.width/n.getAspect())),t&&(a.height=t,a.width=Math.round(a.height*n.getAspect()));let r=a.getComparedScale(n);for(let e=0;e<s.length;e++){let t=this.downRect[e];if(t){let i=s[e];i.rect.x=Math.round(a.x+(t.x-n.x)*r.width),i.rect.y=Math.round(a.y+(t.y-n.y)*r.height),i.rect.width=Math.round(t.width*r.width),i.rect.height=Math.round(t.height*r.height),i.rect.width<1&&(i.rect.width=1),i.rect.height<1&&(i.rect.height=1),i instanceof p.Z?i.scaleBect(r.width):i instanceof g.Z?i.scaleTrim(r.width,r.height):i.render()}}i.width=a.width,i.height=a.height}return window.requestAnimationFrame((()=>{this.stage.render(),this.render()})),i},this.inputPosition=(e,t)=>{let i=this.stage.fresco.getSelectedLinkedStack();if(1===i.length)i[0].position(e,t);else{e-=this.historyRect.x,t-=this.historyRect.y;for(let s=0;s<i.length;s++){let n=this.downRect[s];i[s].position(n.x+e,n.y+t)}}window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))},this.step=(e,t)=>{const i=this.stage.fresco.getSelectedLinkedStack();if(0!==i.length&&!this.historyRect&&!this.isDown){if(1===i.length){const s=i[0].editMode?i[0].trim.clone():i[0].rect.clone();i[0].position(s.x+e,s.y+t),this.stage.history.add({type:"arrange",kind:"move",layer:i[0],action:{type:i[0].editMode?"trim":"rect",rect:s}})}else{let s=this.stage.fresco.getStackRect(i);for(let n of i)this.shouldReformLayer(n)&&n.position(n.rect.x+e,n.rect.y+t);this.stage.history.add({type:"arrangeStack",id:this.stage.fresco.getStackHashId(i),kind:"move",stack:Array.from(i),rects:s})}document.dispatchEvent(new CustomEvent("layer-arrange")),window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))}},this.render=()=>{if(!this.stage||!this.stage.fresco||this.stage.supressRender)return;let e,t;if(this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.ctx.lineWidth=1,this.layerOver){if(this.ctx.translate(.5,.5),this.ctx.strokeStyle=a.TA,e=this.stage.getLayerLocationRect(this.layerOver),0!==e.rotation){let t=e.center();this.ctx.translate(t.x,t.y),this.ctx.rotate(e.rotation*Math.PI/180),e.x-=t.x,e.y-=t.y}this.ctx.strokeRect(e.x-1,e.y-1,e.width+1,e.height+1),this.ctx.setTransform(1,0,0,1,0,0)}let i=this.stage.fresco.getSelectedLinkedStack();if(i.length>0){let e=1===i.length;if(e&&!this.shouldReformLayer(i[0]))return;let s,n,r=!0,h=a.xZ,c=a.wf;if(e?i[0].editMode&&i[0]instanceof g.Z?(s=this.stage.getLayerLocationTrim(i[0]),t=this.stage.getLayerLocationRect(i[0]),n=t.center(),h=a.kD,r=!1):(s=this.stage.getLayerLocationRect(i[0]),n=s.center()):(i.forEach((e=>{let t=this.stage.getLayerLocationRect(e);t&&(s=o.Z.merge(s,t.getRotatedBounds()))})),n=s.center(),r=!1),!s)return;this.ctx.translate(.5,.5);let l=10,u=5;s.width<20||s.height<20?(l=6,u=3):(s.width<40||s.height<40)&&(l=8,u=4),0!==s.rotation&&(this.ctx.translate(n.x,n.y),this.ctx.rotate(s.rotation*Math.PI/180),s.x-=n.x,s.y-=n.y,t&&(t.x-=n.x,t.y-=n.y),n.x=0,n.y=0),t&&(this.ctx.lineWidth=2,this.ctx.strokeStyle=a.XI,this.ctx.strokeRect(t.x-2,t.y-2,t.width+2,t.height+2),this.ctx.lineWidth=1),this.ctx.strokeStyle=h,this.ctx.fillStyle=c,this.ctx.strokeRect(s.x-1,s.y-1,s.width+1,s.height+1),this.isDown&&"unset"!==this.method||(0===s.rotation&&this.ctx.translate(-.5,-.5),r&&(this.ctx.fillStyle=h,this.ctx.fillRect(Math.round(s.x+s.width/2-1),s.y-10,2,10),this.ctx.beginPath(),this.ctx.arc(s.x+s.width/2,s.y-10-u,u+1,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.closePath(),this.ctx.fillStyle=c,this.ctx.beginPath(),this.ctx.arc(s.x+s.width/2,s.y-10-u,u,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.closePath()),this.ctx.fillStyle=h,e&&i[0].type===d.Z.TYPE_TEXT?(this.ctx.fillRect(s.x-4,s.y,5,s.height),this.ctx.fillRect(s.x+s.width-1,s.y,5,s.height),s.width>40&&this.ctx.fillRect(n.x-20,s.y+s.height-1,40,4),this.ctx.fillStyle=c,this.ctx.fillRect(s.x-2,s.y+1,1,s.height-2),this.ctx.fillRect(s.x+s.width+1,s.y+1,1,s.height-2),s.width>40&&this.ctx.fillRect(n.x-19,s.y+s.height+1,38,1)):(s.height>10&&(this.ctx.fillRect(s.x-u,s.y+s.height-u,l,l),this.ctx.fillRect(s.x+s.width-u,s.y-u,l,l)),this.ctx.fillRect(s.x-u,s.y-u,l,l),this.ctx.fillRect(s.x+s.width-u,s.y+s.height-u,l,l),this.ctx.fillStyle=c,s.height>10&&(this.ctx.fillRect(s.x-u+1,s.y+s.height-u+1,l-2,l-2),this.ctx.fillRect(s.x+s.width-u+1,s.y-u+1,l-2,l-2)),this.ctx.fillRect(s.x-u+1,s.y-u+1,l-2,l-2),this.ctx.fillRect(s.x+s.width-u+1,s.y+s.height-u+1,l-2,l-2))),this.ctx.setTransform(1,0,0,1,0,0)}this.guides&&this.guides.length>0&&(this.ctx.translate(.5,.5),this.guides.forEach((e=>{e.soft?this.ctx.strokeStyle=a.$n:this.ctx.strokeStyle=a.CE,this.ctx.beginPath(),this.ctx.moveTo(e.start.x,e.start.y),this.ctx.lineTo(e.end.x,e.end.y),this.ctx.stroke()})),this.ctx.setTransform(1,0,0,1,0,0))},this.isControl=(e,t)=>{if(0===e.length)return!1;let i,s,n=1===e.length,r=this.hitSize/2,h=this.hitSize;if(n&&e[0].editMode&&e[0]instanceof g.Z?(i=this.stage.getLayerLocationTrim(e[0]),s=this.stage.getLayerLocationRect(e[0]).center()):(n?i=this.stage.getLayerLocationRect(e[0]):e.forEach((e=>{let t=this.stage.getLayerLocationRect(e);t&&(i=o.Z.merge(i,t.getRotatedBounds()))})),s=i?i.center():void 0),i){if((i.width<40||i.height<40)&&(r/=2,h/=2),t=this.rotatePoint(t,s,i.rotation),n&&e[0].type===d.Z.TYPE_TEXT){if(a.aG(i.x-this.hitSize,i.y,2*this.hitSize,i.height,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(90,i.rotation),this.method="w-resize",!0;if(a.aG(i.x+i.width-this.hitSize,i.y,2*this.hitSize,i.height,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(270,i.rotation),this.method="e-resize",!0;if(i.width>40&&a.aG(s.x-20,i.y+i.height-3,40,10,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(0,i.rotation),this.method="t-resize",!0}else{if(i.height>10){if(a.aG(i.x+i.width-r,i.y-r,h,h,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(45,i.rotation),this.method="ne-resize",!0;if(a.aG(i.x-r,i.y+i.height-r,h,h,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(225,i.rotation),this.method="sw-resize",!0}if(a.aG(i.x-r,i.y-r,h,h,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(315,i.rotation),this.method="nw-resize",!0;if(a.aG(i.x+i.width-r,i.y+i.height-r,h,h,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(135,i.rotation),this.method="se-resize",!0}return!(!n||e[0].editMode||!a.aG(i.x+i.width/2-r,i.y-(h+8),h,h,t.x,t.y))&&(this.raster.style.cursor="grab",this.method="rotate",!0)}},this.getRotatedCursor=(e,t)=>{let i=e+t;i<0&&(i+=360),i>360&&(i-=360),i+=22.5;let s=7;for(;s>0&&!(i>45*s&&i<360);)s--;return["n","ne","e","se","s","sw","w","nw"][s]+"-resize"},this.checkReformGuides=e=>{var t,i;if(this.guides=[],l.ZP.showGuides||l.ZP.snapToGuides){const s=this.stage.fresco.getSelectedLinkedStack(),n=5/this.stage.zoom,a=l.ZP.snapToGuides,r=l.ZP.showGuides;let h=1===s.length&&s[0].editMode&&s[0].trim;const d=h?s[0].rect:new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),u=h?360-s[0].rect.rotation:0,p=d.center(),g=h?this.rotatePoint(e,p,1===s.length?s[0].rect.rotation:0):e;if(!h){const i=this.stage.fresco.getNotSelectedStack(s);for(let s=0;s<i.length;s++){const o=i[s].rect;if(o&&0===o.rotation&&i[s].settings.visible){if(this.willSnap(g.x,o.x,n)&&(a&&(e.x=o.x),r)){const e="ne-resize"===this.method||"se-resize"===this.method||"e-resize"===this.method;this.addGuide(new c.Z(o.x,o.y),new c.Z(o.x,o.bottom()),void 0,0,!0,new c.Z(e?0:-1,-1),new c.Z(e?0:-1,0))}if(this.willSnap(g.x,o.right(),n)&&(a&&(e.x=o.right()),r)){const e="nw-resize"===this.method||"sw-resize"===this.method||"w-resize"===this.method;this.addGuide(new c.Z(o.right(),o.y),new c.Z(o.right(),o.bottom()),void 0,0,!0,new c.Z(e?-1:0,-1),new c.Z(e?-1:0,0))}if(null!==(t=!this.constrain)&&void 0!==t?t:this.isShiftDown){if(this.willSnap(g.y,o.y,n)&&(a&&(e.y=o.y),r)){const e="sw-resize"===this.method||"se-resize"===this.method;this.addGuide(new c.Z(o.x,o.y),new c.Z(o.right(),o.y),void 0,0,!0,new c.Z(-1,e?0:-1),new c.Z(0,e?0:-1))}if(this.willSnap(g.y,o.bottom(),n)&&(a&&(e.y=o.bottom()),r)){const e="ne-resize"===this.method||"nw-resize"===this.method;this.addGuide(new c.Z(o.x,o.bottom()),new c.Z(o.right(),o.bottom()),void 0,0,!0,new c.Z(-1,e?-1:0),new c.Z(0,e?-1:0))}}}}}this.willSnap(g.x,d.x,n)&&(a&&(e.x=h?this.rotatePoint(new c.Z(d.x,g.y),p,u).x:d.x),r&&this.addGuide(new c.Z(d.x,d.y),new c.Z(d.x,d.bottom()),p,u,!1,new c.Z(-1,-1),new c.Z(-1,0))),this.willSnap(g.x,d.right(),n)&&(a&&(e.x=h?this.rotatePoint(new c.Z(d.right(),g.y),p,u).x:d.right()),r&&this.addGuide(new c.Z(d.right(),d.y),new c.Z(d.right(),d.bottom()),p,u,!1,new c.Z(0,-1))),(null!==(i=!this.constrain)&&void 0!==i?i:this.isShiftDown)&&(this.willSnap(g.y,d.top(),n)&&(a&&(e.y=h?this.rotatePoint(new c.Z(g.x,d.top()),p,u).y:d.top()),r&&this.addGuide(new c.Z(d.x,d.y),new c.Z(d.right(),d.y),p,u,!1,new c.Z(-1,-1),new c.Z(0,-1))),this.willSnap(g.y,d.bottom(),n)&&(a&&(e.y=h?this.rotatePoint(new c.Z(g.x,d.bottom()),p,u).y:d.bottom()),r&&this.addGuide(new c.Z(d.x,d.bottom()),new c.Z(d.right(),d.bottom()),p,u,!1,new c.Z(-1))))}return e},this.checkMoveGuides=()=>{if(this.guides=[],l.ZP.showGuides||l.ZP.snapToGuides){const e=this.stage.fresco.getSelectedLinkedStack(),t=this.stage.fresco.getNotSelectedStack(e),i=5/this.stage.zoom,s=l.ZP.snapToGuides,n=l.ZP.showGuides;let a,r,h;if(1===e.length&&e[0].editMode?(a=e[0].getGlobalTrim(),r=e[0].rect,h=360-r.rotation):(r=new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),e.forEach((e=>{e.rect&&(a=o.Z.merge(a,e.rect.getRotatedBounds()))}))),!a)return;let d=new c.Z(0,0);const u=a.center(),p=20/this.stage.zoom;for(let o=0;o<t.length;o++){const e=t[o].rect;if(e&&0===e.rotation&&t[o].settings.visible){const t=e.center();if(this.willSnap(a.x,e.x,i)&&(d.x=a.x-e.x,n)){const i=(e.y<a.y?e.y:a.y)-p,s=(e.y+e.height>a.y+a.height?e.y+e.height:a.y+a.height)+p;this.addGuide(new c.Z(e.x,i),new c.Z(e.x,s),t,h,!0,new c.Z(-1),new c.Z(-1))}if(this.willSnap(a.x,e.x+e.width,i)&&(d.x=a.x-(e.x+e.width),n)){const i=(e.y<a.y?e.y:a.y)-p,s=(e.y+e.height>a.y+a.height?e.y+e.height:a.y+a.height)+p;this.addGuide(new c.Z(e.x+e.width,i),new c.Z(e.x+e.width,s),t,h,!0,new c.Z(-1),new c.Z(-1))}if(this.willSnap(a.x+a.width,e.x,i)&&(d.x=a.x+a.width-e.x,n)){const i=(e.y<a.y?e.y:a.y)-p,s=(e.y+e.height>a.y+a.height?e.y+e.height:a.y+a.height)+p;this.addGuide(new c.Z(e.x,i),new c.Z(e.x,s),t,h,!0)}if(this.willSnap(a.x+a.width,e.x+e.width,i)&&(d.x=a.x+a.width-(e.x+e.width),n)){const i=(e.y<a.y?e.y:a.y)-p,s=(e.y+e.height>a.y+a.height?e.y+e.height:a.y+a.height)+p;this.addGuide(new c.Z(e.x+e.width,i),new c.Z(e.x+e.width,s),t,h,!0)}if(this.willSnap(a.y,e.y,i)&&(d.y=a.y-e.y,n)){const i=(e.x<a.x?e.x:a.x)-p,s=(e.x+e.width>a.x+a.width?e.x+e.width:a.x+a.width)+p;this.addGuide(new c.Z(i,e.y),new c.Z(s,e.y),t,h,!0,new c.Z(0,-1),new c.Z(0,-1))}if(this.willSnap(a.y,e.y+e.height,i)&&(d.y=a.y-(e.y+e.height),n)){const i=(e.x<a.x?e.x:a.x)-p,s=(e.x+e.width>a.x+a.width?e.x+e.width:a.x+a.width)+p;this.addGuide(new c.Z(i,e.y+e.height),new c.Z(s,e.y+e.height),t,h,!0,new c.Z(0,-1),new c.Z(0,-1))}if(this.willSnap(a.y+a.height,e.y,i)&&(d.y=a.y+a.height-e.y,n)){const i=(e.x<a.x?e.x:a.x)-p,s=(e.x+e.width>a.x+a.width?e.x+e.width:a.x+a.width)+p;this.addGuide(new c.Z(i,e.y),new c.Z(s,e.y),t,h,!0)}if(this.willSnap(a.y+a.height,e.y+e.height,i)&&(d.y=a.y+a.height-(e.y+e.height),n)){const i=(e.x<a.x?e.x:a.x)-p,s=(e.x+e.width>a.x+a.width?e.x+e.width:a.x+a.width)+p;this.addGuide(new c.Z(i,e.y+e.height),new c.Z(s,e.y+e.height),t,h,!0)}if(this.willSnap(u.x,t.x,i)&&(d.x=a.x-Math.round(t.x-a.width/2),n)){const i=(e.y<a.y?e.y:a.y)-p,s=(e.y+e.height>a.y+a.height?e.y+e.height:a.y+a.height)+p;this.addGuide(new c.Z(Math.floor(t.x),i),new c.Z(Math.floor(t.x),s),t,h,!0)}if(this.willSnap(u.y,t.y,i)&&(d.y=a.y-Math.round(t.y-a.height/2),n)){const i=(e.x<a.x?e.x:a.x)-p,s=(e.x+e.width>a.x+a.width?e.x+e.width:a.x+a.width)+p;this.addGuide(new c.Z(i,Math.floor(t.y)),new c.Z(s,Math.floor(t.y)),t,h,!0)}}}const g=r.center();this.willSnap(u.x,g.x,i)&&(d.x=a.x-Math.round(g.x-a.width/2),n&&this.addGuide(new c.Z(Math.floor(g.x),r.y),new c.Z(Math.floor(g.x),r.bottom()),g,h)),this.willSnap(u.y,g.y,i)&&(d.y=a.y-Math.round(g.y-a.height/2),n&&this.addGuide(new c.Z(r.x,Math.floor(g.y)),new c.Z(r.right(),Math.floor(g.y)),g,h)),this.willSnap(a.x,r.x,i)&&(d.x=a.x-r.x,n&&this.addGuide(new c.Z(r.x,r.y),new c.Z(r.x,r.bottom()),g,h,!1,new c.Z(-1,-1),new c.Z(-1,0))),this.willSnap(a.right(),r.right(),i)&&(d.x=a.x-(r.right()-a.width),n&&this.addGuide(new c.Z(r.right(),r.y),new c.Z(r.right(),r.bottom()),g,h,!1,new c.Z(0,-1))),this.willSnap(a.y,r.y,i)&&(d.y=a.y-r.y,n&&this.addGuide(new c.Z(r.x,r.y),new c.Z(r.right(),r.y),g,h,!1,new c.Z(-1,-1),new c.Z(0,-1))),this.willSnap(a.bottom(),r.bottom(),i)&&(d.y=a.y-(r.bottom()-a.height),n&&this.addGuide(new c.Z(r.x,r.bottom()),new c.Z(r.right(),r.bottom()),g,h,!1,new c.Z(-1))),!s||0===d.x&&0===d.y||(1===e.length&&e[0].editMode?e[0].position(e[0].trim.x-d.x,e[0].trim.y-d.y):e.forEach((e=>{this.shouldReformLayer(e)&&e.position(e.rect.x-d.x,e.rect.y-d.y)})))}},this.addGuide=(e,t,i,s=0,n=!1,a,r)=>{0!==s&&(e=this.rotatePoint(e,i,s),t=this.rotatePoint(t,i,s)),e=this.stage.translateFrescoToRaster(e).add(a),t=this.stage.translateFrescoToRaster(t).add(r),this.guides.push(new h.Z(e,t,n))},this.willSnap=(e,t,i)=>e<t+i&&e>t-i,this.shouldReformLayer=e=>{if(e&&e.settings.visible&&!e.settings.locked&&e.rect){if("ARRANGE"!==this.mode&&"SIMPLE"!==this.mode){if("TEXT"===this.mode&&e.type!==d.Z.TYPE_TEXT)return;if("FRAME"===this.mode&&e.type!==d.Z.TYPE_FRAME)return;if("SHAPE"===this.mode&&e.type!==d.Z.TYPE_SHAPE)return}return!0}},this.getLayerAt=e=>{if(this.stage.fresco&&this.stage.fresco.layers.length>0)for(let t=this.stage.fresco.layers.length-1;t>=0;t--){if(!this.shouldReformLayer(this.stage.fresco.layers[t]))continue;let i,s;if(this.stage.fresco.layers[t].editMode&&this.stage.fresco.layers[t]instanceof g.Z?(i=this.stage.getLayerLocationTrim(this.stage.fresco.layers[t]),s=this.stage.getLayerLocationRect(this.stage.fresco.layers[t]).center()):(i=this.stage.getLayerLocationRect(this.stage.fresco.layers[t]),s=i?i.center():void 0),i&&i.isInside(this.rotatePoint(e,s,i.rotation)))return this.stage.fresco.layers[t]}},this.getLayersAt=e=>{const t=new Array;if(this.stage.fresco&&this.stage.fresco.layers.length>0)for(let i=this.stage.fresco.layers.length-1;i>=0;i--){if("TEXT"===this.mode&&this.stage.fresco.layers[i].type!==d.Z.TYPE_TEXT)continue;if("FRAME"===this.mode&&this.stage.fresco.layers[i].type!==d.Z.TYPE_FRAME)continue;if("SHAPE"===this.mode&&this.stage.fresco.layers[i].type!==d.Z.TYPE_SHAPE)continue;let s,n;if(this.stage.fresco.layers[i].editMode&&this.stage.fresco.layers[i]instanceof g.Z?(s=this.stage.getLayerLocationTrim(this.stage.fresco.layers[i]),n=this.stage.getLayerLocationRect(this.stage.fresco.layers[i]).center()):(s=this.stage.getLayerLocationRect(this.stage.fresco.layers[i]),n=s?s.center():void 0),s&&s.isInside(this.rotatePoint(e,n,s.rotation))&&t.push(this.stage.fresco.layers[i]),t.length>5)break}return t},this.getLayersInside=e=>{const t=new Array;if(this.stage.fresco&&this.stage.fresco.layers.length>0)for(let i=this.stage.fresco.layers.length-1;i>=0;i--){const s=this.stage.getLayerLocationRect(this.stage.fresco.layers[i]);s&&e.contains(s)&&t.push(this.stage.fresco.layers[i])}return t},this.dblClick=()=>{let e=this.stage.fresco.getSelected();if(e instanceof p.Z){if((0,s.ZP)("floating-text-input"))return;e.settings.visible=!1,this.removeListener(),this.stage.render(),this.render(),this.stage.supressRender=!0;let t=this.stage.getLayerLocationRect(e);t.y+t.height>this.raster.offsetHeight&&(t.y=this.raster.offsetHeight-t.height-20),t.y<20&&(t.y=20),t.width>this.raster.offsetWidth&&(t.width=this.raster.offsetWidth-40),t.x+t.width>this.raster.offsetWidth&&(t.x=this.raster.offsetWidth-t.width-20),t.x<20&&(t.x=20);let i=document.createElement("textarea");i.id="floating-text-input",i.style.top=t.y+this.raster.offsetTop+"px",i.style.left=t.x+this.raster.offsetLeft+"px",i.style.width=t.width+"px",i.style.color="#111";let n=e.textSettings;const r=a.uZ(Math.round(n.size*this.stage.zoom),12,100);i.style.font=n.getCssFont(r),i.style.letterSpacing=Math.floor(n.letterSpace*(r/2.2))+"px",i.style.textAlign=n.align,i.value=e.text;const o=()=>window.setTimeout((()=>{let e=i.cloneNode();e.style.visibility="false",i.parentNode.insertBefore(e,i),e.style.height="auto",e.value=i.value;let t=e.scrollTop+e.scrollHeight+16;i.offsetTop+t>(0,s.ZP)("workspace").offsetHeight-20&&(t=(0,s.ZP)("workspace").offsetHeight-20-i.offsetTop,i.style.overflowY="auto"),i.style.height=t+"px",i.parentNode.removeChild(e)}),0);i.addEventListener("input",(()=>{o()}),!0),(0,s.ZP)("workspace").appendChild(i),window.setTimeout((()=>{o(),i.focus(),i.select()}),10),document.addEventListener("mousedown",this.outsideTextClick,!0)}else e instanceof g.Z&&!e.settings.locked&&(e.canvas&&e.trim?(e.editMode=!e.editMode,window.requestAnimationFrame(this.render),document.dispatchEvent(new CustomEvent("layer-select"))):this.stage.browseFrameImage())},this.outsideTextClick=e=>{let t=(0,s.ZP)("floating-text-input");if(e.target!==t){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),this.stage.supressRender=!1;let i=this.stage.fresco.getSelected();if(i instanceof p.Z){i.settings.visible=!0;let e=i.text;i.setText(t.value),this.stage.history.add({type:"textChange",layer:i,text:e})}this.addListener(),document.removeEventListener("mousedown",this.outsideTextClick,!0),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("text-change")),t.remove()}},this.cleanUp=()=>{this.proxy=void 0,this.removeListener(),this.raster.style.cursor="unset",this.matrix=void 0,this.raster=void 0,this.stage=void 0,this.ctx=void 0},this.stage=e,this.ctx=e.coating.ctx,this.raster=e.coating.raster,this.pointers=new Array,this.matrix=new u.Z,this.hitSize=this.stage.canTouch?32:16,this.downRect=[],this.guides=[],this.addListener(),this.setMode(t)}}},22758:(e,t,i)=>{i.d(t,{Z:()=>h});var s=i(33655),n=i(36817),a=i(4256),r=i(43673),o=i(67175);class h{constructor(e,t){this.setMask=e=>{this.mask=e,this.ctx=this.mask.getContext("2d",{willReadFrequently:!0}),this.createOutline()},this.isSelected=e=>{var t;return!!(null===(t=this.bounds)||void 0===t?void 0:t.isInside(e))&&this.ctx.getImageData(e.x,e.y,1,1).data[3]>=64},this.applyOffset=()=>{let e=s.dN(this.mask);this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.ctx.drawImage(e,this.offset.x,this.offset.y),this.offset.x=this.offset.y=0,this.createOutline()},this.editRectangle=(e,t,i)=>{let n=s.vL(this.mask.width,this.mask.height),a=n.getContext("2d");o.Z.fill(a,"rectangle",e.topLeft(),e.bottomRight()),a=void 0,this.drawOnMask(n,t,!1,i)},this.editEllipse=(e,t,i,n)=>{let a=s.vL(this.mask.width,this.mask.height),r=a.getContext("2d");o.Z.fill(r,"ellipse",e.topLeft(),e.bottomRight()),r=void 0,this.drawOnMask(a,t,i,n)},this.editBezier=(e,t,i,n)=>{let a=s.vL(this.mask.width,this.mask.height),r=a.getContext("2d");r.beginPath(),r.moveTo(e[0].x,e[0].y);for(let s=1;s<e.length;s+=2)s+1===e.length?r.lineTo(e[s].x,e[s].y):r.quadraticCurveTo(e[s+1].x,e[s+1].y,e[s].x,e[s].y);r.fill(),r=void 0,this.drawOnMask(a,t,i,n)},this.editPolygon=(e,t,i,n)=>{let a=s.vL(this.mask.width,this.mask.height),r=a.getContext("2d");r.beginPath(),r.moveTo(e[0].x,e[0].y),e.forEach((e=>r.lineTo(e.x,e.y))),r.fill(),r=void 0,this.drawOnMask(a,t,i,n)},this.drawOnMask=(e,t=0,i=!1,s=!1,n=new r.Z(0,0))=>{if(t>0){let i=new a.Z;i.addShader("blur",t),e=i.apply(e)}else if(i){let t=new a.Z;t.addShader("dealiasing",!0),e=t.apply(e)}this.ctx.save(),s&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.drawImage(e,n.x,n.y),this.ctx.restore(),this.createOutline()},this.selectAll=()=>{this.ctx.fillRect(0,0,this.mask.width,this.mask.height),this.createOutline()},this.invert=()=>{const e=new a.Z([]);e.addShader("alpha-invert",1),this.mask=s.dN(e.apply(this.mask)),this.ctx=this.mask.getContext("2d",{willReadFrequently:!0}),this.createOutline()},this.size=(e,t)=>{const i=s.vL(e,t);this.ctx=i.getContext("2d",{willReadFrequently:!0});const n=Math.round(.5*(i.width-this.mask.width)),a=Math.round(.5*(i.height-this.mask.height));this.ctx.drawImage(this.mask,n,a),this.mask=i,this.createOutline()},this.resize=(e,t)=>{this.mask=s.eY(this.mask,e,t),this.ctx=this.mask.getContext("2d",{willReadFrequently:!0}),this.createOutline()},this.createOutline=()=>{let e=this.ctx.getImageData(0,0,this.mask.width,this.mask.height);if(this.bounds=s.vO(e),!this.bounds)return;let t=this.bounds.top(),i=this.bounds.left(),n=this.bounds.right(),a=this.bounds.bottom(),r=this.mask.width,o=this.mask.height;this.outline=new Array;let h,c,l,d,u,p=-1;for(let s=t;s<a;++s){c=0===i||e.data[4*(s*r+i-1)+3]<64,l=e.data[4*(s*r+i)+3]<64;for(let t=i;t<n;++t)h=c,c=l,l=t+1===r||e.data[4*(s*r+t+1)+3]<64,c||(p=-1,d=s-1<0||e.data[4*((s-1)*r+t)+3]<64,u=s+1===o||e.data[4*((s+1)*r+t)+3]<64,h&&d&&l&&u?p=8:h&&d&&u?p=9:l&&d&&u?p=10:l&&d&&h?p=11:l&&u&&h?p=12:h&&l?p=13:u&&d?p=14:h&&d?p=0:d&&l?p=2:h&&u?p=5:u&&l?p=7:d?p=1:h?p=3:l?p=4:u&&(p=6),-1!==p&&this.outline.push(t,s,p))}},this.clear=()=>{this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.outline=new Array},this.reset=()=>{this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.outline=new Array,this.offset=new r.Z,this.bounds=new n.Z},this.cleanUp=()=>{this.outline=void 0,this.offset=void 0,this.bounds=void 0,this.mask=void 0,this.ctx=void 0},this.mask=s.vL(e,t),this.offset=new r.Z,this.bounds=new n.Z,this.ctx=this.mask.getContext("2d",{willReadFrequently:!0})}}},9389:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(e,t,i,s=1){this.highlight=e,this.midtone=t,this.shadow=i,this.amount=s}static fillPaletteMap(e,t){if(e.midtone){for(let i=0;i<128;i++){let s=i/127;t.data[4*i]=Math.round(e.midtone.r*s+e.shadow.r*(1-s)),t.data[4*i+1]=Math.round(e.midtone.g*s+e.shadow.g*(1-s)),t.data[4*i+2]=Math.round(e.midtone.b*s+e.shadow.b*(1-s))}for(let i=128;i<256;i++){let s=(i-127)/128;t.data[4*i]=Math.round(e.highlight.r*s+e.midtone.r*(1-s)),t.data[4*i+1]=Math.round(e.highlight.g*s+e.midtone.g*(1-s)),t.data[4*i+2]=Math.round(e.highlight.b*s+e.midtone.b*(1-s))}}else for(let i=0;i<256;++i){let s=i/255;t.data[4*i]=Math.round(e.highlight.r*s+e.shadow.r*(1-s)),t.data[4*i+1]=Math.round(e.highlight.g*s+e.shadow.g*(1-s)),t.data[4*i+2]=Math.round(e.highlight.b*s+e.shadow.b*(1-s))}}}},18203:(e,t,i)=>{i.d(t,{Z:()=>n});var s=i(43673);class n{constructor(e,t){this.addPointer=e=>{this.pointers.push(e),this.stage.raster.setPointerCapture(e)},this.removePointer=e=>{for(let t=0;t<this.pointers.length;t++)if(this.pointers[t]===e.pointerId){this.pointers.splice(t,1);break}this.stage.raster.releasePointerCapture(e.pointerId)},this.pointerDown=e=>{e.stopPropagation(),this.stage.coating.override||e.button>0||(this.isDown=!0,this.addPointer(e.pointerId),1===this.pointers.length&&this.down(new s.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType,e.pressure))},this.pointerMove=e=>{e.stopPropagation(),this.pointers.length<2&&this.move(new s.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType,e.pressure)},this.pointerUp=e=>{e.stopPropagation(),this.isDown=!1,this.up(new s.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y))},this.dblClick=e=>{e.stopPropagation(),this.dbl(new s.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y))},this.addDownListeners=()=>{this.stage.raster.addEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.addEventListener("pointerup",this.removePointer,!1)},this.removeDownListeners=()=>{this.stage.raster.removeEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.removeEventListener("pointerup",this.removePointer,!1)},this.addMoveListeners=()=>{this.stage.raster.addEventListener("pointermove",this.pointerMove,!1),this.stage.raster.addEventListener("pointerup",this.pointerUp,!1)},this.removeMoveListeners=()=>{this.stage.raster.removeEventListener("pointermove",this.pointerMove,!1),this.stage.raster.removeEventListener("pointerup",this.pointerUp,!1)},this.down=(e,t,i)=>{},this.move=(e,t,i)=>{},this.dbl=e=>{},this.up=e=>{},this.apply=()=>{},this.cancel=()=>{},this.cleanUp=()=>{},this.name=e,this.stage=t,this.pointers=new Array}}},98776:(e,t,i)=>{i.d(t,{Z:()=>a});var s=i(33655);class n{constructor(e,t,i){this.h=e,this.s=t,this.b=i}toColor(){let e,t,i,s,n,r,o,h;if(0==this.b)e=0,t=0,i=0;else if(0==this.s)e=t=i=this.b;else switch(s=this.h/60,n=s-Math.floor(s),r=this.b*(1-this.s),h=this.b*(1-this.s*n),o=this.b*(1-this.s*(1-n)),Math.floor(s)){case 0:case 6:e=this.b,t=o,i=r;break;case 1:e=h,t=this.b,i=r;break;case 2:e=r,t=this.b,i=o;break;case 3:e=r,t=h,i=this.b;break;case 4:e=o,t=r,i=this.b;break;case 5:e=this.b,t=r,i=h}return new a(Math.round(255*e),Math.round(255*t),Math.round(255*i))}toHEX(){const e=this.toColor(),t=e=>{const t=e.toString(16);return 1===t.length?"0"+t:t};return`#${t(e.r)}${t(e.g)}${t(e.b)}`}}class a{constructor(e=255,t=255,i=255,a=255){this.isEqual=e=>!!e&&(this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a),this.toHEX=()=>{const e=e=>{const t=e.toString(16);return 1===t.length?"0"+t:t};return`#${e(this.r)}${e(this.g)}${e(this.b)}`},this.toHEXA=()=>{const e=e=>{const t=e.toString(16);return 1===t.length?"0"+t:t};return`#${e(this.r)}${e(this.g)}${e(this.b)}${e(this.a)}`},this.toRGBA=(e=this.a)=>`rgba(${this.r},${this.g},${this.b},${e/255})`,this.toHSB=()=>{let e,t,i,s=Math.min(this.r,this.g,this.b),a=Math.max(this.r,this.g,this.b);i=a/255;let r=a-s;return r?(t=r/a,e=this.r==a?(this.g-this.b)/r*60:this.g==a?60*(2+(this.b-this.r)/r):60*(4+(this.r-this.g)/r),e>360?e-=360:e<0&&(e+=360)):e=t=0,new n(e,t,i)},this.r=s.uZ(e,0,255),this.g=s.uZ(t,0,255),this.b=s.uZ(i,0,255),this.a=s.uZ(a,0,255)}rotateHue(e){let t,i,s,n=Math.min(this.r,this.g,this.b),r=Math.max(this.r,this.g,this.b);t=r/255;var o=r-n;return o?(i=o/r,s=this.r==r?(this.g-this.b)/o*60:this.g==r?60*(2+(this.b-this.r)/o):60*(4+(this.r-this.g)/o)):s=i=0,s+=e,s>360?s-=360:s<0&&(s+=360),360===s&&(s=0),a.fromHSB(s,i,t)}static fromRGB(e){if(/^#[0-9A-F]{6}$/i.test(e))return a.fromHEX(e);let t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return!t||t.length<4?new a:new a(Number(t[1]),Number(t[2]),Number(t[3]))}static fromHEXA(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return!t||t.length<4?new a:new a(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16))}static fromHEX(e,t=255){let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return!i||i.length<3?new a:new a(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),t)}static fromHSB(e,t,i){let s,n,r,o,h,c,l,d;if(0==i)s=0,n=0,r=0;else if(0==t)s=n=r=i;else switch(o=e/60,h=o-Math.floor(o),c=i*(1-t),d=i*(1-t*h),l=i*(1-t*(1-h)),Math.floor(o)){case 0:case 6:s=i,n=l,r=c;break;case 1:s=d,n=i,r=c;break;case 2:s=c,n=i,r=l;break;case 3:s=c,n=d,r=i;break;case 4:s=l,n=c,r=i;break;case 5:s=i,n=c,r=d}return new a(Math.round(255*s),Math.round(255*n),Math.round(255*r))}clone(){return new a(this.r,this.g,this.b,this.a)}}},82542:(e,t,i)=>{i.d(t,{Z:()=>s});class s{static rotation(e){return new Promise(((t,i)=>{const s=new FileReader;s.onload=e=>{e.target||t(0);const i=e.target,s=new DataView(i.result);65496!==s.getUint16(0,!1)&&t(0);const n=s.byteLength;let a=2;for(;a<n;){s.getUint16(a+2,!1)<=8&&t(0);const e=s.getUint16(a,!1);if(a+=2,65505===e){1165519206!==s.getUint32(a+=2,!1)&&t(0);const e=18761===s.getUint16(a+=6,!1);a+=s.getUint32(a+4,e);const i=s.getUint16(a,e);a+=2;for(let n=0;n<i;n++)if(274===s.getUint16(a+12*n,e)){switch(s.getUint16(a+12*n+8,e)){case 8:t(-90);break;case 6:t(90);break;case 3:t(180);break;default:t(0)}return}}else{if(65280!=(65280&e))break;a+=s.getUint16(a,!1)}}t(0)},s.readAsArrayBuffer(e)}))}}},9591:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(98776),n=i(77359),a=i(9067);class r{constructor(e){this.value=e,this.getType=()=>this.value instanceof s.Z?"color":this.value instanceof n.ZP?"gradient":this.value instanceof a.Z?"pattern":void 0,this.getStringValue=()=>this.value instanceof s.Z?this.value.toHEX():this.value instanceof n.ZP||this.value instanceof a.Z?this.value.toJSON():void 0,this.getCssValue=()=>this.value instanceof s.Z?this.value.toHEX():this.value instanceof n.ZP||this.value instanceof a.Z?this.value.toCSS():void 0,this.addToCanvasFillStyle=(e,t=0,i=0)=>{this.value instanceof s.Z?e.fillStyle=this.value.toHEX():this.value instanceof n.ZP?e.fillStyle=this.value.createCanvasGradient(e,t,i):this.value instanceof a.Z&&(e.fillStyle=this.value.createCanvasPattern(e))},this.addToCanvasStrokeStyle=(e,t=0,i=0)=>{this.value instanceof s.Z?e.strokeStyle=this.value.toHEX():this.value instanceof n.ZP?e.strokeStyle=this.value.createCanvasGradient(e,t,i):this.value instanceof a.Z&&(e.strokeStyle=this.value.createCanvasPattern(e))}}}r.fromString=async(e,t)=>{let i;return"color"===e&&/^#[0-9A-F]{6}$/i.test(t)?i=new r(s.Z.fromHEX(t)):"gradient"===e?i=new r(n.ZP.fromJSON(t)):"pattern"===e&&(i=new r(await a.Z.fromJSON(t))),i};const o=r},77359:(e,t,i)=>{i.d(t,{Rt:()=>a,ZP:()=>o});var s=i(33655),n=i(98776);class a{constructor(e,t,i=135,s="linear"){this.colors=e,this.positions=t,this.direction=i,this.type=s,this.toCSS=()=>{let e="linear-gradient("+this.direction+"deg";for(let t=0;t<this.colors.length;++t)e+=", "+n.Z.fromHEXA(this.colors[t]).toRGBA()+" "+(100*this.positions[t]).toFixed(0)+"%";return e+=")",e}}}class r{constructor(e,t,i){this.id=e,this.color=t,this.position=i}}class o{constructor(){this.direction=0,this.type="linear",this.addStop=(e,t)=>{t=s.uZ(t,0,1);const i=new r(s.Zd(),e,t);return this.stops.push(i),this.sort(),i},this.removeStop=e=>{const t=this.stops.findIndex((t=>t.id===e));return-1!==t&&this.stops.splice(t,1),this.sort(),this.stops[0].id},this.getStop=e=>{let t;return this.stops.forEach((i=>{i.id===e&&(t=i)})),t},this.sort=()=>{this.stops.sort(((e,t)=>e.position-t.position))},this.toCSS=()=>{let e="linear-gradient(to right";for(let t=0;t<this.stops.length;++t)e+=", "+this.stops[t].color.toRGBA()+" "+(100*this.stops[t].position).toFixed(0)+"%";return e+=")",e},this.toJSON=()=>JSON.stringify(this.toIGradient()),this.toIGradient=()=>{let e=new Array;return this.stops.forEach((t=>{e.push({id:t.id,color:t.color.toHEXA(),position:t.position})})),{type:this.type,direction:this.direction,stops:e}},this.createCanvasGradient=(e,t=0,i=0)=>{let s;if("linear"===this.type){const n=(this.direction-90)*Math.PI/180,a=e.canvas.width,r=e.canvas.height;if(a<1||r<1)return;const o=Math.sqrt(a*a+r*r)/2,h=Math.asin(r/2/o);let c=(n%(2*Math.PI)+4*Math.PI)%(2*Math.PI);c>Math.PI&&(c-=Math.PI),c>Math.PI/2&&c<=Math.PI&&(c=Math.PI/2-(c-Math.PI/2));let l=Math.PI/2-h-Math.abs(c),d=Math.abs(h-Math.abs(c)),u=Math.max(Math.cos(d)*a,Math.cos(l)*r)/2,p=Math.cos(n)*u,g=Math.sin(n)*u;s=e.createLinearGradient(a/2+p+t,r/2+g+i,a/2-p+t,r/2-g+i)}else{let n=e.canvas.width/2,a=e.canvas.height/2,r=Math.max(e.canvas.width,e.canvas.height)/2;s=e.createRadialGradient(n+t,a+i,0,n+t,a+i,r)}return this.addStopToCanvasGradient(s),s},this.addStopToCanvasGradient=(e,t=!1)=>{for(let i=0;i<this.stops.length;++i)e.addColorStop(this.stops[i].position,this.stops[i].color.toRGBA(t?255-this.stops[i].color.a:this.stops[i].color.a))},this.stops=new Array}static fromJSON(e){let t=JSON.parse(e);return o.fromIGradient(t)}static fromIGradient(e){const t=new o;if(t.type=e.type&&"radial"===e.type?"radial":"linear",t.direction=e.direction,e.stops)for(let i=0;i<e.stops.length;++i){let s="string"==typeof e.stops[i].color?n.Z.fromHEXA(e.stops[i].color):new n.Z(e.stops[i].color.r,e.stops[i].color.g,e.stops[i].color.b,e.stops[i].color.a);t.addStop(s,e.stops[i].position)}return t}static fromPreset(e){const t=new o;for(let i=0;i<e.colors.length;++i)t.addStop(n.Z.fromHEXA(e.colors[i]),e.positions[i]);return t.direction=e.direction+180,t.type=e.type,t}static fromColors(e,t){const i=new o;return i.addStop(e,0),i.addStop(t,1),i}}},63646:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(e,t,i=!1){this.start=e,this.end=t,this.soft=i}}},11726:(e,t,i)=>{i.d(t,{Z:()=>n});var s=i(43673);class n{constructor(e=1,t=0,i=0,s=1,a=0,r=0){this.a=e,this.b=t,this.c=i,this.d=s,this.e=a,this.f=r,this.reset=()=>{this.a=this.d=1,this.b=this.c=this.e=this.f=0},this.translate=e=>{this.transform(1,0,0,1,e.x,e.y)},this.rotate=e=>{let t=Math.cos(e),i=Math.sin(e);this.transform(t,i,-i,t,0,0)},this.rotateDegree=function(e){this.rotate(.017453292519943295*e)},this.transform=(e,t,i,s,n,a)=>{const r=this.a,o=this.b,h=this.c,c=this.d,l=this.e,d=this.f;this.a=r*e+h*t,this.b=o*e+c*t,this.c=r*i+h*s,this.d=o*i+c*s,this.e=r*n+h*a+l,this.f=o*n+c*a+d},this.invert=()=>{let e=this.a,t=this.b,i=this.c,s=this.d,a=this.e,r=this.f,o=(new n,e*s-t*i);this.a=s/o,this.b=-t/o,this.c=-i/o,this.d=e/o,this.e=(i*r-s*a)/o,this.f=-(e*r-t*a)/o}}transformPoint(e){return new s.Z(e.x*this.a+e.y*this.c+this.e,e.x*this.b+e.y*this.d+this.f)}}},9067:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(33655),n=i(95574);class a{constructor(e,t=1,i=0){this.svg=e,this.scale=t,this.direction=i,this.createCanvasPattern=e=>{let t;if(1!=this.scale){let i=s.vL(Math.round(this.image.width*this.scale),Math.round(this.image.height*this.scale));i.getContext("2d").drawImage(this.image,0,0,i.width,i.height),t=e.createPattern(i,"repeat")}else t=e.createPattern(this.image,"repeat");return 0!==this.direction&&t.setTransform((new DOMMatrix).rotate(this.direction)),t},this.toCSS=()=>"url(data:image/svg+xml;base64,"+btoa(this.svg)+")",this.toJSON=()=>JSON.stringify(this.toIPattern())}toIPattern(e=this.svg){return{svg:e,scale:this.scale,direction:this.direction}}}a.fromIPattern=async e=>{let t=new a(e.svg,e.scale,e.direction),i=new Blob([t.svg],{type:"image/svg+xml"});return t.image=await(0,n.s4)(i),t},a.fromJSON=async e=>{let t=JSON.parse(e);return a.fromIPattern(t)};const r=a},43673:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(e=0,t=0){this.x=e,this.y=t}distanceTo(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}angleTo(e){let t=-(this.x-e.x),i=this.y-e.y,s=360-Math.atan2(i,t)*(180/Math.PI);return s<0&&(s+=360),s>360&&(s-=360),s}dot(e){return this.x*e.x+this.y*e.y}lengthSQ(){return this.dot(this)}length(){return Math.sqrt(this.lengthSQ())}hypot2(){return this.dot(this)}hypot(){return Math.hypot(this.x,this.y)}add(e){return e?e instanceof s?new s(this.x+e.x,this.y+e.y):new s(this.x+e,this.y+e):this}neg(e){return e instanceof s?new s(this.x-e.x,this.y-e.y):new s(this.x-e,this.y-e)}mul(e){return e instanceof s?new s(this.x*e.x,this.y*e.y):new s(this.x*e,this.y*e)}rotateAround(e,t){let i=Math.sin(t),n=Math.cos(t),a=this.x-e.x,r=this.y-e.y,o=a*i+r*n;return new s(a*n-r*i+e.x,o+e.y)}equalTo(e){return this.x===e.x&&this.y===e.y}clone(){return new s(this.x,this.y)}}},36817:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(11726),n=i(43673),a=i(99872);class r{constructor(e=0,t=0,i=0,s=0,n=0){this.x=e,this.y=t,this.width=i,this.height=s,this.rotation=n}left(){return this.x}right(){return this.x+this.width}top(){return this.y}bottom(){return this.y+this.height}size(){return new a.Z(this.width,this.height)}center(){return new n.Z(this.x+this.width/2,this.y+this.height/2)}topLeft(){return new n.Z(this.x,this.y)}topRight(){return new n.Z(this.right(),this.y)}bottomLeft(){return new n.Z(this.x,this.bottom())}bottomRight(){return new n.Z(this.right(),this.bottom())}setTop(e){this.height=this.y+this.height-e,this.y=e}setLeft(e){this.width=this.x+this.width-e,this.x=e}setRight(e){this.width=Math.round(e-this.x)}setBottom(e){this.height=Math.round(e-this.y)}setCenter(e){this.x=e.x-.5*this.width,this.y=e.y-.5*this.height}setCenterX(e){this.x=e-.5*this.width}setCenterY(e){this.y=e-.5*this.height}moveRight(e){this.x=Math.round(e-this.width)}moveBottom(e){this.y=Math.round(e-this.height)}isSet(){return this.x>0||this.y>0||this.width>0||this.height>0||this.rotation>0}isInside(e){return e.x>=this.x&&e.x<this.x+this.width&&e.y>=this.y&&e.y<this.y+this.height}contains(e){return e.x>=this.x&&e.y>=this.y&&e.bottom()<=this.bottom()&&e.right()<=this.right()}equalTo(e){return!!e&&(this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.rotation===e.rotation)}clone(){return new r(this.x,this.y,this.width,this.height,this.rotation)}scale(e){return new r(Math.round(this.x*e),Math.round(this.y*e),Math.round(this.width*e),Math.round(this.height*e),this.rotation)}flipWidthAndHeight(){return new r(this.y,this.x,this.height,this.width)}union(e){if(!e)return this;const t=Math.min(this.x,e.x),i=Math.min(this.y,e.y),s=Math.max(this.x+this.width,e.x+e.width),n=Math.max(this.y+this.height,e.y+e.height);return new r(t,i,s-t,n-i)}intersect(e){let t=Math.max(this.x,e.x),i=Math.min(this.x+this.width,e.x+e.width);if(i<=t)return;let s=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return n<=s?void 0:new r(t,s,i-t,n-s)}rebase(e,t){return new r(Math.round(this.x-e),Math.round(this.y-t),Math.round(this.width),Math.round(this.height))}gridAlign(){return new r(Math.floor(this.x),Math.floor(this.y),Math.ceil(this.width),Math.ceil(this.height))}getRotatedBounds(){if(0===this.rotation)return this;let e=new s.Z,t=this.center();e.translate(t),e.rotate(this.rotation*Math.PI/180),e.invert();const i=e.transformPoint(this.topLeft()),n=e.transformPoint(this.topRight()),a=e.transformPoint(this.bottomLeft()),o=e.transformPoint(this.bottomRight());let h=r.fromPoints([i,n,a,o]);return h.x=Math.round(h.x+t.x),h.y=Math.round(h.y+t.y),h.rotation=this.rotation,h}rotatedSize(e){const t=this.width,i=this.height,s=(e,t)=>{var i=e[0].x,s=e[0].y,a=e[1].x,r=e[1].y,o=t[0].x,h=t[0].y,c=t[1].x,l=t[1].y;return new n.Z(((i*r-s*a)*(o-c)-(i-a)*(o*l-h*c))/((i-a)*(h-l)-(s-r)*(o-c)),((i*r-s*a)*(h-l)-(s-r)*(o*l-h*c))/((i-a)*(h-l)-(s-r)*(o-c)))};let r,o,h,c,l,d,u;var p=e*(Math.PI/180),g=[new n.Z(0,0),new n.Z(t,0),new n.Z(t,i),new n.Z(0,i)];g=((e,t,i)=>{for(var s=new Array,a=0;a<e.length;++a)s.push(new n.Z(e[a].x+t,e[a].y+i));return s})(g,-t/2,-i/2);var m=((e,t)=>{for(var i=new Array,s=0;s<e.length;++s)i.push(new n.Z(e[s].x*Math.cos(t)-e[s].y*Math.sin(t),e[s].x*Math.sin(t)+e[s].y*Math.cos(t)));return i})(g,p);return e>=0?(r=[new n.Z(0,0),new n.Z(-t/2,-i/2)],h=[m[0],m[3]],d=s(r,h),o=[new n.Z(0,0),new n.Z(t/2,-i/2)],c=[m[0],m[1]],u=s(o,c)):(r=[new n.Z(0,0),new n.Z(t/2,-i/2)],h=[m[1],m[2]],u=s(r,h),o=[new n.Z(0,0),new n.Z(-t/2,-i/2)],c=[m[0],m[1]],d=s(o,c)),l=new n.Z(Math.max(d.x,-u.x),Math.max(d.y,u.y)),new a.Z(Math.round(-l.x-l.x),Math.round(-l.y-l.y))}pad(e){return new r(this.x-e,this.y-e,this.width+2*e,this.height+2*e)}getAspect(){return this.width/this.height}getComparedScale(e){if(e)return new a.Z(this.width/e.width,this.height/e.height)}static calculate(e,t,i=0){if(!e||!t)return;let s=new r;return s.x=Math.round(e.x<t.x?e.x:t.x),s.y=Math.round(e.y<t.y?e.y:t.y),s.width=Math.round(e.x<t.x?t.x-s.x:e.x-s.x),s.height=0!==i?Math.round(s.width/i):Math.round(e.y<t.y?t.y-s.y:e.y-s.y),s}static merge(e,t){if(!e&&!t)return;if(e&&!t)return e;if(!e&&t)return t;const i=Math.round(Math.min(e.x,t.x)),s=Math.round(Math.min(e.y,t.y)),n=Math.round(Math.max(e.x+e.width,t.x+t.width)),a=Math.round(Math.max(e.y+e.height,t.y+t.height));return new r(i,s,n-i,a-s)}static fillFit(e,t,i,s,n=!1){let a=1;return a=e/t<i/s?i/e:s/t,n&&a>1&&(a=1),new r(Math.round((i-e*a)/2),Math.round((s-t*a)/2),Math.round(e*a),Math.round(t*a))}static bestFit(e,t,i,s,n=!1){let a=1;return a=e/t>i/s?i/e:s/t,a>1&&!n&&(a=1),new r(Math.round((i-e*a)/2),Math.round((s-t*a)/2),Math.round(e*a),Math.round(t*a))}static fromPoints(e){let t=e[0].x,i=e[0].x,s=e[0].y,n=e[0].y;return e.forEach((e=>{t=Math.min(e.x,t),i=Math.max(e.x,i),s=Math.min(e.y,s),n=Math.max(e.y,n)})),new r(Math.round(t),Math.round(s),Math.round(i-t),Math.round(n-s))}static fromPointRects(e,t,i){let s=e[0].x,n=e[0].x+t,a=e[0].y,o=e[0].y+i;return e.forEach((e=>{s=Math.min(e.x,s),n=Math.max(e.x+t,n),a=Math.min(e.y,a),o=Math.max(e.y+i,o)})),new r(s,a,n-s,o-a)}}},89679:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(e,t){this.name=e,this.value=t}}},67175:(e,t,i)=>{i.d(t,{Z:()=>a});var s=i(36817);class n{static roundRect(e,t,i,s,n,a=0){const r=Math.min(s/2,n/2,a);e.beginPath(),e.moveTo(t+r,i),e.lineTo(t+s-r,i),e.quadraticCurveTo(t+s,i,t+s,i+r),e.lineTo(t+s,i+n-r),e.quadraticCurveTo(t+s,i+n,t+s-r,i+n),e.lineTo(t+r,i+n),e.quadraticCurveTo(t,i+n,t,i+n-r),e.lineTo(t,i+r),e.quadraticCurveTo(t,i,t+r,i),e.closePath()}}n.ellipse=(e,t,i)=>{let s=.5*(i.x-t.x),n=.5*(i.y-t.y),a=t.x+s,r=t.y+n,o=.01,h=o,c=2*Math.PI-o;for(e.beginPath(),e.moveTo(a+s*Math.cos(0),r+n*Math.sin(0));h<c;h+=o)e.lineTo(a+s*Math.cos(h),r+n*Math.sin(h));e.closePath()},n.triangle=(e,t,i)=>{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.lineTo(t.x-(i.x-t.x),i.y),e.lineTo(t.x,t.y),e.closePath()},n.star=(e,t,i)=>{let s=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2));e.beginPath(),e.translate(t.x,t.y),e.moveTo(0,0-s);for(var n=0;n<5;n++)e.rotate(Math.PI/5),e.lineTo(0,0-.5*s),e.rotate(Math.PI/5),e.lineTo(0,0-s);e.translate(-t.x,-t.y)},n.heart=(e,t,i)=>{let s=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),n=.8*s;e.save(),e.translate(t.x,t.y-s/2),e.rotate(45*Math.PI/180),e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(-n,0,-n,s,0,s),e.lineTo(s,s),e.lineTo(s,0),e.bezierCurveTo(s,-n,0,-n,0,0),e.closePath(),e.restore()},n.rectangle=(e,t,i,s,n)=>{e.beginPath(),e.moveTo(t,i),e.lineTo(t+s,i),e.lineTo(t+s,i+n),e.lineTo(t,i+n),e.lineTo(t,i),e.closePath()},n.line=(e,t,i)=>{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y)},n.bezier=(e,t,i,s)=>{e.beginPath(),e.moveTo(t.x,t.y),e.quadraticCurveTo(s.x,s.y,i.x,i.y)},n.arc=(e,t,i)=>{e.beginPath(),e.arc(t.x,t.y,i,0,2*Math.PI)},n.fill=(e,t,i,a,r)=>{switch(t){case"rectangle":e.fillRect(i.x,i.y,a.x-i.x,a.y-i.y);break;case"rounded":const t=s.Z.fromPoints([i,a]);n.roundRect(e,t.x,t.y,t.width,t.height,r),e.fill();break;case"ellipse":n.ellipse(e,i,a),e.fill();break;case"triangle":n.triangle(e,i,a),e.fill();break;case"star":n.star(e,i,a),e.fill();break;case"heart":n.heart(e,i,a),e.fill();break;case"line":n.line(e,i,a),e.stroke()}},n.stroke=(e,t,i,a,r)=>{switch(t){case"rectangle":e.strokeRect(i.x,i.y,a.x-i.x,a.y-i.y);break;case"rounded":const t=s.Z.fromPoints([i,a]);n.roundRect(e,t.x,t.y,t.width,t.height,r),e.stroke();break;case"ellipse":n.ellipse(e,i,a),e.stroke();break;case"triangle":n.triangle(e,i,a),e.stroke();break;case"star":n.star(e,i,a),e.stroke();break;case"heart":n.heart(e,i,a),e.stroke();break;case"line":n.line(e,i,a),e.stroke()}};const a=n},99872:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(e=0,t=0){this.width=e,this.height=t}}},59064:(e,t,i)=>{i.d(t,{Z:()=>c});var s=i(33655),n=i(93947),a=i(43673),r=i(98776),o=i(11726),h=i(74820);class c{constructor(e){this.zoomor=!1,this.hypo=void 0,this.cursorPos=new a.Z(-999,-999),this.lastPos=new a.Z(-999,-999),this.ants=Array(!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1),this.hide=()=>{this.raster.style.display="none"},this.show=()=>{this.raster.style.display="block"},this.drawDropPreviewRect=(e,t)=>{this.ctx.save(),this.ctx.strokeStyle=s.TA,this.clear();const i=this.stage.rasterRect,n=this.stage.zoom,a=t.rect.width*n,r=t.rect.height*n;this.ctx.strokeRect(e.x-i.x-a/2,e.y-i.y-r/2,a,r),this.dirty=!0,this.ctx.restore()},this.setPan=(e=this.raster,t=!1)=>{this.override||(this.byMouse=t,this.override=!0,e.addEventListener("mousedown",this.panDown,!1),e.classList.add("grab"),this.stage.resetAnchor(),this.cursorImage&&(0,n.ZP)("cursor-image")&&this.cursorImage.remove())},this.removePan=(e=this.raster)=>{(0,n.ZP)("color-picker-quick")||(this.override=!1,e.classList.remove("grab"),e.removeEventListener("mousedown",this.panDown,!1),this.cursorImage&&((0,n.ZP)("workspace").appendChild(this.cursorImage),this.positionCursorImage()))},this.panDown=e=>{e.stopPropagation(),this.stage.resetAnchor(),this.downPoint=new a.Z(e.clientX,e.clientY),this.downAnchor=this.stage.anchor.clone(),document.addEventListener("mousemove",this.panMove,!0),document.addEventListener("mouseup",this.panUp,!0)},this.panMove=e=>{let t=~~((e.clientX-this.downPoint.x)/this.stage.zoom),i=~~((e.clientY-this.downPoint.y)/this.stage.zoom);this.stage.setAnchor(new a.Z(this.downAnchor.x-t,this.downAnchor.y-i)),this.stage.updateViewport()},this.panUp=e=>{document.removeEventListener("mousemove",this.panMove,!0),document.removeEventListener("mouseup",this.panUp,!0),this.byMouse&&this.removePan()},this.setPicker=(e=this.raster)=>{var t;if(this.override)return;this.override=!0,e.addEventListener("mousedown",this.pickerDown,!1),e.addEventListener("mousemove",this.pickerMove,!1),e.classList.add("crosshair");const i=this.lastPos.clone(),c=new o.Z;let l=null!==(t=(0,n.ZP)("color-picker-quick"))&&void 0!==t?t:(0,n.T)("div",{id:"color-picker-quick"});for(let s=0;s<h.ZP.oldColor.length;s++){c.reset(),c.rotateDegree(14*-s);let e=c.transformPoint(new a.Z(-100,0));e.x+=i.x+20,e.y+=i.y-46;let t=(0,n.T)("div",{className:"color-pod small floater"});t.style.backgroundColor=h.ZP.oldColor[s],t.style.left=e.x+"px",t.style.top=e.y+"px",t.addEventListener("mousemove",(e=>{this.lastPos.x=e.clientX,this.lastPos.y=e.clientY,this.pickerPreview(this.lastPos.clone()),this.preview.style.backgroundColor=e.currentTarget.style.backgroundColor})),t.addEventListener("click",(e=>{let t=r.Z.fromRGB(e.currentTarget.style.backgroundColor);this.preview.style.backgroundColor=t.toHEX(),document.dispatchEvent(new CustomEvent("set-color",{detail:t}))})),l.append(t)}(0,n.ZP)("workspace").appendChild(l),this.pickerCanvas=s.dN(document.getElementsByClassName("canvas")[0]),this.pickerCanvasCTX=this.pickerCanvas.getContext("2d",{willReadFrequently:!0}),this.preview=document.createElement("div"),this.preview.id="color-picker-preview",this.preview.style.display="none",(0,n.ZP)("workspace").appendChild(this.preview),this.cursorImage&&(0,n.ZP)("cursor-image")&&this.cursorImage.remove(),this.pickerPreview(i)},this.updateHistoryPods=()=>{var e=(0,n.ZP)("color-picker-quick").children;for(let t=0;t<e.length;t++)e[t].style.backgroundColor=h.ZP.oldColor[t]},this.pickerMove=e=>{this.lastPos.x=e.clientX,this.lastPos.y=e.clientY,this.pickerPreview(this.lastPos.clone())},this.pickerPreview=e=>{if(this.preview.style.top=e.y-50+"px",this.preview.style.left=e.x+10+"px",this.preview.style.display="block",e.x-=this.stage.canvas.offsetLeft,e.y-=this.stage.canvas.offsetTop,e.x<0||e.y<0||e.x>this.stage.canvas.width||e.y>this.stage.canvas.height)return void(this.preview.style.display="none");let t=this.pickerCanvasCTX.getImageData(e.x,e.y,1,1).data;this.preview.style.backgroundColor=new r.Z(t[0],t[1],t[2]).toHEX()},this.pickerDown=e=>{let t=new a.Z(e.clientX-this.stage.canvas.offsetLeft,e.clientY-this.stage.canvas.offsetTop);if(t.x<0||t.y<0||t.x>this.stage.canvas.width||t.y>this.stage.canvas.height)return;let i=this.pickerCanvasCTX.getImageData(t.x,t.y,1,1).data;const s=new r.Z(i[0],i[1],i[2]);this.updateColorHistory(s),this.updateHistoryPods(),document.dispatchEvent(new CustomEvent("set-color",{detail:s}))},this.updateColorHistory=e=>{let t=e.toHEX(),i=h.ZP.oldColor.findIndex((e=>e===t));i>-1?h.ZP.oldColor.splice(0,0,h.ZP.oldColor.splice(i,1)[0]):(h.ZP.oldColor.pop(),h.ZP.oldColor.unshift(t)),(0,h.Lt)("oldColor",h.ZP.oldColor)},this.removePicker=(e=this.raster)=>{var t;this.override&&(this.override=!1,e.classList.remove("crosshair"),e.removeEventListener("mousedown",this.pickerDown,!1),e.removeEventListener("mousemove",this.pickerMove,!1),this.preview.remove(),null===(t=(0,n.ZP)("color-picker-quick"))||void 0===t||t.remove(),this.cursorImage&&(this.stage.workspace.appendChild(this.cursorImage),this.positionCursorImage()),this.pickerCanvasCTX=void 0,this.pickerCanvas=void 0)},this.setCursorImage=e=>{this.cursorImage&&(0,n.ZP)("cursor-image")&&(this.cursorImage.remove(),this.cursorImage=void 0),this.raster.style.cursor=e?"none":"crosshair",e&&(this.cursorImage=e,this.cursorImage.id="cursor-image",this.stage.workspace.appendChild(this.cursorImage),this.positionCursorImage())},this.animateCursorTap=()=>{const e=(0,n.T)("div",{className:"clickEffect"});e.style.top=this.cursorPos.y+this.stage.rasterRect.y+"px",e.style.left=this.cursorPos.x+this.stage.rasterRect.x+"px",e.addEventListener("animationend",(()=>e.remove())),this.stage.workspace.appendChild(e)},this.positionCursorImage=()=>{this.cursorImage&&(this.cursorImage.style.left=this.cursorPos.x-~~(this.cursorImage.width/2)+this.raster.offsetLeft+"px",this.cursorImage.style.top=this.cursorPos.y-~~(this.cursorImage.height/2)+this.raster.offsetTop+"px")},this.removeCursorImage=()=>{this.raster.style.cursor="unset",this.cursorImage&&(this.cursorImage.remove(),this.cursorImage=void 0,this.cursorPos.x=this.cursorPos.y=-999)},this.throttle=0,this.mouseWheel=e=>{if("none"!==h.ZP.scrollMode&&(e.preventDefault(),e.stopPropagation(),this.throttle+20<Date.now())){if(this.throttle=Date.now(),this.stage.supressRender=!0,"zoom"===h.ZP.scrollMode&&!e.shiftKey||"move"===h.ZP.scrollMode&&e.shiftKey){const t=this.stage.getViewPortCenter(),i=new a.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),s=this.stage.translateRasterToFresco(i);this.stage.setFluidZoom(e.deltaY<0);const n=this.stage.translateRasterToFresco(i);this.stage.setAnchor(new a.Z(t.x+(s.x-n.x),t.y+(s.y-n.y)))}else{const t=this.stage.anchor.add(new a.Z(e.deltaX,e.deltaY));this.stage.setAnchor(t)}this.stage.supressRender=!1,this.stage.updateViewport()}},this.mouseMove=e=>{this.lastPos.x=e.clientX,this.lastPos.y=e.clientY,this.cursorPos.x=e.clientX-this.stage.rasterRect.x,this.cursorPos.y=e.clientY-this.stage.rasterRect.y,this.cursorImage&&this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:this.stage.translateRasterToFresco(this.cursorPos)}))},this.mouseLeave=e=>{this.cursorPos.x=this.cursorPos.y=-999,this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:void 0}))},this.touchMove=e=>{if(e.targetTouches.length>1){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=Math.hypot(e.targetTouches[0].pageX-e.targetTouches[1].pageX,e.targetTouches[0].pageY-e.targetTouches[1].pageY);if(void 0===this.hypo)return this.hypo=t,this.downPoint=new a.Z((e.targetTouches[0].pageX+e.targetTouches[1].pageX)/2,(e.targetTouches[0].pageY+e.targetTouches[1].pageY)/2),this.stage.resetAnchor(),void(this.downAnchor=this.stage.anchor.clone());if(this.hypo-t<-20||this.hypo-t>20)this.stage.setFluidZoom(Boolean(t>this.hypo)),this.hypo=t;else{const t=new a.Z((e.targetTouches[0].pageX+e.targetTouches[1].pageX)/2,(e.targetTouches[0].pageY+e.targetTouches[1].pageY)/2),i=this.stage.isHDPI?.5*this.stage.zoom:this.stage.zoom,s=Math.round(t.x-this.downPoint.x)/i,n=Math.round(t.y-this.downPoint.y)/i;this.stage.setAnchor(new a.Z(this.downAnchor.x-s,this.downAnchor.y-n)),this.stage.updateViewport()}}else this.lastPos.x=e.targetTouches[0].pageX,this.lastPos.y=e.targetTouches[0].pageY,this.cursorPos.x=e.targetTouches[0].pageX-this.stage.rasterRect.x,this.cursorPos.y=e.targetTouches[0].pageY-this.stage.rasterRect.y,this.cursorImage&&this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:this.stage.translateRasterToFresco(this.cursorPos)}))},this.touchEnd=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.hypo=void 0,this.downPoint=void 0,this.downAnchor=void 0,this.cursorPos.x=this.cursorPos.y=-999,this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:void 0}))},this.freeze=(e=!0)=>{this.frozen=e,e||this.render()},this.sleep=()=>{this.sleeping=!0,this.clear(!0)},this.wake=()=>{this.sleeping=!1,this.render()},this.so=7,this.render=(e,t=!0)=>{if(t&&this.clear(),this.sleeping)return;if(window.clearTimeout(this.timer),!this.stage||!this.stage.fresco||this.stage.supressRender)return;if(!this.stage.fresco.hasSelection())return void(e&&this.ctx.putImageData(e,0,0));let i,s,n,a,r,o=this.stage.zoom,h=this.stage.fresco.selection,c=this.stage.getViewPort(),l=this.stage.offset.x>0?this.stage.offset.x:0,d=this.stage.offset.y>0?this.stage.offset.y:0;if(e||(e=this.getImageData()),o>1){var u=Math.ceil(o)-1;for(let t=0,o=0,l=h.outline.length;t<l;t+=3)if(n=h.outline[t],a=h.outline[t+1],r=h.outline[t+2],n+h.offset.x>=c.x&&n+h.offset.x<c.x+c.width&&a+h.offset.y>=c.y&&a+h.offset.y<c.y+c.height)switch(i=Math.round((n+h.offset.x)*this.stage.zoom)+this.stage.offset.x,s=Math.round((a+h.offset.y)*this.stage.zoom)+this.stage.offset.y,r){case 0:for(this.drawAnt(i,s,e),o=1;o<=u;++o)this.drawAnt(i+o,s,e),this.drawAnt(i,s+o,e);break;case 1:for(o=0;o<=u;++o)this.drawAnt(i+o,s,e);break;case 2:for(i+=u,this.drawAnt(i,s,e),o=1;o<=u;++o)this.drawAnt(i-o,s,e),this.drawAnt(i,s+o,e);break;case 3:for(o=0;o<=u;++o)this.drawAnt(i,s+o,e);break;case 4:for(i+=u,o=0;o<=u;++o)this.drawAnt(i,s+o,e);break;case 5:for(s+=u,this.drawAnt(i,s,e),o=1;o<=u;++o)this.drawAnt(i,s-o,e),this.drawAnt(i+o,s,e);break;case 6:for(s+=u,o=0;o<=u;++o)this.drawAnt(i+o,s,e);break;case 7:for(i+=u,s+=u,this.drawAnt(i,s,e),o=1;o<=u;++o)this.drawAnt(i,s-o,e),this.drawAnt(i-o,s,e);break;case 8:for(this.drawAnt(i,s,e),this.drawAnt(i+u,s+u,e),o=1;o<=u;++o)this.drawAnt(i+o,s,e),this.drawAnt(i,s+o,e),this.drawAnt(i+u,s-o+u,e),this.drawAnt(i-o+u,s+u,e);break;case 9:for(this.drawAnt(i,s,e),o=1;o<=u;++o)this.drawAnt(i+o,s,e),this.drawAnt(i,s+o,e),this.drawAnt(i+o,s+u,e);break;case 10:for(i+=u,s+=u,this.drawAnt(i,s,e),o=1;o<=u;++o)this.drawAnt(i+o-u,s-u,e),this.drawAnt(i,s-o,e),this.drawAnt(i-o,s,e);break;case 11:for(o=0;o<=u;++o)this.drawAnt(i+o,s,e),this.drawAnt(i,s+o,e),this.drawAnt(i+u,s+o,e);break;case 12:for(o=0;o<=u;++o)this.drawAnt(i+o,s+u,e),this.drawAnt(i,s+o,e),this.drawAnt(i+u,s+o,e);break;case 13:for(o=0;o<=u;++o)this.drawAnt(i,s+o,e),this.drawAnt(i+u,s+o,e);break;case 14:for(o=0;o<=u;++o)this.drawAnt(i+o,s,e),this.drawAnt(i+o,s+u,e)}}else for(let p=0,g=h.outline.length;p<g;p+=3)n=h.outline[p],a=h.outline[p+1],r=h.outline[p+2],i=Math.round((n+h.offset.x-c.x)*o)+l,s=Math.round((a+h.offset.y-c.y)*o)+d,this.drawAnt(i,s,e);this.ctx.putImageData(e,0,0),this.dirty=!0,this.frozen||(this.timer=window.setTimeout((()=>{--this.so<0&&(this.so=7),this.frozen||this.render()}),400))},this.drawAnt=(e,t,i)=>{if(t=~~t,(e=~~e)>=0&&t>=0&&e<this.raster.width&&t<this.raster.height){let s=4*(t*this.raster.width+e);this.ants[(e+this.so)%8*8+t%8]?(i.data[s]=0,i.data[s+1]=0,i.data[s+2]=0,i.data[s+3]=255):(i.data[s]=255,i.data[s+1]=255,i.data[s+2]=255,i.data[s+3]=255)}},this.clear=(e=!1)=>{(e||this.dirty)&&(this.ctx&&this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.dirty=!1)},this.stage=e,this.raster=e.raster,this.ctx=this.raster.getContext("2d",{willReadFrequently:!0}),this.ctx.imageSmoothingEnabled=!1,this.raster.addEventListener("mousemove",this.mouseMove,!0),this.raster.addEventListener("mouseout",this.mouseLeave,!0),this.raster.addEventListener("touchmove",this.touchMove,{passive:!1}),this.raster.addEventListener("touchend",this.touchEnd,{passive:!1}),this.raster.addEventListener("wheel",this.mouseWheel,{passive:!1}),this.raster.addEventListener("contextmenu",(e=>{e.preventDefault()}),!1),"e"===h.ZP.product&&document.addEventListener("viewport-render",(()=>this.render()),!1)}getImageData(){return this.ctx.getImageData(0,0,this.raster.width,this.raster.height)}drawAntPolygon(e){this.clear(),e.length>0&&(this.ctx.save(),this.ctx.translate(.5,.5),this.ctx.strokeStyle="#ffffff",this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y),e.forEach((e=>{this.ctx.lineTo(e.x,e.y)})),this.ctx.stroke(),this.ctx.strokeStyle="#000000",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y),e.forEach((e=>{this.ctx.lineTo(e.x,e.y)})),this.ctx.stroke(),this.ctx.restore(),this.dirty=!0),this.render(void 0,!1)}drawAntBezier(e){if(this.clear(),e.length>0){this.ctx.save(),this.ctx.translate(.5,.5),this.ctx.strokeStyle="#ffffff",this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t+=2)t+1===e.length?this.ctx.lineTo(e[t].x,e[t].y):this.ctx.quadraticCurveTo(e[t+1].x,e[t+1].y,e[t].x,e[t].y);this.ctx.stroke(),this.ctx.strokeStyle="#000000",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t+=2)t+1===e.length?this.ctx.lineTo(e[t].x,e[t].y):this.ctx.quadraticCurveTo(e[t+1].x,e[t+1].y,e[t].x,e[t].y);this.ctx.stroke(),this.ctx.restore(),this.dirty=!0}this.render(void 0,!1)}drawAntRectangle(e){this.clear();let t=this.getImageData();for(var i=0;i<e.height;++i)this.drawAnt(e.x,e.y+i,t),this.drawAnt(e.right()-1,e.y+i,t);for(var s=0;s<e.width;++s)this.drawAnt(e.x+s,e.y,t),this.drawAnt(e.x+s,e.bottom()-1,t);this.dirty=!0,this.render(t,!1)}drawAntEllipse(e){this.clear();let t=this.getImageData();var i,s,n,a,r,o,h,c,l,d,u,p,g,m,v,f,y=e.width%2==0?1:0,w=e.height%2==0?1:0;i=.5*e.width,h=0,c=s=.5*e.height,u=(l=i*i)*(1-(s<<1))+(m=(d=s*s)<<1),p=d-(g=l<<1)*((s<<1)-1),n=3*m,a=f=d<<2,r=(v=l<<2)*(s-1),o=g*((s<<1)-3),this.drawAnt(e.x+h+i-y,e.y+c+s-w,t),this.drawAnt(e.x-h+i,e.y+c+s-w,t),this.drawAnt(e.x-h+i,e.y-c+s,t),this.drawAnt(e.x+h+i-y,e.y-c+s,t);do{u<0?(u+=n,p+=a,n+=f,a+=f,h++):p<0?(u+=n-r,n+=f,r-=v,p+=a-o,a+=f,o-=v,h++,c--):(u-=r,r-=v,p-=o,o-=v,c--),this.drawAnt(e.x+h+i-y,e.y+c+s-w,t),this.drawAnt(e.x-h+i,e.y+c+s-w,t),this.drawAnt(e.x-h+i,e.y-c+s,t),this.drawAnt(e.x+h+i-y,e.y-c+s,t)}while(c>0);this.dirty=!0,this.render(t,!1)}cleanUp(){window.clearTimeout(this.timer)}}},94699:(e,t,i)=>{i.d(t,{F:()=>b,q:()=>x});var s=i(23770),n=i(33655),a=i(95574),r=i(36817),o=i(78685),h=i(82282),c=i(51294),l=i(87108),d=i(77664),u=i(44170),p=i(77758),g=i(50694),m=i(44686),v=i(47163),f=i(92396),y=i(68934),w=i(84253);class x{constructor(e,t,i,s,n,a,r){this.name=t,this.width=i,this.height=s,this.color=n,this.animation=r,this.templateMeta=a,this.id=e,this.lastModified=new Date,this.pinned=!1,this.timeoutId=null}async restore(e){const t=await(0,s.X3)();try{const[i,s]=t.transaction("readonly","layer-meta","document-selection"),[a,o]=await Promise.all([i.index("document").getAll(this.id),s.get(this.id)]);this.order||(this.order=a.sort(((e,t)=>e.order-t.order)).map((e=>e.id)));let h=[];if(this.order.forEach((e=>{const t=a.find((t=>t.id===e));t&&("bitmap"===t.type&&(t.type=u.Z.TYPE_IMAGE),t.settings.rotation&&t.rect&&void 0===t.rect.rotation&&(t.rect.rotation=t.settings.rotation),t.rect&&void 0===t.rect.rotation&&(t.rect=new r.Z(t.rect.x,t.rect.y,t.rect.width,t.rect.height,0)),h.push(t))})),h.length!==a.length){console.warn("Had layers that could not be sorted, this is a problem");const e=a.filter((e=>!this.order.includes(e.id)));h=h.concat(e)}if(o){e.addSelection();const t=e.selection;t.mask=await n.Td(o),t.ctx=t.mask.getContext("2d"),t.createOutline()}const c=await Promise.all(h.map((async e=>{const i=n.mS(b,e),[s,a]=t.transaction("readonly","layer-bitmap","layer-mask"),[r,o]=await Promise.all([s.get(i.id),a.get(i.id)]);return i.toLayer(r,o)})));c.forEach((t=>e.layers.push(t)))}catch(i){throw console.error("Restore",i),i}}async save(){const e=await(0,s.X3)(),[t]=e.transaction("readwrite","document-meta");await t.put(this)}async remove(){const e=await(0,s.X3)(),[t,i,n,a,r,o]=e.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta","layer-mask","layer-bitmap"),h=[t.delete(this.id),i.delete(this.id),n.delete(this.id)],c=await a.index("document").getAll(this.id);for(let s=0;s<c.length;s++){const e=c[s];h.push(a.delete(e.id)),h.push(o.delete(e.id)),h.push(r.delete(e.id))}await Promise.all(h)}async pendingRemove(e){const t=setTimeout((async()=>{await this.remove(),e(null,this)}),5e3);this.timeoutId=t}async undoRemove(){clearTimeout(this.timeoutId)}static async saveOrder(e){const t=e.layers.map((e=>e.id)),i=await(0,s.X3)(),[n]=i.transaction("readwrite","document-meta"),a=await n.get(e.id);a.order=t,await n.put(a)}static async duplicate(e){const t=await(0,s.X3)(),[i,a,r,o,h,c]=t.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta","layer-mask","layer-bitmap"),l=n.M8(),d=[(async()=>{const t=await a.get(e);t&&await a.add(t,l)})(),(async()=>{const t=await r.get(e);t&&await r.add(t,l)})()],u=await o.index("document").getAll(e),p={};for(let s=0;s<u.length;s++){const e=u[s],t=e.id,i=n.M8();p[t]=i,d.push((async()=>{e.id=i,e.document=l,await o.add(e)})(),(async()=>{const e=await c.get(t);e&&await c.add(e,i)})(),(async()=>{const e=await h.get(t);e&&await h.add(e,i)})())}d.push((async()=>{const t=await i.get(e);t.id=l,t.pinned=!1,t.order=t.order.map((e=>p[e])),t.lastModified=new Date,await i.add(t)})()),await Promise.all(d)}static async deleteAll(){const e=await(0,s.X3)(),[t]=e.transaction("readwrite","document-meta"),i=await t.getAll();for(let s=0;s<i.length;s++){const e=n.mS(x,i[s]);e.pinned||await e.remove()}}async getThumbnail(){const e=await(0,s.X3)(),[t]=e.transaction("readonly","document-thumbnail"),i=await t.get(this.id);return i?"string"==typeof i?(0,a.OA)(i):(0,a.s4)(i):Promise.resolve(void 0)}static async getAll(){const e=await(0,s.X3)(),[t]=e.transaction("readonly","document-meta");return(await t.getAll()).map((e=>n.mS(x,e)))}static async history(){return x.getAll().then((e=>e.sort(((e,t)=>e.lastModified===t.lastModified?0:e.lastModified<t.lastModified?1:-1))))}static async getByID(e){const t=await(0,s.X3)(),[i]=t.transaction("readonly","document-meta"),a=await i.get(e);return n.mS(x,a)}async pin(){this.pinned=!0,await this.save()}async unpin(){this.pinned=!1,await this.save()}}class b{constructor(e,t){this.order=0,this.id=e.id,this.type=e.type,this.document=t,this.settings=e.settings,this.animation=e.animation,this.rect=e.rect,this.trim=e.trim,e instanceof o.Z&&(this.textSettings=e.textSettings,this.text=e.text),e instanceof d.Z&&(this.url=e.url,this.variant=e.variant,this.scalemethod=e.scalemethod),e instanceof l.Z&&(this.shapeSettings=e.shapeSettings),e instanceof c.Z&&(this.frameSettings=e.frameSettings),e instanceof w.Z&&(this.groupSettings=e.groupSettings)}async toLayer(e,t){const i="string"==typeof e?await n.lU(e):await n.Td(e),s="string"==typeof t?await n.lU(t):await n.Td(t);switch(this.type){case u.Z.TYPE_IMAGE:{const e=new h.Z(this.id,this.settings.name,i,n.mS(r.Z,this.rect),this.settings.locked);return s&&(e.mask=s,e.render()),e.settings=this.settings,e.animation=n.mS(f.Z,this.animation),e}case u.Z.TYPE_ELEMENT:{const e=new d.Z(this.id,this.settings.name,i,this.url,this.variant,this.settings.blendmode,this.scalemethod);return e.settings=this.settings,e.rect=n.mS(r.Z,this.rect),e.animation=n.mS(f.Z,this.animation),e}case u.Z.TYPE_TEXT:{const e=new o.Z(this.id,this.text,n.mS(r.Z,this.rect),n.mS(p.Z,this.textSettings));return e.settings=this.settings,e.animation=n.mS(f.Z,this.animation),await v.Z.loadFont(this.textSettings.font),await e.prepare(),e}case u.Z.TYPE_SHAPE:{const e=new l.Z(this.id,this.settings.name,n.mS(r.Z,this.rect),n.mS(m.Z,this.shapeSettings));return e.settings=this.settings,e.animation=n.mS(f.Z,this.animation),await e.prepare(),e}case u.Z.TYPE_FRAME:{const e=new c.Z(this.id,this.settings.name,n.mS(r.Z,this.rect),n.mS(g.Z,this.frameSettings));return e.canvas=i,e.settings=this.settings,e.trim=n.mS(r.Z,this.trim),e.animation=n.mS(f.Z,this.animation),e.canvas&&e.render(),e}case u.Z.TYPE_GROUP:{const e=new w.Z(this.id,this.settings.name,n.mS(y.Z,this.groupSettings));return e.settings=this.settings,e.animation=n.mS(f.Z,this.animation),e}}}static async delete(e){const t=await(0,s.X3)();let[i,n,a]=t.transaction("readwrite","layer-bitmap","layer-meta","layer-mask");await Promise.all([i.delete(e),n.delete(e),a.delete(e)])}static async sync(e,t){if(!t.hasLayer(e))throw new Error("This is probably a bug, cant create layermeta from layer not in the fresco");const i=new b(e,t.id);let a=!1;if(e.type===u.Z.TYPE_IMAGE||e.type===u.Z.TYPE_ELEMENT?a=e.rect&&e.rect.isSet()&&!!e.canvas||!e.rect&&!e.canvas:e.type===u.Z.TYPE_FRAME&&(a=e.trim&&e.trim.isSet()&&!!e.canvas||!e.trim&&!e.canvas),a){const[t,a]=await Promise.all([n._c(e.canvas),n._c(e.mask)]),r=await(0,s.X3)();let[o,h,c]=r.transaction("readwrite","layer-bitmap","layer-meta","layer-mask");await Promise.all([h.put(i),t?o.put(t,i.id):o.delete(i.id),a?c.put(a,i.id):c.delete(i.id)])}else{const e=await(0,s.X3)();let[t]=e.transaction("readwrite","layer-meta");await t.put(i)}e.syncLatest=new Date}}},77664:(e,t,i)=>{i.d(t,{Z:()=>l});var s=i(44170),n=i(33655),a=i(36817),r=i(43673),o=i(82282),h=i(92396);class c extends s.Z{constructor(e=n.M8(),t,i,l,d,u="",p=c.SCALE_METHOD_NONE){super(s.Z.TYPE_ELEMENT),this.id=e,this.rotateAndFit=(e,t)=>{this.settings.locked&&this.variant===c.VARIANT_OVERLAY?(this.rotate(e),this.calculate(new r.Z(0,0),new r.Z(t.width,t.height),0)):this.rect.rotation+=e?-90:90},this.calculate=(e,t,i)=>{this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.width<10&&(this.rect.width=10),0!==i?this.rect.height=Math.round(this.rect.width/i):(this.rect.height=Math.round(t.y-e.y),this.rect.height<10&&(this.rect.height=10))},this.rasterize=()=>{const e=new o.Z(n.M8(),this.settings.name,n.dN(this.canvas),this.rect.clone(),this.settings.locked);return e.settings=Object.assign({},this.settings),e.applyTransform(),e},this.clone=(e=!1)=>{let t=new c(e?this.id:n.M8(),this.settings.name,n.dN(this.canvas),this.url,this.variant,this.settings.blendmode,this.scalemethod);return t.settings=Object.assign({},this.settings),t.rect=this.rect.clone(),t.animation=h.Z.clone(this.animation),e&&(t.id=this.id,t.settings.name=this.settings.name),t},this.url=l,this.canvas=i,this.variant=d,this.scalemethod=p,this.settings.name=t,this.settings.blendmode=u,this.rect=new a.Z(0,0,i.width,i.height)}}c.VARIANT_OVERLAY="overlay",c.VARIANT_STICKER="sticker",c.SCALE_METHOD_STRETCH="stretch",c.SCALE_METHOD_FILL="fill",c.SCALE_METHOD_NONE="none";const l=c},51294:(e,t,i)=>{i.d(t,{Z:()=>d});var s=i(44170),n=i(33655),a=i(36817),r=i(98776),o=i(43673),h=i(82282),c=i(50694),l=i(92396);class d extends s.Z{constructor(e=n.M8(),t,i,u=new c.Z){super(s.Z.TYPE_FRAME),this.id=e,this.prepare=()=>{this.setPath()},this.calculate=(e,t,i)=>{this.editMode&&this.trim?(this.trim.x=Math.round(e.x),this.trim.y=Math.round(e.y),this.trim.width=Math.round(t.x-e.x),this.trim.height=0===i?Math.round(t.y-e.y):Math.round(this.trim.width/(this.canvas.width/this.canvas.height)),this.trim.width<10&&(this.trim.width=10),this.trim.height<10&&(this.trim.height=10)):(this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.height=0!==i?Math.round(this.rect.width/i):Math.round(t.y-e.y),this.rect.width<10&&(this.rect.width=10),this.rect.height<10&&(this.rect.height=10))},this.setWidth=(e,t)=>{this.rect&&(e<1&&(e=1),this.editMode&&this.trim?(this.trim.width=e,0!==t&&(this.trim.height=Math.round(this.trim.width/(this.canvas.width/this.canvas.height)))):(this.rect.width=e,0!==t&&(this.rect.height=this.rect.width*t)),this.render())},this.setHeight=(e,t)=>{this.rect&&(e<1&&(e=1),this.editMode&&this.trim?(this.trim.height=e,0!==t&&(this.trim.height=Math.round(this.trim.height/(this.canvas.height/this.canvas.width)))):(this.rect.height=e,0!==t&&(this.rect.width=this.rect.height/t)),this.render())},this.position=(e,t)=>{this.rect&&(this.editMode?(this.trim&&(void 0!==e&&(this.trim.x=e),void 0!==t&&(this.trim.y=t)),this.render()):(void 0!==e&&(this.rect.x=e),void 0!==t&&(this.rect.y=t),this.bect.x=this.rect.x-(this.bect.width-this.rect.width)/2,this.bect.y=this.rect.y-(this.bect.height-this.rect.height)/2))},this.scale=(e,t)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.rect.height=Math.round(this.rect.height*t),this.trim&&(this.trim.x=Math.round(this.trim.x*e),this.trim.y=Math.round(this.trim.y*t),this.trim.width=Math.round(this.trim.width*e),this.trim.height=Math.round(this.trim.height*t)),this.frameSettings.outlineSize>0&&(this.frameSettings.outlineSize=Math.round(this.frameSettings.outlineSize*e)),this.frameSettings.shadow&&(this.frameSettings.shadowDistance=Math.round(100*this.frameSettings.shadowDistance*e)/100,this.frameSettings.shadowBlur=Math.round(100*this.frameSettings.shadowBlur*e)/100),this.render())},this.rotate=e=>{this.rect.rotation+=e?-90:90},this.flip=e=>{this.canvas&&(this.canvas=n.x2(this.canvas,e),this.render())},this.setPath=(e=this.frameSettings.clip,t=!1)=>{e&&(t||(this.frameSettings.clip=e),this.path2D=new Path2D(e)),this.render()},this.setOutline=(e,t,i)=>{this.frameSettings.outline=e,this.frameSettings.outlineSize=t,this.frameSettings.outlineColor=i,this.render()},this.setShadow=(e,t,i,s,n,a)=>{this.frameSettings.shadow=e,this.frameSettings.shadowBlur=t,this.frameSettings.shadowOpacity=i,this.frameSettings.shadowColor=s,this.frameSettings.shadowDistance=n,this.frameSettings.shadowDirection=a,this.render()},this.setFrameSettings=e=>{this.frameSettings=e,this.render()},this.setContent=e=>{this.canvas=e,this.fitContent()},this.trimOnResize=e=>{if(!this.trim)return;let t=this.rect.getComparedScale(e);this.trim.x=Math.round(this.trim.x*t.width),this.trim.y=Math.round(this.trim.y*t.height),this.trim.width=Math.round(this.trim.width*t.width),this.trim.height=Math.round(this.trim.height*t.height)},this.fitContent=()=>{this.canvas?this.trim=a.Z.fillFit(this.canvas.width,this.canvas.height,this.rect.width,this.rect.height):this.trim=void 0,this.render()},this.getGlobalTrim=()=>{if(this.trim)return new a.Z(this.rect.x+this.trim.x,this.rect.y+this.trim.y,this.trim.width,this.trim.height,this.rect.rotation)},this.scaleTrim=(e,t)=>{let i=this.trim.clone();this.trim.x=Math.round(this.trim.x*e),this.trim.y=Math.round(this.trim.y*t),this.trim.width=Math.round(this.trim.width*e),this.trim.height=Math.round(this.trim.height*t),this.trim.width<1&&(this.trim.width=1),this.trim.height<1&&(this.trim.height=1),this.render(),this.trim=i},this.render=()=>{if(this.bect=this.rect.clone(),this.frameSettings.shadow){let e=100*this.frameSettings.shadowBlur;e+=Math.abs(100*this.frameSettings.shadowDistance),this.bect.width+=2*e,this.bect.height+=2*e,this.bect.x-=e,this.bect.y-=e}const e=this.baked.getContext("2d");if(this.baked.width!==this.bect.width||this.baked.height!==this.bect.height?(this.baked.height=this.bect.height,this.baked.width=this.bect.width):e.clearRect(0,0,this.baked.width,this.baked.height),this.canvas){const t=new Path2D;let i=e.lineWidth=this.frameSettings.outline?Math.round(100*this.frameSettings.outlineSize):0;t.addPath(this.path2D,(new DOMMatrix).scale((this.rect.width-i)/100,(this.rect.height-i)/100)),e.save(),e.translate(this.rect.x-this.bect.x+i/2,this.rect.y-this.bect.y+i/2),this.frameSettings.outline?(e.strokeStyle=this.frameSettings.outlineColor,e.lineWidth=i,this.frameSettings.shadow&&this.shadowContext(e),e.fill(t),e.stroke(t)):this.frameSettings.shadow&&(this.shadowContext(e),e.fill(t)),e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0,e.clip(t),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",e.drawImage(this.canvas,this.trim.x-i/2,this.trim.y-i/2,this.trim.width,this.trim.height),e.restore()}else{const t=new Path2D;let i=e.lineWidth=this.frameSettings.outline?Math.round(100*this.frameSettings.outlineSize):2;t.addPath(this.path2D,(new DOMMatrix).scale((this.rect.width-i)/100,(this.rect.height-i)/100)),e.save(),e.translate(this.rect.x-this.bect.x+i/2,this.rect.y-this.bect.y+i/2),this.frameSettings.outline?e.strokeStyle=this.frameSettings.outlineColor:e.strokeStyle="#ccc",e.fillStyle="rgba(0, 0, 0, 0.3)",this.frameSettings.shadow&&this.shadowContext(e),e.fill(t),e.stroke(t),e.restore();const s=new o.Z(Math.round(this.bect.width/2),Math.round(this.bect.height/2));let n=20;e.lineWidth=8,this.rect.width>500&&this.rect.height>500&&(e.lineWidth=16,n=40),e.save(),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.beginPath(),e.moveTo(s.x-n,s.y),e.lineTo(s.x+n,s.y),e.moveTo(s.x,s.y-n),e.lineTo(s.x,s.y+n),e.closePath(),e.stroke(),e.restore()}},this.shadowContext=e=>{const t=r.Z.fromHEX(this.frameSettings.shadowColor,Math.round(255*this.frameSettings.shadowOpacity)).toRGBA();var i=(this.frameSettings.shadowDirection-90)*Math.PI/180,s=Math.cos(i)*this.frameSettings.shadowDistance,n=Math.sin(i)*this.frameSettings.shadowDistance;e.fillStyle=t,e.shadowColor=t,e.shadowBlur=100*this.frameSettings.shadowBlur,e.shadowOffsetX=100*s,e.shadowOffsetY=100*n},this.replaceCanvas=e=>{const t=this.canvas.getContext("2d");t.save(),t.globalCompositeOperation="copy",t.drawImage(e,0,0),t.restore()},this.switchCanvas=(e,t)=>{this.canvas=e,this.trim=t.clone(),this.render()},this.rasterize=()=>{let e=this.baked?this.baked:this.canvas,t=this.bect?this.bect.clone():this.rect.clone();const i=new h.Z(n.M8(),this.settings.name,e,t,this.settings.locked);return i.settings=Object.assign({},this.settings),i.applyTransform(),i},this.clone=(e=!1)=>{var t;let i=new d(e?this.id:n.M8(),this.settings.name,this.rect.clone(),this.frameSettings.clone());return i.settings=Object.assign({},this.settings),i.animation=l.Z.clone(this.animation),i.trim=null===(t=this.trim)||void 0===t?void 0:t.clone(),i.canvas=n.dN(this.canvas),i.render(),e&&(i.id=this.id,i.settings.name=this.settings.name),i},this.rect=i,this.settings.name=t,this.frameSettings=u,this.baked=n.vL(i.width,i.height),this.prepare()}}},50694:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(){this.clip="M 0,0 H 100 V 100 H 0 Z",this.outline=!1,this.outlineColor="#555555",this.outlineSize=.3,this.shadow=!1,this.shadowBlur=.3,this.shadowOpacity=.8,this.shadowColor="#000000",this.shadowDistance=.3,this.shadowDirection=180}clone(){const e=Object.create(s.prototype);return Object.assign(e,this)}equalTo(e){return!!e&&(this.clip===e.clip&&this.outline===e.outline&&this.outlineSize===e.outlineSize&&this.outlineColor===e.outlineColor&&this.shadow===e.shadow&&this.shadowBlur===e.shadowBlur&&this.shadowColor===e.shadowColor&&this.shadowOpacity===e.shadowOpacity&&this.shadowDistance===e.shadowDistance&&this.shadowDirection===e.shadowDirection)}}},58027:(e,t,i)=>{i.d(t,{Z:()=>h});var s=i(44170),n=i(36817),a=i(51294),r=i(49198),o=i(22758);class h{constructor(e,t,i,r,o,h,c,l){this.block=!1,this.layerAddedCounterForUserEase=0,this.savedTimesCounterForUserEase=0,this.setBlock=(e=!1)=>{this.block=e||Boolean(!!this.templateMeta&&this.templateMeta.locked)},this.unblock=()=>{this.block=!1,this.templateMeta&&(this.templateMeta.locked=!1)},this.getSelected=()=>1!==this.selected.length?void 0:this.selected[0],this.getSelectedStack=()=>this.selected,this.getSelectedLinkedStack=()=>this.selectedLinked,this.updateSelectedLinkedStack=()=>{let e=new Set;for(let i of this.selected)i.hasLink()&&e.add(i.settings.link);let t=this.layers.filter((t=>e.has(t.settings.link)));this.selectedLinked=[...new Set([...this.selected,...t])]},this.getNotSelectedStack=(e=this.selected)=>this.layers.filter((t=>!e.includes(t))),this.getStackRect=(e=this.selected)=>{let t=new Array;for(let i of e)t.push(i.rect?i.rect.clone():void 0);return t},this.getStackBounds=(e=this.selected)=>{let t;if(1===e.length)t=e[0].editMode&&e[0]instanceof a.Z?e[0].trim.clone():e[0].rect?e[0].rect.clone():void 0;else for(let i of e)i.rect&&(t=n.Z.merge(t,i.rect.getRotatedBounds()));return t},this.getStackId=(e=this.selected)=>{let t=new Array;return e.forEach((e=>{t.push(e.id)})),t},this.getStackHashId=(e=this.selected)=>{if(0===e.length)return;if(1===e.length)return e[0].id;let t=this.getStackId(e).join(),i=0;for(let s=0;s<t.length;s++)i=(i<<5)-i+t.charCodeAt(s),i&=i;return i.toString()},this.getLayerById=e=>{let t;return this.layers.forEach((i=>{i.id===e&&(t=i)})),t},this.hasSelected=()=>this.selected.length>0,this.isSelectedStack=()=>this.selected.length>1,this.isSelectedLinkedStack=()=>this.selectedLinked.length>1,this.isSelectedType=e=>1===this.selected.length&&this.selected[0].type===e,this.isSelectedImageWithCanvas=()=>(!this.selected||1===this.selected.length)&&(this.selected[0].type===s.Z.TYPE_IMAGE&&!!this.selected[0].canvas),this.isSelectedShaderbleWithCanvas=()=>(!this.selected||1===this.selected.length)&&((this.selected[0].type===s.Z.TYPE_IMAGE||this.selected[0].type===s.Z.TYPE_FRAME||this.selected[0].type===s.Z.TYPE_ELEMENT)&&!!this.selected[0].canvas),this.isSelectedById=e=>{if(e)return-1!==this.selected.findIndex((t=>t.id===e))},this.isSelectedLinkedById=e=>{if(e)return-1!==this.selectedLinked.findIndex((t=>t.id===e))},this.selectLayerById=(e,t=!1,i=!1)=>{this.selected[0]&&(this.selected[0].editMode=!1);let n=!1;return e?t?this.isSelectedById(e)?i&&(this.unselectLayerById(e),n=!0):(this.selected.push(this.getLayerById(e)),n=!0):this.isSelectedById(e)&&1===this.selected.length||(this.selected=[this.getLayerById(e)],n=!0):0!==this.layers.length&&this.layers[0].settings.locked&&this.layers[0].type===s.Z.TYPE_IMAGE?0===this.selected.length||1===this.selected.length&&this.selected[0]===this.layers[0]||(this.selected=[this.layers[0]],n=!0):0!==this.selected.length&&(this.selected=[],n=!0),this.selected.length>1&&this.selected.sort(((e,t)=>this.layers.indexOf(e)-this.layers.indexOf(t))),this.updateSelectedLinkedStack(),n},this.unselectLayerById=e=>{const t=this.selected.findIndex((t=>t.id===e));return-1!==t?(this.selected.splice(t,1),!0):(this.updateSelectedLinkedStack(),!1)},this.unselectLayers=()=>{this.selected=[],this.selectedLinked=[]},this.selectLayerStack=(e,t=!1)=>{this.selected=e,this.updateSelectedLinkedStack()},this.deleteLayerById=e=>{const t=this.layers.findIndex((t=>t.id===e));let i;return-1!==t&&(i=this.layers[t],this.layers.splice(t,1),this.unselectLayerById(e)),!this.hasSelected()&&this.layers.length>0&&(this.selected=[this.layers[t>0?t-1:0]]),this.updateSelectedLinkedStack(),i},this.id=e,this.name=t,this.width=i,this.height=r,this.color=o,this.animation=h,this.templateMeta=c,this.source=l,this.layers=[],this.selected=[],this.selectedLinked=[],this.setBlock()}addScratch(){return this.scratch||(this.scratch=new r.Z),this.scratch}removeScratch(){this.scratch=void 0}hasScratch(){return!!this.scratch&&"none"!==this.scratch.renderMode}addSelection(){this.selection||(this.selection=new o.Z(this.width,this.height))}clearSelection(){this.selection&&this.selection.clear()}removeSelection(){this.selection&&(this.selection.cleanUp(),this.selection=void 0)}hasSelection(){return this.selection&&this.selection.bounds&&this.selection.outline&&this.selection.outline.length>0}hasAnimation(){if(this.animation)return!0;for(const e of this.layers)if(e.animation&&!e.animation.block)return!0;return!1}hasLayers(){return this.layers.length>0}hasLayer(e){return this.layerNr(e.id)>=0}numLayers(){return this.layers.length}numSelected(){return this.selected.length}isSelectedLinked(){return this.selected.filter((e=>e.hasLink())).length===this.selected.length}nextAddedLayerNumber(){return this.numLayers()>this.layerAddedCounterForUserEase&&(this.layerAddedCounterForUserEase=this.numLayers()),(this.layerAddedCounterForUserEase+1).toString()}lockedBackground(){return this.layers.length>0&&this.layers[0].settings.locked&&this.layers[0].type===s.Z.TYPE_IMAGE}selectedLayerNr(){if(0===this.selected.length)return-1;if(1===this.selected.length)return this.layerNr(this.selected[0].id);let e=0;return this.selected.forEach((t=>{e=Math.max(e,this.layerNr(t.id))})),e}layerNr(e){return this.layers.findIndex((t=>t.id===e))}changeLayerOrder(e,t){this.layers.splice(t,0,this.layers.splice(e,1)[0])}rotate(e){let t=this.width;this.width=this.height,this.height=t;for(let i=0;i<this.layers.length;i++)this.layers[i].rotate(e),this.layers[i].render()}flip(e){for(let t=0;t<this.layers.length;t++)this.layers[t].type===s.Z.TYPE_IMAGE&&(this.layers[t].flip(e),this.layers[t].render())}straighten(e,t,i){if(this.lockedBackground()){let s=this.layers[0];s.rect.rotation=e,s.rect.x=-(s.rect.width-t)/2,s.rect.y=-(s.rect.height-i)/2}this.width=t,this.height=i}crop(e){this.width=e.width,this.height=e.height;for(let t=0;t<this.layers.length;t++)this.layers[t].rect&&(this.layers[t].rect.x-=e.x,this.layers[t].rect.y-=e.y,this.layers[t].render());this.selection&&this.selection.size(this.width,this.height)}setSize(e,t){this.width=e,this.height=t}resize(e,t,i){let s=e/this.width,n=t/this.height;this.width=e,this.height=t;for(let a=0;a<this.layers.length;a++)this.layers[a].scale(s,n,i);this.selection&&this.selection.resize(this.width,this.height)}size(e,t,i,s){let n=i?e:e-this.width,a=i?t:t-this.height;if(this.width=i?this.width+e:e,this.height=i?this.height+t:t,"TL"!=s){"CL"!=s&&"BL"!=s||(n=0),"TC"!=s&&"CC"!=s&&"BC"!=s||(n=Math.round(n/2)),"TC"!=s&&"TR"!=s||(a=0),"CL"!=s&&"CC"!=s&&"CR"!=s||(a=Math.round(a/2));for(let e=0;e<this.layers.length;e++)this.layers[e].rect&&(this.layers[e].rect.x+=n,this.layers[e].rect.y+=a,this.layers[e].render())}this.selection&&this.selection.size(this.width,this.height)}addLayer(e){this.layerAddedCounterForUserEase++;let t=this.selectedLayerNr();return t>-1?this.layers.splice(t+1,0,e):this.layers.push(e),this.selected=[e],this.updateSelectedLinkedStack(),e}replaceLayer(e){const t=this.layers.findIndex((t=>t.id===e.id));this.layers[t]=e;const i=this.selected.findIndex((t=>t.id===e.id));-1!==i&&(this.selected[i]=e),this.updateSelectedLinkedStack()}}},84253:(e,t,i)=>{i.d(t,{Z:()=>a});var s=i(44170),n=i(33655);class a extends s.Z{constructor(e=n.M8(),t,i){super(s.Z.TYPE_GROUP),this.id=e,this.settings.name=t,this.groupSettings=i}}},68934:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(){this.color="",this.collapsed=!1,this.numberOfMembers=0}clone(){const e=Object.create(s.prototype);return Object.assign(e,this)}equalTo(e){return!!e&&(this.collapsed===e.collapsed&&this.numberOfMembers===e.numberOfMembers)}}},82282:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(44170),n=i(33655),a=i(36817),r=i(92396);class o extends s.Z{constructor(e=n.M8(),t,i,h,c=!1){super(s.Z.TYPE_IMAGE),this.id=e,this.calculate=(e,t,i)=>{this.canvas&&(this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.width<10&&(this.rect.width=10),0!==i?this.rect.height=Math.round(this.rect.width/i):(this.rect.height=Math.round(t.y-e.y),this.rect.height<10&&(this.rect.height=10)))},this.scale=(e,t,i)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.rect.height=Math.round(this.rect.height*t),this.applyTransform(i))},this.wouldApplyTransform=()=>!(!this.canvas||!this.rect)&&(0!==this.rect.rotation||this.rect.width!==this.canvas.width||this.rect.height!==this.canvas.height),this.applyStraighten=e=>{this.canvas=n.zs(this.canvas,this.rect.rotation,e),this.mask&&(this.mask=n.zs(this.mask,this.rect.rotation,e)),this.rect=e,this.render()},this.applyTransform=(e=!0)=>{if(!this.wouldApplyTransform())return!1;if(this.rect.width===this.canvas.width&&this.rect.height===this.canvas.height||(this.canvas=e?n.Ai(this.canvas,this.rect.width,this.rect.height):n.ZE(this.canvas,this.rect.width,this.rect.height),this.mask&&(this.mask=n.Ai(this.mask,this.rect.width,this.rect.height))),0!==this.rect.rotation){this.rect=this.rect.getRotatedBounds(),this.canvas=n.zs(this.canvas,this.rect.rotation,this.rect),this.mask&&(this.mask=n.zs(this.mask,this.rect.rotation,this.rect));let e=n.l(this.canvas);e.equalTo(new a.Z(0,0,this.canvas.width,this.canvas.height))||(this.canvas=n.fg(this.canvas,e),this.mask&&(this.mask=n.fg(this.mask,e)),this.rect.width=e.width,this.rect.height=e.height,this.rect.x+=e.x,this.rect.y+=e.y),this.rect.rotation=0}return this.render(),!0},this.switchCanvas=(e,t)=>{this.mask&&!this.rect.equalTo(t)&&(this.mask=n.ST(this.mask,this.rect,t)),this.canvas=e,this.rect=t.clone()},this.extendCanvas=e=>{if(!this.canvas)return this.rect=e,void(this.canvas=n.vL(e.width,e.height));let t=this.rect.union(e);this.rect.equalTo(t)||(this.canvas=n.ST(this.canvas,this.rect,t),this.mask&&(this.mask=n.ST(this.mask,this.rect,t)),this.rect=t)},this.hasMask=()=>!!this.mask,this.addMask=(e="clear")=>{if(this.mask=n.vL(this.canvas.width,this.canvas.height),"fill"===e){this.mask.getContext("2d").fillRect(0,0,this.mask.width,this.mask.height)}},this.invertMask=()=>{if(this.mask){let e=n.vL(this.mask.width,this.mask.height),t=e.getContext("2d");t.save(),t.fillRect(0,0,e.width,e.height),t.globalCompositeOperation="xor",t.drawImage(this.mask,0,0),t.restore(),this.mask=e}},this.removeMask=()=>{this.mask=void 0,this.baked=void 0},this.render=()=>{if(this.mask){if(!this.canvas)return;this.baked&&this.baked.width===this.canvas.width&&this.baked.height===this.canvas.height||(this.baked=n.vL(this.canvas.width,this.canvas.height));var e=this.baked.getContext("2d");e.save(),e.globalCompositeOperation="copy",e.drawImage(this.canvas,0,0),e.globalCompositeOperation="destination-in",e.drawImage(this.mask,0,0),e.restore(),e=void 0}},this.shrinkWrap=()=>{const e=n.l(this.canvas);if(!e)return this.canvas=void 0,this.mask=void 0,this.baked=void 0,this.rect=void 0,!0;if(!e.equalTo(this.rect)){const t=n.vL(e.width,e.height);return t.getContext("2d").drawImage(this.canvas,-e.x,-e.y),this.canvas=t,this.rect=e.rebase(-this.rect.x,-this.rect.y),this.mask&&(this.mask=n.WL(this.mask,e)),!0}return!1},this.rasterize=()=>this.clone(),this.clone=(e=!1)=>{var t;let i=new o(e?this.id:n.M8(),this.settings.name,n.dN(this.canvas),null===(t=this.rect)||void 0===t?void 0:t.clone(),!1);return i.settings=Object.assign({},this.settings),e||(i.settings.locked=!1),i.animation=r.Z.clone(this.animation),this.baked&&(i.baked=n.dN(this.baked)),this.hasMask()&&(i.mask=n.dN(this.mask)),i},this.canvas=i,this.rect=h,this.settings.name=t,this.settings.locked=c}}},44170:(e,t,i)=>{i.d(t,{Z:()=>a});var s=i(33655);class n{constructor(e){this.settings={opacity:1,blendmode:"",locked:!1,visible:!0,name:"",link:""},this.hasLink=()=>this.settings.link&&""!==this.settings.link,this.rotate=e=>{this.canvas&&(this.canvas=s.Xj(this.canvas,e?-90:90),this.mask&&(this.mask=s.Xj(this.mask,e?-90:90)),this.rect=this.rect.flipWidthAndHeight())},this.flip=e=>{this.canvas&&(this.canvas=s.x2(this.canvas,e),this.mask&&(this.mask=s.x2(this.mask,e)))},this.setWidth=(e,t)=>{this.rect&&(e<1&&(e=1),this.rect.width=e,0!==t&&(this.rect.height=Math.round(this.rect.width/t),this.rect.height<1&&(this.rect.height=1)))},this.setHeight=(e,t)=>{this.rect&&(e<1&&(e=1),this.rect.height=e,0!==t&&(this.rect.width=Math.round(this.rect.height*t),this.rect.width<1&&(this.rect.width=1)))},this.position=(e,t)=>{this.rect&&(void 0!==e&&(this.rect.x=e),void 0!==t&&(this.rect.y=t))},this.scale=(e,t,i)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.rect.height=Math.round(this.rect.height*t),this.rect.width<0&&(this.rect.width=1),this.rect.height<0&&(this.rect.height=1))},this.setRect=e=>{this.bect?this.bect=e:this.rect=e},this.getRect=()=>this.bect?this.bect:this.rect,this.getCanvas=()=>this.transient?this.transient:this.baked?this.baked:this.canvas,this.setAltCanvas=()=>{this.transient=s.dN(this.canvas)},this.replaceCanvas=e=>{this.canvas?this.canvas.width===e.width&&this.canvas.height===e.height||(this.canvas.width=e.width,this.canvas.height=e.height):this.canvas=s.vL(this.rect.width,this.rect.height);const t=this.canvas.getContext("2d");t.save(),t.imageSmoothingEnabled=!1,t.globalCompositeOperation="copy",t.drawImage(e,0,0),t.restore()},this.extendCanvas=e=>{},this.switchCanvas=(e,t)=>{},this.render=(e=!1)=>{},this.calculate=(e,t,i)=>{},this.rasterize=()=>{},this.clone=(e=!1)=>{},this.id=s.M8(),this.type=e}}n.TYPE_GROUP="group",n.TYPE_SCRATCH="scratch",n.TYPE_ELEMENT="element",n.TYPE_IMAGE="image",n.TYPE_SHAPE="shape",n.TYPE_FRAME="frame",n.TYPE_TEXT="text";const a=n},49198:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(33655),n=i(44170),a=i(43673);class r extends n.Z{constructor(){super(n.Z.TYPE_SCRATCH),this.renderMode="none",this.setRenderMode=e=>{this.renderMode=e},this.calculate=(e,t,i)=>{this.canvas&&(this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.width<10&&(this.rect.width=10),0!==i?this.rect.height=Math.round(this.rect.width/i):(this.rect.height=Math.round(t.y-e.y),this.rect.height<10&&(this.rect.height=10)))},this.clear=e=>{e?s.lI(this.canvas,e,new a.Z(0,0)):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.baked&&this.btx.clearRect(0,0,this.baked.width,this.baked.height)},this.addBake=()=>{this.baked=s.dN(this.canvas),this.btx=this.baked.getContext("2d"),this.btx.imageSmoothingEnabled=!1},this.getCanvas=()=>this.baked?this.baked:this.canvas,this.applySelection=e=>{if(e.fresco.hasSelection()){let t=this.baked?this.btx:this.ctx;t.save(),this.baked&&(t.globalCompositeOperation="copy",t.drawImage(this.canvas,0,0)),t.globalCompositeOperation="destination-in",t.drawImage(e.fresco.selection.mask,-this.rect.x,-this.rect.y),t.restore()}},this.drawCanvas=(e,t="source-over",i=1)=>{e&&(this.ctx.save(),this.ctx.save(),this.ctx.globalAlpha=i,this.ctx.globalCompositeOperation=t,this.ctx.drawImage(e,0,0,e.width,e.height),this.ctx.restore())},this.drawToLayer=(e,t="source-over",i=1)=>{if(e&&e.canvas&&e.rect)if(e.type===n.Z.TYPE_FRAME){this.canvas.width===e.canvas.width&&this.canvas.height===e.canvas.height||(e.canvas.width=this.canvas.width,e.canvas.height=this.canvas.height);const t=e.canvas.getContext("2d");t.imageSmoothingEnabled=!1,t.clearRect(0,0,e.canvas.width,e.canvas.height),t.drawImage(this.canvas,0,0)}else{const s=e.canvas.getContext("2d");s.save(),s.globalAlpha=i,s.imageSmoothingEnabled=!1,s.globalCompositeOperation=t,s.drawImage(this.baked?this.baked:this.canvas,Math.round(this.rect.x-e.rect.x),Math.round(this.rect.y-e.rect.y),this.rect.width,this.rect.height),s.restore()}}}setTarget(e,t,i,n){this.id=e,this.rect=t.clone(),this.renderMode=i,this.canvas=n?s.dN(n):s.vL(t.width,t.height),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.baked=void 0,this.btx=void 0}}},87108:(e,t,i)=>{i.d(t,{Z:()=>p});var s=i(33655),n=i(44170),a=i(9591),r=i(36817),o=i(98776),h=i(43673),c=i(67175),l=i(82282),d=i(95574),u=i(92396);class p extends n.Z{constructor(e=s.M8(),t,i,g){super(n.Z.TYPE_SHAPE),this.id=e,this.prepare=async()=>{if("svg"===this.shapeSettings.variant&&!this.image){let e=new Blob([this.shapeSettings.content],{type:"image/svg+xml"});this.image=await(0,d.s4)(e),this.rect||(this.rect=new r.Z(0,0,this.image.width,this.image.height))}"path"===this.shapeSettings.variant&&(this.path2D=new Path2D(this.shapeSettings.content)),this.shapeSettings.fillType&&(this.fill=await a.Z.fromString(this.shapeSettings.fillType,this.shapeSettings.fillValue),document.dispatchEvent(new CustomEvent("layer-select"))),"line"===this.shapeSettings.variant&&this.shapeSettings.outlineSize!==this.rect.height&&(this.rect.height=this.shapeSettings.outlineSize),this.canvas||(this.canvas=s.vL(this.rect.width,this.rect.height)),this.render()},this.setVariant=e=>{switch(e){case"rounded":this.shapeSettings.variant="rounded";break;case"rectangle":this.shapeSettings.variant="rectangle";break;case"ellipse":this.shapeSettings.variant="ellipse";break;case"line":this.shapeSettings.variant="line"}this.render()},this.setPath=(e,t=!1)=>{t||(this.shapeSettings.content=e),this.shapeSettings.variant="path",this.path2D=new Path2D(e),this.render()},this.setFill=(e,t=!1)=>{this.fill=e,t||(this.shapeSettings.fillType=this.fill?e.getType():void 0,this.shapeSettings.fillValue=this.fill?e.getStringValue():void 0),this.render()},this.setOutline=(e,t)=>{this.shapeSettings.outlineSize=e,this.shapeSettings.outlineColor=t,"line"===this.shapeSettings.variant&&(this.rect.height=0===e?1:e),this.render()},this.setShadow=(e,t,i,s,n,a)=>{this.shapeSettings.shadow=e,this.shapeSettings.shadowBlur=t,this.shapeSettings.shadowOpacity=i,this.shapeSettings.shadowColor=s,this.shapeSettings.shadowDistance=n,this.shapeSettings.shadowDirection=a,this.render()},this.setRadii=e=>{this.shapeSettings.radii=e,this.render()},this.render=(e=!1)=>{if(!this.canvas)return;const t=this.canvas.getContext("2d");if(this.canvas.width!==this.rect.width||this.canvas.height!==this.rect.height?(this.canvas.height=this.rect.height,this.canvas.width=this.rect.width):t.clearRect(0,0,this.canvas.width,this.canvas.height),"svg"===this.shapeSettings.variant)return t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",void t.drawImage(this.image,0,0,this.rect.width,this.rect.height);if("line"===this.shapeSettings.variant)t.fillStyle=this.shapeSettings.outlineColor,t.fillRect(0,0,this.rect.width,this.rect.height);else{t.save();let e,i=2*this.shapeSettings.outlineSize,s=this.shapeSettings.outlineSize,n=this.rect.width-i,a=this.rect.height-i,r=s>0,o=!(!this.fill||!this.fill.value);switch(t.lineWidth=i,t.strokeStyle=this.shapeSettings.outlineColor,this.shapeSettings.variant){case"path":e=new Path2D,e.addPath(this.path2D,(new DOMMatrix).scale(n/100,a/100)),t.translate(s,s);break;case"rounded":c.Z.roundRect(t,s,s,n,a,this.shapeSettings.radii);break;case"rectangle":c.Z.rectangle(t,s,s,n,a);break;case"ellipse":c.Z.ellipse(t,new h.Z(s,s),new h.Z(s+n,s+a))}r&&e?t.stroke(e):r&&t.stroke(),o?this.fill.addToCanvasFillStyle(t):(t.fillStyle="#ffffff",t.globalCompositeOperation="destination-out"),e?t.fill(e):t.fill(),t.restore()}if(this.shapeSettings.shadow){this.baked||(this.baked=document.createElement("canvas"));var i=100*this.shapeSettings.shadowBlur;i+=Math.abs(100*this.shapeSettings.shadowDistance),this.bect=new r.Z(this.rect.x-i,this.rect.y-i,this.rect.width+2*i,this.rect.height+2*i,this.rect.rotation),this.baked.width=this.bect.width,this.baked.height=this.bect.height;let e=this.baked.getContext("2d");var s=(this.shapeSettings.shadowDirection-90)*Math.PI/180,n=Math.cos(s)*this.shapeSettings.shadowDistance,a=Math.sin(s)*this.shapeSettings.shadowDistance;e.save(),e.shadowColor=o.Z.fromHEX(this.shapeSettings.shadowColor,Math.round(255*this.shapeSettings.shadowOpacity)).toRGBA(),e.shadowBlur=100*this.shapeSettings.shadowBlur,e.shadowOffsetX=100*n,e.shadowOffsetY=100*a,e.drawImage(this.canvas,i,i),e.restore()}else this.baked=void 0,this.bect=void 0},this.calculate=(e,t,i)=>{"line"===this.shapeSettings.variant?(this.rect.x=Math.round(e.x),this.rect.width=Math.round(t.x-e.x)):(this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.width<2&&(this.rect.width=2),0!==i?this.rect.height=Math.round(this.rect.width/i):(this.rect.height=Math.round(t.y-e.y),this.rect.height<2&&(this.rect.height=2)))},this.position=(e,t)=>{this.rect&&(void 0!==e&&(this.rect.x=e),void 0!==t&&(this.rect.y=t),this.bect&&(this.bect.x=this.rect.x-(this.bect.width-this.rect.width)/2,this.bect.y=this.rect.y-(this.bect.height-this.rect.height)/2))},this.scale=(e,t)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.rect.height=Math.round(this.rect.height*t),this.rect.width<0&&(this.rect.width=1),this.rect.height<0&&(this.rect.height=1),this.shapeSettings.outlineSize>0&&(this.shapeSettings.outlineSize=Math.round(this.shapeSettings.outlineSize*e)),this.shapeSettings.shadow&&(this.shapeSettings.shadowDistance=Math.round(100*this.shapeSettings.shadowDistance*e)/100,this.shapeSettings.shadowBlur=Math.round(100*this.shapeSettings.shadowBlur*e)/100),this.render())},this.rotate=e=>{this.rect.rotation+=e?-90:90},this.rasterize=()=>{let e=this.baked?this.baked:this.canvas,t=this.bect?this.bect.clone():this.rect.clone();const i=new l.Z(s.M8(),this.settings.name,e,t,this.settings.locked);return i.settings=Object.assign({},this.settings),i.applyTransform(),i},this.clone=(e=!1)=>{let t=new p(e?this.id:s.M8(),this.settings.name,this.rect.clone(),this.shapeSettings.clone());return t.settings=Object.assign({},this.settings),t.animation=u.Z.clone(this.animation),t.prepare(),t},this.rect=i,this.settings.name=t,this.shapeSettings=g}}},44686:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(){this.radii=0,this.outlineSize=0,this.outlineColor="#555555",this.shadow=!1,this.shadowBlur=.3,this.shadowOpacity=.8,this.shadowColor="#000000",this.shadowDistance=.3,this.shadowDirection=180}clone(){const e=Object.create(s.prototype);return Object.assign(e,this)}equalTo(e){return!!e&&(this.variant===e.variant&&this.radii===e.radii&&this.content===e.content&&this.fillType===e.fillType&&this.fillValue===e.fillValue&&this.outlineSize===e.outlineSize&&this.outlineColor===e.outlineColor&&this.shadow===e.shadow&&this.shadowBlur===e.shadowBlur&&this.shadowColor===e.shadowColor&&this.shadowOpacity===e.shadowOpacity&&this.shadowDistance===e.shadowDistance&&this.shadowDirection===e.shadowDirection)}}},66792:(e,t,i)=>{i.d(t,{Z:()=>R});var s=i(96548),n=i(93947),a=i(23770),r=i(71030),o=i(74820),h=i(75934),c=i(58027),l=i(59064),d=i(47339),u=i(92365),p=i(33655),g=i(99872),m=i(36817),v=i(43673),f=i(44170),y=i(4256),w=i(78685),x=i(51294),b=i(82282),Z=i(87108),k=i(77664),E=i(77758),P=i(44686),S=i(33506),C=i(45453),L=i(94699),T=i(84253),M=i(68934),A=i(70840);class I{constructor(e,t){this.zoom=1,this.zoomMode="fit",this.anchor=new v.Z(0,0),this.fresco=e,this.history=new C.N(e,t)}}class R{constructor(e){this.tabLimit=10,this.showTabs=!1,this.bounds=20,this.isHDPI=!1,this.canTouch=!1,this.syncDisabled=!1,this.supressRender=!1,this.zoom=1,this.zoomMode="fit",this.doSync=e=>{e instanceof CustomEvent&&this.syncDocument(e.detail)},this.doRender=e=>{e instanceof CustomEvent&&(this.supressRender=!1===e.detail)},this.touch=()=>{document.documentElement.classList.add("touch"),document.removeEventListener("touchstart",this.touch,!1),this.canTouch=!0},this.notify=e=>{document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)(e)}))},this.syncQueue=0,this.browseFrameImage=async()=>{await h.Q0(!1,!0).then((async e=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let t=0;t<e.length;t++)await h.ZB(this,e[t],!1,"frame");document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}))},this.setFrameContent=e=>{var t;const i=this.fresco.getSelected();let s,n;i.canvas&&(s=p.dN(i.canvas),n=null===(t=i.trim)||void 0===t?void 0:t.clone()),i.setContent(e),i.editMode=!1;const a=s?e?"replace":"delete":"add";this.history.add({type:"frameContent",kind:a,layer:i,canvas:s,trim:n}),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render"))},this.fitFrameContent=()=>{var e;const t=this.fresco.getSelected();if(t instanceof x.Z){let i=null===(e=t.trim)||void 0===e?void 0:e.clone();t.fitContent(),this.history.add({type:"arrange",layer:t,kind:"fitContent",action:{type:"trim",rect:i}})}document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render"))},this.addLayer=e=>{for(let t=0;t<e.length;t++)this.fresco.addLayer(e[t]),this.history.add({type:"addLayer",kind:"add"+e[t].type,layer:e[t]});this.fresco.selectLayerStack(e)},this.addCopiedLayer=async e=>{let t,i=new Array,n=new m.Z(0,0,this.fresco.width,this.fresco.height),a=this.fresco.getStackBounds(e);n.contains(a)||(t=new v.Z(Math.round((n.width-a.width)/2),Math.round((n.height-a.height)/2)));for(let r=0;r<e.length;r++){let n=e[r].clone();-1===n.settings.name.indexOf((0,s.Z)("copy"))&&(n.settings.name+=" "+(0,s.Z)("copy")),n.settings.link="",t&&(n.rect.x=n.rect.x-a.x+t.x,n.rect.y=n.rect.y-a.y+t.y),n instanceof Z.Z||n instanceof w.Z||n instanceof x.Z?await n.prepare():n.render(),this.fresco.addLayer(n),this.history.add({type:"addLayer",kind:"paste"+n.type,layer:n}),i.push(n)}this.fresco.selectLayerStack(i),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.duplicateLayer=async(e=!0)=>{let t=this.fresco.getSelectedStack();if(0===t.length)return;let i=new Array;for(let n=0;n<t.length;n++){let e=t[n].clone();-1===e.settings.name.indexOf((0,s.Z)("copy"))&&(e.settings.name+=" "+(0,s.Z)("copy")),e.settings.link="",e instanceof Z.Z||e instanceof w.Z||e instanceof x.Z?await e.prepare():e.render(),this.fresco.addLayer(e),this.history.add({type:"addLayer",kind:"duplicate"+e.type,layer:e}),i.push(e)}this.fresco.selectLayerStack(i),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),e&&this.notify("duplicated")},this.deleteLayer=(e=!1)=>{let t=this.fresco.getSelectedStack();if(0!==t.length){if(1===t.length&&t[0]instanceof x.Z&&(e||t[0].editMode))this.setFrameContent(void 0);else{this.fresco.getStackId().forEach((e=>{const t=this.fresco.layerNr(e),i=this.fresco.deleteLayerById(e);this.history.add({type:"deleteLayer",layer:i,index:t})})),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))}this.notify("deleted")}},this.linkLayer=()=>{let e=this.fresco.getSelectedStack();if(0===e.length||1===e.length&&!e[0].hasLink())return;let t="add";const i=new Array,s=p.Zd(),n=e.filter((e=>!e.hasLink()));if(n.length===e.length)e.forEach((e=>{var t;i.push({layer:e,link:null!==(t=e.settings.link)&&void 0!==t?t:""}),e.settings.link=s}));else if(0===n.length){t="remove";const s=new Set;e.forEach((e=>{var t;s.add(e.settings.link),i.push({layer:e,link:null!==(t=e.settings.link)&&void 0!==t?t:""}),e.settings.link=""})),s.forEach((e=>{var t;const s=this.fresco.layers.filter((t=>t.settings.link===e));1===s.length&&(i.push({layer:s[0],link:null!==(t=s[0].settings.link)&&void 0!==t?t:""}),s[0].settings.link="")}))}else{const t=new Set;if(e.forEach((e=>{t.add(e.settings.link)})),1===t.entries.length){let e=[...t][0];n.forEach((t=>{var s;i.push({layer:t,link:null!==(s=t.settings.link)&&void 0!==s?s:""}),t.settings.link=e}))}else e.forEach((e=>{var t;i.push({layer:e,link:null!==(t=e.settings.link)&&void 0!==t?t:""}),e.settings.link=s})),t.forEach((e=>{var t;const s=this.fresco.layers.filter((t=>t.settings.link===e));1===s.length&&(i.push({layer:s[0],link:null!==(t=s[0].settings.link)&&void 0!==t?t:""}),s[0].settings.link="")}))}i.length>0&&this.history.add({type:"link",kind:t,stack:i}),this.fresco.updateSelectedLinkedStack(),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectLayer=(e,t=!1,i=!1,s=!1)=>{this.selectLayerById(e?e.id:void 0,t,i,s)},this.selectLayerStack=(e,t=!1,i=!1)=>{this.fresco.selectLayerStack(e,t),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectLayerById=(e,t=!1,i=!1,s=!1)=>{this.fresco.selectLayerById(e,t,i)&&(document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),s&&document.dispatchEvent(new CustomEvent("layer-marked")))},this.unselectLayerById=e=>{this.fresco.unselectLayerById(e)&&(document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")))},this.isSelectedLayerShaderble=()=>{var e;const t=null===(e=this.fresco)||void 0===e?void 0:e.getSelected();return t&&(t.type===f.Z.TYPE_IMAGE||t.type===f.Z.TYPE_FRAME||t.type===f.Z.TYPE_ELEMENT)&&!!t.canvas},this.mergeDown=()=>{if(!this.fresco.getSelected())return;const e=this.fresco.getSelected(),t=this.fresco.layers.findIndex((t=>e.id===t.id)),i=this.fresco.layers.map((e=>e.id));if(t<1)return void this.notify("noMerger");const s=this.fresco.layers[t-1],n=e.rect?e.rect.getRotatedBounds():void 0,a=s.rect?s.rect.getRotatedBounds():void 0,r=n?n.union(a):a;let o;if(r){o=p.vL(r.width,r.height);const t=o.getContext("2d");this.renderLayer(t,s,!1,r.topLeft()),this.renderLayer(t,e,!1,r.topLeft())}const h=new b.Z(p.M8(),e.settings.name,o,r,s.settings.locked),c=this.fresco.layers.splice(t-1,2,h);this.fresco.selectLayerById(h.id),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"down",layers:c,order:i,target:h}),this.notify("layersMerged")},this.mergeVisible=()=>{const e=this.fresco.layers.findIndex((e=>e.settings.visible)),t=this.fresco.layers.map((e=>e.id));if(e<0)return void this.notify("noMerge");const i=this.fresco.layers[e];let s=this.getOutputCanvas();const n=new b.Z(p.M8(),i.settings.name,s,new m.Z(0,0,s.width,s.height),!0),a=this.fresco.layers.filter((e=>e.settings.visible));this.fresco.layers=this.fresco.layers.filter((e=>!e.settings.visible)),this.fresco.layers.splice(e,0,n),this.fresco.selectLayerById(n.id),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"visible",order:t,layers:a,target:n}),this.notify("layersMerged")},this.mergeFlatten=()=>{let e=this.getOutputCanvas();const t=new b.Z(p.M8(),(0,s.Z)("background"),e,new m.Z(0,0,e.width,e.height),!0),i=this.fresco.layers.slice(),n=this.fresco.layers.map((e=>e.id));this.fresco.layers=[t],this.fresco.selectLayerById(t.id),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"flatten",layers:i,order:n,target:t}),this.notify("imageFlattend")},this.moveUp=()=>{if(this.fresco.getSelected()){let e=this.fresco.selectedLayerNr(),t=e+1;(0!=e||!this.fresco.lockedBackground())&&t<this.fresco.numLayers()&&this.changeOrder(e,t)}},this.moveDown=()=>{if(this.fresco.getSelected()){let e=this.fresco.selectedLayerNr(),t=e-1;(t>0||!this.fresco.lockedBackground()&&1==e)&&this.changeOrder(e,t)}},this.changeOrder=(e,t)=>{this.fresco.changeLayerOrder(e,t),this.render(),this.history.add({type:"order",from:e,to:t})},this.changeVisible=(e,t)=>{if(!e)return;const i=Object.assign({},e.settings);e.settings.visible=t,this.history.add({type:"layerSettings",kind:"visible",layer:e,settings:i}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLocked=(e,t)=>{if(e||(e=this.fresco.getSelected()),!e)return;const i=Object.assign({},e.settings);e.settings.locked=t,this.history.add({type:"layerSettings",kind:"locked",layer:e,settings:i}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.changeCollapsed=e=>{const t=e.groupSettings.clone();e.groupSettings.collapsed=!e.groupSettings.collapsed,this.history.add({type:"groupSettings",kind:"collapse",layer:e,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.unblock=()=>{var e;this.fresco.unblock(),null===(e=(0,n.ZP)("premium-unlock-message"))||void 0===e||e.remove(),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.rasterize=()=>{let e=this.fresco.getSelectedStack();if(0===e.length)return;let t=new Array;for(let i=0;i<e.length;i++){let s=e[i];if(s instanceof b.Z||s instanceof x.Z&&!s.canvas){t.push(s);continue}const n=this.fresco.layers.findIndex((e=>e.id===s.id)),a=s.rasterize();this.fresco.layers.splice(n,1,a),this.history.add({type:"rasterize",kind:s.type,newId:a.id,layer:s}),t.push(a)}t.length>0?(this.fresco.selectLayerStack(t),this.notify("layerRasterized")):this.notify("noRasterization"),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.cutLayer=()=>{let e=this.fresco.getSelectedStack();if(e.length>0){let t=new Array;e.forEach((e=>{t.push(e.clone())})),this.clipboard=t,this.clipboardSize=this.fresco.getStackBounds(t).size(),this.deleteLayer(),this.notify("cut")}},this.copyLayer=()=>{let e=this.fresco.getSelectedStack();if(e.length>0){let t=new Array;e.forEach((e=>{t.push(e.clone())})),this.clipboard=t,this.clipboardSize=this.fresco.getStackBounds(t).size(),this.notify("copy")}},this.pasteLayer=()=>{Array.isArray(this.clipboard)?(this.addCopiedLayer(this.clipboard),this.notify("paste")):document.dispatchEvent(new CustomEvent("viewport-render"))},this.pasteFromSelection=()=>{if(this.fresco.hasSelection()){let e=this.copy();e instanceof HTMLCanvasElement?(this.addImage(p.dN(e),(this.fresco,this.fresco.nextAddedLayerNumber()),"paste"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("paste")})),this.selectionDeselect()):this.notify("selectionEmpty")}else this.notify("selectionEmpty")},this.cut=()=>{if(!this.fresco.hasSelection())return void this.cutLayer();let e=this.copy();return e?(this.clear("cut"),this.selectionDeselect(),e):void 0},this.copy=()=>{if(!this.fresco)return;if(!this.fresco.hasSelection()&&this.fresco.hasSelected())return void this.copyLayer();const e=this.fresco.getSelected();if(!e||!e.rect||!e.rect.isSet())return void this.notify("selectionEmpty");let t=this.fresco.selection.bounds.intersect(e.rect);if(t){let i=p.vL(t.width,t.height),s=i.getContext("2d");s.drawImage(e.baked?e.baked:e.canvas,e.rect.x-t.x,e.rect.y-t.y);const n=new v.Z(-t.x,-t.y);return s.save(),s.globalCompositeOperation="destination-in",s.drawImage(this.fresco.selection.mask,n.x,n.y),s.restore(),s=void 0,i}this.notify("selectionEmpty")},this.clear=(e="clear")=>{if(!this.fresco||!this.fresco.hasSelection())return!1;if(!this.fresco.isSelectedImageWithCanvas())return this.notify("notAImageLayer"),!1;const t=this.fresco.getSelected();let i=this.fresco.selection.bounds.intersect(t.rect);if(!i)return void this.notify("selectionEmpty");i=i.rebase(t.rect.x,t.rect.y);const s=p.$E(t.canvas,i),n=t.rect.clone();let a=t.canvas.getContext("2d");return a.save(),a.globalCompositeOperation="destination-out",a.drawImage(this.fresco.selection.mask,-t.rect.x,-t.rect.y),a.restore(),a=void 0,t.shrinkWrap(),t.render(),t.rect&&(i=i.rebase(t.rect.x-n.x,t.rect.y-n.y)),this.history.add({type:"bitmapChange",kind:e,layer:t,patchRect:i,rect:n,patch:s}),this.render(),!0},this.primeCut=(e=!0)=>{if(!this.fresco||!this.fresco.hasSelection())return[void 0,void 0];const t=this.fresco.getSelected();if(!t||!t.rect)return this.notify("noLayerSelected"),[void 0,void 0];const i=this.fresco.selection.bounds.intersect(t.rect);if(i){let s=p.vL(i.width,i.height),n=s.getContext("2d");return n.drawImage(t.canvas,t.rect.x-i.x,t.rect.y-i.y),n.save(),n.globalCompositeOperation="destination-in",n.drawImage(this.fresco.selection.mask,-i.x,-i.y),n.restore(),n=void 0,e&&(n=t.canvas.getContext("2d"),n.save(),n.globalCompositeOperation="destination-out",n.drawImage(this.fresco.selection.mask,-t.rect.x,-t.rect.y),n.restore(),n=void 0,t.render()),[s,i]}return this.notify("selectionEmpty"),[void 0,void 0]},this.selectionSave=()=>{this.fresco&&this.fresco.selection&&((0,n.ZP)("selection-restore").classList.remove("disabled"),this.selection=p.dN(this.fresco.selection.mask),this.notify("selectionSaved"))},this.selectionRestore=()=>{var e,t;this.selection&&(this.history.add({type:"selectionChange",kind:"restore",selection:p.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.addSelection(),this.fresco.selection.drawOnMask(this.selection,0,!1,!1),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionAll=()=>{var e,t;this.fresco&&(this.history.add({type:"selectionChange",kind:"all",selection:p.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.addSelection(),this.fresco.selection.selectAll(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionDeselect=()=>{var e,t;this.fresco&&this.fresco.selection&&(this.history.add({type:"selectionChange",kind:"deselect",selection:p.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.removeSelection(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionInvert=()=>{var e,t;this.fresco&&this.fresco.hasSelection()&&(this.history.add({type:"selectionChange",kind:"invert",selection:p.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.selection.invert(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionPixels=()=>{var e,t;const i=this.fresco.getSelected();if(!i||!i.canvas)return;this.history.add({type:"selectionChange",kind:"pixels",selection:p.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.addSelection(),this.fresco.clearSelection();let s=new y.Z;s.addShader("alpha-mask",1);const n=s.apply(i.canvas);console.log(n),console.log(this.fresco.selection),this.fresco.selection.drawOnMask(n,0,!1,!1,i.rect.topLeft()),s.cleanUp(),s=void 0,document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.selectionSubject=async()=>{var e,t;const i=this.fresco.getSelected();if(!i||!i.canvas)return;document.dispatchEvent(new CustomEvent("loading",{detail:"start"})),this.history.add({type:"selectionChange",kind:"subject",selection:p.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.addSelection(),this.fresco.clearSelection();const s=await(0,u.J)(i.canvas),n=new y.Z;n.addShader("alpha-shift-mask",!0);const a=n.apply(p.qT(s,1080)),r=p.vL(i.canvas.width,i.canvas.height);r.getContext("2d").drawImage(a,0,0,r.width,r.height),this.fresco.selection.drawOnMask(r,0,!1,!1,i.rect.topLeft()),n.cleanUp(),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.selectionConvert=()=>{if(!this.fresco.isSelectedImageWithCanvas())return;if(!this.fresco.hasSelection())return;const e=this.fresco.getSelected(),t=p.dN(this.fresco.selection.mask);e.addMask(),e.mask.getContext("2d").drawImage(this.fresco.selection.mask,-e.rect.x,-e.rect.y),this.fresco.removeSelection(),this.history.add({type:"convertSelectionToMask",layer:e,selection:t}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.maskAdd=()=>{if(!this.fresco.isSelectedImageWithCanvas())return;const e=this.fresco.getSelected();this.history.add({type:"mask",layer:e,rect:e.rect.clone()}),e.addMask(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.maskApply=()=>{if(!this.fresco.isSelectedImageWithCanvas())return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("noCutout")}));const e=this.fresco.getSelected(),t=e.mask,i=e.canvas,n=e.rect.clone();e.render(),e.canvas=e.baked,e.removeMask(),e.shrinkWrap(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("maskApplied")})),this.history.add({type:"applyMask",layer:e,canvas:i,mask:t,rect:n})},this.maskInvert=()=>{if(!this.fresco.isSelectedImageWithCanvas())return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("noCutout")}));const e=this.fresco.getSelected();e.hasMask()?(e.invertMask(),e.render(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("invert")})),document.dispatchEvent(new CustomEvent("layer-select")),this.history.add({type:"maskInvert",layer:e})):document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("noCutout")}))},this.maskDelete=()=>{if(!this.fresco.getSelected())return;const e=this.fresco.getSelected();if(!e.hasMask())return;const t=p.$E(e.mask);e.removeMask(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("reset")})),this.history.add({type:"mask",layer:e,rect:new m.Z(0,0,t.width,t.height),patch:t})},this.maskExtract=()=>{const e=this.fresco.getSelected();if(e&&e.mask){let t=p.dN(e.canvas),i=t.getContext("2d");i.save(),i.globalCompositeOperation="destination-in",i.drawImage(e.mask,0,0),i.restore(),i=void 0;let n=p.l(e.mask),a=p.vL(n.width,n.height);i=a.getContext("2d"),i.drawImage(t,-n.x,-n.y),this.addImage(a,"Cutout","extract"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("layerCreated")}))}else document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("noCutout")}))},this.maskConvert=()=>{const e=this.fresco.getSelected();if(!e||!e.hasMask())return;const t=e.mask;this.fresco.addSelection(),this.fresco.selection.drawOnMask(e.mask,0,!1,!1,e.rect.topLeft()),e.removeMask(),this.history.add({type:"convertMaskToSelection",layer:e,mask:t}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.setZoomStep=(e,t=1)=>{this.fresco&&(1===t&&(this.zoom=Math.round(10*this.zoom)/10),this.zoom+=e?this.zoom>=5?1*t:.1*t:this.zoom>=6?-1*t:-.1*t,this.zoom=p.uZ(this.zoom,.1,50),this.zoomMode="free",this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")))},this.setFluidZoom=e=>{if(!this.fresco)return;const t=this.isHDPI?.1:.12;this.zoomMode="free",this.zoom+=e?this.zoom*t:-this.zoom*t,this.zoom=p.uZ(this.zoom,.1,50),this.zoom>.95&&this.zoom<1.05&&(this.zoom=1),this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change"))},this.resetZoom=()=>{this.setZoom(this.zoomMode)},this.setZoom=e=>{this.fresco&&("fit"===e?(this.zoomMode="fit",this.zoom=p.q7(this.fresco.width,this.fresco.height,this.raster.width-2*this.bounds,this.raster.height-2*this.bounds),this.anchor.x=Math.round(this.fresco.width/2),this.anchor.y=Math.round(this.fresco.height/2)):"fill"===e?(this.zoomMode="fill",this.zoom=p.UF(this.fresco.width,this.fresco.height,this.raster.width,this.raster.height),this.anchor.x=Math.round(this.fresco.width/2),this.anchor.y=Math.round(this.fresco.height/2)):"free"!==e&&(this.zoomMode="free",this.zoom=Number.parseFloat(e),this.zoom=p.uZ(this.zoom,.1,50)),this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")))},this.setAnchor=e=>{e.equalTo(this.anchor)||(this.anchor.x=p.uZ(e.x,0,this.fresco.width),this.anchor.y=p.uZ(e.y,0,this.fresco.height))},this.resetAnchor=()=>{this.setAnchor(this.getViewPortCenter())},this.resize=(e,t,i,s)=>{this.raster.height=this.isHDPI?2*s:s,this.raster.width=this.isHDPI?2*i:i,this.raster.style.left=e+"px",this.raster.style.top=t+"px",this.raster.style.width=i+"px",this.raster.style.height=s+"px";let n=this.raster.getBoundingClientRect();this.rasterRect=new m.Z(n.x,n.y,n.width,n.height),this.setZoom(this.zoomMode)},this.updateViewport=()=>{if(this.fresco){if(this.fresco.width*this.zoom<this.raster.width)this.canvas.width!==~~(this.fresco.width*this.zoom)&&(this.canvas.width=~~(this.fresco.width*this.zoom)),this.isHDPI?(this.canvas.style.left=~~(.25*(this.raster.width-this.canvas.width)+this.raster.offsetLeft)+"px",this.offset.x=2*(this.canvas.offsetLeft-this.raster.offsetLeft)):(this.canvas.style.left=~~(.5*(this.raster.width-this.canvas.width)+this.raster.offsetLeft)+"px",this.offset.x=this.canvas.offsetLeft-this.raster.offsetLeft);else{this.canvas.style.left=this.raster.style.left,this.canvas.width=this.raster.width;let e=this.anchor.x*this.zoom-this.canvas.width/2,t=this.fresco.width*this.zoom-this.canvas.width;if(this.offset.x=-p.uZ(~~e,0,~~t),e<0){let t=p.uZ(-1*e,0,250);this.offset.x+=t,this.canvas.style.left=this.raster.offsetLeft+t+"px",this.canvas.width=this.raster.width-t}if(e>t){let i=p.uZ(e-t,0,250);this.canvas.width=this.raster.width-i,this.offset.x-=i}}if(this.fresco.height*this.zoom<this.raster.height)this.canvas.height!==~~(this.fresco.height*this.zoom)&&(this.canvas.height=~~(this.fresco.height*this.zoom)),this.isHDPI?(this.canvas.style.top=~~(.25*(this.raster.height-this.canvas.height)+this.raster.offsetTop)+"px",this.offset.y=2*(this.canvas.offsetTop-this.raster.offsetTop)):(this.canvas.style.top=~~(.5*(this.raster.height-this.canvas.height)+this.raster.offsetTop)+"px",this.offset.y=this.canvas.offsetTop-this.raster.offsetTop);else{this.canvas.style.top=this.raster.style.top,this.canvas.height=this.raster.height;let e=this.anchor.y*this.zoom-this.canvas.height/2,t=this.fresco.height*this.zoom-this.canvas.height;if(this.offset.y=-p.uZ(~~e,0,~~t),e<0){let t=p.uZ(-1*e,0,250);this.offset.y+=t,this.canvas.style.top=this.raster.offsetTop+t+"px",this.canvas.height=this.raster.height-t}if(e>t){let i=p.uZ(e-t,0,250);this.canvas.height=this.raster.height-i,this.offset.y-=i}}this.isHDPI&&(this.canvas.style.width=~~(.5*this.canvas.width)+"px",this.canvas.style.height=~~(.5*this.canvas.height)+"px"),this.supressRender||document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("viewport-update"))}},this.getViewPort=()=>new m.Z(this.offset.x>0?0:-1*~~(this.offset.x/this.zoom),this.offset.y>0?0:-1*~~(this.offset.y/this.zoom),Math.ceil(this.canvas.width/this.zoom),Math.ceil(this.canvas.height/this.zoom)),this.getViewPortCenter=()=>{let e=new v.Z;return e.x=(this.offset.x>0?-this.offset.x/this.zoom:this.offset.x/this.zoom*-1)+this.raster.width/this.zoom/2,e.y=(this.offset.y>0?-this.offset.y/this.zoom:this.offset.y/this.zoom*-1)+this.raster.height/this.zoom/2,e},this.getLayerLocationRect=e=>{if(!e.rect)return;const t=this.isHDPI?.5*this.zoom:this.zoom;return new m.Z(Math.round(e.rect.x*t+this.offset.x),Math.round(e.rect.y*t+this.offset.y),Math.round(e.rect.width*t),Math.round(e.rect.height*t),e.rect.rotation)},this.getLayerLocationTrim=e=>{if(!e.trim)return;const t=this.isHDPI?.5*this.zoom:this.zoom;let i=e.getGlobalTrim();return new m.Z(Math.round(i.x*t+this.offset.x),Math.round(i.y*t+this.offset.y),Math.round(i.width*t),Math.round(i.height*t),i.rotation)},this.isAnimating=!1,this.animationId=0,this.playAnimation=(e=24,t=new Array)=>{if(this.isAnimating)return;this.animators=t,0===this.animators.length&&(this.animators=d.Z.bakeAnimators(this.fresco));let i=0;for(const s of this.animators)i=Math.max(i,s.getDuration()),s.prepare(new g.Z(this.fresco.width,this.fresco.height));if(i>0){this.coating.hide(),this.isAnimating=!0,document.dispatchEvent(new CustomEvent("animation-play",{detail:i}));let t=0,s=performance.now(),n=performance.now();const a=1e3/e,r=Math.ceil((i+50)/1e3)*e,o=()=>{const e=performance.now(),i=e-s;i>a&&(t++,s=e-i%a,this.stepAnimation(s-n)),t>r?this.finnishAnimation():this.animationId=window.requestAnimationFrame(o)};o()}},this.stepAnimation=e=>{if(!this.animators)return;const t=new g.Z(this.fresco.width,this.fresco.height);for(const i of this.animators)i.step(e,t);document.dispatchEvent(new CustomEvent("animation-step",{detail:e})),this.render()},this.stopAnimation=()=>{window.cancelAnimationFrame(this.animationId),this.finnishAnimation()},this.finnishAnimation=()=>{if(this.isAnimating){if(this.animators)for(const e of this.animators)e.finish();this.isAnimating=!1,this.coating.show(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("animation-stop"))}},this.render=()=>{if(!this.supressRender&&this.ctx&&this.fresco){if(this.fresco.color?(this.ctx.fillStyle=this.fresco.color,this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.translate(this.offset.x<0?this.offset.x:0,this.offset.y<0?this.offset.y:0),this.ctx.scale(this.zoom,this.zoom),this.isAnimating)for(var e=0;e<this.fresco.layers.length;e++){const t=this.fresco.layers[e];t.settings.visible&&(t.transform?this.renderTransformedLayer(this.ctx,t):this.renderLayer(this.ctx,t,!1))}else for(let e=0;e<this.fresco.layers.length;e++){const t=this.fresco.layers[e];t.settings.visible&&(this.fresco.hasScratch()&&this.fresco.scratch.id===t.id?("over"===this.fresco.scratch.renderMode&&this.renderLayer(this.ctx,t,this.zoom<1),this.renderLayer(this.ctx,this.fresco.scratch,this.zoom<1)):this.renderLayer(this.ctx,t,this.zoom<1))}if(this.ctx.setTransform(1,0,0,1,0,0),this.fresco.block){this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over";let e=this.canvas.width<this.canvas.height?this.canvas.height:this.canvas.width;this.ctx.drawImage(this.premiumGrid,0,this.canvas.height-e,e,e)}}},this.renderOutputFrame=(e,t,i=!1)=>{e.clearRect(0,0,e.canvas.width,e.canvas.height),i||(e.fillStyle=this.fresco.color?this.fresco.color:"#000000",e.fillRect(0,0,e.canvas.width,e.canvas.height)),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";for(var s=0;s<this.fresco.layers.length;s++){const i=this.fresco.layers[s];(t||i.settings.visible)&&(i.transform?this.renderTransformedLayer(e,i):this.renderLayer(e,i,!1))}e.setTransform(1,0,0,1,0,0)},this.renderTransformedLayer=(e,t)=>{var i,s,n,a,r;if((t.canvas||t.baked)&&t.rect){e.globalAlpha=t.settings.opacity*(null!==(i=t.transform.opacity)&&void 0!==i?i:1),e.globalCompositeOperation=""===t.settings.blendmode?"source-over":t.settings.blendmode;try{const i=t.bect?t.bect:t.rect,o=t.transient?t.transient:t.baked?t.baked:t.canvas;e.save(),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";let h=i.x+.5*i.width+(null!==(n=null===(s=t.transform.offset)||void 0===s?void 0:s.x)&&void 0!==n?n:0),c=i.y+.5*i.height+(null!==(r=null===(a=t.transform.offset)||void 0===a?void 0:a.y)&&void 0!==r?r:0);e.translate(h,c),h=-.5*i.width,c=-.5*i.height,t.rect.rotation&&e.rotate(t.rect.rotation*Math.PI/180),t.transform.rotation&&(e.translate(i.width*(t.transform.rAnchor.x-.5),i.height*(t.transform.rAnchor.y-.5)),e.rotate(t.transform.rotation*Math.PI/180),h=-i.width*t.transform.rAnchor.x,c=-i.height*t.transform.rAnchor.y),!t.transform.scale||1===t.transform.scale.x&&1===t.transform.scale.y||(e.translate(i.width*(t.transform.sAnchor.x-.5),i.height*(t.transform.sAnchor.y-.5)),e.scale(t.transform.scale.x,t.transform.scale.y),h=-i.width*t.transform.sAnchor.x,c=-i.height*t.transform.sAnchor.y),e.drawImage(o,h,c,i.width,i.height),e.restore()}catch(o){console.log(o)}}},this.renderLayer=(e,t,i,s)=>{if((t.canvas||t.baked)&&t.rect){e.imageSmoothingQuality="high",e.globalAlpha=t.settings.opacity,e.imageSmoothingEnabled=i||0!==t.rect.rotation,e.globalCompositeOperation=""===t.settings.blendmode?"source-over":t.settings.blendmode;try{const i=t.bect?t.bect:t.rect,n=t.transient?t.transient:t.baked?t.baked:t.canvas;t.rect.rotation?(this.ix=i.x+.5*i.width,this.iy=i.y+.5*i.height,s&&(this.ix-=s.x,this.iy-=s.y),e.save(),e.translate(this.ix,this.iy),e.rotate(t.rect.rotation*Math.PI/180),e.drawImage(n,-.5*i.width,-.5*i.height,i.width,i.height),e.restore()):(this.ix=i.x,this.iy=i.y,s&&(this.ix-=s.x,this.iy-=s.y),e.drawImage(n,this.ix,this.iy,i.width,i.height))}catch(n){console.log(n)}}},this.renderPreview=e=>{this.ctx&&e&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(e,0,0,this.canvas.width,this.canvas.height))},this.getThumbnail=()=>{if(this.canvas)return this.getOutputCanvas(this.fresco,p.UF(this.fresco.width,this.fresco.height,200,180))},this.getSingleLayerOutputCanvas=()=>{const e=this.fresco.getSelected();if(!e||!e.canvas)return;let t=p.vL(this.fresco.width,this.fresco.height),i=t.getContext("2d");return this.renderLayer(i,e,!1),i=null,t},this.getOutputCanvas=(e=this.fresco,t=1,i)=>{t>1&&(t=1);let s=p.vL(Math.round(e.width*t),Math.round(e.height*t)),n=s.getContext("2d");(e.color||i)&&(n.fillStyle=e.color?e.color:i,n.fillRect(0,0,s.width,s.height)),n.scale(t,t);for(var a=0;a<e.layers.length;a++){const i=e.layers[a];i.settings.visible&&this.renderLayer(n,i,t<1)}return n=null,s},this.translateToRect=(e,t,i,s)=>{if(i){const i=e.x-t.x,s=e.y-t.y;let n=Math.sqrt(i*i+s*s)/Math.sqrt(2);t.x=e.x+(i>0?-n:n),t.y=e.y+(s>0?-n:n)}let n=e.x<t.x?e.x:t.x,a=e.y<t.y?e.y:t.y,r=e.x<t.x?t.x:e.x,o=e.y<t.y?t.y:e.y;return e=this.translateRasterToFresco(new v.Z(n,a),void 0,!0),(t=this.translateRasterToFresco(new v.Z(r,o),void 0,!1)).x=Math.ceil(t.x),t.y=Math.ceil(t.y),s&&(e=this.translateFrescoToRaster(e),t=this.translateFrescoToRaster(t)),new m.Z(e.x,e.y,t.x-e.x,t.y-e.y)},this.translateRasterToFresco=(e,t=void 0,i=!0)=>{const s=this.isHDPI?.5*this.zoom:this.zoom;let n=e.x/s-this.offset.x/this.zoom,a=e.y/s-this.offset.y/this.zoom;return t&&(n-=t.x,a-=t.y),i?new v.Z(Math.floor(n),Math.floor(a)):new v.Z(n,a)},this.translateFrescoToRaster=(e,t)=>{let i=e.x,s=e.y;const n=this.isHDPI?.5*this.zoom:this.zoom;return t&&(i+=t.x,s+=t.y),i=Math.round(i*n)+this.offset.x,s=Math.round(s*n)+this.offset.y,new v.Z(i,s)},this.togglePremiumMessage=()=>{var e;null===(e=(0,n.ZP)("premium-unlock-message"))||void 0===e||e.remove(),this.fresco.block&&this.fresco.templateMeta&&(0,n.ZP)("workspace").appendChild((0,n.T)("div",{id:"premium-unlock-message",onclick:()=>new A.Z(this)},(0,s.Z)("unlockPremiumMessage"),(0,n.T)("img",{className:"close",src:"/img/icon/close.svg",width:14,height:14,onclick:e=>(e.preventDefault(),e.stopImmediatePropagation(),(0,n.ZP)("premium-unlock-message").remove(),!1)})))},this.layerDragMove=()=>{this.layerDrag.fresco!==this.fresco.id&&this.coating.drawDropPreviewRect(this.layerDrag.position,this.layerDrag.layer)},this.layerDragDrop=()=>{const e=this.layerDrag;if(e.fresco===this.fresco.id)return;const t=this.layerDrag.layer.clone(),i=new v.Z(e.position.x-this.rasterRect.x,e.position.y-this.rasterRect.y),s=this.translateRasterToFresco(i);t.rect.x=s.x-e.layer.rect.width/2,t.rect.y=s.y-e.layer.rect.height/2,t.settings.link="",this.fresco.addLayer(t),this.coating.clear(),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"duplicate"+t.type,layer:t})},this.closeAll=()=>{this.tabs=[],this.history=null,this.fresco=null,this.showTabs=!1,this.coating.clear(),this.render(),document.dispatchEvent(new CustomEvent("tool-apply")),document.dispatchEvent(new CustomEvent("layer-list-render"))},this.close=e=>{this.stopAnimation(),void 0===e&&this.fresco&&(e=this.fresco.id);const t=this.tabs.findIndex((t=>t.fresco.id===e)),i=this.fresco&&this.fresco.id===e;if(!(t<0)){if(this.tabs.splice(t,1),0===this.tabs.length)return this.history=null,this.fresco=null,this.showTabs=!1,this.coating.clear(),this.render(),document.dispatchEvent(new CustomEvent("tool-apply")),void document.dispatchEvent(new CustomEvent("layer-list-render"));if(i){const e=Math.min(t,this.tabs.length-1);this.select(this.tabs[e].fresco.id)}else document.dispatchEvent(new CustomEvent("fresco-select"))}},this.cleanUp=()=>{document.removeEventListener("viewport-render",this.render,!1),document.removeEventListener("sync-document",this.doSync,!1),document.removeEventListener("layer-drag-move",this.layerDragMove,!1),document.removeEventListener("layer-drag-drop",this.layerDragDrop,!1),document.removeEventListener("render-enabled",this.doRender,!1),document.removeEventListener("reset-viewport",this.resetZoom,!1),document.removeEventListener("unblock-viewport",this.unblock,!1),document.removeEventListener("touchstart",this.touch,!1)},this.workspace=e,this.tabs=[],document.addEventListener("touchstart",this.touch,!1);this.isHDPI="m"===o.ZP.product&&matchMedia("(-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2), (min-resolution: 192dpi)").matches,this.canvas=this.workspace.querySelector(".canvas"),this.canvas||(this.canvas=(0,n.T)("canvas",{className:"canvas"}),e.appendChild(this.canvas)),this.canvas.width=this.canvas.height=0,this.ctx=this.canvas.getContext("2d"),this.raster=this.workspace.querySelector(".raster"),this.raster||(this.raster=(0,n.T)("canvas",{className:"raster"}),e.appendChild(this.raster)),this.anchor=new v.Z(0,0),this.offset=new v.Z(0,0),this.coating=new l.Z(this),document.addEventListener("viewport-render",this.render,!1),document.addEventListener("sync-document",this.doSync,!1),document.addEventListener("layer-drag-move",this.layerDragMove,!1),document.addEventListener("layer-drag-drop",this.layerDragDrop,!1),document.addEventListener("render-enabled",this.doRender,!1),document.addEventListener("reset-viewport",this.resetZoom,!1),document.addEventListener("unblock-viewport",this.unblock,!1),"premium"!==(null===S.a||void 0===S.a?void 0:S.a.subscriptionAccess)&&(this.premiumGrid=(0,n.T)("img",{src:"/img/misc/premium-grid.svg"}))}async syncDocument(e){var t,i,s;if(!(!e||this.syncQueue>0||this.syncDisabled)&&(!e.templateMeta||this.history.hasChanges()))try{this.syncQueue++;let n,r=new Date;e.id===(null===(t=this.fresco)||void 0===t?void 0:t.id)&&(n=await p._c(this.getThumbnail()));const o=e.layers.map((e=>e.id)),h=await p._c(null===(i=null==e?void 0:e.selection)||void 0===i?void 0:i.mask),c=await(0,a.X3)(),[l,d,u,g]=c.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta");let m=p.mS(L.q,await l.get(e.id));m||(m=new L.q(e.id,e.name,e.width,e.height,e.color,e.templateMeta,e.animation)),m.lastModified=r,m.width=e.width,m.color=e.color,m.height=e.height,m.selected=null===(s=null==e?void 0:e.getSelected())||void 0===s?void 0:s.id,m.templateMeta=e.templateMeta,m.animation=e.animation,m.order=o;const[v]=await Promise.all([g.index("document").getAllKeys(e.id),n?d.put(n,e.id):void 0,h?u.put(h,e.id):u.delete(e.id),l.put(m)]),f=v.filter((t=>!e.layers.some((e=>e.id===t)))),y=e.layers.filter((e=>!v.includes(e.id)));await Promise.all(y.map((t=>L.F.sync(t,e)))),await Promise.all(f.map((async e=>L.F.delete(e))));const w=e.layers.filter((e=>e.syncRequested&&(!e.syncLatest||e.syncRequested>e.syncLatest)));await Promise.all(w.map((t=>L.F.sync(t,e)))),document.cookie="has-history=true; path=/; SameSite=Strict; expires=Fri, 31 Dec 9999 23:59:59 GMT"}finally{this.syncQueue--}}createNew(e,t,i,s){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),this.addTab(new c.Z(p.M8(),e,t,i,s),"create"),this.addEmpty(),this.setZoom("fit"),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}))}async openFromHistory(e,t){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),e.templateMeta&&e.templateMeta.premium&&"premium"===(null===S.a||void 0===S.a?void 0:S.a.subscriptionAccess)&&(e.templateMeta.locked=!1);const i=new c.Z(e.id,e.name,e.width,e.height,e.transparent?void 0:e.color,e.animation,e.templateMeta);this.addTab(i,"document"),this.setZoom("fit"),this.renderPreview(t),this.supressRender=!0,document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));try{await e.restore(i),i.layers.length>0&&this.selectLayer(i.layers[0])}catch(s){console.log(s)}document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),this.supressRender=!1,document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("selection-update")),document.dispatchEvent(new CustomEvent("resize")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}))}addGroup(){let e="Group "+this.fresco.nextAddedLayerNumber();const t=new M.Z;this.fresco.numSelected()>1&&(t.numberOfMembers=this.fresco.numSelected());let i=new T.Z(p.M8(),e,t);return this.fresco.addLayer(i),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"group",layer:i}),i}addEmpty(){let e="Layer "+this.fresco.nextAddedLayerNumber(),t=new b.Z(p.M8(),e);return this.fresco.addLayer(t),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"addemptyimage",layer:t}),t}addImage(e,t,i){if(document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),this.fresco||this.addTab(new c.Z(p.M8(),t,e.width,e.height,void 0,void 0,void 0,i),"image"),"frame"===i&&this.fresco.getSelected()instanceof x.Z)return void this.setFrameContent(e);const n=0===this.fresco.layers.length;let a=this.fresco.addLayer(new b.Z(p.M8(),n?(0,s.Z)("background"):t,e,new m.Z(0,0,e.width,e.height),n));if(n)this.setZoom("fit"),this.syncDocument(this.fresco);else{let e=this.getViewPort().center();a.rect.x=Math.round(e.x-a.rect.width/2),a.rect.y=Math.round(e.y-a.rect.height/2),this.history.add({type:"addLayer",kind:i+"image",layer:a})}return document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),o.ZP.tool&&(document.dispatchEvent(new CustomEvent("select-tool",{detail:o.ZP.tool})),o.ZP.tool=void 0),a}async addSVGShape(e,t,i){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}));let s=new P.Z;s.variant="svg",s.content=e;let n=new Z.Z(p.M8(),t,void 0,s);if(await n.prepare(),this.fresco||this.addTab(new c.Z(p.M8(),n.settings.name,n.rect.width,n.rect.height,void 0,void 0,void 0,i),"shape"),this.fresco.addLayer(n),1===this.fresco.layers.length)this.setZoom("fit"),this.syncDocument(this.fresco);else{let e=this.getViewPort().center();n.rect.x=Math.round(e.x-n.rect.width/2),n.rect.y=Math.round(e.y-n.rect.height/2),this.history.add({type:"addLayer",kind:i+"shape",layer:n})}return document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),o.ZP.tool&&(document.dispatchEvent(new CustomEvent("select-tool",{detail:o.ZP.tool})),o.ZP.tool=void 0),n}async addShape(e,t,i="add"){e||(e=new m.Z(Math.round(this.fresco.width/4),Math.round(this.fresco.height/4),Math.round(this.fresco.width/2),Math.round(this.fresco.height/2))),t||((t=new P.Z).variant="rectangle",t.fillType="color",t.fillValue="#444444");let n=(0,s.Z)("shape")+" "+this.fresco.nextAddedLayerNumber(),a=new Z.Z(p.M8(),n,e,t);return await a.prepare(),this.fresco.addLayer(a),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:i+"shape",layer:a}),a}addElement(e,t,i,s,n){let a;if((0,r.Z)("add-element",i),n!==k.Z.SCALE_METHOD_NONE)if((this.fresco.height>this.fresco.width&&e.height<e.width||this.fresco.width>this.fresco.height&&e.width<e.height)&&(e=p.Xj(e,90)),a=new k.Z(p.M8(),t,e,i,"overlay",s,n),n==k.Z.SCALE_METHOD_FILL){let t=m.Z.fillFit(e.width,e.height,this.fresco.width,this.fresco.height);a.calculate(new v.Z(t.x,t.y),new v.Z(t.right(),t.bottom()),0)}else a.calculate(new v.Z(0,0),new v.Z(this.fresco.width,this.fresco.height),0);else{let r=m.Z.bestFit(e.width,e.height,this.fresco.width,this.fresco.height);(e.height>this.fresco.height||e.width>this.fresco.width)&&(e=p.Ai(e,r.width,r.height)),a=new k.Z(p.M8(),t,e,i,"sticker",s,n),a.rect.x=r.x,a.rect.y=r.y}return this.fresco.addLayer(a),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"addelement",layer:a}),a}async addText(e,t,i,s="add"){if(!e||!t||!i){e="Lorem ipsum ..",(i=new E.Z("Verdana",40)).fillType="color",i.fillValue="#ffffff";let s=this.getViewPort();t=new m.Z(Math.round(s.x+(s.width-Math.round(s.width/1.2))/2),Math.round(s.y+s.height/2.5),Math.round(s.width/1.2),40)}const n=new w.Z(p.M8(),e,t,i);return await n.prepare(),this.fresco.addLayer(n),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:s+"text",layer:n}),n}addFrame(e){e||(e=new m.Z(Math.round(this.fresco.width/4),Math.round(this.fresco.height/4),Math.round(this.fresco.width/2),Math.round(this.fresco.height/2)));let t=(0,s.Z)("frame")+" "+this.fresco.nextAddedLayerNumber();const i=new x.Z(p.M8(),t,e);return this.fresco.addLayer(i),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:"addframe",layer:i}),i}crop(e){const t=new g.Z(this.fresco.width,this.fresco.height),i=new v.Z(-e.x,-e.y);this.fresco.crop(e),this.updateViewport(),this.history.add({type:"crop",offset:i,size:t})}flip(e){this.fresco.flip(e),this.render(),this.history.add({type:"flip",vertical:e})}rotate(e){this.fresco.rotate(e),this.updateViewport(),this.history.add({type:"rotate",counterClock:e})}rotateSelected(e){const t=this.fresco.getSelected();t?t.settings.locked?this.notify("layer locked"):(this.history.add({type:"rotateLayer",layer:t,counterClock:e}),t.rotate(e),document.dispatchEvent(new CustomEvent("viewport-render"))):this.notify("no layer selected")}flipSelected(e){if(!this.isSelectedLayerShaderble())return void this.notify("onlyImageLayer");const t=this.fresco.getSelected();t.settings.locked?this.notify("layerLocked"):(this.history.add({type:"flipLayer",layer:t,vertical:e}),t.flip(e),t.render(),this.render())}straighten(e){if(!this.fresco.lockedBackground())return;const t=this.fresco.layers[0].rect.rotatedSize(e);this.fresco.straighten(e,t.width,t.height),this.updateViewport()}addTab(e,t,i=!0,s=!1){s||document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}));const n=new I(e,t);this.tabs.push(n),i&&(this.fresco=n.fresco,this.history=n.history,this.setZoom("fit"),n.zoom=this.zoom,n.zoomMode=this.zoomMode,n.anchor=this.anchor,document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.dispatchHistoryStatus(),this.togglePremiumMessage()),this.tabs.length>this.tabLimit&&this.close(this.tabs[0].fresco.id),this.tabs.length>1&&(this.showTabs=!0),document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("resize"))}select(e){this.stopAnimation();const t=this.tabs.find((t=>t.fresco.id===e));if(!t)return;const i=this.tabs.find((e=>{var t;return e.fresco.id===(null===(t=this.fresco)||void 0===t?void 0:t.id)}));i&&(i.zoom=this.zoom,i.zoomMode=this.zoomMode,i.anchor=this.anchor.clone()),this.fresco=t.fresco,this.history=t.history,this.zoom=t.zoom,this.zoomMode=t.zoomMode,this.anchor=t.anchor,this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("resize")),this.history.dispatchHistoryStatus(),this.togglePremiumMessage()}}},78685:(e,t,i)=>{i.d(t,{Z:()=>u});var s=i(33655),n=i(44170),a=i(9591),r=i(36817),o=i(98776),h=i(43673),c=i(82282),l=i(77758),d=i(92396);class u extends n.Z{constructor(e=s.M8(),t,i,p){super(n.Z.TYPE_TEXT),this.id=e,this.prepare=async(e=!1)=>{this.fill&&!e||(this.fill=await a.Z.fromString(this.textSettings.fillType,this.textSettings.fillValue),document.dispatchEvent(new CustomEvent("layer-select"))),this.setText()},this.setText=(e=this.text)=>{this.text=e,this.settings.name=e.substring(0,25)+"..",this.textSettings.uppercase?this.words=this.text.replace(/[\n]/g," §§§ ").toUpperCase().split(" "):this.words=this.text.replace(/[\n]/g," §§§ ").split(" "),this.render()},this.setTextSize=e=>{this.textSettings.setSize(e),this.render()},this.setLineSpace=e=>{this.textSettings.lineSpace=e,this.render()},this.setLetterSpace=e=>{this.textSettings.letterSpace=e,this.render()},this.setTextFill=(e,t=!1)=>{this.fill=e,t||(this.textSettings.fillType=e.getType(),this.textSettings.fillValue=e.getStringValue()),this.render()},this.setTextFont=(e,t=!1)=>{this.textSettings.setFont(e),this.render(t)},this.setTextUpperCase=e=>{this.textSettings.uppercase=e,this.setText(this.text)},this.setTextItalic=e=>{this.textSettings.italic=e,this.setText(this.text)},this.setTextBold=e=>{this.textSettings.bold=e,this.setText(this.text)},this.setTextUnderline=e=>{this.textSettings.underline=e,this.setText(this.text)},this.setTextAlign=e=>{this.textSettings.align=e,this.render()},this.setCurve=(e,t,i,s,n)=>{this.textSettings.curve=e,this.textSettings.curveType=t,this.textSettings.curveAmount=i,this.textSettings.curveSpread=s,this.textSettings.curveFlip=n,this.render()},this.setWarp=(e,t,i,s,n,a,r)=>{this.textSettings.warp=e,this.textSettings.warpType=t,this.textSettings.warpMode=i,this.textSettings.warpEdgeSize=s,this.textSettings.warpCenterSize=n,this.textSettings.warpHorizontalOffset=a,this.textSettings.warpVerticalOffset=r,this.render()},this.setBackground=(e,t,i,s,n)=>{this.textSettings.background=e,this.textSettings.backgroundType=t,this.textSettings.backgroundColor=i,this.textSettings.backgroundPunch=s,this.textSettings.backgroundOffset=n,this.render()},this.setOutline=(e,t,i,s,n,a)=>{this.textSettings.outline=e,this.textSettings.outlineSize=t,this.textSettings.outlineColor=i,this.textSettings.outlinePunch=s,this.textSettings.outlineDistance=n,this.textSettings.outlineDirection=a,this.render()},this.setShadow=(e,t,i,s,n,a)=>{this.textSettings.shadow=e,this.textSettings.shadowBlur=t,this.textSettings.shadowAlpha=i,this.textSettings.shadowColor=s,this.textSettings.shadowDistance=n,this.textSettings.shadowDirection=a,this.render()},this.setTextSettings=e=>{this.textSettings=e,this.render()},this.setCanvasStyle=()=>{var e;this.ctx.textBaseline="top",this.ctx.font=this.textSettings.getCssFont(),this.ctx.strokeStyle=this.textSettings.outlineColor,this.ctx.lineWidth=Math.round(this.textSettings.outlineSize*this.textSettings.padding),this.ctx.lineJoin="miter",this.ctx.miterLimit=2,null===(e=this.fill)||void 0===e||e.addToCanvasFillStyle(this.ctx)},this.isPunchOut=!1,this.isWordBackground=!1,this.render=(e=!1)=>{this.isPunchOut=void 0===this.fill||this.textSettings.background&&this.textSettings.backgroundPunch||this.textSettings.outline&&this.textSettings.outlinePunch,this.isWordBackground=this.textSettings.background&&this.textSettings.backgroundType===l.Z.BACKGROUND_WORD;let t=this.textSettings.padding;this.canvas||(this.canvas=document.createElement("canvas")),this.ctx||(this.ctx=this.canvas.getContext("2d")),this.setCanvasStyle();const i=new h.Z;if(this.textSettings.outline&&this.textSettings.outlineDistance>0){const e=(this.textSettings.outlineDirection-90)*Math.PI/180;i.x=Math.cos(e)*this.textSettings.outlineDistance*t,i.y=Math.sin(e)*this.textSettings.outlineDistance*t}const n=this.textSettings.getLineSpacing();let a=this.textSettings.height+t+n,c=this.textSettings.background?Math.round(this.textSettings.backgroundOffset*t):0;this.textSettings.background&&this.textSettings.backgroundType!==l.Z.BACKGROUND_FULL&&(a+=2*t);let d=this.splitTextIntoLines(a);this.setCanvasSize(d.length,n),this.setCanvasStyle();let u=!1;if(this.textSettings.curve&&"arc"===this.textSettings.curveType){if(u=!0,0!==this.textSettings.curveAmount){const e=this.textSettings.getLetterSpacing();let[t,i]=this.calculateArcRadius(),s=(t-this.textSettings.height/2)*Math.PI*2;u=(this.ctx.measureText(" ").width+e)/s*Math.PI*2<5e-4}this.textSettings.curveAmount<=0&&!u&&(d=d.reverse())}for(let s=0;s<d.length;s++){if(""===d[s])continue;const e=this.lineWidth(d[s]);this.textSettings.curve&&!u?this.drawCurveLine(d[s],t+s*a,e,c,i):this.drawLine(d[s],t+s*a,e,c,i,u)}if(this.textSettings.warp){this.transient=s.dN(this.canvas),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high";let e=this.textSettings.warpMode,i="angular"===this.textSettings.warpType,n=this.textSettings.background||this.textSettings.outline?0:t,a=this.transient.width,r=this.transient.height-2*n,o=r+r*this.textSettings.warpEdgeSize,h=r+r*this.textSettings.warpCenterSize,c=a*(.5+.5*this.textSettings.warpHorizontalOffset),l=a*(1-(.5+.5*this.textSettings.warpHorizontalOffset)),d=180/(2*c),u=180/(2*l),p=0,g=r*this.textSettings.warpVerticalOffset;if("upper"===e)g<0?(this.rect.height=Math.max(Math.abs(g)+o,h),p-=g):this.rect.height=Math.max(g+h,o);else if("lower"===e)g*=-1,p=Math.max(o,h-g)-r,this.rect.height=g<=0?Math.max(Math.abs(g)+h,o):Math.max(g+o,h);else if("middle"===e){g*=.75,p=.5*(Math.max(o,h)-r);let e=.5*(o-h),t=Math.max(h,o);if(g<0){let e=.5*(o-h),t=Math.max(h,o);e+h+Math.abs(g)>t?(this.rect.height=e+h+Math.abs(g),p-=e+g,e<0&&(p+=e)):(this.rect.height=t,h>o&&(p-=g))}else e+h+g>t?(this.rect.height=e+h+g,e<0&&(p+=e)):(this.rect.height=t,h>o&&(p-=g))}for(this.rect.height+=2*n,this.canvas.width=this.rect.width,this.canvas.height=this.rect.height;a--;){let t=0;t=a>c?i?1-(a-c)/l:Math.sin((l-(a-c))*u*Math.PI/180):i?1-(c-a)/c:Math.sin(a*d*Math.PI/180);let s=(1-t)*o+h*t,m=t*g,v="upper"===e?0:"lower"===e?r-s:.5*(r-s);this.ctx.drawImage(this.transient,a,n,1,r,a,n+m+v+p,1,s)}this.transient=void 0}if(this.textSettings.shadow&&!e){this.baked||(this.baked=document.createElement("canvas"));let e=this.baked.getContext("2d");if(this.bect=new r.Z(this.rect.x-4*t,this.rect.y-4*t,this.rect.width+8*t,this.rect.height+8*t,this.rect.rotation),this.baked.width=this.bect.width,this.baked.height=this.bect.height,this.textSettings.shadow){e.save();var p=(this.textSettings.shadowDirection-90)*Math.PI/180,g=Math.cos(p)*this.textSettings.shadowDistance,m=Math.sin(p)*this.textSettings.shadowDistance;e.shadowBlur=this.textSettings.shadowBlur*this.textSettings.padding*2,e.shadowOffsetX=g*this.textSettings.padding*2,e.shadowOffsetY=m*this.textSettings.padding*2,e.shadowColor=o.Z.fromHEX(this.textSettings.shadowColor,Math.round(255*this.textSettings.shadowAlpha)).toRGBA(),e.drawImage(this.canvas,4*t,4*t),e.restore()}}else this.baked=void 0,this.bect=void 0},this.scaleBect=e=>{if(this.bect){const t=4*this.textSettings.padding*e;this.bect=new r.Z(this.rect.x-t,this.rect.y-t,this.rect.width+2*t,this.rect.height+2*t,this.rect.rotation),this.bect.width<1&&(this.bect.width=1),this.bect.height<1&&(this.bect.height=1)}},this.setCanvasSize=(e,t)=>{if(this.textSettings.background&&this.textSettings.backgroundType!==l.Z.BACKGROUND_FULL?this.rect.height=(this.textSettings.height+3*this.textSettings.padding)*e+t*(e-1)-this.textSettings.padding:this.rect.height=(this.textSettings.height+this.textSettings.padding)*e+t*(e-1)+this.textSettings.padding,this.textSettings.curve)switch(this.textSettings.curveType){case"arc":let e=this.calculateArcHeight();this.rect.height+=e;break;case"circle":this.rect.height=this.rect.width;break;case"half":this.rect.height=Math.round(this.rect.width/2)}this.canvas.width=this.rect.width,this.canvas.height=this.rect.height,this.textSettings.background&&this.textSettings.backgroundType===l.Z.BACKGROUND_FULL&&(this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))},this.splitTextIntoLines=e=>{let t="",i=new Array,s=this.textSettings.curve?this.curveMaxWidth(0,e):this.rect.width;for(var n=0;n<this.words.length;n++){let a=""!==t?t+" "+this.words[n]:this.words[n];if("§§§"===this.words[n]||this.lineWidth(a)>s&&a!==this.words[n]){if(i.push(t),t="§§§"===this.words[n]?"":this.words[n],this.textSettings.curve&&(s=this.curveMaxWidth(i.length,e),s<0))return i}else t=a}return i.push(t),i},this.lineWidth=e=>{let t=0,i=this.textSettings.getLineSpacing(),s=this.textSettings.getLetterSpacing();if(this.isWordBackground){let n=e.split(" ").filter((e=>e));for(let e=0;e<n.length;e++)t+=this.measureTextWidth(n[e],s,!0)+2*this.textSettings.padding,t+=this.textSettings.padding+i;this.textSettings.curve&&"circle"===this.textSettings.curveType||(t-=this.textSettings.padding+i)}else this.textSettings.curve&&"circle"===this.textSettings.curveType?(t=this.measureTextWidth(e,s,!1),t+=this.measureTextWidth(" ",s,!1)):(t=this.measureTextWidth(e,s,!0),t+=2*this.textSettings.padding);return t},this.curveMaxWidth=(e,t)=>{if("arc"===this.textSettings.curveType){if(0===this.textSettings.curveAmount)return this.rect.width;let[e,i]=this.calculateArcRadius();return this.textSettings.curveAmount<0&&(i+=-t/4),i}if("circle"===this.textSettings.curveType){let i=this.rect.width/2-this.textSettings.padding-e*t;return i<t?-1:i*Math.PI*2}{let i=this.rect.width/2-e*t-(this.textSettings.background?this.textSettings.padding:0);return i<t?-1:i*Math.PI}},this.calculateArcHeight=()=>Math.round(this.rect.width/5*Math.abs(this.textSettings.curveAmount)),this.calculateArcRadius=()=>{let e=this.calculateArcHeight(),t=new h.Z(0,e),i=new h.Z(this.rect.width/2,0),s=new h.Z(this.rect.width,e),n=(i.y-t.y)/(i.x-t.x),a=(s.y-i.y)/(s.x-i.x),r=-1*((n*a*(t.y-s.y)+a*(t.x+i.x)-n*(i.x+s.x))/(2*(a-n))-(t.x+i.x)/2)/n+(t.y+i.y)/2;return[r,Math.atan2(this.rect.width/2,r-e)*r*2]},this.drawHalfLine=(e,t,i,s,n)=>{var a;const r=this.textSettings.curveFlip,o=this.textSettings.curveSpread,h=this.textSettings.getLineSpacing(),c=this.textSettings.getLetterSpacing();let d=!1,u=this.rect.width/2-t,p=u*Math.PI*2;if(this.textSettings.background)if(this.textSettings.backgroundType===l.Z.BACKGROUND_LINE){let e=u-this.textSettings.height/2;e>0&&(this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.ellipse(this.rect.width/2,r?0:this.rect.width/2,e,e,0,Math.PI,0,r),this.ctx.stroke(),this.ctx.restore())}else if(this.textSettings.backgroundType===l.Z.BACKGROUND_WORD){let t=o?-p/4:-i/2,n=(p/2-i)/e.replace(/\s/g,"").length;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let a=e.split(" ").filter((e=>e));for(var g=0;g<a.length;g++){let e=this.measureTextWidth(a[g],c,!0);o&&(e+=n*a[g].length);let i=u-this.textSettings.height/2;if(i<this.textSettings.height)continue;let l=(e+2*this.textSettings.padding)/p*360*(Math.PI/180),d=t/p*360*(Math.PI/180),m=r?90:270,v=m*(Math.PI/180)+(r?-d:d),f=m*(Math.PI/180)+(r?-(l+d):l+d);if(this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,r?0:this.rect.width/2,i,v,f,r),this.ctx.stroke(),this.textSettings.underline){const n=Math.ceil(.06*this.textSettings.height),a=Math.round(this.textSettings.padding+c);this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=n,d=(t+a)/p*360*(Math.PI/180),l=(e-2*c)/p*360*(Math.PI/180),v=m*(Math.PI/180)+(r?-d:d),f=m*(Math.PI/180)+(r?-(l+d):l+d);const o=Math.round(.5*(this.textSettings.baseline+n)+s);this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,r?0:this.rect.width/2,i+(r?o:-o),v,f,r),this.ctx.stroke(),this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding}t+=Math.round(e+3*this.textSettings.padding+h)}this.ctx.restore(),d=!0}let m=0;if(o){m=(p/2-i)/(d?e.replace(/\s/g,"").length:e.length+1)/2,i=d?p/2:p/2-2*m}if(this.textSettings.underline&&!this.isWordBackground){let e=u-this.textSettings.height/2;if(e<this.textSettings.height){const t=Math.ceil(.06*this.textSettings.height);let n=(i-2*Math.round(this.textSettings.padding+c))/(u*Math.PI*2)*360*(Math.PI/180/2),a=r?90:270,o=a*(Math.PI/180)-n,h=a*(Math.PI/180)+n;const l=Math.round(.5*(this.textSettings.baseline+t)+s);this.ctx.save(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=t,this.ctx.beginPath(),r?this.ctx.arc(this.rect.width/2,0,e+l,o,h):this.ctx.arc(this.rect.width/2,this.rect.width/2,e-l,o,h),this.ctx.stroke(),this.ctx.restore()}}if(this.ctx.save(),e.length>0){const t=.5*this.rect.width,o=r?0:.5*this.rect.width;null===(a=this.fill)||void 0===a||a.addToCanvasFillStyle(this.ctx,-t,-o),this.ctx.translate(t,o);let l=r?u-this.textSettings.height-this.textSettings.ascent:-u-this.textSettings.ascent;this.ctx.textAlign="center";let g=r?-1:1,f=d?2*c+2*this.textSettings.padding:2*this.textSettings.padding+2*c;this.ctx.rotate((i-f)/p*Math.PI*-g),this.ctx.textAlign="center";for(var v=0;v<e.length;v++){if(d&&" "===e[v]){if(v>0&&" "===e[v-1])continue;this.ctx.rotate((3*this.textSettings.padding+h+c)/p*(2*Math.PI)*g);continue}let t=this.ctx.measureText(e[v]).width/2;this.ctx.rotate((t+m)/p*Math.PI*2*g),this.drawChar(e[v],0,l+s,n),this.ctx.rotate((t+c+m)/p*Math.PI*2*g)}}this.ctx.restore()},this.drawCircleLine=(e,t,i,s,n)=>{var a;const r=this.textSettings.curveFlip,o=this.textSettings.curveSpread,h=this.textSettings.getLineSpacing(),c=this.textSettings.getLetterSpacing();let d=!1,u=this.rect.width/2-t,p=u*Math.PI*2;if(this.textSettings.background)if(this.textSettings.backgroundType===l.Z.BACKGROUND_LINE){let e=u-this.textSettings.height/2;e>this.textSettings.height&&(this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.ellipse(this.rect.width/2,this.rect.width/2,e,e,0,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore())}else if(this.textSettings.backgroundType===l.Z.BACKGROUND_WORD){let t=o?this.textSettings.padding/2+h/2-p/2:this.textSettings.padding/2+h/2-i/2,n=(p-i)/e.replace(/\s/g,"").length;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let a=e.split(" ").filter((e=>e));for(var g=0;g<a.length;g++){let e=this.measureTextWidth(a[g],c,!0);o&&(e+=n*a[g].length);let i=u-this.textSettings.height/2;if(i<this.textSettings.height)continue;let l=(e+2*this.textSettings.padding)/p*360*(Math.PI/180),d=t/p*360*(Math.PI/180),m=r?90:270,v=m*(Math.PI/180)+(r?-d:d),f=m*(Math.PI/180)+(r?-(l+d):l+d);if(this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,this.rect.width/2,i,v,f,r),this.ctx.stroke(),this.textSettings.underline){const n=Math.ceil(.06*this.textSettings.height),a=Math.round(this.textSettings.padding+c);this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=n,d=(t+a)/p*360*(Math.PI/180),l=(e-2*c)/p*360*(Math.PI/180),v=m*(Math.PI/180)+(r?-d:d),f=m*(Math.PI/180)+(r?-(l+d):l+d);const o=Math.round(.5*(this.textSettings.baseline+n)+s);this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,this.rect.width/2,i+(r?o:-o),v,f,r),this.ctx.stroke(),this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding}t+=Math.round(e+3*this.textSettings.padding+h)}this.ctx.restore(),d=!0}let m=0;if(o){m=(p-i)/(d?e.replace(/\s/g,"").length:e.length+1)/2,i=d?p:p-2*m}if(this.textSettings.underline&&!this.isWordBackground){let e=u-this.textSettings.height/2;if(e>this.textSettings.height){const t=Math.ceil(.06*this.textSettings.height);let n=(i-2*Math.round(this.textSettings.padding+c))/(u*Math.PI*2)*360*(Math.PI/180/2),a=r?90:270,o=a*(Math.PI/180)-n,h=a*(Math.PI/180)+n;const l=Math.round(.5*(this.textSettings.baseline+t)+s);this.ctx.save(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=t,this.ctx.beginPath(),r?this.ctx.arc(this.rect.width/2,this.rect.width/2,e+l,o,h):this.ctx.arc(this.rect.width/2,this.rect.width/2,e-l,o,h),this.ctx.stroke(),this.ctx.restore()}}if(this.ctx.save(),e.length>0){const t=.5*this.rect.width,o=.5*this.rect.height;null===(a=this.fill)||void 0===a||a.addToCanvasFillStyle(this.ctx,-t,-o),this.ctx.translate(t,o);let l=r?u-this.textSettings.height-this.textSettings.ascent:-u-this.textSettings.ascent,g=r?-1:1,f=d?2*c+3*this.textSettings.padding+h:this.measureTextWidth(" ",c,!0);this.ctx.rotate((i-f)/p*Math.PI*-g),this.ctx.textAlign="center";for(var v=0;v<e.length;v++){if(d&&" "===e[v]){if(v>0&&" "===e[v-1])continue;this.ctx.rotate((3*this.textSettings.padding+h+c)/p*(2*Math.PI)*g);continue}let t=this.ctx.measureText(e[v]).width/2;this.ctx.rotate((t+m)/p*Math.PI*2*g),this.drawChar(e[v],0,l+s,n),this.ctx.rotate((t+c+m)/p*Math.PI*2*g)}}this.ctx.restore()},this.drawArcLine=(e,t,i,s,n)=>{var a;const r=this.textSettings.getLineSpacing(),o=this.textSettings.getLetterSpacing();let[h,c]=this.calculateArcRadius(),d=h-t,u=d*Math.PI*2,p=this.textSettings.curveAmount<0,g=!1;if(this.textSettings.background)if(this.textSettings.backgroundType===l.Z.BACKGROUND_WORD){let t=-i/2;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let n=e.split(" ").filter((e=>e));for(var m=0;m<n.length;m++){let e=this.measureTextWidth(n[m],o,!0),i=d-this.textSettings.height/2;if(i<this.textSettings.height)continue;let a=(e+2*this.textSettings.padding)/u*360*(Math.PI/180),c=t/u*360*(Math.PI/180),l=p?this.canvas.height-h:h,g=p?90:270,v=g*(Math.PI/180)+(p?-c:c),f=g*(Math.PI/180)+(p?-(a+c):a+c);if(this.ctx.beginPath(),p?this.ctx.arc(this.rect.width/2,l,i,f,v):this.ctx.arc(this.rect.width/2,l,i,v,f),this.ctx.stroke(),this.textSettings.underline){const n=Math.ceil(.06*this.textSettings.height),r=Math.round(this.textSettings.padding+o);this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=n,c=(t+r)/u*360*(Math.PI/180),a=(e-2*o)/u*360*(Math.PI/180),v=g*(Math.PI/180)+(p?-c:c),f=g*(Math.PI/180)+(p?-(a+c):a+c);const h=Math.round(.5*(this.textSettings.baseline+n)+s);this.ctx.beginPath(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),p?this.ctx.arc(this.rect.width/2,l,i+h,f,v):this.ctx.arc(this.rect.width/2,l,i-h,v,f),this.ctx.stroke(),this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding}t+=Math.round(e+3*this.textSettings.padding+r)}this.ctx.restore(),g=!0}else if(this.textSettings.backgroundType===l.Z.BACKGROUND_LINE){let e=d-this.textSettings.height/2;if(e>this.textSettings.height){let t=i/(d*Math.PI*2)*360*(Math.PI/180/2),s=p?this.canvas.height-h:h,n=p?90:270,a=n*(Math.PI/180)-t,r=n*(Math.PI/180)+t;this.ctx.save(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,s,e,a,r),this.ctx.stroke(),this.ctx.restore()}}if(this.textSettings.underline&&!this.isWordBackground){let e=d-this.textSettings.height/2;if(e>this.textSettings.height){const t=Math.ceil(.06*this.textSettings.height);let n=(i-2*Math.round(this.textSettings.padding+o))/(d*Math.PI*2)*360*(Math.PI/180/2),a=p?this.canvas.height-h:h,r=p?90:270,c=r*(Math.PI/180)-n,l=r*(Math.PI/180)+n;const u=Math.round(.5*(this.textSettings.baseline+t)+s);this.ctx.save(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=t,this.ctx.beginPath(),p?this.ctx.arc(this.rect.width/2,a,e+u,c,l):this.ctx.arc(this.rect.width/2,a,e-u,c,l),this.ctx.stroke(),this.ctx.restore()}}if(this.ctx.save(),e.length>0){let t=p?-1:1,c=p?d-this.textSettings.height-this.textSettings.ascent:-d-this.textSettings.ascent;this.ctx.textAlign="center";const l=.5*this.ctx.canvas.width,m=p?this.canvas.height-h:h;this.ctx.translate(l,m),null===(a=this.fill)||void 0===a||a.addToCanvasFillStyle(this.ctx,-l,-m),this.ctx.rotate((i-2*o-2*this.textSettings.padding)/u*Math.PI*-t);for(var v=0;v<e.length;v++){if(g&&" "===e[v]){if(v>0&&" "===e[v-1])continue;this.ctx.rotate((3*this.textSettings.padding+r+o)/u*(2*Math.PI)*t);continue}let i=this.ctx.measureText(e[v]).width;i/u*Math.PI*2>5e-4?(this.ctx.rotate(i/2/u*Math.PI*2*t),this.drawChar(e[v],0,c+s,n),this.ctx.rotate((i/2+o)/u*Math.PI*2*t)):(this.drawChar(e[v],i/2,c+s,n),this.ctx.rotate((i+o)/u*Math.PI*2*t))}}this.ctx.restore()},this.drawLine=(e,t,i,s,n,a=!1)=>{var r,o;let h=0,c=0;const d=this.textSettings.getLineSpacing(),u=this.textSettings.getLetterSpacing(),p=Math.ceil(.06*this.textSettings.height),g=Math.round(this.textSettings.padding+u),m=e.split(" ");if("center"==this.textSettings.align?h=Math.round((this.rect.width-i)/2):"right"==this.textSettings.align?h=Math.round(this.rect.width-i):"justify"==this.textSettings.align&&m.length>1&&i/this.rect.width>.7&&(c=this.isWordBackground?(this.rect.width-i)/(e.split(" ").filter((e=>e)).length-1):(this.rect.width-i)/(m.length-1),i=this.rect.width),this.textSettings.background&&this.textSettings.backgroundType===l.Z.BACKGROUND_LINE&&(this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(h,t-this.textSettings.padding,Math.round(i),this.textSettings.height+2*this.textSettings.padding),null===(r=this.fill)||void 0===r||r.addToCanvasFillStyle(this.ctx)),this.textSettings.underline&&!this.isWordBackground){const e=Math.ceil(.06*this.textSettings.height),n=Math.round(this.textSettings.padding+u);this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillRect(h+n,t+this.textSettings.baseline+e+s,i-2*n,e),this.ctx.globalCompositeOperation="source-over"}if(0!==c||this.isWordBackground){let e=this.ctx.measureText(" ").width;for(let i=0;i<m.length;i++){const a=this.measureTextWidth(m[i],u,!0);if(this.isWordBackground){if(!m[i])continue;this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(h,t-this.textSettings.padding,Math.round(a+2*this.textSettings.padding),this.textSettings.height+2*this.textSettings.padding),null===(o=this.fill)||void 0===o||o.addToCanvasFillStyle(this.ctx),e=3*this.textSettings.padding+d,this.textSettings.underline&&(this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillRect(h+g,t+this.textSettings.baseline+p+s,Math.round(a+2*this.textSettings.padding)-2*g,p),this.ctx.globalCompositeOperation="source-over")}0===u?this.drawText(m[i],h+this.textSettings.padding+u,t-this.textSettings.ascent+s,n):this.drawSpacedText(m[i],h+this.textSettings.padding+u,t-this.textSettings.ascent+s,u,n),h+=Math.round(a+e+c)}}else 0!==u||a?this.drawSpacedText(e,h+this.textSettings.padding+u,t-this.textSettings.ascent+s,u,n):this.drawText(e,h+this.textSettings.padding+u,t-this.textSettings.ascent+s,n)},this.drawSpacedText=(e,t,i,s,n)=>{let a=0,r="";for(;a<e.length;)r=e[a++],this.drawChar(r,t,i,n),t+=this.ctx.measureText(r).width+s},this.drawText=(e,t,i,s)=>{this.textSettings.outline&&0===s.x&&0===s.y&&this.ctx.strokeText(e,t,i),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillText(e,t,i),this.ctx.globalCompositeOperation="source-over",!this.textSettings.outline||0===s.x&&0===s.y||this.ctx.strokeText(e,t+s.x,i+s.y)},this.drawChar=(e,t,i,s)=>{this.textSettings.outline&&0===s.x&&0===s.y&&this.ctx.strokeText(e,t,i),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillText(e,t,i),this.ctx.globalCompositeOperation="source-over",!this.textSettings.outline||0===s.x&&0===s.y||this.ctx.strokeText(e,t+s.x,i+s.y)},this.measureTextWidth=(e,t,i)=>{if(!e)return 0;let s=0;if(0!==t){for(let t=0;t<e.length;t++)s+=this.ctx.measureText(e[t]).width;s+=e.length*t}else s=this.ctx.measureText(e).width;return i&&(s+=t),s},this.position=(e,t)=>{this.rect&&(void 0!==e&&(this.rect.x=e),void 0!==t&&(this.rect.y=t),this.bect&&(this.bect.x=this.rect.x-4*this.textSettings.padding,this.bect.y=this.rect.y-4*this.textSettings.padding))},this.scale=(e,t)=>{this.textSettings.setSize(Math.round(this.textSettings.size*t)),this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.render()},this.calculate=(e,t)=>{this.rect.x=Math.round(e.x),this.rect.width=Math.round(t.x-e.x),this.rect.width<20&&(this.rect.width=20),this.render()},this.setWidth=e=>{this.rect.width=Math.round(e),this.rect.width<20&&(this.rect.width=20),this.render()},this.getHeight=()=>this.textSettings.height,this.setHeightScale=e=>{let t=Math.round(this.textSettings.size*e);this.setTextSize(t>1e3?1e3:t)},this.rotate=e=>{this.rect.rotation+=e?-90:90},this.rasterize=()=>{let e=this.baked?this.baked:this.canvas,t=this.bect?this.bect.clone():this.rect.clone();const i=new c.Z(s.M8(),this.settings.name,e,t,this.settings.locked);return i.settings=Object.assign({},this.settings),i.applyTransform(),i},this.clone=(e=!1)=>{let t=new u(e?this.id:s.M8(),this.text,this.rect.clone(),this.textSettings.clone());return t.settings=Object.assign({},this.settings),t.animation=d.Z.clone(this.animation),t.rect=this.rect.clone(),t.canvas=s.dN(this.canvas),t.prepare(),t},this.textSettings=p,this.text=t,this.rect=i}drawCurveLine(e,t,i,s,n){switch(this.textSettings.curveType){case"arc":this.drawArcLine(e,t,i,s,n);break;case"circle":this.drawCircleLine(e,t,i,s,n);break;case"half":this.drawHalfLine(e,t,i,s,n)}}}},77758:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(93947),n=i(33655);class a{constructor(e,t,i=!0){this.lineSpace=0,this.letterSpace=0,this.bold=!1,this.italic=!1,this.uppercase=!1,this.underline=!1,this.align="center",this.curve=!1,this.curveAmount=0,this.curveType="arc",this.curveFlip=!1,this.curveSpread=!1,this.warp=!1,this.warpEdgeSize=0,this.warpCenterSize=0,this.warpHorizontalOffset=0,this.warpVerticalOffset=0,this.warpType=a.WARP_CIRCULAR,this.warpMode=a.WARP_UPPER,this.background=!1,this.backgroundOffset=0,this.backgroundPunch=!1,this.backgroundColor="#555555",this.backgroundType=a.BACKGROUND_FULL,this.outline=!1,this.outlinePunch=!1,this.outlineColor="#555555",this.outlineSize=.3,this.outlineDistance=0,this.outlineDirection=305,this.shadow=!1,this.shadowBlur=.3,this.shadowColor="#444444",this.shadowAlpha=.3,this.shadowDistance=.3,this.shadowDirection=160,this.font=e,this.size=t,i&&this.measureText()}setSize(e){this.size=e,this.measureText()}setFont(e){this.font=e,this.measureText()}measureText(){if(this.size<1)return;var e=document.createElement("canvas");e.width=20*this.size,e.height=Math.round(2*this.size);const t=e.getContext("2d",{willReadFrequently:!0});t.textBaseline="top",t.fillStyle="white",t.font=this.getCssFont(),t.fillText("SfTgMjkHpqLRnliIFIABCDEFGIJKNOPQSUVXYZabcdeghmnorstuvxyz",0,Math.round(.5*this.size));const i=n.vO(t.getImageData(0,0,e.width,e.height));if(i){this.ascent=i.y-Math.round(.5*this.size),this.height=i.height,t.clearRect(0,0,e.width,e.height),t.fillText("SMOP",0,Math.round(.5*this.size));const s=n.vO(t.getImageData(0,0,e.width,e.height));this.baseline=s.height}this.height<=0&&this.measureTextFallback(),this.padding=Math.round(.2*this.height)}measureTextFallback(){var e=document.createElement("span");e.innerHTML="ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz",e.style.fontFamily=this.font,e.style.fontSize=this.size+"px";var t=document.createElement("div");t.style.display="inline-block",t.style.width="1px",t.style.height="0px";var i=document.createElement("div");i.appendChild(e),i.appendChild(t),(0,s.ZP)("workspace").appendChild(i);try{t.style.verticalAlign="baseline",this.ascent=t.offsetTop-e.offsetTop+1,t.style.verticalAlign="bottom",this.height=t.offsetTop-e.offsetTop+1,this.baseline=this.height}finally{i.remove()}}getLineSpacing(){var e;return Math.ceil(this.height*Number(null!==(e=this.lineSpace)&&void 0!==e?e:0))}getLetterSpacing(){var e;return Math.ceil(this.height/2*Number(null!==(e=this.letterSpace)&&void 0!==e?e:0))}getCssFont(e=this.size){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+e+"px "+this.font}clone(){const e=Object.create(a.prototype);return Object.assign(e,this)}equalTo(e){return!!e&&(this.font===e.font&&this.size===e.size&&this.lineSpace===e.lineSpace&&this.letterSpace===e.letterSpace&&this.bold===e.bold&&this.italic===e.italic&&this.underline===e.underline&&this.uppercase===e.uppercase&&this.fillType===e.fillType&&this.fillValue===e.fillValue&&this.align===e.align&&this.curve===e.curve&&this.curveAmount===e.curveAmount&&this.curveType===e.curveType&&this.curveSpread===e.curveSpread&&this.curveFlip===e.curveFlip&&this.warp===e.curve&&this.warpMode===e.warpMode&&this.warpType===e.warpType&&this.warpEdgeSize===e.warpEdgeSize&&this.warpCenterSize==this.warpCenterSize&&this.warpHorizontalOffset==this.warpHorizontalOffset&&this.warpVerticalOffset==this.warpVerticalOffset&&this.background===e.background&&this.backgroundPunch===e.backgroundPunch&&this.backgroundColor===e.backgroundColor&&this.backgroundType===e.backgroundType&&this.outline===e.outline&&this.outlinePunch===e.outlinePunch&&this.outlineSize===e.outlineSize&&this.outlineColor===e.outlineColor&&this.outlineDistance===e.outlineDistance&&this.outlineDirection===e.outlineDirection&&this.shadow===e.shadow&&this.shadowBlur===e.shadowBlur&&this.shadowColor===e.shadowColor&&this.shadowAlpha===e.shadowAlpha&&this.shadowDistance===e.shadowDistance&&this.shadowDirection===e.shadowDirection)}}a.BACKGROUND_FULL="full",a.BACKGROUND_LINE="line",a.BACKGROUND_WORD="word",a.WARP_CIRCULAR="circular",a.WARP_ANGULAR="angular",a.WARP_UPPER="upper",a.WARP_MIDDLE="middle",a.WARP_LOWER="lower";const r=a},74820:(e,t,i)=>{i.d(t,{Lt:()=>r,UU:()=>c,X6:()=>l,ZP:()=>p,nS:()=>o,ru:()=>h});var s=i(93947),n=i(71030),a=i(43673);function r(e,t){(0,n.Z)("setting-"+e,t.toString());const i=window.localStorage.getItem("user-settings"),s=JSON.parse(i||"{}");u[e]=s[e]=t,window.localStorage.setItem("user-settings",JSON.stringify(s)),document.dispatchEvent(new CustomEvent("user-setting-updated",{detail:e}))}function o(e){let t=e.toHEX(),i=u.oldColor.findIndex((e=>e===t));i>-1?u.oldColor.splice(0,0,u.oldColor.splice(i,1)[0]):(u.oldColor.pop(),u.oldColor.unshift(t)),r("oldColor",u.oldColor)}function h(){let e=1,t=d();u.ddid&&""!==u.ddid&&-1!==u.ddid.indexOf(":")&&Number(u.ddid.split(":")[0])===t&&(e=Number(u.ddid.split(":")[1])+1),r("ddid",t+":"+e),(0,n.Z)("daily-saves",e.toString())}function c(){if(u.ddid&&""!==u.ddid&&-1!==u.ddid.indexOf(":")&&Number(u.ddid.split(":")[0])===d()){let e=Number(u.ddid.split(":")[1]);return e<=0&&(e=666),e}return 0}function l(){return c()>=3}function d(){let e=new Date;return(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())-Date.UTC(e.getFullYear(),0,0))/24/60/60/1e3}const u=function(){const e={product:"web",api:!1,debug:"",cdnUrl:"",accent:"default",workspace:"default",allTooltip:!1,autoSelect:!0,showGuides:!0,snapToGuides:!0,smoothScaling:!0,askToPreResize:!0,useLegacySave:!1,scrollMode:"zoom",maxHistoryUndos:25,boxBarXState:"maximized",panelFloating:!1,panelNavigator:!0,panelLayer:!0,panelHistory:!0,barQuicklink:!0,mainColor:"#ffffff",altColor:"#000000",oldColor:["#A8534B","#EC9D75","#F9D697","#DCE6A7","#9ADFB0","#57CBAB","#38A793","#5A5E5A"],gradients:[],dialogPos:new a.Z(0,0),adyenClientKey:"",lastNewsCheck:"1970-01-01T00:00:00Z",ddid:""};return Object.assign(e,(()=>{const e=window.localStorage.getItem("user-settings");return JSON.parse(e||"{}")})()),Object.assign(e,(()=>{const e=new URL(window.location.href),t={};return e.searchParams.forEach(((e,i)=>{t[i]=e})),t})()),Object.assign(e,(()=>{const e=(0,s.ZP)("config_data");if(e&&e.innerText){let e=JSON.parse((0,s.ZP)("config_data").innerText);return(0,s.ZP)("config_data").remove(),e}return{}})()),e.api=!!e.referrer&&!!e.file,e}(),p=u},72951:(e,t,i)=>{i.d(t,{Z:()=>d});var s=i(96548),n=i(93947),a=i(57909),r=i(71030),o=i(27969),h=i(33506),c=i(21951),l=i(74820);class d extends a.Z{constructor(){super(!0),(0,r.Z)("ads","pop"),this.dialog.style.maxWidth="420px",this.setContent(`\n            <div id="after-content" style="padding-top:20px;display:flex;position:relative;flex-direction:column;align-items:stretch;min-height:420px;">\n\n                <div style="padding:40px 40px 0px 40px;">\n                    <h3 class="split">${(0,s.Z)("common-success")} <span style="font-weight:normal;font-size:small">${(0,l.UU)()}/3  ${(0,s.Z)("common-freeSave")}</span></h3>\n                    <div id="after-save-message" style="padding-top:16px"></div>\n\n                    <button id="premium-go-now" style="display:none;margin-top:140px;width:100%;" class="button big green">${(null===h.a||void 0===h.a?void 0:h.a.eligibleForTrail)?(0,s.Z)("try30DayFreePremium"):(0,s.Z)("subscribeNow")}</button>\n                </div>\n\n                <div id="after-entry" style="flex-direction:column;width:420px;flex-grow:0;flex-shrink:0;"></div>\n            </div>\n        `),this.dialog.style.overflow="unset",h.a?((0,n.ZP)("after-content").append((0,n.T)("div",{className:"premium-plug"},(0,n.T)("img",{src:"/img/icon/premium.svg"}))),(0,n.ZP)("premium-go-now").addEventListener("click",(async()=>{this.cleanUp(),new c.Z("afterSave")}),!0),(0,n.ZP)("after-save-message").innerText=(0,s.Z)("common-afterFileSaveTryPremium"),(0,n.ZP)("premium-go-now").style.display="block"):(new o.ZP("chooser",{method:"embed",holder:(0,n.ZP)("after-entry")}),(0,n.ZP)("after-content").append((0,n.T)("div",{className:"user-plug"},(0,n.T)("img",{src:"/img/icon/user.svg"}))),(0,n.ZP)("after-save-message").innerText=(0,s.Z)("common-afterFileSaveRegister"))}}},57909:(e,t,i)=>{i.d(t,{Z:()=>a});var s=i(93947),n=i(33655);class a{constructor(e=!0){this.setContent=(...e)=>{e[0]instanceof HTMLElement?this.content.append(...e):this.content.innerHTML+=e[0]},this.keyDown=e=>{"Escape"!==e.key&&"Esc"!==e.key||this.cleanUp()},this.cleanUp=()=>{document.removeEventListener("keydown",this.keyDown,!1),this.dialog.classList.remove("ani"),this.modal.classList.remove("dim"),setTimeout((()=>{this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null}),200)},this.mid=n.Zd(),this.modal=(0,s.T)("div",{id:"modal-"+this.mid,className:"modal"}),document.body.appendChild(this.modal),this.dialog=(0,s.T)("div",{className:"announce"}),this.modal.appendChild(this.dialog),this.content=(0,s.T)("div",{className:"content"}),this.dialog.append((0,s.T)("img",{id:"announce-close"+this.mid,className:"close",src:"/img/icon/close.svg",onclick:()=>this.cleanUp()}),this.content),document.addEventListener("keydown",this.keyDown,!1),setTimeout((()=>this.dialog.classList.add("ani")),5),e&&setTimeout((()=>this.modal.classList.add("dim")),5)}}},64652:(e,t,i)=>{i.d(t,{Z:()=>l});var s=i(96548),n=i(93947),a=i(57909),r=i(71030),o=i(33506),h=i(21951),c=i(74820);class l extends a.Z{constructor(e){var t,i;if(super(),this.selectedIndex=0,this.dialog.classList.add("news-dialog"),e.length>1){const i=e.map(((t,i)=>(0,n.T)("a",{id:`news-menu-item-${i}`,className:i===this.selectedIndex?"item selected":"item",href:"javascript:;",onclick:()=>{var t;(0,n.ZP)(`news-menu-item-${this.selectedIndex}`).classList.remove("selected"),(0,n.ZP)(`news-menu-item-${i}`).classList.add("selected"),(0,n.ZP)("news-current").replaceWith(d(e[i])),this.selectedIndex=i,null===(t=(0,n.ZP)("new-checkout-cta"))||void 0===t||t.addEventListener("click",(()=>{new h.Z("news"),this.cleanUp()})),(0,r.Z)("news-select")}},(0,n.T)("div",{className:"block"}),(0,n.T)("div",t.title)))),a=e.map(((e,t)=>(0,n.T)("div",{className:1===t?"item show right":"item"},(0,n.T)("a",{href:"javascript:;",onclick:()=>{var i;(0,n.ZP)("news-current").replaceWith(d(e)),this.selectedIndex=t+1,u(t),null===(i=(0,n.ZP)("new-checkout-cta"))||void 0===i||i.addEventListener("click",(()=>{new h.Z("news"),this.cleanUp()}))}},e.title),(0,n.T)("div",{className:"icon"}))));this.setContent((0,n.T)("div",{className:"news-split"},(0,n.T)("div",{className:"news-menu flair"},(0,n.T)("div",{className:"headline"},(0,s.Z)("whatsNew")),(0,n.T)("div",{className:"non-mobile"},...i)),(0,n.T)("div",{className:"news-body"},d(e[this.selectedIndex]),(0,n.T)("div",{className:"news-footer is-mobile"},(0,n.T)("div",{className:"menu"},...a))))),null===(t=(0,n.ZP)("new-checkout-cta"))||void 0===t||t.addEventListener("click",(()=>{new h.Z("news"),this.cleanUp()}))}else this.dialog.classList.add("single-news"),this.setContent(d(e[0])),null===(i=(0,n.ZP)("new-checkout-cta"))||void 0===i||i.addEventListener("click",(()=>{new h.Z("news"),this.cleanUp()}));(0,c.Lt)("lastNewsCheck",(new Date).toISOString())}}function d(e,t){const i=new Date(e.publishDate);let a;if(e.video){const i=()=>{const t=Math.max(360,s.getBoundingClientRect().height),i=`https://www.youtube.com/embed/${e.video}?autoplay=1&modestbranding=1`;a.style.height=t+"px",s.style.filter="blur(6px)",(0,r.Z)("news-play"),a.append((0,n.T)("div",{className:"player-container"},(0,n.T)("iframe",{width:"640",height:"360",src:i,className:"player",allow:"autoplay"})))};let s=(0,n.T)("img",{className:"news-cover",src:e.cover,onload:t}),o=(0,n.T)("div",{className:"play-button",onclick:i},(0,n.T)("img",{src:"/img/icon/play-circle.svg"}));a=(0,n.T)("div",{className:"cover-stack"},s,o)}else a=(0,n.T)("img",{className:"news-cover",src:e.cover,onload:t});return(0,n.T)("div",{id:"news-current"},a,(0,n.T)("div",{className:"news-content"},(0,n.T)("div",{className:"news-title"},(0,n.T)("div",{className:"news-date"},(0,n.T)("span",{className:"is-mobile is-tablet"},(0,s.Z)("whatsNew")),(0,n.T)("img",{src:"/img/misc/ellipse.svg",className:"is-mobile is-tablet"}),(0,n.T)("span",`${(0,s.Z)("launced")} ${i.toLocaleDateString()}`)),(0,n.T)("span",{className:"news-headline"},e.title)),(0,n.T)("div",{className:"news-text"},e.text),e.checkoutCta&&"free"===(null===o.a||void 0===o.a?void 0:o.a.subscriptionAccess)?(0,n.T)("a",{className:"button med positive",style:"margin-right:auto",id:"new-checkout-cta",dataset:e.ctaDataset||{}},o.a?"GET A SUBSCRIPTION":"SIGN UP NOW!"):e.urlWeb?(0,n.T)("a",{className:"button med positive",style:"margin-right:auto",href:e.urlWeb,target:"_blank",onmousedown:()=>{(0,r.Z)("news-url-web")}},e.cta):""))}const u=e=>{const t=document.querySelectorAll(".news-footer .menu .item ");0==e&&(document.querySelector(".news-footer .menu").style.justifyContent="flex-end"),0!=e&&(document.querySelector(".news-footer .menu").style.justifyContent="space-between"),e==t.length-1&&(document.querySelector(".news-footer .menu").style.justifyContent="flex-start"),t.forEach(((t,i)=>{i===e+1||i===e-1?(t.classList.add("show"),i===e+1&&t.classList.add("right"),i===e-1&&t.classList.add("left")):(t.classList.remove("show"),t.classList.remove("right"),t.classList.remove("left"))}))}},57246:(e,t,i)=>{i.d(t,{Z:()=>l});var s=i(93947),n=i(96548),a=i(57909),r=i(71030),o=i(27969),h=i(33506),c=i(16577);class l extends a.Z{constructor(){super(!0),(0,r.Z)("paywall"),this.dialog.style.maxWidth="920px",this.content.style.flexDirection="column",this.content.style.padding="40px 40px 20px 40px",this.content.style.background="linear-gradient(180deg, #00000000 0%, #00000000 10%, #00000010 100%)",this.setContent(`\n            <h1 class="heavy bold">${(0,n.Z)("snapYouHaveUseAllDailySaves")}</h1>\n            <p style="font-size:16px;" class="pad-5">${(0,n.Z)("forAsLow075GetUnlimitedSavesAdFree")}</p>\n\n            <p id="do-login" style="display:none">${(0,n.Z)("common-alreadyMember")} <a id="login-link" class="anchor">${(0,n.Z)("common-loginHere")}</a></p>\n\n            <section class="paywal-plan pad-40">\n\n                <div id="subscribe-plus" class="plan">\n                    <div class="plan-details">\n                        <span style="display: flex; column-gap: 12px">\n                            <img src="/img/misc/plus-icon.svg" alt="plus icon" style="width: 24px;">\n                            <h1 class="text-capitalize">${(0,n.Z)("plus")}</h1>\n                        </span>\n\n                        <p class="pad-5" style="line-height: 22px; color: #3F4246;">${(0,n.Z)("addFreeUnlimitedSaves")}</p>\n                        <div style="font-size: 36px; line-height: normal;">$0.75</div>\n                        <div style="font-size: 16px; line-height: normal;">USD /${(0,n.Z)("month")}</div>\n\n                        <div class="button big white w-100 pad-30 text-default">${(0,n.Z)("subscribeNow")}</div>\n                    </div>\n                </div>\n\n                <div id="subscribe-premium" class="plan popular">\n                    <div class="plan-header">\n                        ${(0,n.Z)("mostPopular")}\n                    </div>\n                    <div class="plan-details">\n                        <span style="display: flex; column-gap: 12px">\n                            <img src="/img/misc/premium-icon.svg" alt="premium icon" style="width: 24px;">\n                            <h1 class="text-capitalize">${(0,n.Z)("premium")}</h1>\n                        </span>\n\n                        <p class="pad-5" style="line-height: 22px; color: #3F4246;">${(0,n.Z)("fullAccessToPixlrSuiteAssetTemplates")}</p>\n                        <div style="font-size: 36px; line-height: normal;">$4.90</div>\n                        <div style="font-size: 16px; line-height: normal;">USD /${(0,n.Z)("month")}</div>\n\n                        <div class="button big w-100 pad-30" style="background: #019ECF;">${!h.a||h.a.eligibleForTrail?(0,n.Z)("try30DaysFree"):(0,n.Z)("subscribeNow")}</div>\n                    </div>\n                </div>\n\n                <div id="subscribe-team" class="plan">\n                    <div class="plan-details">\n                        <span style="display: flex; column-gap: 12px">\n                            <img src="/img/misc/team-icon.svg" alt="team icon">\n                            <h1 class="text-capitalize">${(0,n.Z)("team")}</h1>\n                        </span>\n\n                        <p class="pad-5" style="line-height: 22px; color: #3F4246;">${(0,n.Z)("manageYourTeamAndCollaborate")}</p>\n                        <div style="font-size: 36px; line-height: normal;">$9.91</div>\n                        <div style="font-size: 16px; line-height: normal;">USD /${(0,n.Z)("month")}</div>\n\n                        <div class="button big white w-100 pad-30 text-default">${(0,n.Z)("subscribeNow")}</div>\n                    </div>\n                </div>\n            </section>\n\n            <p class="pad-30 center">${(0,n.Z)("unsureWhichSubscriptionToGet",`<a href="/pricing" class="anchor" target="_blank" style="color: #019ECF;">${(0,n.Z)("pricingPage")}</a>`)} ${(0,n.Z)("freeForEducation",`<a href="/learn/education/" class="anchor" target="_blank" style="color: #019ECF;">${(0,n.Z)("education")}</a>`)}</p>\n        `),h.a||((0,s.ZP)("do-login").style.display="block",(0,s.ZP)("login-link").addEventListener("click",(()=>{this.cleanUp(),new o.ZP}))),(0,s.ZP)("subscribe-plus").addEventListener("click",(()=>{this.cleanUp(),h.a?new c.Z("subscription",{plan:"plus-monthly",bounceSource:"paywall"}):new o.ZP})),(0,s.ZP)("subscribe-premium").addEventListener("click",(()=>{this.cleanUp(),h.a?new c.Z("subscription",{plan:"premium-monthly",bounceSource:"paywall"}):new o.ZP})),(0,s.ZP)("subscribe-team").addEventListener("click",(()=>{this.cleanUp(),h.a?new c.Z("subscription",{plan:"team-monthly",bounceSource:"paywall"}):new o.ZP}))}}},21951:(e,t,i)=>{i.d(t,{Z:()=>l});var s=i(93947),n=i(96548),a=i(57909),r=i(71030),o=i(27969),h=i(33506),c=i(16577);class l extends a.Z{constructor(e,t){super(!0),(0,r.Z)("premium-bounce",e),this.dialog.style.maxWidth="920px",this.content.id="bounce-content",this.content.style.flexDirection="column";const i=!(!h.a||"plus"!==h.a.subscriptionAccess);this.setContent(`\n            <div id="bounce-top">\n\n                <div class="premium-tag" title="premium"><img src="/img/icon/premium.svg"></div>\n                   \n                <h1 class="top-30">${(0,n.Z)("premiumBounceTitle")}</h1>\n                <p class="top-20" style="text-align:left;">${(0,n.Z)("premiumFeaturePitch")}</p>\n\n            </div>\n\n            <section class="paywal-plan" style="padding:40px;background:linear-gradient(180deg, #00000000 0%, #00000000 10%, #00000010 100%)">\n\n                <div id="subscribe-plus" class="plan">\n                    <div class="plan-details">\n                        <span style="display: flex; column-gap: 12px">\n                            <img src="/img/misc/plus-icon.svg" alt="plus icon" style="width: 24px;">\n                            <h1 class="text-capitalize">${(0,n.Z)("plus")}</h1>\n                        </span>\n\n                        <p class="top-5" style="line-height: 22px; color: #3F4246;">${(0,n.Z)("addFreeUnlimitedSaves")}</p>\n                        <div style="font-size: 36px; line-height: normal;">$0.75</div>\n                        <div style="font-size: 16px; line-height: normal;">USD /${(0,n.Z)("month")}</div>\n\n                        ${i?`<div class="button big disabled w-100 top-30 text-default" style="color: #000;cursor: not-allowed !important;">${(0,n.Z)("currentPlan")}</div>`:`<div class="button big white w-100 top-30 text-default">${(0,n.Z)("subscribeNow")}</div>`}\n                    </div>\n                </div>\n\n                <div id="subscribe-premium" class="plan popular">\n                    <div class="plan-header">\n                        ${(0,n.Z)("mostPopular")}\n                    </div>\n                    <div class="plan-details">\n                        <span style="display: flex; column-gap: 12px">\n                            <img src="/img/misc/premium-icon.svg" alt="premium icon" style="width: 24px;">\n                            <h1 class="text-capitalize">${(0,n.Z)("premium")}</h1>\n                        </span>\n\n                        <p class="top-5" style="line-height: 22px; color: #3F4246;">${(0,n.Z)("fullAccessToPixlrSuiteAssetTemplates")}</p>\n                        <div style="font-size: 36px; line-height: normal;">$4.90</div>\n                        <div style="font-size: 16px; line-height: normal;">USD /${(0,n.Z)("month")}</div>\n\n                        <div class="button big w-100 top-30" style="background: #019ECF;">\n                        ${i?(0,n.Z)("upgradeNow"):!h.a||h.a.eligibleForTrail?(0,n.Z)("try30DaysFree"):(0,n.Z)("subscribeNow")}\n                        </div>\n                    </div>\n                </div>\n\n                <div id="subscribe-team" class="plan">\n                    <div class="plan-details">\n                        <span style="display: flex; column-gap: 12px">\n                            <img src="/img/misc/team-icon.svg" alt="team icon">\n                            <h1 class="text-capitalize">${(0,n.Z)("team")}</h1>\n                        </span>\n\n                        <p class="top-5" style="line-height: 22px; color: #3F4246;">${(0,n.Z)("manageYourTeamAndCollaborate")}</p>\n                        <div style="font-size: 36px; line-height: normal;">$9.91</div>\n                        <div style="font-size: 16px; line-height: normal;">USD /${(0,n.Z)("month")}</div>\n\n                        <div class="button big white w-100 top-30 text-default">${i?(0,n.Z)("upgradeNow"):(0,n.Z)("subscribeNow")}</div>\n                    </div>\n                </div>\n            </section>\n\n            <p class="center" style="padding:10px;">${(0,n.Z)("unsureWhichSubscriptionToGet",`<a href="/pricing" class="anchor" target="_blank" style="color: #019ECF;">${(0,n.Z)("pricingPage")}</a>`)} ${(0,n.Z)("freeForEducation",`<a href="/learn/education/" class="anchor" target="_blank" style="color: #019ECF;">${(0,n.Z)("education")}</a>`)}</p>\n            \n        `),(0,s.ZP)("subscribe-plus").addEventListener("click",(()=>{i||(this.cleanUp(),h.a?new c.Z("subscription",{platform:(null==t?void 0:t.platform)||"suite",plan:"plus-monthly",bounceSource:"premiumbounce"}):new o.ZP)})),(0,s.ZP)("subscribe-premium").addEventListener("click",(()=>{this.cleanUp(),h.a?i?new c.Z("subscription",{platform:(null==t?void 0:t.platform)||"suite",plan:"premium-yearly",checkoutMode:"upgrade",bounceSource:"premiumbounce"}):new c.Z("subscription",{platform:(null==t?void 0:t.platform)||"suite",plan:"premium-monthly",bounceSource:"premiumbounce"}):new o.ZP})),(0,s.ZP)("subscribe-team").addEventListener("click",(()=>{this.cleanUp(),h.a?i?new c.Z("subscription",{platform:(null==t?void 0:t.platform)||"suite",plan:"team-yearly",checkoutMode:"upgrade",bounceSource:"premiumbounce"}):new c.Z("subscription",{platform:(null==t?void 0:t.platform)||"suite",plan:"team-monthly",bounceSource:"premiumbounce"}):new o.ZP}))}}},70840:(e,t,i)=>{i.d(t,{Z:()=>d});var s=i(93947),n=i(96548),a=i(57909),r=i(71030),o=i(27969),h=i(33506),c=i(16577),l=i(92409);class d extends a.Z{constructor(e){super(!0),this.hasPlayBilling=!1,this.checkPlayBilling=async()=>{this.hasPlayBilling=await(0,l.Ev)(),this.hasPlayBilling&&((0,s.ZP)("gpay-info").style.display="block")},this.showAuth=async()=>{(0,s.ZP)("tbounce-content").style.display="none",(0,s.ZP)("tbounce-entry").style.display="flex",new o.ZP("chooser",{method:"embed",holder:(0,s.ZP)("tbounce-entry")})},this.stage=e,(0,r.Z)("premium-bounce","template"),this.setContent(`\n            <div id="tbounce-content" style="display:flex;width:420px;flex-grow:0;flex-shrink:0;padding:30px;flex-direction:column;">\n\n                <div class="premium-tag" title="premium"><img src="/img/icon/premium.svg"></div> \n\n                <h1 class="pad-40">${(0,n.Z)("premiumTemplate")}</h1>\n\n                <p class="pad-10">${(0,n.Z)("premiumTemplateSalesPitch")}</p>\n\n                <div style="display:flex;flex-direction:column;flex-grow:1;padding-bottom:10px;">\n                    <a id="premium-one-time" class="button big green w-100" style="margin-top:auto">${(0,n.Z)("premiumOneTime")} ${"USD"===(null===h.a||void 0===h.a?void 0:h.a.currency)?"$":"€"}1</a>\n                    <a id="premium-go-now" class="button big green outline pad-15 w-100" style="border-radius:50vh">${(null===h.a||void 0===h.a?void 0:h.a.eligibleForTrail)?(0,n.Z)("try30DayFreePremium"):(0,n.Z)("subscribeNow")}</a>\n                    <div id="gpay-info" class="pad-10 center" style="display:none;font-size:12px;font-style:italic">\n                        *30 day free trial is only eligible for new users and can only be claimed once per customer.\n                    </div>\n                    <p class="pad-30 center" id="one-of-us">${(0,n.Z)("common-alreadyMember")} <a id="premiumbounce-auth" class="link" style="cursor:pointer">${(0,n.Z)("common-loginHere")}</a></p>\n                </div>\n            </div>\n            <div id="tbounce-entry" style="display:none;flex-direction:column;width:420px;flex-grow:0;flex-shrink:0;"></div>\n            <div id="tbounce-template-holder" class="flair left-panel">\n\n            </div>\n        `),(0,s.ZP)("tbounce-template-holder").appendChild(this.stage.getOutputCanvas()),h.a?((0,s.ZP)("one-of-us").style.display="none",(0,s.ZP)("premium-one-time").addEventListener("click",(async()=>{var e,t,i;this.hasPlayBilling?await(0,l.V)(!0,null!==(i=null===(t=null===(e=this.stage.fresco)||void 0===e?void 0:e.templateMeta)||void 0===t?void 0:t.templateId)&&void 0!==i?i:null)&&(this.cleanUp(),document.dispatchEvent(new CustomEvent("unblock-viewport"))):(this.cleanUp(),new c.Z("template",{bounceSource:"premiumtemplatebounce",stage:this.stage}))})),(0,s.ZP)("premium-go-now").addEventListener("click",(async()=>{this.hasPlayBilling?await(0,l.V)(!1,null)&&(this.cleanUp(),document.dispatchEvent(new CustomEvent("unblock-viewport"))):(this.cleanUp(),new c.Z("subscription",{plan:"premium-monthly",bounceSource:"premiumtemplatebounce"}))}))):((0,s.ZP)("premium-one-time").addEventListener("click",this.showAuth),(0,s.ZP)("premium-go-now").addEventListener("click",this.showAuth)),(0,s.ZP)("premiumbounce-auth").addEventListener("click",this.showAuth),this.checkPlayBilling()}}},74211:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(93947),n=i(98776),a=i(15181);class r{constructor(e,t,i,r){this.previewColor=e=>{this.setColor(e),this.preview&&this.preview(this.color)},this.callbackColor=e=>{this.setColor(e),this.callback&&this.callback(this.color)},this.setColor=e=>{e?(e instanceof n.Z?this.color=e:this.color=n.Z.fromHEX(e),this.container.classList.remove("empty"),this.container.style.backgroundColor=this.color.toHEX()):(this.color=void 0,this.container.classList.add("empty"),this.container.style.backgroundColor="unset")},this.getColor=()=>this.color,this.picker=()=>{new a.Z(this.color,this.callbackColor,this.previewColor)},this.cleanUp=()=>{this.container.removeEventListener("click",this.picker,!1)},this.preview=r,this.callback=i,this.container=(0,s.ZP)(e),this.container.classList.add("color-pod"),this.container.addEventListener("click",this.picker,!1),this.setColor(t)}}},92397:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(93947),n=i(33655),a=i(43673),r=i(98776);class o{constructor(e,t=["#ffffff","#eb7d46","#b4eb46","#46eb7d","#46b4eb","#7d46eb","#eb46b4"],i,o=!0,h=220,c=100,l=!1){var d;if(this.activeColorPick=e=>{if((0,s.ZP)("modal-color-select"))return;const t=document.createElement("div");t.classList.add("modal"),t.id="modal-color-select",t.style.cursor="crosshair",document.body.appendChild(t),this.preview=document.createElement("div"),this.preview.classList.add("color-selector-preview"),this.preview.style.display="none",t.appendChild(this.preview),this.stageC=document.getElementsByClassName("canvas")[0],this.stageCanvas=n.dN(this.stageC),this.stageCanvasCTX=this.stageCanvas.getContext("2d"),t.addEventListener("click",this.removeColorPicker,!0),t.addEventListener("mousemove",this.pickerPreviewColor,!0)},this.pickerPreviewColor=e=>{let t=new a.Z(e.clientX,e.clientY);if(this.preview.style.top=t.y-60+"px",this.preview.style.left=t.x+10+"px",this.preview.style.display="block",t.x-=this.stageC.offsetLeft,t.y-=this.stageC.offsetTop,t.x<0||t.y<0||t.x>this.stageC.width||t.y>this.stageC.height)return void(this.preview.style.display="none");let i=this.stageCanvasCTX.getImageData(t.x,t.y,1,1).data;this.preview.style.backgroundColor=new r.Z(i[0],i[1],i[2]).toHEX()},this.removeColorPicker=e=>{(0,s.ZP)("modal-color-select").remove(),this.preview=null;let t=new a.Z(e.clientX,e.clientY);if(t.x-=this.stageC.offsetLeft,t.y-=this.stageC.offsetTop,t.x<0||t.y<0||t.x>this.stageC.width||t.y>this.stageC.height)return;let i=this.stageCanvasCTX.getImageData(t.x,t.y,1,1).data,n=new r.Z(i[0],i[1],i[2]);this.setHex(n.toHEX(),!0),this.updateColor(!0)},this.satMouseDown=e=>{e.stopPropagation(),document.addEventListener("mousemove",this.satMouseMove,!0),document.addEventListener("mouseup",this.satMouseUp,!0);var t=this.satSlide.getBoundingClientRect(),i=e.pageX-t.left,s=e.pageY-t.top;this.selectSat(i,s)},this.satMouseMove=e=>{e.stopPropagation();var t=this.satSlide.getBoundingClientRect(),i=e.pageX-t.left,s=e.pageY-t.top;this.selectSat(i,s)},this.satMouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.satMouseMove,!0),document.removeEventListener("mouseup",this.satMouseUp,!0)},this.satTouchStart=e=>{e.stopPropagation(),document.addEventListener("touchmove",this.satTouchMove,{passive:!1}),document.addEventListener("touchend",this.satTouchEnd,{passive:!1});var t=this.satSlide.getBoundingClientRect(),i=e.targetTouches[0].pageX-t.left,s=e.targetTouches[0].pageY-t.top;this.selectSat(i,s)},this.satTouchMove=e=>{e.stopPropagation();var t=this.satSlide.getBoundingClientRect(),i=e.targetTouches[0].pageX-t.left,s=e.targetTouches[0].pageY-t.top;this.selectSat(i,s)},this.satTouchEnd=e=>{e.stopPropagation(),document.removeEventListener("touchmove",this.satTouchMove),document.removeEventListener("touchend",this.satTouchEnd)},this.selectSat=(e,t)=>{e=n.uZ(e,0,this.width),t=n.uZ(t,0,this.height),this.hsb.s=e/this.width,this.hsb.b=1-t/this.height,this.setSat(),this.updateColor()},this.setSat=()=>{this.satKnob.style.left=this.hsb.s*this.width-9+"px",this.satKnob.style.top=(1-this.hsb.b)*this.height-9+"px"},this.hueMouseDown=e=>{e.stopPropagation(),document.addEventListener("mousemove",this.hueMouseMove,!0),document.addEventListener("mouseup",this.hueMouseUp,!0);var t=this.hueSlide.getBoundingClientRect(),i=e.pageX-t.left;this.selectHue(i)},this.hueMouseMove=e=>{e.stopPropagation();var t=this.hueSlide.getBoundingClientRect(),i=e.pageX-t.left;this.selectHue(i)},this.hueMouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.hueMouseMove,!0),document.removeEventListener("mouseup",this.hueMouseUp,!0)},this.hueTouchStart=e=>{e.stopPropagation(),this.hueSlide.addEventListener("touchmove",this.hueTouchMove,{passive:!1}),document.addEventListener("touchend",this.hueTouchEnd,{passive:!1});var t=e.target.getBoundingClientRect(),i=e.targetTouches[0].pageX-t.left;this.selectHue(i)},this.hueTouchMove=e=>{e.stopPropagation();var t=e.target.getBoundingClientRect(),i=e.targetTouches[0].pageX-t.left;this.selectHue(i)},this.hueTouchEnd=e=>{e.stopPropagation(),this.hueSlide.removeEventListener("touchmove",this.hueTouchMove),document.removeEventListener("touchend",this.hueTouchEnd)},this.selectHue=e=>{e=n.uZ(e,0,this.width),this.hsb.h=Math.round(e/this.width*360),this.setHue(),this.updateColor()},this.setHue=()=>{this.hueKnob.style.left=this.hsb.h/360*this.width-2+"px";let e=this.satSlide.getContext("2d");e.fillStyle=r.Z.fromHSB(this.hsb.h,1,1).toHEX(),e.fillRect(0,0,this.satSlide.width,this.satSlide.height);var t=e.createLinearGradient(0,0,this.satSlide.width,0);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=t,e.fillRect(0,0,this.satSlide.width,this.satSlide.height);var i=e.createLinearGradient(0,0,0,this.satSlide.height);i.addColorStop(0,"rgba(0,0,0,0)"),i.addColorStop(1,"rgba(0,0,0,1)"),e.fillStyle=i,e.fillRect(0,0,this.satSlide.width,this.satSlide.height)},this.selectPod=e=>{var t;let i=e.currentTarget;if(i.classList.contains("selected")&&!this.extended)"block"==this.selector.style.display?this.selector.style.display="none":(this.selector.style.display="block",this.setHex(i.getAttribute("data")));else{if(null===(t=this.selected)||void 0===t||t.classList.remove("selected"),this.selected=i,this.selected.classList.add("selected"),this.selector.style.display="block","empty"===i.getAttribute("data"))return void(this.callback&&this.callback(void 0));this.setHex(i.getAttribute("data"),!0)}},this.updateColor=(e=!0,t=!0)=>{clearTimeout(this.setTimer),this.color=r.Z.fromHSB(this.hsb.h,this.hsb.s,this.hsb.b);const i=this.color.toHEX();this.hexInput.value=i,t&&this.selected&&(this.selected.classList.contains("empty")&&(this.selected.classList.remove("selected"),this.selected=this.selected.nextElementSibling,this.selected.classList.add("selected")),this.selected.setAttribute("data",i),this.selected.style.backgroundColor=i),this.setTimer=setTimeout((()=>{this.callback&&e&&this.callback(this.color)}),50)},this.hexInputInput=e=>{/^#[0-9A-F]{6}$/i.test(this.hexInput.value)&&this.setHex(this.hexInput.value,!1)},this.hexInputBlur=e=>{/^#[0-9A-F]{6}$/i.test(this.hexInput.value)?this.setHex(this.hexInput.value,!0):this.hexInput.value=this.getHex()},this.setColor=(e,t=!1)=>{this.hsb=e.toHSB(),this.setHue(),this.setSat(),this.updateColor(t,!0)},this.setHex=(e,t=!1)=>this.setColor(r.Z.fromHEX(e),t),this.getHex=()=>this.color.toHEX(),this.getColor=()=>this.color,this.holder=e,this.callback=i,this.width=h,this.height=c,this.extended=l,this.holder.innerHTML="",this.presets=(0,s.T)("div",{className:"color-selector-presets",style:"width:"+this.width+"px"}),l){this.presets.classList.add("extended");let e=(0,s.T)("div",{className:"color-pod square empty"});e.addEventListener("click",this.selectPod,!1),e.setAttribute("data","empty"),void 0===t[0]&&(e.classList.add("selected"),this.selected=e),this.presets.appendChild(e)}for(let s=0;s<t.length;++s)if(void 0!==t[s]){let e=document.createElement("div");e.addEventListener("click",this.selectPod,!1),e.style.backgroundColor=t[s],e.setAttribute("data",t[s]),e.className=l?"color-pod square":"color-selector-pod",this.presets.appendChild(e),s+1===t.length&&e.classList.add("last"),0!==s||l||(this.selected=e,e.classList.add("selected"))}this.selector=(0,s.T)("div",{className:"color-selector-selector",style:"width:"+this.width+"px"}),l?(this.selector.style.display="block",this.presets.classList.add("pad-10"),this.holder.append(this.selector,(0,s.T)("div",{className:"splitter pad-10"}),this.presets)):(this.selector.classList.add("pad-16"),this.holder.append(this.presets,this.selector));let u=document.createElement("div");u.classList.add("color-selector-sat"),u.style.width=this.width+"px",u.style.height=this.height+"px",this.selector.appendChild(u),this.satSlide=n.vL(this.width,this.height),this.satSlide.addEventListener("mousedown",this.satMouseDown,!1),this.satSlide.addEventListener("touchstart",this.satTouchStart,{passive:!1}),this.satSlide.classList.add("color-selector-sat-slide"),u.appendChild(this.satSlide),this.satKnob=document.createElement("div"),this.satKnob.classList.add("color-selector-sat-knob","ic"),u.appendChild(this.satKnob);let p=document.createElement("div");if(p.classList.add("color-selector-hue"),p.style.width=this.width+"px",this.selector.appendChild(p),this.hueSlide=document.createElement("div"),this.hueSlide.style.width=this.width+"px",this.hueSlide.addEventListener("mousedown",this.hueMouseDown,!1),this.hueSlide.addEventListener("touchstart",this.hueTouchStart,{passive:!1}),this.hueSlide.classList.add("color-selector-hue-slide"),p.appendChild(this.hueSlide),this.hueKnob=document.createElement("div"),this.hueKnob.classList.add("color-selector-hue-knob","ic"),p.appendChild(this.hueKnob),this.hexInput=document.createElement("input"),this.hexInput.type="text",this.hexInput.spellcheck=!1,this.hexInput.maxLength=7,this.hexInput.addEventListener("input",this.hexInputInput,!1),this.hexInput.addEventListener("blur",this.hexInputBlur,!1),this.hexInput.classList.add("color-selector-input"),this.selector.appendChild(this.hexInput),o){let e=document.createElement("a");e.classList.add("color-selector-pick"),e.classList.add("button","outline"),e.innerHTML='<img src="/img/tool/thick/picker.svg" class="ic" width="16" height="16" loading="lazy"/>',e.addEventListener("click",this.activeColorPick,!1),this.selector.appendChild(e)}this.hsb=r.Z.fromHEX(null!==(d=t[0])&&void 0!==d?d:"#ffffff").toHSB(),this.setHue(),this.setSat(),this.updateColor(!1,!!t[0])}}},99924:(e,t,i)=>{i.d(t,{C:()=>a,Z:()=>n});var s=i(93947);class n{constructor(e,t,i,s,n){this.name=e,this.callback=t,this.short=i,this.icon=s,this.sub=n}}class a{constructor(e,t,i=!1){this.addItem=(e,t)=>{if(e.name)if(e.sub){const i=(0,s.T)("ul"),n=(0,s.T)("li",{className:"more"},e.icon?(0,s.T)("img",{src:e.icon}):"",e.name,i);for(const t of e.sub)this.addItem(t,i);t.append(n)}else e.callback?t.appendChild((0,s.T)("li",{onclick:()=>{e.callback(),this.cleanUp()}},e.icon?(0,s.T)("img",{src:e.icon}):"",e.name,e.short?(0,s.T)("span",{},e.short):"")):t.appendChild((0,s.T)("li",{className:"disabled"},e.icon?(0,s.T)("img",{src:e.icon}):"",e.name,e.short?(0,s.T)("span",{},e.short):""));else t.appendChild((0,s.T)("li",{className:"split"}))},this.cleanUp=()=>{this.holder.removeEventListener("mouseleave",this.cleanUp),this.holder.remove(),this.holder=void 0,this.id=void 0},this.id=Math.round(99999999999999*Math.random()).toString(),this.holder=(0,s.T)("div",{id:this.id,className:"overflow-menu-holder"}),this.holder.addEventListener("contextmenu",(e=>(e.stopPropagation(),e.preventDefault(),!1))),this.holder.style.display="block",this.holder.style.left=i?e.x-235+"px":e.x-5+"px",this.list=(0,s.T)("ul",{className:"overflow-menu"}),this.holder.appendChild(this.list);for(const s of t)this.addItem(s,this.list);this.holder.addEventListener("mouseleave",this.cleanUp);const n="block"===(0,s.ZP)("workspace").style.display?(0,s.ZP)("workspace"):(0,s.ZP)("home");n.appendChild(this.holder),e.y+this.holder.clientHeight>n.scrollHeight?this.holder.style.top=e.y+5-this.holder.clientHeight+"px":this.holder.style.top=e.y-5+"px"}}},39868:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(93947),n=i(96548),a=i(23868);class r extends a.Z{constructor(){super((0,n.Z)("dialogChoiceTitle"),!0),this.init=()=>new Promise(((e,t)=>{const i=this.content.querySelector("#open-as-new"),s=this.content.querySelector("#open-in-current");this.cancel=()=>{this.cleanUp(),e("close")},i.onclick=()=>{this.cleanUp(),e("create")},s.onclick=()=>{this.cleanUp(),e("layer")}})),this.setContent(`    \n            ${(0,n.Z)("dialogChoiceHeadline")}\n            <ul class="push-buttons pad-20" style="text-align: center">\n                <li id="open-as-new">\n                    <img src="/img/icon/document-new.svg" class="ic" />\n                    <span>${(0,n.Z)("createNew")}</span>\n                </li>\n                <li id="open-in-current">\n                    <img src="/img/icon/document-add.svg" class="ic" />\n                    <span>${(0,n.Z)("addCurrent")}</span>\n                </li>\n            </ul>\n        `),(0,s.ZP)("dialog-buttons"+this.mid).style.display="none"}}},15181:(e,t,i)=>{i.d(t,{Z:()=>l});var s=i(96548),n=i(33655),a=i(93947),r=i(23868),o=i(98776),h=i(43673),c=i(74820);class l extends r.Z{constructor(e,t,i){var r;super((0,s.Z)("titleColorPicker"),!1),this.hue=0,this.sat=0,this.bri=1,this.setHistory=e=>{let t=o.Z.fromRGB(e.currentTarget.style.backgroundColor);this.setColor(t)},this.pickerPreviewColor=e=>{let t=new h.Z(e.clientX,e.clientY);if(this.colorPreview.style.top=t.y-50+"px",this.colorPreview.style.left=t.x+10+"px",this.colorPreview.style.display="block",t.x-=this.stageC.offsetLeft,t.y-=this.stageC.offsetTop,e.target!==this.modal||t.x<0||t.y<0||t.x>this.stageC.width||t.y>this.stageC.height)return void(this.colorPreview.style.display="none");let i=this.stageCanvasCTX.getImageData(t.x,t.y,1,1).data;this.colorPreview.style.backgroundColor=new o.Z(i[0],i[1],i[2]).toHEX()},this.pickerPreviewLeave=()=>{this.colorPreview.style.display="none"},this.pickerSetColor=e=>{let t=new h.Z(e.clientX-this.stageC.offsetLeft,e.clientY-this.stageC.offsetTop);if(e.target!==this.modal||t.x<0||t.y<0||t.x>this.stageC.width||t.y>this.stageC.height)return;let i=this.stageCanvasCTX.getImageData(t.x,t.y,1,1).data;this.setColor(new o.Z(i[0],i[1],i[2]))},this.satMouseDown=e=>{e.stopPropagation(),document.addEventListener("mousemove",this.satMouseMove,!0),document.addEventListener("mouseup",this.satMouseUp,!0);var t=this.satSlide.getBoundingClientRect(),i=e.pageX-t.left,s=e.pageY-t.top;this.selectSat(i,s)},this.satMouseMove=e=>{e.stopPropagation();var t=this.satSlide.getBoundingClientRect(),i=e.pageX-t.left,s=e.pageY-t.top;this.selectSat(i,s)},this.satMouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.satMouseMove,!0),document.removeEventListener("mouseup",this.satMouseUp,!0)},this.satTouchStart=e=>{e.stopPropagation(),document.addEventListener("touchmove",this.satTouchMove,!0),document.addEventListener("touchend",this.satTouchEnd,!0);var t=this.satSlide.getBoundingClientRect(),i=e.targetTouches[0].pageX-t.left,s=e.targetTouches[0].pageY-t.top;this.selectSat(i,s)},this.satTouchMove=e=>{e.stopPropagation();var t=this.satSlide.getBoundingClientRect(),i=e.targetTouches[0].pageX-t.left,s=e.targetTouches[0].pageY-t.top;this.selectSat(i,s)},this.satTouchEnd=e=>{e.stopPropagation(),document.removeEventListener("touchmove",this.satTouchMove,!0),document.removeEventListener("touchend",this.satTouchEnd,!0)},this.selectSat=(e,t)=>{e=n.uZ(e,0,256),t=n.uZ(t,0,256),this.sat=e/256,this.bri=1-t/256,this.setSatKnob(),this.calculateColor()},this.setSatKnob=()=>{this.satKnob.style.left=256*this.sat-9+"px",this.satKnob.style.top=256*(1-this.bri)-9+"px"},this.hueMouseDown=e=>{e.stopPropagation(),document.addEventListener("mousemove",this.hueMouseMove,!0),document.addEventListener("mouseup",this.hueMouseUp,!0);var t=this.hueSlide.getBoundingClientRect();this.selectHue(e.pageY-t.top)},this.hueMouseMove=e=>{e.stopPropagation();var t=this.hueSlide.getBoundingClientRect();this.selectHue(e.pageY-t.top)},this.hueMouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.hueMouseMove,!0),document.removeEventListener("mouseup",this.hueMouseUp,!0)},this.hueTouchStart=e=>{e.stopPropagation(),this.hueSlide.addEventListener("touchmove",this.hueTouchMove,!0),document.addEventListener("touchend",this.hueTouchEnd,!0);var t=e.target.getBoundingClientRect();this.selectHue(e.targetTouches[0].pageY-t.top)},this.hueTouchMove=e=>{e.stopPropagation();var t=e.target.getBoundingClientRect();this.selectHue(e.targetTouches[0].pageY-t.top)},this.hueTouchEnd=e=>{e.stopPropagation(),this.hueSlide.removeEventListener("touchmove",this.hueTouchMove,!0),document.removeEventListener("touchend",this.hueTouchEnd,!0)},this.selectHue=e=>{e=n.uZ(e,0,256),this.hue=Math.round(359-e/256*359),this.setHueKnob(),this.calculateColor()},this.setHueKnob=()=>{this.hueKnob.style.top=252-this.hue/359*254+"px";let e=this.satSlide.getContext("2d");e.fillStyle=o.Z.fromHSB(this.hue,1,1).toHEX(),e.fillRect(0,0,this.satSlide.width,this.satSlide.height);var t=e.createLinearGradient(0,0,this.satSlide.width,0);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=t,e.fillRect(0,0,this.satSlide.width,this.satSlide.height);var i=e.createLinearGradient(0,0,0,this.satSlide.height);i.addColorStop(0,"rgba(0,0,0,0)"),i.addColorStop(1,"rgba(0,0,0,1)"),e.fillStyle=i,e.fillRect(0,0,this.satSlide.width,this.satSlide.height)},this.calculateColor=()=>{this.color=o.Z.fromHSB(this.hue,this.sat,this.bri);var e=document.activeElement;this.hexInput.value=this.color.toHEX(),e!==this.hueInput&&(this.hueInput.value=Math.round(this.hue).toString()),e!==this.satInput&&(this.satInput.value=Math.round(100*this.sat).toString()),e!==this.briInput&&(this.briInput.value=Math.round(100*this.bri).toString()),e!==this.redInput&&(this.redInput.value=this.color.r.toString()),e!==this.greenInput&&(this.greenInput.value=this.color.g.toString()),e!==this.blueInput&&(this.blueInput.value=this.color.b.toString()),this.selected.style.backgroundColor=this.color.toRGBA(),this.preview&&n.Ds("preview",50,(()=>{this.preview(this.color)}))},this.hexInputChange=e=>{/^#[0-9A-F]{6}$/i.test(this.hexInput.value)&&this.setColor(o.Z.fromHEX(this.hexInput.value))},this.hueInputChange=e=>{this.hue=n.uZ(parseInt(this.hueInput.value),0,359),this.setHueKnob(),this.calculateColor()},this.satInputChange=e=>{this.sat=n.uZ(parseInt(this.satInput.value),0,100)/100,this.setSatKnob(),this.calculateColor()},this.briInputChange=e=>{this.bri=n.uZ(parseInt(this.briInput.value),0,100)/100,this.setSatKnob(),this.calculateColor()},this.redInputChange=e=>{this.color.r=n.uZ(parseInt(this.redInput.value),0,255),this.setColor(this.color)},this.greenInputChange=e=>{this.color.g=n.uZ(parseInt(this.greenInput.value),0,255),this.setColor(this.color)},this.blueInputChange=e=>{this.color.b=n.uZ(parseInt(this.blueInput.value),0,255),this.setColor(this.color)},this.setColor=e=>{this.color=null!=e?e:new o.Z;let t=Math.min(this.color.r,this.color.g,this.color.b),i=Math.max(this.color.r,this.color.g,this.color.b);this.bri=i/255;var s=i-t;s?(this.sat=s/i,this.color.r==i?this.hue=(this.color.g-this.color.b)/s*60:this.color.g==i?this.hue=60*(2+(this.color.b-this.color.r)/s):this.hue=60*(4+(this.color.r-this.color.g)/s),this.hue>360?this.hue-=360:this.hue<0&&(this.hue+=360),360===this.hue&&(this.hue=0)):this.hue=this.sat=0,this.setHueKnob(),this.setSatKnob(),this.calculateColor()},this.getColor=()=>this.color,this.getHex=()=>this.color.toHEX(),this.cancel=()=>{this.preview&&this.preview(this.current),this.cleanUp()},this.apply=()=>{this.callback&&(this.preview&&this.preview(this.current),(0,c.nS)(this.color),this.callback(this.color)),this.cleanUp()},this.cleanUp=()=>{document.dispatchEvent(new CustomEvent("viewport-render")),(0,a.ZP)("color-picker-history").querySelectorAll(".color-pod").forEach((e=>e.removeEventListener("click",this.setHistory))),this.satSlide.removeEventListener("mousedown",this.satMouseDown,!1),this.satSlide.removeEventListener("touchstart",this.satTouchStart),this.hueSlide.removeEventListener("mousedown",this.hueMouseDown,!1),this.hueSlide.removeEventListener("touchstart",this.hueTouchStart),this.hexInput.removeEventListener("input",this.hexInputChange,!1),this.hueInput.removeEventListener("input",this.hueInputChange,!1),this.satInput.removeEventListener("input",this.satInputChange,!1),this.briInput.removeEventListener("input",this.briInputChange,!1),this.redInput.removeEventListener("input",this.redInputChange,!1),this.greenInput.removeEventListener("input",this.greenInputChange,!1),this.blueInput.removeEventListener("input",this.blueInputChange,!1),this.modal.removeEventListener("mousedown",this.pickerSetColor,!0),this.modal.removeEventListener("mousemove",this.pickerPreviewColor,!0),this.modal.removeEventListener("mouseleave",this.pickerPreviewLeave,!0),document.removeEventListener("keydown",this.keyDown,!1),this.stageCanvasCTX=void 0,this.stageCanvas=void 0,this.stageC=void 0,this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.preview=i,this.callback=t,this.dialog.style.width="500px",this.content.style.paddingBottom="10px",(0,a.ZP)("dialog-apply"+this.mid).innerText="ok",this.setContent('\n            <div id="color-picker-selector">\n                <div id="color-picker-sat">\n                    <canvas id="color-picker-sat-slide"></canvas>\n                    <div id="color-picker-sat-knob" class="ic"></div>\n                </div>\n                <div id="color-picker-hue">\n                    <div id="color-picker-hue-slide"></div>\n                    <div id="color-picker-hue-knob" class="ic"></div>\n                </div>\n                <div id="color-picker-etc">\n                    <div id="color-picker-new"></div>\n                    <div id="color-picker-current"></div>\n\n                    <div id="color-picker-inputs">\n                        <div>\n                            <div>H:<input type="number"id="picker-input-hue"></div>\n                            <div>S:<input type="number"id="picker-input-sat"></div>\n                            <div>B:<input type="number"id="picker-input-bri"></div>\n                        </div>\n                        <div>\n                            <div>R:<input type="number"id="picker-input-red"></div>\n                            <div>G:<input type="number"id="picker-input-green"></div>\n                            <div>B:<input type="number"id="picker-input-blue"></div>\n                        </div>\n                    </div>\n                    <div id="color-picker-hex">\n                        HEX:<input type="text" spellcheck="false" maxlength="7" id="picker-input-hex">\n                    </div>\n                 </div>\n            </div>\n        ');let l=(0,a.T)("div",{id:"color-picker-history",className:"color-pod-list"});(0,a.ZP)("dialog-buttons"+this.mid).append(l),c.ZP.oldColor.forEach((e=>{let t=(0,a.T)("div",{className:"color-pod small"});t.style.backgroundColor=e,l.append(t)})),(0,a.ZP)("color-picker-history").querySelectorAll(".color-pod").forEach((e=>e.addEventListener("click",this.setHistory))),this.selected=(0,a.ZP)("color-picker-new"),this.selector=(0,a.ZP)("color-picker-selector"),this.satSlide=(0,a.ZP)("color-picker-sat-slide"),this.satKnob=(0,a.ZP)("color-picker-sat-knob"),this.hueSlide=(0,a.ZP)("color-picker-hue-slide"),this.hueKnob=(0,a.ZP)("color-picker-hue-knob"),this.satSlide.addEventListener("mousedown",this.satMouseDown,!1),this.satSlide.addEventListener("touchstart",this.satTouchStart,{passive:!1}),this.hueSlide.addEventListener("mousedown",this.hueMouseDown,!1),this.hueSlide.addEventListener("touchstart",this.hueTouchStart,{passive:!1}),this.hexInput=(0,a.ZP)("picker-input-hex"),this.hexInput.addEventListener("input",this.hexInputChange,!1),this.hueInput=(0,a.ZP)("picker-input-hue"),this.hueInput.addEventListener("input",this.hueInputChange,!1),this.satInput=(0,a.ZP)("picker-input-sat"),this.satInput.addEventListener("input",this.satInputChange,!1),this.briInput=(0,a.ZP)("picker-input-bri"),this.briInput.addEventListener("input",this.briInputChange,!1),this.redInput=(0,a.ZP)("picker-input-red"),this.redInput.addEventListener("input",this.redInputChange,!1),this.greenInput=(0,a.ZP)("picker-input-green"),this.greenInput.addEventListener("input",this.greenInputChange,!1),this.blueInput=(0,a.ZP)("picker-input-blue"),this.blueInput.addEventListener("input",this.blueInputChange,!1),"block"===(null===(r=(0,a.ZP)("workspace"))||void 0===r?void 0:r.style.display)&&(this.modal.style.cursor="crosshair",this.colorPreview=document.createElement("div"),this.colorPreview.id="color-picker-preview",this.colorPreview.style.display="none",this.modal.appendChild(this.colorPreview),this.modal.addEventListener("mousedown",this.pickerSetColor,!0),this.modal.addEventListener("mousemove",this.pickerPreviewColor,!0),this.modal.addEventListener("mouseleave",this.pickerPreviewLeave,!0),this.stageC=document.getElementsByClassName("canvas")[0],this.stageCanvas=n.dN(this.stageC),this.stageCanvasCTX=this.stageCanvas.getContext("2d")),(0,a.ZP)("color-picker-current").style.backgroundColor=e?e.toHEX():"#ffffff",this.current=e,this.setColor(e)}}},7976:(e,t,i)=>{i.d(t,{Z:()=>a});var s=i(23868),n=i(93947);class a extends s.Z{constructor(e,t,i,s,a){super(e,!0),this.init=()=>new Promise(((e,t)=>{this.cancel=()=>{this.cleanUp(),e(!1)},this.condition=()=>{this.cleanUp(),e(void 0)},this.apply=()=>{this.cleanUp(),e(!0)}})),this.setContent((0,n.T)("p",t)),i&&((0,n.ZP)("dialog-apply"+this.mid).innerText=i),s&&((0,n.ZP)("dialog-cancel"+this.mid).innerText=s),a&&(0,n.ZP)("dialog-cancel"+this.mid).before((0,n.T)("a",{id:"dialog-condition"+this.mid,className:"button negative",style:"position:absolute;left:10px;",onclick:()=>this.condition()},a))}}},23868:(e,t,i)=>{i.d(t,{Z:()=>h});var s=i(96548),n=i(33655),a=i(43673),r=i(74820),o=i(93947);class h{constructor(e,t=!0,i=!1){this.setContent=(...e)=>{e[0]instanceof HTMLElement?this.content.append(...e):this.content.innerHTML+=e[0],this.position()},this.disableApply=()=>{const e=(0,o.ZP)("dialog-apply"+this.mid);e.classList.add("disabled"),e.onclick=void 0},this.enableApply=()=>{const e=(0,o.ZP)("dialog-apply"+this.mid);e.classList.remove("disabled"),e.onclick=()=>this.apply()},this.disableCancel=()=>{const e=(0,o.ZP)("dialog-cancel"+this.mid);e.classList.add("disabled"),e.onclick=void 0},this.enableCancel=()=>{const e=(0,o.ZP)("dialog-cancel"+this.mid);e.classList.remove("disabled"),e.onclick=()=>this.cancel()},this.position=()=>{this.dialog.style.left=Math.round((this.modal.offsetWidth-this.dialog.offsetWidth)/2+r.ZP.dialogPos.x)+"px",this.dialog.style.top=Math.round((this.modal.offsetHeight-this.dialog.offsetHeight)/2+r.ZP.dialogPos.y)+"px";let e=this.dialog.getBoundingClientRect(),t=this.modal.getBoundingClientRect();e.bottom>t.bottom&&(this.dialog.style.top=t.height-e.height<0?"0px":t.height-e.height+"px"),e.right>t.right&&(this.dialog.style.left=t.width-e.width<0?"0px":t.width-e.width+"px"),this.dialog.offsetTop<0&&(this.dialog.style.top="0px"),this.dialog.offsetLeft<0&&(this.dialog.style.left="0px")},this.dragStart=e=>{this.p=e,this.d=new a.Z(this.dialog.offsetLeft,this.dialog.offsetTop)},this.dragMove=e=>{this.dialog.style.left=Math.round(this.d.x+(e.x-this.p.x))+"px",this.dialog.style.top=Math.round(this.d.y+(e.y-this.p.y))+"px"},this.dragEnd=e=>{r.ZP.dialogPos.x=Math.round(this.dialog.offsetLeft-(this.modal.offsetWidth-this.dialog.offsetWidth)/2),r.ZP.dialogPos.y=Math.round(this.dialog.offsetTop-(this.modal.offsetHeight-this.dialog.offsetHeight)/2)},this.resizeStart=e=>{this.d=new a.Z(this.dialog.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.dialog.style.height=(t<320?320:t)+"px"},this.keyDown=e=>{27!=e.keyCode||"none"===(0,o.ZP)("dialog-cancel"+this.mid).style.display?13!=e.keyCode||"none"===(0,o.ZP)("dialog-apply"+this.mid).style.display||e.shiftKey||(0,o.ZP)("dialog-apply"+this.mid).classList.contains("disabled")||this.apply():this.cancel()},this.condition=()=>{this.cleanUp()},this.cancel=()=>{this.cleanUp()},this.apply=()=>{this.cleanUp()},this.cleanUp=()=>{document.removeEventListener("keydown",this.keyDown,!1),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.mid=n.Zd(),this.modal=(0,o.T)("div",{id:"modal-"+this.mid,className:"modal"}),t&&this.modal.classList.add("dim"),document.body.appendChild(this.modal),this.dialog=(0,o.T)("div",{className:"dialog"}),this.modal.appendChild(this.dialog),this.content=(0,o.T)("div",{className:"content"});const h=(0,o.T)("div",{id:"dialog-title",className:"title"},e);if((0,o.Rg)(h,this.dragStart,this.dragMove,this.dragEnd),this.dialog.append(h,(0,o.T)("img",{id:"dialog-close"+this.mid,className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.cancel()}),(0,o.T)("div",{id:"dialog-splitter"+this.mid,className:"splitter"}),this.content,(0,o.T)("div",{className:"buttons",id:"dialog-buttons"+this.mid},(0,o.T)("a",{id:"dialog-apply"+this.mid,className:"button positive",onclick:()=>this.apply()},(0,s.Z)("apply")),(0,o.T)("a",{id:"dialog-cancel"+this.mid,className:"button negative",onclick:()=>this.cancel()},(0,s.Z)("cancel")))),i){const e=(0,o.T)("img",{id:"resize-"+this.mid,src:"/img/icon/three-dot.svg",className:"resize ic"});(0,o.Rg)(e,this.resizeStart,this.resizeMove),this.dialog.append(e)}document.addEventListener("keydown",this.keyDown,!1)}}},4375:(e,t,i)=>{i.d(t,{Z:()=>c});var s=i(93947),n=i(96548),a=i(23868),r=i(71030),o=i(95574);class h extends a.Z{constructor(e={}){super((0,n.Z)("dialogLoadTitle")),this.load=async e=>{(0,r.Z)("load-url");const t=(0,s.ZP)("load-message");try{this.cancel=()=>{throw h.CANCEL};const i=this.settings.title||(0,n.Z)("image"),a=this.settings.referrer||(0,n.Z)("source");t.innerText=(0,n.Z)("dialogLoadLoadingFrom",i.toLowerCase(),a.toLowerCase());const r=await(0,o.c6)(e,(e=>{const t=(0,s.ZP)("load-progress");-1==e?t.removeAttribute("value"):t.value=e})),c=new File([r],this.settings.title||e.substring(e.lastIndexOf("/")+1),{type:r.type});return this.cleanUp(),c}catch(i){if(i===h.CANCEL)return void this.cleanUp();(0,s.ZP)("load-progress")&&(t.innerText=(0,n.Z)("dialogLoadError"),(0,s.ZP)("load-progress").style.display="none",this.cancel=()=>{this.cleanUp()})}},this.settings=e,this.setContent('\n            <p id="load-message"></p><br />\n\n            <progress id="load-progress" value="0" max="100" style="width: 100%;"></progress>\n            <br><br>\n        '),(0,s.ZP)("dialog-apply"+this.mid).style.display="none";(0,s.ZP)("load-message").innerText=(0,n.Z)("dialogLoadPrepare")}}h.CANCEL=new Error("CANCEL");const c=h},43747:(e,t,i)=>{i.d(t,{Z:()=>h});var s=i(93947),n=i(96548),a=i(4375),r=i(23868),o=i(75934);class h extends r.Z{constructor(e,t=!0){super((0,n.Z)("dialogOpenURLTitle")),this.apply=async()=>{let e=(0,s.ZP)("image-url").value;if(this.cleanUp(),""!==e){const t=e.substring(e.lastIndexOf("/")+1);e="https://pixlr.com/proxy/?url="+encodeURIComponent(e);const i=new a.Z({title:t});let s=await i.load(e);o.ZB(this.stage,s,this.askToAdd)}},this.stage=e,this.askToAdd=t,this.setContent(`\n            <label>${(0,n.Z)("dialogOpenURLHeadline")}</label>\n            <input type="url" id="image-url" style="width: 100%" placeholder='https://example.com/this-image.jpg' />\n        `),(0,s.ZP)("dialog-apply"+this.mid).innerText=(0,n.Z)("load"),setTimeout((()=>{(0,s.ZP)("image-url").focus()}),300)}}},31971:(e,t,i)=>{i.d(t,{Z:()=>h});var s=i(96548),n=i(23868),a=i(98776),r=i(92397),o=i(74820);class h extends n.Z{constructor(e){super((0,s.Z)("titlePageColor"),!1),this.change=e=>{this.stage.fresco.color=e?e.toHEX():void 0,window.requestAnimationFrame((()=>{this.stage.render()}))},this.apply=()=>{this.stage.history.add({type:"background",color:this.current}),this.stage.fresco.color&&(0,o.nS)(a.Z.fromHEX(this.stage.fresco.color)),this.cleanUp()},this.cancel=()=>{this.stage.fresco.color=this.current,document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.dialog.style.width="340px",this.stage=e,this.current=this.stage.fresco.color,this.colorselector=new r.Z(this.content,[this.current,...o.ZP.oldColor.slice(),"#ffffff","#000000"],this.change,!0,300,120,!0),this.position()}}},56584:(e,t,i)=>{i.d(t,{Z:()=>l});var s=i(93947),n=i(96548),a=i(33655),r=i(23868),o=i(99872),h=i(74820),c=i(33506);class l extends r.Z{constructor(e,t){if(super((0,n.Z)("dialogPreResizeTitle")),this.rotation=0,this.size=1920,this.init=()=>new Promise(((e,t)=>{this.apply=()=>{(0,s.ZP)("preresize-never-ask-again").checked&&(0,h.Lt)("askToPreResize",!1);const t=new o.Z(Number((0,s.ZP)("pre-resize-width").value),Number((0,s.ZP)("pre-resize-height").value)),i=(0,s.ZP)("pre-resize-auto-rotate").checked?this.rotation:0;this.cleanUp(),e([t,i])},this.cancel=()=>{this.cleanUp(),e([void 0,void 0])}})),this.presetChange=e=>{let t=e.currentTarget,i=(0,s.ZP)("pre-resize-preset").getElementsByTagName("li");for(var n=0;n<i.length;n++)i[n].classList.remove("selected");t.classList.add("selected"),this.size=Number(t.getAttribute("data")),this.setSize()},this.imageSizeInputChange=e=>{let t,i,n=e.currentTarget;"pre-resize-width"===n.id?(t=a.uZ(Number(n.value),1,this.width),i=Math.round(t/this.width*this.height)):(i=a.uZ(Number(n.value),1,this.height),t=Math.round(i/this.height*this.width)),(0,s.ZP)("pre-resize-height").value=i.toString(),(0,s.ZP)("pre-resize-width").value=t.toString()},this.setSize=()=>{let e=(0,s.ZP)("pre-resize-width"),t=(0,s.ZP)("pre-resize-height");this.width>this.height?(e.value=this.size.toString(),t.value=Math.round(this.size/this.width*this.height).toString()):(t.value=this.size.toString(),e.value=Math.round(this.size/this.height*this.width).toString())},"premium"===(null===c.a||void 0===c.a?void 0:c.a.subscriptionAccess)?this.dialog.style.width="560px":this.dialog.style.width="480px",this.image=e,90===t||-90===t?(this.height=e.width,this.width=e.height):(this.width=e.width,this.height=e.height),this.rotation=t,this.setContent(`\n            <span style="display: block;">${(0,n.Z)("dialogPreResizeInfo1")} (<span id="pre-resize-start"></span>) ${(0,n.Z)("dialogPreResizeInfo2")}</span>\n\n            <input type="checkbox" id="preresize-never-ask-again" />\n            <label class="switch pad-10" for="preresize-never-ask-again">${(0,n.Z)("neverAskMeAgain")}<span></span></label>\n\n            <span id="pre-resize-auto-rotate-setting" style="display:none;">\n                <input type="checkbox" checked id="pre-resize-auto-rotate" />\n                <label class="switch pad-20" for="pre-resize-auto-rotate">${(0,n.Z)("dialogPreResizeExif")}<span></span></label>\n            </span>\n        \n            <ul id="pre-resize-preset" class="push-buttons pad-20">\n                <li id="pre-resize-original" data="4096"><img src="/img/icon/layer-image.svg" class="ic"><span>${(0,n.Z)("original")}<br /><small id="pre-resize-uhd-size">Max 3840 px</small></span></li>\n                <li id="pre-resize-uhd" data="3840"><img src="/img/icon/size-uhd.svg" class="ic"><span>${(0,n.Z)("sizeUltraHD")}<br /><small>Max 3840 px</small></span></li>\n                <li id="pre-resize-fhd" data="1920" class="selected"><img src="/img/icon/size-fhd.svg" class="ic"><span>${(0,n.Z)("sizeFullHD")}<br /><small>Max 1920 px</small></span></li>\n                <li id="pre-resize-uhd" data="1280"><img src="/img/icon/size-web.svg" class="ic"><span>${(0,n.Z)("sizeWeb")}<br /><small>Max 1280 px</small></span></li>\n            </ul>\n\n            <div class="pad-20" style="text-align:right;line-height:32px;">${(0,n.Z)("newSize")}<input type="number" style="text-align:center;margin-left:16px" id="pre-resize-width"/> x <input type="number" style="text-align:center" id="pre-resize-height"/></div>\n        `),this.maxSize="premium"===(null===c.a||void 0===c.a?void 0:c.a.subscriptionAccess)?8192:4096,"premium"===(null===c.a||void 0===c.a?void 0:c.a.subscriptionAccess)?(this.width<3840&&this.height<3840&&((0,s.ZP)("pre-resize-uhd").style.display="none"),(0,s.ZP)("pre-resize-original").setAttribute("data",Math.min(Math.max(this.width,this.height),this.maxSize).toString()),(0,s.ZP)("pre-resize-uhd-size").innerText=(0,n.Z)("dialogPreResizeMaxSize",Math.min(Math.max(this.width,this.height),this.maxSize))):this.width<3840&&this.height<3840?((0,s.ZP)("pre-resize-uhd").style.display="none",(0,s.ZP)("pre-resize-original").setAttribute("data",Math.max(this.width,this.height).toString()),(0,s.ZP)("pre-resize-uhd-size").innerText=(0,n.Z)("dialogPreResizeMaxSize",Math.max(this.width,this.height))):(0,s.ZP)("pre-resize-original").style.display="none",0!==t){let e=(0,s.ZP)("pre-resize-auto-rotate-setting");e.style.display="block",e.addEventListener("change",(()=>{let e=(0,s.ZP)("pre-resize-width"),t=(0,s.ZP)("pre-resize-height");const i=e.value;e.value=t.value,t.value=i}),!1)}(0,s.ZP)("pre-resize-start").innerText=this.width.toString()+" x "+this.height.toString();let i=(0,s.ZP)("pre-resize-preset").getElementsByTagName("li");for(var r=0;r<i.length;r++)i[r].addEventListener("click",this.presetChange,!1);this.setSize(),(0,s.ZP)("pre-resize-width").addEventListener("change",this.imageSizeInputChange,!1),(0,s.ZP)("pre-resize-height").addEventListener("change",this.imageSizeInputChange,!1)}}},9579:(e,t,i)=>{i.d(t,{Z:()=>f});var s=i(96548),n=i(23868),a=i(93947),r=i(36817),o=i(99872),h=i(33655),c=i(43673),l=i(44170),d=i(94178),u=i(78685),p=i(51294),g=i(82282),m=i(87108),v=i(77664);class f extends n.Z{constructor(e){super((0,s.Z)("dialogResizeTitle"),!0,!0),this.anchor="CC",this.constrain=!0,this.messy=!1,this.saving=!1,this.selectPreset=e=>{if(this.saving)return;let t=e.currentTarget.getAttribute("data");if(-1!==t.indexOf(":")){const e=Number(t.split(":")[0]),i=Number(t.split(":")[1]);let s=this.source.width,n=this.source.height;s=n=s>n?s:n,e/i>1?n=Math.floor(n/(e/i)):s=Math.floor(s/(i/e)),this.setSize(s,n)}else{const e=t.split("x");this.setSize(Number(e[0]),Number(e[1]))}},this.changeContraint=e=>{this.saving||(this.constrain=!this.constrain,(0,a.ZP)("resize-size-lock").style.display=this.constrain?"block":"none",(0,a.ZP)("resize-size-vs").style.display=this.constrain?"none":"block",(0,a.ZP)("toggle-resize-constraint").checked=this.constrain)},this.setMethod=e=>{this.saving||(this.method=e,(0,a.ZP)("resize-smoothing-label").style.display="scale"===this.method?"block":"none",(0,a.ZP)("resize-stretch-label").style.display="scale"===this.method?"block":"none",(0,a.ZP)("resize-anchor").style.display="size"===this.method?"flex":"none",this.calculateResize())},this.setSize=(e,t)=>{this.target.width=e,this.target.height=t,(0,a.ZP)("resize-width").value=e.toString(),(0,a.ZP)("resize-height").value=t.toString(),this.calculateResize()},this.sizeInputChange=e=>{if(this.saving)return;let t=null==e?void 0:e.currentTarget;if("resize-width"==t.id){if(this.target.width=h.uZ(Number(t.value),1,this.maxSize),this.constrain){let e=this.target.width/this.source.width;this.target.height=Math.round(e*this.source.height),(0,a.ZP)("resize-height").value=this.target.height.toString()}}else if(this.target.height=h.uZ(Number(t.value),1,this.maxSize),this.constrain){let e=this.target.height/this.source.height;this.target.width=Math.round(e*this.source.width),(0,a.ZP)("resize-width").value=this.target.width.toString()}t!=document.activeElement&&((0,a.ZP)("resize-width").value=this.target.width.toString(),(0,a.ZP)("resize-height").value=this.target.height.toString()),h.Ds("resize",250,this.calculateResize)},this.anchorChange=e=>{if(this.saving)return;let t=e.currentTarget,i=(0,a.ZP)("resize-anchor-grid").getElementsByClassName("box");for(var s=0;s<i.length;s++)i[s].classList.remove("selected");t.classList.add("selected"),this.anchor=t.getAttribute("data"),this.calculateResize()},this.calculateResize=(e=this.method,t=!1)=>{if(!this.saving||t){if(this.reset(),this.target.width!==this.source.width||this.target.height!==this.source.height){switch(e){case"size":let e=this.target.width-this.source.width,i=this.target.height-this.source.height;if("TL"!=this.anchor){"CL"!=this.anchor&&"BL"!=this.anchor||(e=0),"TC"!=this.anchor&&"CC"!=this.anchor&&"BC"!=this.anchor||(e=Math.round(e/2)),"TC"!=this.anchor&&"TR"!=this.anchor||(i=0),"CL"!=this.anchor&&"CC"!=this.anchor&&"CR"!=this.anchor||(i=Math.round(i/2));for(const t of this.stage.fresco.layers)t.rect&&(t.rect.x+=e,t.rect.y+=i,t.bect&&(t.bect.x+=e,t.bect.y+=i))}break;case"scale":let s=0,n=0,r=new c.Z(this.target.width/this.source.width,this.target.height/this.source.height);const o="smart"===this.method||(0,a.ZP)("resize-stretch").checked;r.x!==r.y&&o&&(this.source.width/this.source.height>this.target.width/this.target.height?(r.x=r.y=this.target.width/this.source.width,n=Math.round(.5*(this.target.height-this.source.height*r.y))):(r.x=r.y=this.target.height/this.source.height,s=Math.round(.5*(this.target.width-this.source.width*r.x))));for(const t of this.stage.fresco.layers)if(t.rect){let e=r.x,i=r.y;if(t.rect.rotation){let s=t.rect.rotation>180?t.rect.rotation-180:t.rect.rotation,n=Math.abs(90-s)/90;e=r.x*n+r.y*(1-n),i=r.y*n+r.x*(1-n)}t.rect.x=s+Math.round(t.rect.x*r.x),t.rect.y=n+Math.round(t.rect.y*r.y),e!==i&&t instanceof u.Z?(t.rect.x+=.5*Math.round(t.rect.width*e-t.rect.width*i),t.rect.width=Math.round(t.rect.width*i),t.rect.height=Math.round(t.rect.height*i)):(t.rect.width=Math.round(t.rect.width*e),t.rect.height=Math.round(t.rect.height*i)),t.rect.width<1&&(t.rect.width=1),t.rect.height<1&&(t.rect.height=1),t instanceof u.Z?t.scaleBect(i):t instanceof p.Z?t.scaleTrim(e,i):t.render()}break;case"smart":if(Math.round(this.target.width/this.source.width*1e3)===Math.round(this.target.height/this.source.height*1e3))return void this.calculateResize("scale",t);this.calculateSmartResize()}this.messy=!0}this.preview.width=this.target.width,this.preview.height=this.target.height,(0,a.ZP)("preview-scale-label").innerText=(this.preview.offsetWidth/this.target.width*100).toFixed(1)+"%",this.stage.renderOutputFrame(this.ctx,!1,void 0===this.stage.fresco.color)}},this.calculateSmartResize=()=>{const e=this.target.width===this.target.height?"square":this.target.width>this.target.height?"landscape":"portrait",t=this.source.width===this.source.height?"square":this.source.width>this.source.height?"landscape":"portrait";if(t===e||"square"===t||"square"===e){const e=new c.Z(this.target.width/this.source.width,this.target.height/this.source.height);for(const t of this.stage.fresco.layers)if(t.rect)if(t.rect.width>=this.source.width&&t.rect.height>=this.source.height&&(t.type===l.Z.TYPE_SHAPE||t.type===l.Z.TYPE_IMAGE||t.type===l.Z.TYPE_FRAME))t instanceof p.Z?(t.rect.x=t.rect.y=0,t.rect.width=this.target.width,t.rect.height=this.target.height,t.fitContent()):(t.rect=r.Z.fillFit(t.rect.width,t.rect.height,this.target.width,this.target.height),t.render());else{const i=this.source.width>this.source.height?.2*this.source.width:.2*this.source.height;this.positionAndScaleLayer(t,e,i)}}else{const t=new Array,i=new Array,s=new Array;for(const o of this.stage.fresco.layers)if(o.rect)if(o.rect.width>=.65*this.source.width&&o.rect.height>=.65*this.source.height&&(o.type===l.Z.TYPE_SHAPE||o.type===l.Z.TYPE_IMAGE||o.type===l.Z.TYPE_ELEMENT||o.type===l.Z.TYPE_FRAME)){let e=new c.Z(this.target.width/this.source.height,this.target.height/this.source.width);if(o instanceof g.Z||o instanceof v.Z){let t=e.x<e.y?e.y:e.x;o.rect.width>=this.source.width&&o.rect.height>=this.source.height&&(t=e.x>e.y?e.y:e.x);let i=o.rect.center();o.rect.width=Math.round(o.rect.width*t),o.rect.height=Math.round(o.rect.height*t),o.rect.setCenter(new c.Z(Math.round(i.y*e.x),Math.round(i.x*e.y))),o.rect.rotation+=90}else o.rect=o.rect.flipWidthAndHeight(),o.rect.x=Math.floor(o.rect.x*e.x),o.rect.y=Math.floor(o.rect.y*e.y),o.rect.width=Math.round(o.rect.width*e.x),o.rect.height=Math.round(o.rect.height*e.y),o instanceof p.Z?o.fitContent():o.render()}else{let n=o.rect.center();"portrait"===e?n.x>.45*this.source.width&&n.x<.55*this.source.width?s.push(o):n.x>=.5*this.source.width?(o.rect.x-=.5*this.source.width,i.push(o)):t.push(o):n.y>=.5*this.source.height?(o.rect.y-=.5*this.source.height,i.push(o)):t.push(o)}const n=this.stage.fresco.getStackBounds(t),a=this.stage.fresco.getStackBounds(i),r=this.stage.fresco.getStackBounds(s);if("portrait"===e){const e=.2*this.source.height;let h=new o.Z(.5*this.source.width,this.source.height),l=new o.Z(this.target.width,.5*this.target.height);if(n){let i=new c.Z(l.width/h.width,l.height/h.height);n.x>0&&n.width<1.5*h.width?i.x=l.width/(n.width+2*n.x):n.x<=0&&n.width>.5*h.width&&(i.x=i.x=l.width/n.width);for(const s of t)this.positionAndScaleLayer(s,i,e)}if(a){let t=0,s=new c.Z(l.width/h.width,l.height/h.height);a.x>=0&&a.right()<=h.width&&a.width<1.5*h.width?(t=h.width-a.right()-a.x,s.x=l.width/(a.width+2*(h.width-a.right()))):a.x<=0&&a.width>.5*h.width&&(t=Math.abs(a.x),s.x=l.width/(a.width-(a.right()-h.width)));for(const n of i)n.rect.x+=t,this.positionAndScaleLayer(n,s,e),n.rect.y+=.5*this.target.height,n.bect&&(n.bect.y+=.5*this.target.height)}if(r){let e=r.width/this.source.width>.5?.95*this.target.width/r.width:this.target.width/(.5*this.source.width);for(const t of s){let i=t.rect.center();t.rect.width=Math.round(t.rect.width*e),t.rect.height=Math.round(t.rect.height*e),t.rect.width<1&&(t.rect.width=1),t.rect.height<1&&(t.rect.height=1),t.rect.setCenter(new c.Z(this.target.width*(i.x/this.source.width),.25*this.target.height+.5*this.target.height*(i.y/this.source.height))),t instanceof u.Z?t.scaleBect(e):t instanceof p.Z?t.scaleTrim(e,e):t.render()}}}else{let e=0;const s=.2*this.source.width;let r=new o.Z(this.source.width,.5*this.source.height),h=new o.Z(.5*this.target.width,this.target.height);if((n&&!a||!n&&a)&&(e=n?.5*r.width:-.5*r.width),n){let i=0,a=new c.Z(h.width/r.width,h.height/r.height);n.y>0&&n.height<1.5*r.height?a.y=h.height/(n.height+2*n.y):n.y>0&&n.height>1.5*r.height?i=-1*n.y:n.y<=0&&n.height>.5*r.height&&(a.y=a.y=h.height/n.height);for(const n of t)n.rect.y+=i,n.rect.x+=e,this.positionAndScaleLayer(n,a,s,!0)}if(a){let t=0,n=new c.Z(h.width/r.width,h.height/r.height);a.y<0&&(t=Math.abs(a.y),a.y+=t),a.height-t>r.height&&(a.height=r.height+t),a.height>=r.height?n.y=h.height/a.height:t+=.5*(r.height-a.height);for(const a of i)a.rect.y+=t,a.rect.x+=e,this.positionAndScaleLayer(a,n,s,!0),a.rect.x+=.5*this.target.width,a.bect&&(a.bect.x+=.5*this.target.width)}}}},this.positionAndScaleLayer=(e,t,i,s=!1)=>{const n=t.x>t.y?t.y:t.x;if(this.willScaleUniform(e,i))e.rect.x=Math.floor(e.rect.x*t.x),e.rect.y=Math.floor(e.rect.y*t.y),e.rect.width=Math.round(e.rect.width*t.x),e.rect.height=Math.round(e.rect.height*t.y),e.rect.width<1&&(e.rect.width=1),e.rect.height<1&&(e.rect.height=1),e instanceof p.Z?e.fitContent():e.render();else{const i=e.rect.center();e.rect.width=Math.round(e.rect.width*n),e.rect.height=Math.round(e.rect.height*n),e.rect.width<1&&(e.rect.width=1),e.rect.height<1&&(e.rect.height=1),s?(e.rect.y=Math.floor(e.rect.y*t.y),e.rect.setCenterX(Math.round(i.x*t.x))):e.rect.setCenter(new c.Z(Math.round(i.x*t.x),Math.round(i.y*t.y))),e instanceof u.Z?e.scaleBect(n):e instanceof p.Z?e.scaleTrim(n,n):e.render()}},this.willScaleUniform=(e,t)=>(e instanceof p.Z||e instanceof m.Z)&&(e.rect.width>t||e.rect.height>t)&&!(e instanceof m.Z&&("svg"===e.shapeSettings.variant||"ellipse"===e.shapeSettings.variant)),this.reset=()=>{if(this.messy){for(let e=0;e<this.stage.fresco.layers.length;++e)this.stage.fresco.layers[e].rect&&(this.stage.fresco.layers[e].rect=this.rOrg[e].clone(),this.stage.fresco.layers[e].trim&&(this.stage.fresco.layers[e].trim=this.tOrg[e].clone()),this.stage.fresco.layers[e].render());this.messy=!1}},this.cancel=()=>{this.reset(),this.cleanUp()},this.apply=()=>{if(this.saving)return;this.saving=!0;const e=new o.Z(this.source.width,this.source.height),t=(0,a.ZP)("resize-smoothing").checked;switch(this.method){case"size":this.stage.fresco.setSize(this.target.width,this.target.height),this.stage.fresco.selection&&this.stage.fresco.selection.size(this.target.width,this.target.height),this.stage.history.add({type:"pageSize",anchor:"TL",size:e});break;case"scale":case"smart":this.reset(),this.stage.fresco.setSize(this.target.width,this.target.height),this.stage.fresco.selection&&this.stage.fresco.selection.size(this.target.width,this.target.height);const i=this.stage.fresco.layers.map((e=>e.clone(!0)));this.calculateResize(this.method,!0);for(const e of this.stage.fresco.layers)e instanceof g.Z&&e.applyTransform("smart"===this.method||t);this.stage.history.add({type:"pageResize",size:e,layers:i})}this.stage.updateViewport(),document.dispatchEvent(new CustomEvent("layer-arrange")),this.cleanUp()},this.stage=e,this.maxSize=8192,this.rOrg=new Array,this.tOrg=new Array;for(let s of this.stage.fresco.layers)this.rOrg.push(s.rect?s.rect.clone():void 0),this.tOrg.push(s.trim?s.trim.clone():void 0);this.source=new o.Z(this.stage.fresco.width,this.stage.fresco.height),this.target=new o.Z(this.stage.fresco.width,this.stage.fresco.height),this.dialog.style.width="90%",this.dialog.style.height="80%",this.dialog.style.maxWidth="1200px",this.content.style.flex="1",this.content.style.height="1px",this.content.style.padding="0px",this.content.style.display="flex",this.content.style.position="relative",this.setContent(`\n            <div id="resize-settings" style="flex:0 0 auto;width:320px;position:relative;overflow: hidden;">\n\n                <div id="resize-settings-inner" style="padding:20px;overflow: hidden;">\n                    <div style="display: flex; line-height: 28px;">\n                        <div style="flex-grow:1">\n                            <label class="split" style="height: 36px!important;">${(0,s.Z)("width")} <input type="number" id="resize-width"/></label>\n                            <label class="split" style="height: 36px!important;">${(0,s.Z)("height")} <input type="number" id="resize-height"/></label>\n                        </div>\n                        <div style="width:30px">\n                            <div id="resize-constraint" class="constraint">\n                                <div class="constraint-lock" flow="left" tooltip="${(0,s.Z)("toggleConstraint")}">\n                                    <img src="/img/icon/locked.svg" id="resize-size-lock" width="16" height="16" loading="lazy" class="ic tiny-icon">\n                                    <img src="/img/icon/x.svg" id="resize-size-vs" width="16" height="16" loading="lazy" style="display:none" class="ic tiny-icon">\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <input type="checkbox" checked id="toggle-resize-constraint" />\n                    <label class="switch pad-20" for="toggle-resize-constraint">${(0,s.Z)("dialogResizeLock")}<span></span></label>\n                \n                    <div class="switch-field stretch pad-30">\n                        <input type="radio" id="resize-method-size" name="resize-method" value="size"/><label for="resize-method-size">${(0,s.Z)("size")}</label>\n                        <input type="radio" id="resize-method-scale" name="resize-method" value="scale" /><label for="resize-method-scale">${(0,s.Z)("scale")}</label>\n                        <input type="radio" id="resize-method-smart" name="resize-method" value="smart" /><label id="resize-method-smart-label" for="resize-method-smart">${(0,s.Z)("smart")}</label>\n                    </div>\n                    \n                    <div id="resize-anchor" class="pad-20">\n                    <label style="flex-grow:1">${(0,s.Z)("anchor")}</label>\n                    <div id="resize-anchor-grid" class="anchor-grid">\n                        <div class="row">\n                            <div data="TL" class="box"></div>\n                            <div data="TC" class="box"></div>\n                            <div data="TR" class="box"></div>\n                        </div>\n                        <div class="row">\n                            <div data="CL" class="box"></div>\n                            <div data="CC" class="box selected"></div>\n                            <div data="CR" class="box"></div>\n                        </div>\n                        <div class="row">\n                            <div data="BL" class="box"></div>\n                            <div data="BC" class="box"></div>\n                            <div data="BR" class="box"></div>\n                        </div>\n                    </div>\n                    </div>\n\n                    <input type="checkbox" checked id="resize-smoothing" />\n                    <label class="switch pad-20" id="resize-smoothing-label" for="resize-smoothing">${(0,s.Z)("dialogResizeSmoothing")}<span></span></label>\n                    \n                    <input type="checkbox" id="resize-stretch" />\n                    <label class="switch pad-10" id="resize-stretch-label" for="resize-stretch">${(0,s.Z)("dialogResizeStretching")}<span></span></label>\n\n                    <div class="splitter pad-20"></div>\n\n                    <ul id="resize-presets" class="size-list pad-20">\n\n                        <li data="" id="resize-reset"><img src="/img/icon/reset.svg" width="18" height="18" loading="lazy" title="reset">${(0,s.Z)("reset")} <span id="resize-reset-span"></span></span></li>\n\n                        <li data="1:1"><img src="/img/icon/category/landscape.svg" width="18" height="18" loading="lazy" title="Square">Square <span>1:1 aspect</span></span></li>\n                        <li data="16:9"><img src="/img/icon/category/landscape.svg" width="18" height="18" loading="lazy" title="Wide">Wide <span>16:9 aspect</span></span></li>\n                        <li data="9:16"><img src="/img/icon/category/portrait.svg" width="18" height="18" loading="lazy" title="Tall">Tall <span>9:16 aspect</span></span></li>\n                        <li data="4:3"><img src="/img/icon/category/landscape.svg" width="18" height="18" loading="lazy" title="Landscape">Landscape <span>4:3 aspect</span></span></li>\n                        <li data="3:4"><img src="/img/icon/category/portrait.svg" width="18" height="18" loading="lazy" title="Portrait">Portrait <span>3:4 aspect</span></span></li>\n\n                        <li data="1080x1920"><img src="/img/icon/category/tiktok.svg" width="18" height="18" loading="lazy" title="Tiktok video">Tiktok video<span>1080x1920px</span></li>\n\n                        <li data="1080x1080"><img src="/img/icon/category/instagram.svg" width="18" height="18" loading="lazy" title="Instagram square">Instagram square <span>1080x1080px</span></li>\n                        <li data="1080x1350"><img src="/img/icon/category/instagram.svg" width="18" height="18" loading="lazy" title="Instagram post">Instagram post <span>1080x1350px</span></li>\n                        <li data="1080x1920"><img src="/img/icon/category/instagram.svg" width="18" height="18" loading="lazy" title="Instagram story">Instagram story <span>1080x1920px</span></li>\n                        <li data="1080x1920"><img src="/img/icon/category/instagram.svg" width="18" height="18" loading="lazy" title="Instagram reelse">Instagram reels <span>1080x1920px</span></li>\n\n                        <li data="1200x630"><img src="/img/icon/category/facebook.svg" width="18" height="18" loading="lazy" title="Facebook post">Facebook post <span>1200x630px</span></li>\n                        <li data="1080x1920"><img src="/img/icon/category/facebook.svg" width="18" height="18" loading="lazy" title="Facebook story">Facebook story <span>1080x1920px</span></li>\n                        <li data="1080x1920"><img src="/img/icon/category/facebook.svg" width="18" height="18" loading="lazy" title="Facebook reelse">Facebook reels <span>1080x1920px</span></li>\n                        <li data="850x850"><img src="/img/icon/category/facebook.svg" width="18" height="18" loading="lazy" title="Facebook profile">Facebook profile <span>850x850px</span></li>\n                        <li data="1920x1005"><img src="/img/icon/category/facebook.svg" width="18" height="18" loading="lazy" title="Facebook event">Facebook event <span>1920x1005px</span></li>\n                        \n                        <li data="1600x900"><img src="/img/icon/category/twitter.svg" width="18" height="18" loading="lazy" title="Twitter post">Twitter post <span>1600x900px</span></li>\n                        <li data="1500x500"><img src="/img/icon/category/twitter.svg" width="18" height="18" loading="lazy" title="Twitter cover">Twitter cover <span>1500x500px</span></li>\n                        <li data="400x400"><img src="/img/icon/category/twitter.svg" width="18" height="18" loading="lazy" title="Twitter profile">Twitter profile <span>400x400px</span></li>\n\n                        <li data="1080x1920"><img src="/img/icon/category/youtube.svg" width="18" height="18" loading="lazy" title="Youtube shorts">Youtube shorts <span>1080x1920px</span></li>\n                        <li data="800x800"><img src="/img/icon/category/youtube.svg" width="18" height="18" loading="lazy" title="Youtube profile">Youtube profile <span>800x800px</span></li>\n                        <li data="1280x720"><img src="/img/icon/category/youtube.svg" width="18" height="18" loading="lazy" title="Youtube thumbnail">Youtube thumbnail <span>1280x720px</span></li>\n                        <li data="2048x1152"><img src="/img/icon/category/youtube.svg" width="18" height="18" loading="lazy" title="Youtube channel art">Youtube channel art <span>2048x1152px</span></li>\n\n                        <li data="1000x1500"><img src="/img/icon/category/pinterest.svg" width="18" height="18" loading="lazy" title="Pinterest pin">Pinterest pin <span>1000x1500px</span></li>\n                        <li data="1000x1000"><img src="/img/icon/category/pinterest.svg" width="18" height="18" loading="lazy" title="Pinterest square pin">Pinterest square pin <span>1000x1000px</span></li>\n                        <li data="1000x2100"><img src="/img/icon/category/pinterest.svg" width="18" height="18" loading="lazy" title="Pinterest long pin">Pinterest long pin <span>1000x2100px</span></li>\n\n                        <li data="1240x1748"><img src="/img/icon/category/paper.svg" width="18" height="18" loading="lazy" title="ISO A6">A6 105 x 148 mm <span>1240x1748px</span></li>\n                        <li data="1748x2480"><img src="/img/icon/category/paper.svg" width="18" height="18" loading="lazy" title="ISO A5">A5 148 x 210 mm <span>1748x2480px</span></li>\n                        <li data="2480x3508"><img src="/img/icon/category/paper.svg" width="18" height="18" loading="lazy" title="ISO A4">A4 210 x 297 mm <span>2480x3508px</span></li>\n\n                        <li data="1275x1650"><img src="/img/icon/category/flyer.svg" width="18" height="18" loading="lazy" title="Flyer 4.25 x 5.5 in">Flyer 4.25 x 5.5 in<span>1275x1650px</span></li>\n                        <li data="1650x2550"><img src="/img/icon/category/flyer.svg" width="18" height="18" loading="lazy" title="Flyer 5.5 x 8.5 in">Flyer 5.5 x 8.5 in<span>1650x2550px</span></li>\n                        <li data="1650x2550"><img src="/img/icon/category/flyer.svg" width="18" height="18" loading="lazy" title="Flyer 8.5 x 11 in">Flyer 8.5 x 11 in<span>2550x3300px</span></li>\n                    </ul>\n\n                </div>\n            </div>\n\n            <div id="resize-preview" class="centercenter" style="flex-grow:1;background: linear-gradient(43deg, #ffffff00 0%, #ffffff11 100%);padding:20px;">\n                <canvas id="resize-preview-canvas" style="max-height:100%; max-width:100%; box-shadow: 6px 6px 12px rgb(0 0 0 / 30%);background-image: var(--square-bg);background-size: 20px 20px;background-position: 50% 50%;"/>\n            </div>\n        `),this.content.append((0,a.T)("div",{id:"preview-scale",style:"display:flex;position:absolute;z-index:99;height:28px;top:20px;right:20px;padding:0 15px 0 10px;gap:8px;border-radius:50vh;background-color:#00000088;color:#fff;opacity:0.7;align-items:center;"},(0,a.T)("img",{src:"/img/tool/thick/zoom.svg",width:16,height:16}),(0,a.T)("span",{id:"preview-scale-label",style:"font-size:14px;"}))),(0,a.ZP)("resize-reset").setAttribute("data",this.source.width+"x"+this.source.height),(0,a.ZP)("resize-reset-span").innerText=this.source.width+"x"+this.source.height+"px",(0,a.ZP)("resize-method-size").addEventListener("change",(()=>this.setMethod("size")),!1),(0,a.ZP)("resize-method-scale").addEventListener("change",(()=>this.setMethod("scale")),!1),(0,a.ZP)("resize-method-smart").addEventListener("change",(()=>this.setMethod("smart")),!1),(0,a.ZP)("resize-constraint").addEventListener("click",this.changeContraint,!1),(0,a.ZP)("toggle-resize-constraint").addEventListener("click",this.changeContraint,!1),(0,a.ZP)("resize-stretch").addEventListener("click",(()=>this.calculateResize()),!1);let t=(0,a.ZP)("resize-anchor-grid").getElementsByClassName("box");for(var i=0;i<t.length;i++)t[i].addEventListener("click",this.anchorChange,!1);let n=(0,a.ZP)("resize-width");n.addEventListener("input",this.sizeInputChange,!1),n.addEventListener("change",this.sizeInputChange,!1),n.value=this.source.width.toString();let f=(0,a.ZP)("resize-height");f.addEventListener("change",this.sizeInputChange,!1),f.addEventListener("input",this.sizeInputChange,!1),f.value=this.source.height.toString();let y=(0,a.ZP)("resize-presets").getElementsByTagName("li");for(i=0;i<y.length;i++)y[i].addEventListener("click",this.selectPreset,!1);new d.Z((0,a.ZP)("resize-settings")),this.preview=(0,a.ZP)("resize-preview-canvas"),this.ctx=this.preview.getContext("2d"),1===this.stage.fresco.layers.length&&this.stage.fresco.layers[0].settings.locked?((0,a.ZP)("resize-method-scale").checked=!0,(0,a.ZP)("resize-method-smart-label").remove(),(0,a.ZP)("resize-method-smart").remove(),this.setMethod("scale")):this.stage.fresco.templateMeta?((0,a.ZP)("resize-method-smart").checked=!0,this.setMethod("smart")):((0,a.ZP)("resize-method-size").checked=!0,this.setMethod("size"))}}},99091:(e,t,i)=>{i.a(e,(async(e,s)=>{try{i.d(t,{Z:()=>y});var n=i(96548),a=i(23868),r=i(4188),o=i(93947),h=i(33655),c=i(71030),l=i(57246),d=i(33506),u=i(93409),p=i(72951),g=i(28132),m=i(74820),v=i(47630),f=e([g]);g=(f.then?(await f)():f)[0];class y extends a.Z{constructor(e){if(super((0,n.Z)("dialogSaveTitle"),!0),this.setTab=e=>{const t=e.currentTarget.getAttribute("data");this.changeTab(t)},this.changeTab=e=>{this.tab&&(0,o.ZP)("tab-"+this.tab).classList.remove("selected"),(0,o.ZP)("tab-"+e).classList.add("selected"),this.tab=e,(0,o.ZP)("type-jpg").style.display="image"===this.tab?"flex":"none",(0,o.ZP)("type-png").style.display="image"===this.tab?"flex":"none",(0,o.ZP)("type-webp").style.display="image"===this.tab&&this.hasWebP?"flex":"none",(0,o.ZP)("type-gif").style.display="animation"===this.tab?"flex":"none",(0,o.ZP)("type-mp4").style.display="animation"===this.tab?"flex":"none",(0,o.ZP)("type-zip").style.display="animation"===this.tab?"flex":"none",(0,o.ZP)("type-pdf").style.display="document"===this.tab?"flex":"none",this.changeType(this.type,!0)},this.setType=e=>{const t=e.currentTarget.getAttribute("data");this.changeType(t)},this.changeType=(e,t=!1)=>{if(!t&&this.type===e)return;let i;switch(e){case"gif":i=Number(document.querySelector('input[name="gif-scale"]:checked').value);break;case"mp4":i=Number(document.querySelector('input[name="mp4-scale"]:checked').value);break;case"zip":i=Number(document.querySelector('input[name="zip-scale"]:checked').value);break;default:i=1}if("jpg"===e){i=Number((0,o.ZP)("jpg-width").value)/this.stage.fresco.width}this.type&&(0,o.ZP)("type-"+this.type).classList.remove("active"),(0,o.ZP)("type-"+e).classList.add("active"),this.type=e,this.canvas.remove();let s="jpg"===this.type||"pdf"===this.type||"png"===this.type&&!(0,o.ZP)("png-transparent").checked||"webp"===this.type&&!(0,o.ZP)("webp-transparent").checked;this.canvas=this.stage.getOutputCanvas(this.stage.fresco,i,s?"#ffffff":void 0),(null===d.a||void 0===d.a?void 0:d.a.subscription)||(this.canvas.oncontextmenu=()=>!1),(0,o.ZP)("save-file-prop").innerHTML=this.canvas.width+" x "+this.canvas.height+"px",(0,o.ZP)("save-file-type").innerHTML="."+this.type,(0,o.ZP)("save-preview").prepend(this.canvas),this.renderBlob()},this.jpgSizeChange=e=>{let t=e.currentTarget;if(""!==t.value){if("jpg-width"===t.id){const e=h.uZ(Number(t.value),1,this.canvas.width),i=Math.round(e/this.stage.fresco.width*this.stage.fresco.height);(0,o.ZP)("jpg-height").value=i.toString()}else{const e=h.uZ(Number(t.value),1,this.canvas.width),i=Math.round(e/this.stage.fresco.height*this.stage.fresco.width);(0,o.ZP)("jpg-width").value=i.toString()}h.Ds("save",500,(()=>this.changeType("jpg",!0)))}},this.renderBlob=async()=>{if((0,o.ZP)("save-file-size").innerText=(0,n.Z)("dialogSaveCalculate"),"pxz"===this.type||"gif"===this.type||"mp4"===this.type||"zip"===this.type)return this.blob=void 0,void((0,o.ZP)("save-file-size").innerText=`Format: ${this.type}`);if("pdf"===this.type)return void this.canvas.toBlob((e=>{this.blob=e,(0,o.ZP)("save-file-size").innerText=`Format: ${this.type}, size: ${h.jb(e.size+1024)}`}),"image/jpeg",.9);const e="image/"+this.type.replace("jpg","jpeg"),t="jpg"===this.type?this.jpgquality.getValue():"webp"===this.type?this.webpquality.getValue():1;this.canvas.toBlob((e=>{this.blob=e,(0,o.ZP)("save-file-size").innerText=`Format: ${this.type}, size: ${h.jb(e.size)}`}),e,t)},this.applyAPI=(e,t)=>{let i=this,s=this.stage.fresco.name;setTimeout((async()=>{const n=this.type;if((0,c.Z)(`save-${t}`),"pxz"===n){this.setMessage("Creating your PXZ file","You've selected a large file format, please wait while we create the file for you.");try{this.blob=await(0,v.iM)(this.stage,{id:this.stage.fresco.id,name:s,quality:"100",nonDestructive:(0,o.ZP)("save-pxz-ndestuctive").checked,type:"document",unit:"pixel"})}catch(h){return console.error(h),void this.setMessage("Error when creating PXZ file")}}var a=new FormData;a.append("file",this.blob,s+"."+this.type);let r=new XMLHttpRequest;r.onerror=function(e){i.setMessage("Error",`Failed to save to ${t}, please try again.`)},r.onreadystatechange=()=>{if(1===r.readyState)i.setMessage("Saving",`Uploading image to ${t}, please wait...`);else if(4===r.readyState)if(200===r.status&&1==r.response.status){let e=`<p>The image was saved to ${t}</p> <div class="buttons center"><a class="button positive xlarge"  href=" ${r.response.data.view_file_url} ">View</a></div>`;i.setMessage("Save completed",e),(0,o.ZP)("dialog-close"+this.mid).style.display="none"}else i.setMessage("Error",`Failed to save to ${t}, please try again.`)},r.open("post",e),r.responseType="json",r.send(a)}),200)},this.apply=async()=>{const e=this.type;let t,i=(0,o.ZP)("save-file-name").value||this.stage.fresco.name||"Untitled";if((0,c.Z)("save-file",e),!this.useLegacySave&&this.stage.fresco.savedTimesCounterForUserEase>0&&(i+="("+this.stage.fresco.savedTimesCounterForUserEase+")"),this.stage.fresco.savedTimesCounterForUserEase++,!this.useLegacySave){let s="image/jpeg",n="Jpg image";switch(e){case"mp4":s="video/mp4",n="Mp4 video";break;case"zip":s="application/zip",n="Zip achive";break;case"pxz":s="application/pxz",n="Pixlr document";break;case"pdf":s="application/pdf",n="PDF document";break;case"png":s="image/png",n="PNG image";break;case"gif":s="image/gif",n="GIF image";break;case"webp":s="image/webp",n="WebP image"}if(t=await(0,v.f1)(i,e,n,s),!1===t)return}if("gif"===e){this.setWorking();try{let e=(0,o.ZP)("save-gif-repeat").checked,t=(0,o.ZP)("save-gif-inclusive").checked,i=(0,o.ZP)("save-gif-transparency").checked,s=Number(document.querySelector('input[name="gif-speed"]:checked').value),n=Number(document.querySelector('input[name="gif-scale"]:checked').value);const a=(0,v.DD)(this.stage,6,n,s,e,i,t,(e=>{(0,o.ZP)("save-progress").style.width=100*e+"%"}));(0,o.ZP)("dialog-cancel"+this.mid).addEventListener("click",(()=>a.cancel())),this.blob=await a}catch(s){return void(s instanceof h.Mk||(console.error(s),this.setMessage("Error when creating GIF file")))}}if("zip"===e){this.setWorking();try{let e=(0,o.ZP)("save-zip-inclusive").checked,t=(0,o.ZP)("save-zip-transparency").checked,i=Number(document.querySelector('input[name="zip-scale"]:checked').value),s=Number(document.querySelector('input[name="zip-fps"]:checked').value),n=new u.Z(this.stage,s,i,t,e),a=await n.requestFrame();const r=new Array;let h=0;for(;a;){(0,o.ZP)("save-progress").style.width=n.currentFrame/n.totalFrames*100+"%";const e=await new Promise((e=>a.toBlob(e,"image/png",1)));r.push(new File([e],"frame-"+h+".png")),a=await n.requestFrame(),h++}let c=new g.ZipWriter;for(let o=0;o<r.length;o++){const e=r[o];let t=await e.arrayBuffer(),i=new Uint8Array(t);c.writeFile(e.name,i,!1)}const l=c.finish();this.blob=new Blob([l.buffer])}catch(s){return console.error(s),void this.setMessage("Error when creating GIF file")}}if("mp4"===e){this.setWorking();try{let e=(0,o.ZP)("save-mp4-inclusive").checked,t=Number(document.querySelector('input[name="mp4-scale"]:checked').value),i=Number(document.querySelector('input[name="mp4-fps"]:checked').value),s=(0,v.sj)(this.stage,i,t,e,(e=>{(0,o.ZP)("save-progress").style.width=100*e+"%"}));(0,o.ZP)("dialog-cancel"+this.mid).addEventListener("click",(()=>s.cancel())),this.blob=await s}catch(s){return void(s instanceof h.Mk||(console.error(s),this.setMessage("Error when creating mp4 file")))}}if("pxz"===e){this.setMessage("Creating your PXZ file","You've selected a large file format, please wait while we create the file for you.");try{this.blob=await(0,v.iM)(this.stage,{id:this.stage.fresco.id,name:i,quality:"100",nonDestructive:(0,o.ZP)("save-pxz-ndestuctive").checked,type:"document",unit:"pixel"})}catch(s){return console.error(s),void this.setMessage("Error when creating PXZ file")}}if("pdf"===e){this.setMessage("Creating your PDF file","You've selected a large file format, please wait while we create the file for you.");try{this.blob=await(0,v.b4)(this.stage,this.blob)}catch(s){return console.error(s),void this.setMessage("Error when creating PDF file")}}if(this.blob){if(t){await(0,v.BI)(t,new File([this.blob],i+"."+e))||(0,v.vV)(new File([this.blob],i+"."+e),i,e),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("fileSaved")}))}else(0,v.vV)(new File([this.blob],i+"."+e),i,e);this.cleanUp(),(0,m.ru)(),(null===d.a||void 0===d.a?void 0:d.a.subscription)||new p.Z}},this.setWorking=()=>{(0,o.ZP)("dialog-apply"+this.mid).style.display="none",(0,o.ZP)("dialog-api-apply")&&((0,o.ZP)("dialog-api-apply").style.display="none"),(0,o.ZP)("save-settings").style.display="none",(0,o.ZP)("save-working").style.display="block"},this.setMessage=(e,t="")=>{(0,o.ZP)("dialog-apply"+this.mid).style.display="none",(0,o.ZP)("dialog-api-apply")&&((0,o.ZP)("dialog-api-apply").style.display="none"),(0,o.ZP)("save-working").style.display="none",(0,o.ZP)("save-settings").style.display="none",(0,o.ZP)("save-message").style.display="block",(0,o.ZP)("save-message-title").innerText=e,(0,o.ZP)("save-message-body").innerHTML=t,(0,o.ZP)("dialog-cancel"+this.mid).innerText=(0,n.Z)("close")},e.fresco.block)return void this.cleanUp();if(!(null===d.a||void 0===d.a?void 0:d.a.subscription)&&(0,m.X6)())return this.cleanUp(),void new l.Z;this.stage=e,this.dialog.style.width="700px",this.dialog.style.minHeight="440px",this.content.classList.add("flex"),this.useLegacySave=m.ZP.useLegacySave||!(0,v.Zp)(),(0,o.ZP)("dialog-apply"+this.mid).innerText=this.useLegacySave?(0,n.Z)("save"):(0,n.Z)("saveAs"),(0,o.ZP)("dialog-buttons"+this.mid).style.marginTop="0px",this.setContent(`\n        <section id="save-preview">\n            <div id="save-file-size" class="pad-10"></div>\n            <div id="save-file-prop"></div>\n        </section>\n        <section id="save-section">\n            <div id="save-message" style="display:none;">\n                <h2 id="save-message-title"></h2>\n                <p id="save-message-body"></p>\n            </div>\n            <div id="save-working" style="display:none;">\n                <h2>${(0,n.Z)("working")}...</h2>\n                \n                <div class="progress-bar pad-20">\n                    <span id="save-progress" class="inner"></span>\n                </div>\n            </div>\n\n            <div id="save-settings">\n\n                <div id="file-name-section" style="display:none;padding-bottom:20px">\n                    <label>${(0,n.Z)("name")}</label>\n                    <div style="display:flex">\n                        <input type="text" id="save-file-name" style="width:280px" />\n                        <div id="save-file-type" style="padding-left:10px;line-height:32px;"></div>\n                    </div>\n                </div>\n\n                <ul class="tab-list" style="flex: 0 1 auto;margin-top:-10px;margin-bottom:15px;">\n                    <li data="animation" id="tab-animation">${(0,n.Z)("animation")}</li>\n                    <li data="image" id="tab-image">${(0,n.Z)("image")}</li>\n                    <li data="document" id="tab-document">${(0,n.Z)("document")}</li>\n                </ul>\n\n                <div id="type-jpg" data="jpg" class="option-task">\n                    <img src="/img/icon/file-jpg.svg" class="type ic">\n                    <div class="name">JPG <span>${(0,n.Z)("smallFilesPerfect")}</span></div>\n                    <div class="settings">\n                        <div id="jpg-quality"></div>\n\n                        <div id="jpg-quality-switch" class="switch-field stretch pad-10">\n                            <input type="radio" id="jpg-quality-low" name="jpg-quality-preset" value="50"/><label for="jpg-quality-low">${(0,n.Z)("dialogSaveLow")}</label>\n                            <input type="radio" id="jpg-quality-med" name="jpg-quality-preset" value="70" /><label for="jpg-quality-med">${(0,n.Z)("dialogSaveMed")}</label>\n                            <input type="radio" id="jpg-quality-high" name="jpg-quality-preset" value="90" checked /><label for="jpg-quality-high">${(0,n.Z)("dialogSaveHigh")}</label>\n                        </div>\n\n                        <label class="split pad-20">${(0,n.Z)("width")} <input type="number" id="jpg-width" value="${e.fresco.width}"/></label>\n                        <label class="split">${(0,n.Z)("height")} <input type="number" id="jpg-height" value="${e.fresco.height}"/></label>\n                    </div>\n                </div>\n\n                <div id="type-png" data="png" class="option-task">\n                    <img src="/img/icon/file-png.svg" class="type ic">\n                    <div class="name">PNG<span>${(0,n.Z)("largeAndLossless")}</span></div>\n                    <div class="settings">\n                        <input type="checkbox" id="png-transparent" checked>\n                        <label class="switch" for="png-transparent">${(0,n.Z)("transparent")}<span></span></label>\n                    </div>\n                </div>\n\n                <div id="type-webp" data="webp" class="option-task">\n                    <img src="/img/icon/file-webp.svg" class="type ic">\n                    <div class="name">WebP<span>${(0,n.Z)("modrenFormatSuitable")}</span></div>\n                    <div class="settings">\n                        <div id="webp-quality"></div>\n\n                        <div id="webp-quality-switch" class="switch-field stretch pad-10">\n                            <input type="radio" id="webp-quality-low" name="webp-quality-preset" value="50"/><label for="webp-quality-low">${(0,n.Z)("dialogSaveLow")}</label>\n                            <input type="radio" id="webp-quality-med" name="webp-quality-preset" value="70" /><label for="webp-quality-med">${(0,n.Z)("dialogSaveMed")}</label>\n                            <input type="radio" id="webp-quality-high" name="webp-quality-preset" value="90" checked /><label for="webp-quality-high">${(0,n.Z)("dialogSaveHigh")}</label>\n                        </div>\n\n                        <input type="checkbox" id="webp-transparent" checked>\n                        <label class="switch pad-20" for="webp-transparent">${(0,n.Z)("transparent")}<span></span></label>\n                    </div>\n                </div>\n\n                <div id="type-mp4" data="mp4" class="option-task">\n                    <img src="/img/icon/file-mp4.svg" class="type ic">\n                    <div class="name">MP4 <span>${(0,n.Z)("popularHighQuality")}</span></div>\n                    <div class="settings">\n\n                        <input type="checkbox" id="save-mp4-inclusive" />\n                        <label class="switch" for="save-mp4-inclusive">${(0,n.Z)("inclusiveAnimation")}<span></span></label>\n\n                        <label class="pad-10">${(0,n.Z)("fps")}</label>\n                        <div id="mp4-fps-switch" class="switch-field stretch">\n                            <input type="radio" id="mp4-fps-24" name="mp4-fps" value="24" checked/><label for="mp4-fps-24">24</label>\n                            <input type="radio" id="mp4-fps-30" name="mp4-fps" value="30" /><label for="mp4-fps-30">30</label>\n                            <input type="radio" id="mp4-fps-48" name="mp4-fps" value="48" /><label for="mp4-fps-48">48</label>\n                            <input type="radio" id="mp4-fps-60" name="mp4-fps" value="60" /><label for="mp4-fps-60">60</label>\n                        </div>\n\n                        <label class="pad-10">${(0,n.Z)("size")}</label>\n                        <div id="mp4-scale-switch" class="switch-field stretch">\n                            <input type="radio" id="mp4-scale-full" name="mp4-scale" value="1" checked/><label for="mp4-scale-full">1x</label>\n                            <input type="radio" id="mp4-scale-half" name="mp4-scale" value="0.5" /><label for="mp4-scale-half">0.5x</label>\n                            <input type="radio" id="mp4-scale-quart" name="mp4-scale" value="0.25" /><label for="mp4-scale-quart">0.25x</label>\n                        </div>                        \n                    </div>\n                </div>\n\n                <div id="type-gif" data="gif" class="option-task">\n                    <img src="/img/icon/file-gif.svg" class="type ic">\n                    <div class="name">GIF <span>${(0,n.Z)("funAndSimpleAnimated")}</span></div>\n                    <div class="settings">\n\n                        <input type="checkbox" id="save-gif-inclusive" />\n                        <label class="switch" for="save-gif-inclusive">${(0,n.Z)("inclusiveAnimation")}<span></span></label>\n\n                        <input type="checkbox" id="save-gif-repeat" />\n                        <label class="switch pad-10" for="save-gif-repeat">${(0,n.Z)("loopAnimation")}<span></span></label>\n\n                        <input type="checkbox" id="save-gif-transparency" />\n                        <label class="switch pad-10" for="save-gif-transparency">${(0,n.Z)("transparency")}<span></span></label>\n\n                        <label class="pad-20">${(0,n.Z)("speed")}</label>\n                        <div id="gif-speed-switch" class="switch-field stretch">\n                            <input type="radio" id="gif-speed-normal" name="gif-speed" value="1" checked/><label for="gif-speed-normal">1x</label>\n                            <input type="radio" id="gif-speed-double" name="gif-speed" value="2" /><label for="gif-speed-double">2x</label>\n                            <input type="radio" id="gif-speed-triple" name="gif-speed" value="3" /><label for="gif-speed-triple">3x</label>\n                        </div>\n\n                        <label class="pad-10">${(0,n.Z)("size")}</label>\n                        <div id="gif-scale-switch" class="switch-field stretch">\n                            <input type="radio" id="gif-scale-full" name="gif-scale" value="1"/><label for="gif-scale-full">1x</label>\n                            <input type="radio" id="gif-scale-half" name="gif-scale" value="0.5" checked/><label for="gif-scale-half">0.5x</label>\n                            <input type="radio" id="gif-scale-quart" name="gif-scale" value="0.25" /><label for="gif-scale-quart">0.25x</label>\n                        </div>\n                    </div>\n                </div>\n\n                <div id="type-pdf" data="pdf" class="option-task">\n                    <img src="/img/icon/file-pdf.svg" class="type ic">\n                    <div class="name">PDF <span>${(0,n.Z)("bestForFlyersAndMarketing")}.</span></div>\n                </div>\n\n                <div id="type-zip" data="zip" class="option-task">\n                    <img src="/img/icon/file-zip.svg" class="type ic">\n                    <div class="name">ZIP <span>${(0,n.Z)("aZipOfAllTheIndividual")}</span></div>\n                    <div class="settings">\n\n                        <input type="checkbox" id="save-zip-inclusive" />\n                        <label class="switch" for="save-zip-inclusive">${(0,n.Z)("inclusiveAnimation")}<span></span></label>\n\n                        <input type="checkbox" id="save-zip-transparency" />\n                        <label class="switch pad-10" for="save-zip-transparency">${(0,n.Z)("transparency")}<span></span></label>\n\n                        <label class="pad-20">${(0,n.Z)("fps")}</label>\n                        <div id="zip-fps-switch" class="switch-field stretch">\n                            <input type="radio" id="zip-fps-2" name="zip-fps" value="2" checked/><label for="zip-fps-2">2</label>\n                            <input type="radio" id="zip-fps-6" name="zip-fps" value="6" /><label for="zip-fps-6">6</label>\n                            <input type="radio" id="zip-fps-24" name="zip-fps" value="24" /><label for="zip-fps-24">24</label>\n                            <input type="radio" id="zip-fps-60" name="zip-fps" value="60" /><label for="zip-fps-60">60</label>\n                        </div>\n\n                        <label class="pad-10">${(0,n.Z)("size")}</label>\n                        <div id="zip-scale-switch" class="switch-field stretch">\n                            <input type="radio" id="zip-scale-full" name="zip-scale" value="1" checked/><label for="zip-scale-full">1x</label>\n                            <input type="radio" id="zip-scale-half" name="zip-scale" value="0.5" /><label for="zip-scale-half">0.5x</label>\n                            <input type="radio" id="zip-scale-quart" name="zip-scale" value="0.25" /><label for="zip-scale-quart">0.25x</label>\n                        </div>                        \n                    </div>\n                </div>\n\n                <div id="type-pxz" data="pxz" class="option-task">\n                    <img src="/img/icon/file-pxz.svg" class="type ic">\n                    <div class="name">PXZ <span>${(0,n.Z)("completePixlrDocument")}</span></div>\n                    <div class="settings">\n                        <input type="checkbox" id="save-pxz-ndestuctive" />\n                        <label class="switch pad-10" for="save-pxz-ndestuctive">${(0,n.Z)("dialogSaveNonDestructive")}<span></span></label>\n                        <p>${(0,n.Z)("dialogSavePXZDescription")}</p>\n                    </div>\n                </div>\n            </div>\n        </section>\n        `),this.useLegacySave?(0,o.ZP)("file-name-section").style.display="block":(0,o.ZP)("dialog-buttons"+this.mid).append((0,o.T)("div",{style:"cursor:pointer;margin-right:auto;",onclick:()=>{document.dispatchEvent(new CustomEvent("preferences")),this.cleanUp()}},(0,n.Z)("issuesSavingUseLegacy"))),this.canvas=this.stage.getOutputCanvas(),this.hasWebP=-1!==h.vL(5,5).toDataURL("image/webp").indexOf("webp"),this.stage.fresco.hasAnimation()?((0,o.ZP)("tab-animation").style.display="block",this.tab="animation",this.type="mp4"):((0,o.ZP)("tab-animation").style.display="none",this.type=h.EL(this.canvas)?"png":"jpg",this.tab="image"),(0,o.ZP)("type-"+this.type).append((0,o.T)("div",{className:"reko"},(0,n.Z)("recommend"))),(0,o.ZP)("tab-image").addEventListener("click",this.setTab),(0,o.ZP)("tab-animation").addEventListener("click",this.setTab),(0,o.ZP)("tab-document").addEventListener("click",this.setTab),(0,o.ZP)("type-jpg").addEventListener("click",this.setType),(0,o.ZP)("type-png").addEventListener("click",this.setType),(0,o.ZP)("type-webp").addEventListener("click",this.setType),(0,o.ZP)("type-pdf").addEventListener("click",this.setType),(0,o.ZP)("type-pxz").addEventListener("click",this.setType),(0,o.ZP)("type-mp4").addEventListener("click",this.setType),(0,o.ZP)("type-gif").addEventListener("click",this.setType),(0,o.ZP)("type-zip").addEventListener("click",this.setType);let t=this.stage.fresco.name?this.stage.fresco.name.lastIndexOf("."):-1;(0,o.ZP)("save-file-name").value=-1!==t?this.stage.fresco.name.substring(0,t):this.stage.fresco.name||"Untitled",this.jpgquality=new r.Z("jpg-quality",{range:[.01,1],defaultValue:.9,step:.001,label:(0,n.Z)("quality"),labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{e<.5?(0,o.ZP)("jpg-quality-low").checked=!0:e<.8?(0,o.ZP)("jpg-quality-med").checked=!0:(0,o.ZP)("jpg-quality-high").checked=!0,this.renderBlob()}});let i=(0,o.ZP)("jpg-quality-switch").getElementsByTagName("input");for(var s=0;s<i.length;s++)i[s].addEventListener("change",(e=>{let t=e.currentTarget;this.jpgquality.setValue(Number(t.value)/100),this.renderBlob()}),!1);let a=(0,o.ZP)("jpg-width");a.addEventListener("change",this.jpgSizeChange,!1),a.addEventListener("input",this.jpgSizeChange,!1);let f=(0,o.ZP)("jpg-height");f.addEventListener("change",this.jpgSizeChange,!1),f.addEventListener("input",this.jpgSizeChange,!1),this.webpquality=new r.Z("webp-quality",{range:[.01,1],defaultValue:.9,step:.001,label:(0,n.Z)("quality"),labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{e<.5?(0,o.ZP)("webp-quality-low").checked=!0:e<.8?(0,o.ZP)("webp-quality-med").checked=!0:(0,o.ZP)("webp-quality-high").checked=!0,this.renderBlob()}}),i=(0,o.ZP)("webp-quality-switch").getElementsByTagName("input");for(s=0;s<i.length;s++)i[s].addEventListener("change",(e=>{let t=e.currentTarget;this.webpquality.setValue(Number(t.value)/100),this.renderBlob()}),!1);(0,o.ZP)("webp-transparent").addEventListener("change",(()=>this.changeType("webp",!0))),(0,o.ZP)("png-transparent").addEventListener("change",(()=>this.changeType("png",!0))),i=(0,o.ZP)("gif-scale-switch").getElementsByTagName("input");for(s=0;s<i.length;s++)i[s].addEventListener("change",(e=>{this.changeType("gif",!0)}),!1);i=(0,o.ZP)("gif-speed-switch").getElementsByTagName("input");for(s=0;s<i.length;s++)i[s].addEventListener("change",(e=>{this.changeType("gif",!0)}),!1);i=(0,o.ZP)("mp4-scale-switch").getElementsByTagName("input");for(s=0;s<i.length;s++)i[s].addEventListener("change",(e=>{this.changeType("mp4",!0)}),!1);i=(0,o.ZP)("zip-scale-switch").getElementsByTagName("input");for(s=0;s<i.length;s++)i[s].addEventListener("change",(e=>{this.changeType("zip",!0)}),!1);m.ZP.target&&m.ZP.referrer&&"api"===this.stage.fresco.source&&((0,o.ZP)("dialog-apply"+this.mid).after((0,o.T)("a",{id:"dialog-api-apply",className:"button positive",onclick:()=>this.applyAPI(m.ZP.target,m.ZP.referrer)},(0,o.T)("img",{src:m.ZP.icon})," save")),(0,o.ZP)("dialog-apply"+this.mid).style.display="none",m.ZP.target&&((0,o.ZP)("dialog-api-apply").style.display="inline-block")),this.changeTab(this.tab)}}s()}catch(y){s(y)}}))},55390:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(93947),n=i(33655),a=i(36817),r=i(43673);class o{constructor(e,t){this.stage=e,this.render=()=>{if(!this.stage||!this.stage.fresco||this.stage.supressRender)return;this.viewport=a.Z.bestFit(this.stage.fresco.width,this.stage.fresco.height,180,180),this.scale=this.viewport.width/this.stage.fresco.width,this.panel.style.width=this.viewport.width+2+"px",this.panel.style.height=this.viewport.height+2+"px",this.back.width=this.viewport.width,this.back.height=this.viewport.height;var e=this.back.getContext("2d");e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";let t=this.stage.getOutputCanvas(this.stage.fresco,this.scale);t&&t.width>0&&t.height>0&&e.drawImage(t,0,0),this.position()},this.position=()=>{let e=this.stage.fresco.width*this.stage.zoom,t=this.stage.fresco.height*this.stage.zoom;if(!(this.stage.raster.width<=e||this.stage.raster.height<=t))return void(this.panel.style.display="none");this.panel.style.display="block";let i=this.viewport.width,s=this.viewport.height,n=0,a=0;i=Math.round(this.back.width*(this.stage.canvas.width/(this.stage.fresco.width*this.stage.zoom))),s=Math.round(this.back.height*(this.stage.canvas.height/(this.stage.fresco.height*this.stage.zoom))),n=-Math.round((this.stage.offset.x<0?this.stage.offset.x/this.stage.zoom:0)*this.scale),a=-Math.round((this.stage.offset.y<0?this.stage.offset.y/this.stage.zoom:0)*this.scale),this.marker.style.width=i+"px",this.marker.style.height=s+"px",this.marker.style.left=n+"px",this.marker.style.top=a+"px"},this.backDown=e=>{e.stopPropagation();let t=this.back.getBoundingClientRect(),i=this.stage.fresco.width/this.back.width;this.stage.setAnchor(new r.Z(Math.round((e.clientX-t.x)*i),Math.round((e.clientY-t.y)*i))),this.stage.updateViewport()},this.markerDown=e=>{e.stopPropagation(),this.down(e.clientX,e.clientY),document.addEventListener("pointermove",this.pointerMove,!0),document.addEventListener("pointerup",this.pointerUp,!0)},this.pointerMove=e=>{e.stopPropagation(),this.move(e.clientX,e.clientY)},this.pointerUp=e=>{e.stopPropagation(),document.removeEventListener("pointermove",this.pointerMove,!0),document.removeEventListener("pointerup",this.pointerUp,!0)},this.down=(e,t)=>{this.downPoint=new r.Z(e,t),this.downPosition=new r.Z(this.marker.offsetLeft,this.marker.offsetTop)},this.move=(e,t)=>{let i=this.downPosition.x+(e-this.downPoint.x),s=this.downPosition.y+(t-this.downPoint.y);this.stage.setAnchor(new r.Z(Math.round((i+this.marker.clientWidth/2)/this.scale),Math.round((s+this.marker.clientHeight/2)/this.scale))),this.stage.updateViewport()},this.cleanUp=()=>{this.panel.remove(),document.removeEventListener("viewport-update",this.position),document.removeEventListener("layer-list-render",this.render)},this.viewport=new a.Z,this.panel=(0,s.T)("div",{id:"navigator"}),this.marker=(0,s.T)("div",{id:"navigator-marker"}),this.back=n.vL(50,50),this.back.id="navigator-back",this.panel.append(this.back,this.marker),t.append(this.panel),this.marker.addEventListener("pointerdown",this.markerDown,!1),this.back.addEventListener("pointerdown",this.backDown,!1),document.addEventListener("viewport-update",this.position),document.addEventListener("layer-list-render",this.render)}}},94178:(e,t,i)=>{i.d(t,{Z:()=>n});var s=i(93947);class n{constructor(e){for(this.scrollTop=()=>{this.content.scrollTo(0,0)},this.moveBar=e=>{let t=this.content.scrollHeight,i=this.content.clientHeight;if(this.scrollRatio=i/t,this.scrollRatio>=1)this.bar.classList.add("ss-hidden");else{this.bar.classList.remove("ss-hidden");const e=Math.max(this.scrollRatio*i,20),s=this.content.scrollTop/(t-i)*(i-e);this.bar.style.cssText="height:"+e+"px; top:"+s+"px"}},e.classList.add("ss-wrapper"),this.content=(0,s.T)("div",{id:e.id+"-ss-content",className:"ss-content"});e.firstChild;)this.content.appendChild(e.firstChild);e.appendChild(this.content),this.bar=(0,s.T)("div",{className:"ss-scroll"}),e.append(this.bar);let t=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=e.pageY-this.lastPageY;this.lastPageY=e.pageY,this.content.scrollTop+=t/this.scrollRatio},i=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),document.removeEventListener("mousemove",t,!0),document.removeEventListener("mouseup",i,!0)};this.bar.addEventListener("mousedown",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.lastPageY=e.pageY,document.addEventListener("mousemove",t,!0),document.addEventListener("mouseup",i,!0)}),!0),this.moveBar(null),window.addEventListener("resize",this.moveBar),this.content.addEventListener("click",this.moveBar),this.content.addEventListener("scroll",this.moveBar),this.content.addEventListener("mouseenter",this.moveBar)}}},4188:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(96548),n=i(33655),a=i(93947);const r={step:[.01],range:[0,1],stops:[0,1],compact:!1,force:!1,defaultValue:0,labelFormat:e=>String(e),labelParse:e=>parseInt(e,10)};class o{constructor(e,t={}){if(this.findElements=()=>{this.outlet=this.container.querySelector("input"),this.slider=this.container.querySelector(".slider"),this.knob=this.container.querySelector(".slider .knob"),this.diff=this.container.querySelector(".slider .diff"),this.bounds=this.container.querySelector(".slider .bounds"),this.label=this.container.querySelector(".info label"),this.hold=this.container.querySelector(".slider-holder")},this.buildElements=()=>{this.container.classList.add("range-box"),this.label=document.createElement("label"),this.label.innerText=(this.options.label||this.name)+" ",this.outlet=document.createElement("input"),this.outlet.type="text",this.outlet.autocomplete="off",this.outlet.value=this.options.labelFormat(this.options.defaultValue);const e=document.createElement("div");e.className="info",e.appendChild(this.label),e.appendChild(this.outlet),this.knob=document.createElement("div"),this.knob.innerHTML="<div></div>",this.knob.className="knob",this.bounds=(0,a.T)("div",{className:"bounds"},this.knob),this.diff=(0,a.T)("div",{className:"diff"},this.bounds),this.slider=(0,a.T)("div",{className:"slider"},this.diff),this.hold=(0,a.T)("div",{className:"slider-holder"},this.slider),this.container.appendChild(e),this.container.appendChild(this.hold)},this.labelOver=()=>{this.value!==this.options.defaultValue&&(this.label.innerText=(0,s.Z)("reset")+" ")},this.labelOut=()=>{this.label.innerText=(this.options.label||this.name)+" "},this.labelClick=()=>{if(this.value===this.options.defaultValue)return;const e=this.value;this.options.onStart&&this.options.onStart(this.value,this.name),this.reset(),this.options.onChange&&this.options.onChange(this.value,this.name),this.options.onEnd&&this.options.onEnd(this.value,e,this.name)},this.sliderMouseDown=e=>{e.preventDefault(),e.stopPropagation(),this.knobDown(e),this.move(e.clientX)},this.knobDown=e=>{document.addEventListener("mousemove",this.knobMouseMove,!1),document.addEventListener("touchmove",this.knobTouchMove,{passive:!1}),document.addEventListener("mouseup",this.knobUp,!0),document.addEventListener("touchend",this.knobUp,{passive:!1}),this.knob.classList.add("grabbed"),e.preventDefault(),e.stopPropagation(),this.downValue=this.value,this.options.onStart&&setTimeout((()=>this.options.onStart(this.downValue,this.name)),0)},this.move=e=>{const t=this.bounds.getBoundingClientRect();if(e<=t.left)return void this.setAmount(0);if(e>=t.right)return void this.setAmount(1);const i=(e-t.left)/t.width;this.setAmount(i)},this.knobMouseMove=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.clientX)},this.knobTouchMove=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.touches[0].clientX)},this.knobUp=()=>{if(document.removeEventListener("mousemove",this.knobMouseMove,!1),document.removeEventListener("touchmove",this.knobTouchMove),document.removeEventListener("mouseup",this.knobUp,!0),document.removeEventListener("touchend",this.knobUp),this.knob.classList.remove("grabbed"),this.options.onEnd&&(this.options.force||this.downValue!==this.value)){const e=this.downValue;this.downValue=this.value,setTimeout((()=>this.options.onEnd(this.value,e,this.name)),0)}},this.outletKeyUp=e=>{const t=this.options.labelParse(this.outlet.value);if(isNaN(t))return;const i=this.options.range[0],s=this.options.range[this.options.range.length-1],n=Math.max(Math.min(t,s),i);this.value=n,this.slider.classList.toggle("changed",this.value!==this.options.defaultValue),this.diff.style.backgroundImage=this.generateDiff(this.options.defaultValue,this.value);const a=this.calculateAmount(this.value);this.setKnob(100*a),this.options.onChange&&void 0!==e&&setTimeout((()=>this.options.onChange(this.value,this.name)),0)},this.outletFocus=e=>{if(this.options.onStart&&(this.downValue=this.value,this.options.onStart(this.value,this.name)),this.options.compact){this.hold.style.display="block";const e=n.HS(this.container);this.hold.style.left=e.x+this.container.offsetWidth-this.hold.offsetWidth+10+"px",this.hold.style.top=e.y+34+"px"}},this.outletBlur=e=>{this.options.compact&&(this.hold.style.display="none");const t=this.options.labelParse(this.outlet.value);isNaN(t)||(this.outlet.value=this.options.labelFormat(this.value),this.options.onEnd&&(this.options.force||this.downValue!==this.value)&&void 0!==e&&this.options.onEnd(this.value,this.downValue,this.name))},this.calculateAmount=e=>{for(let t=1;t<this.options.range.length;t++){const i=this.options.range[t-1],s=this.options.range[t];if(e>=i&&e<=s){const n=this.options.stops[t-1];return n+(e-i)/(s-i)*(this.options.stops[t]-n)}}if(e==this.options.defaultValue)throw new Error("Cant recurse on default value with calculateAmount, this is a bug");return this.calculateAmount(this.options.defaultValue)},this.setKnob=e=>{const t=100*this.calculateAmount(this.options.defaultValue),i=this.generateDiff(t,e);requestAnimationFrame((()=>{this.knob.style.marginLeft=`${e}%`,this.diff.style.backgroundImage=i}))},this.roundToStep=(e,t,i,s)=>{const n=e%t;return 0===n||e===i||e===s?e:e-n},this.generateDiff=(e,t)=>{if(e===t)return"none";const i="var(--accent-color)",s=this.knob.clientWidth-3;return(t*=this.bounds.clientWidth/this.diff.clientWidth)>e?`linear-gradient(to right, transparent 0%, transparent ${e}%, ${i} ${e}%, ${i} calc(${t}%), transparent calc(${t}%), transparent 100%)`:`linear-gradient(to right, transparent 0%, transparent calc(${t}% + ${s}px), ${i} calc(${t}% + ${s}px), ${i} ${e}%, transparent ${e}%, transparent 100%)`},this.setAmount=(e,t=!1)=>{const[i,s]=this.bucket(e),n=this.options.range[i],a=this.options.range[i+1],r=this.options.step[i];this.setKnob(100*e),this.value=this.roundToStep(s*(a-n)+n,r,n,a),this.slider.classList.toggle("changed",this.value!==this.options.defaultValue),this.outlet.value=this.options.labelFormat(this.value),this.options.onChange&&!t&&setTimeout((()=>this.options.onChange(this.value,this.name)),0)},this.bucket=e=>{for(let t=1;t<this.options.stops.length;t++){const i=this.options.stops[t-1],s=this.options.stops[t];if(e>=i&&e<=s)return[t-1,(e-i)/(s-i)]}throw new Error(`Could not assign ${e} to a bucket, this is a bug`)},this.setValue=(e,t=!1)=>{const i=this.value;void 0===e&&(e=this.options.defaultValue);const s=this.options.range[0],n=this.options.range[this.options.range.length-1];this.value=Math.max(Math.min(e,n),s),this.slider.classList.toggle("changed",this.isChanged()),this.outlet.value=this.options.labelFormat(this.value);const a=this.calculateAmount(this.value);this.setKnob(100*a),(this.options.onChange||this.options.onEnd)&&t&&setTimeout((()=>{this.options.onChange&&this.options.onChange(this.value,this.name),this.options.onEnd&&this.options.onEnd(this.value,i,this.name)}),0)},this.isChanged=()=>this.value!==this.options.defaultValue,this.getValue=()=>{var e;return null!==(e=this.value)&&void 0!==e?e:0},this.reset=()=>{this.value=this.options.defaultValue,this.setKnob(100*this.calculateAmount(this.value)),this.slider.classList.remove("changed"),this.outlet.value=this.options.labelFormat(this.value),this.label.innerText=(this.options.label||this.name)+" "},this.cleanUp=()=>{document.removeEventListener("mousemove",this.knobMouseMove,!1),document.removeEventListener("touchmove",this.knobTouchMove),document.removeEventListener("mouseup",this.knobUp,!0),document.removeEventListener("touchend",this.knobUp),this.knob.removeEventListener("mousedown",this.knobDown,!1),this.knob.removeEventListener("touchstart",this.knobDown),this.slider.removeEventListener("mousedown",this.sliderMouseDown,!1),this.outlet.removeEventListener("focus",this.outletFocus,!1),this.outlet.removeEventListener("keyup",this.outletKeyUp,!1),this.outlet.removeEventListener("blur",this.outletBlur,!1),this.options.compact||(this.label.removeEventListener("mouseover",this.labelOver,!1),this.label.removeEventListener("mouseleave",this.labelOut,!1),this.label.removeEventListener("click",this.labelClick,!1))},this.name=e,this.container=(0,a.ZP)(e),this.options=Object.assign(Object.assign({},r),t),this.value=this.options.defaultValue,Array.isArray(this.options.step)||(this.options=Object.assign(Object.assign({},this.options),{step:[this.options.step]})),this.options.stops.length<2)throw new Error("Slider need to have atleast two stops, default is [0,1]");if(this.options.range.length!=this.options.stops.length)throw new Error("Slider range option and slide stops option, needs to be the same length");if(this.options.step.length!=this.options.stops.length-1)throw new Error("Step array must be the same length as the number of ranges (slider options range - 1)");this.options.compact&&this.container.classList.add("compact");!!this.container.querySelector(".slider")?this.findElements():this.buildElements(),this.knob.addEventListener("mousedown",this.knobDown,!1),this.knob.addEventListener("touchstart",this.knobDown,{passive:!1}),this.slider.addEventListener("mousedown",this.sliderMouseDown,!1),this.outlet.addEventListener("focus",this.outletFocus,!1),this.outlet.addEventListener("keyup",this.outletKeyUp,!1),this.outlet.addEventListener("blur",this.outletBlur,!1),this.options.compact||(this.label.addEventListener("mouseover",this.labelOver,!1),this.label.addEventListener("mouseleave",this.labelOut,!1),this.label.addEventListener("click",this.labelClick,!1)),this.outlet.value!==this.options.labelFormat(this.options.defaultValue)?(this.outletKeyUp(void 0),this.outletBlur(void 0)):this.reset()}hide(){this.container.style.display="none"}show(){this.container.style.display="block"}disable(){this.container.style.pointerEvents="none",this.container.style.opacity="0.4"}enable(){this.container.style.pointerEvents="auto",this.container.style.opacity="1.0"}}},77549:(e,t,i)=>{i.d(t,{Z:()=>a});var s=i(93947),n=i(43673);class a{constructor(e){this.verticalDrag=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=(e.clientY-this.downPoint.y)/this.spaceHeightRatio/this.stage.zoom;this.stage.setAnchor(this.downPos.add(new n.Z(0,t))),this.stage.updateViewport()},this.verticalStop=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),document.removeEventListener("pointermove",this.verticalDrag,!0),document.removeEventListener("pointerup",this.verticalStop,!0)},this.horizontalDrag=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=(e.clientX-this.downPoint.x)/this.spaceWidthRatio/this.stage.zoom;this.stage.setAnchor(this.downPos.add(new n.Z(t,0))),this.stage.updateViewport()},this.horizontalStop=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),document.removeEventListener("pointermove",this.horizontalDrag,!0),document.removeEventListener("pointerup",this.horizontalStop,!0)},this.resize=()=>{this.verticalHolder.style.top=this.stage.raster.offsetTop+"px",this.verticalHolder.style.left=this.stage.raster.offsetLeft+this.stage.raster.offsetWidth-16+"px",this.verticalHolder.style.height=this.stage.raster.offsetHeight-16+"px",this.horizontalHolder.style.top=this.stage.raster.offsetTop+this.stage.raster.offsetHeight-16+"px",this.horizontalHolder.style.left=this.stage.raster.offsetLeft+"px",this.horizontalHolder.style.width=this.stage.raster.offsetWidth+"px",this.spaceHeight=this.stage.raster.offsetHeight-20,this.spaceWidth=this.stage.raster.offsetWidth-181,this.render()},this.render=()=>{if(!this.stage.fresco)return;this.imageInfo.innerText=this.stage.fresco?this.stage.fresco.width+" x "+this.stage.fresco.height+" px @ "+Math.round(100*this.stage.zoom)+"%":"";let e=this.stage.fresco.width*this.stage.zoom,t=this.stage.fresco.height*this.stage.zoom;this.horizontalSlider.style.display=this.stage.raster.width<=e?"block":"none",this.verticalSlider.style.display=this.stage.raster.height<=t?"block":"none",this.spaceHeightRatio=this.spaceHeight/(t+500),this.spaceWidthRatio=this.spaceWidth/(e+500);const i=Math.round(this.spaceWidth*(this.stage.raster.width/(e+500))),s=Math.round(this.spaceHeight*(this.stage.raster.height/(t+500))),n=-1*(this.stage.offset.x-250)/(e+500),a=-1*(this.stage.offset.y-250)/(t+500),r=Math.round((this.spaceWidth-(i<30?30-i:0))*n),o=Math.round((this.spaceHeight-(s<30?30-s:0))*a);this.horizontalSlider.style.width=Math.max(i,30)+"px",this.horizontalSlider.style.left=162+r+"px",this.verticalSlider.style.height=Math.max(s,30)+"px",this.verticalSlider.style.top=2+o+"px"},this.stage=e,this.verticalSlider=(0,s.T)("div",{id:"vertical-scroll-slider"}),this.verticalHolder=(0,s.T)("div",{id:"vertical-scroll-holder"},this.verticalSlider),(0,s.ZP)("workspace").appendChild(this.verticalHolder),this.imageInfo=(0,s.T)("div",{id:"horizontal-image-info"}),this.horizontalSlider=(0,s.T)("div",{id:"horizontal-scroll-slider"}),this.horizontalHolder=(0,s.T)("div",{id:"horizontal-scroll-holder"},this.imageInfo,this.horizontalSlider),(0,s.ZP)("workspace").appendChild(this.horizontalHolder),document.addEventListener("viewport-update",this.render),this.verticalHolder.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=(e.offsetY-2)/this.spaceHeightRatio/this.stage.zoom,i=this.stage.anchor.clone();i.y=t,this.stage.setAnchor(i),this.stage.updateViewport()}),!1),this.verticalSlider.addEventListener("click",(e=>(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1)),!0),this.verticalSlider.addEventListener("pointerdown",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.stage.resetAnchor(),this.downPoint=new n.Z(e.clientX,e.clientY),this.downPos=this.stage.anchor.clone(),document.addEventListener("pointermove",this.verticalDrag,!0),document.addEventListener("pointerup",this.verticalStop,!0)}),!0),this.horizontalHolder.addEventListener("click",(e=>{if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.offsetX-160>this.spaceWidth)this.stage.setZoom("fit");else if(e.offsetX>160){let t=(e.offsetX-160)/this.spaceWidthRatio/this.stage.zoom,i=this.stage.anchor.clone();i.x=t,this.stage.setAnchor(i),this.stage.updateViewport()}}),!1),this.horizontalSlider.addEventListener("click",(e=>(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1)),!0),this.horizontalSlider.addEventListener("pointerdown",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.stage.resetAnchor(),this.downPoint=new n.Z(e.clientX,e.clientY),this.downPos=this.stage.anchor.clone(),document.addEventListener("pointermove",this.horizontalDrag,!0),document.addEventListener("pointerup",this.horizontalStop,!0)}),!0)}}},33506:(e,t,i)=>{i.d(t,{a:()=>n});var s=i(93947);const n=function(){let e;const t=(0,s.ZP)("current_user");if(t&&"null"!==t.innerText)try{e=JSON.parse(t.innerText)}catch(n){console.error("Could not read user data json")}const i=new URL(location.href);return e&&"pixlr.com"!==i.hostname&&"true"===i.searchParams.get("premium")&&(e.subscription=!0,e.subscriptionAccess="premium"),e}()},33655:(e,t,i)=>{i.d(t,{$E:()=>k,$N:()=>P,$n:()=>u,Ai:()=>T,Bm:()=>Z,Bs:()=>g,CE:()=>d,Dc:()=>J,Ds:()=>K,EL:()=>j,HS:()=>se,L5:()=>ne,M8:()=>H,Mk:()=>ae,PP:()=>ie,ST:()=>R,Sy:()=>$,TA:()=>l,Td:()=>x,UF:()=>f,WL:()=>_,XE:()=>r,XI:()=>p,Xj:()=>F,ZE:()=>L,Zd:()=>q,_c:()=>E,aG:()=>y,d4:()=>Q,dN:()=>D,eY:()=>A,fg:()=>I,fu:()=>G,gr:()=>W,iF:()=>ee,jb:()=>U,k3:()=>re,kD:()=>h,l:()=>O,lI:()=>S,lU:()=>b,ly:()=>te,mS:()=>m,q7:()=>v,qT:()=>C,sD:()=>X,uZ:()=>V,vJ:()=>M,vL:()=>w,vO:()=>B,wf:()=>o,x2:()=>N,xZ:()=>c,zs:()=>z});var s=i(96548),n=i(36817),a=i(43673);const r="rgba(255,255,255, 0.7)",o="rgb(255,255,255)",h="rgb(32,209,139)",c="rgb(0,163,218)",l="rgb(209,72,14)",d="rgb(255,0,255)",u="rgb(67,201,143)",p="rgb(75,75,75)",g="rgb(148,148,148)";function m(e,t){if(void 0===t)return;if(t instanceof e)return t;const i=Object.create(e.prototype);return Object.assign(i,t)}function v(e,t,i,s){let n;return n=e/t>i/s?i/e:s/t,n>1?1:n}function f(e,t,i,s){return e/t<i/s?i/e:s/t}function y(e,t,i,s,n,a){return a>=t&&a<t+s&&n>=e&&n<e+i}function w(e,t){e<0&&(e=1),t<0&&(t=1);let i=document.createElement("canvas");return i.width=e,i.height=t,i}async function x(e){if(!e)return;const t=URL.createObjectURL(e),i=await b(t);return URL.revokeObjectURL(t),i}function b(e){if(void 0!==e)return new Promise(((t,i)=>{if(!e)return console.log("Invalid URL in dataURLToCanvas"),void t(void 0);const s=document.createElement("canvas"),n=s.getContext("2d"),a=new Image;a.onerror=e=>i(e),a.onload=()=>{s.width=a.width,s.height=a.height,n.drawImage(a,0,0),t(s)},a.src=e}))}function Z(e){if(void 0!==e)return new Promise(((t,i)=>{if(!e)return console.log("Invalid URL in dataURLToImage"),void t(void 0);const s=new Image;s.onerror=e=>i(e),s.onload=()=>{t(s)},s.src=e}))}function k(e,t){if(!e)return;const i=t||new n.Z(0,0,e.width,e.height);return e.getContext("2d").getImageData(i.x,i.y,i.width,i.height)}function E(e,t){if(!e)return;const i=t||new n.Z(0,0,e.width,e.height),s=w(i.width,i.height);return s.getContext("2d").drawImage(e,-i.x,-i.y),new Promise(((e,t)=>s.toBlob(e)))}function P(e,t="image/jpeg"){const i=w(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),new Promise((e=>i.toBlob(e,t)))}function S(e,t,i){if(!e||!t)return;let s=e.getContext("2d");s.save(),s.globalCompositeOperation="copy",s.drawImage(t,i.x,i.y),s.restore(),s=void 0}function C(e,t,i=0){let s=w(e.width,e.height),a=s.getContext("2d",{colorSpace:"srgb"});if(a.drawImage(e,0,0,e.width,e.height),a=void 0,s.width>t||s.height>t){let i=n.Z.bestFit(e.width,e.height,t,t);s=T(s,i.width,i.height)}return 0!==i&&(s=F(s,i)),s}function L(e,t,i){if(!e)return;let s=w(t,i);var n=e.getContext("2d").getImageData(0,0,e.width,e.height),a=new Int32Array(n.data.buffer),r=e.width,o=e.height,h=s.width,c=s.height,l=s.getContext("2d").getImageData(0,0,s.width,s.height),d=new Int32Array(l.data.buffer);const u=h/r,p=c/o;for(let g=0;g<c;){const e=r*~~(g/p),t=h*g++;for(let i=0;i<h;)d[t+i++]=a[e+~~(i/u)]}return s.getContext("2d").putImageData(l,0,0),s}function T(e,t,i,s){var n;if(!e)return;if(t>e.width||i>e.width)return A(e,t,i);let a=null!==(n=s)&&void 0!==n?n:w(t,i);for(var r=e.getContext("2d").getImageData(0,0,e.width,e.height).data,o=e.width,h=e.height,c=a.width,l=a.height,d=a.getContext("2d").getImageData(0,0,a.width,a.height),u=d.data,p=o/c,g=h/l,m=Math.ceil(p/2),v=Math.ceil(g/2),f=0;f<l;f++)for(var y=0;y<c;y++){for(var x=4*(y+f*c),b=0,Z=0,k=0,E=0,P=0,S=0,C=(f+.5)*g,L=Math.floor(f*g);L<(f+1)*g;L++)for(var T=Math.abs(C-(L+.5))/v,M=(y+.5)*p,I=T*T,R=Math.floor(y*p);R<(y+1)*p;R++){var _=Math.abs(M-(R+.5))/m,D=Math.sqrt(I+_*_);D>=-1&&D<=1&&(b=2*D*D*D-3*D*D+1)>0&&(k+=b*r[_=4*(R+L*o)],E+=b*r[_+1],P+=b*r[_+2],S+=b*r[_+3],Z+=b)}u[x]=k/Z,u[x+1]=E/Z,u[x+2]=P/Z,u[x+3]=S/Z}return a.getContext("2d").putImageData(d,0,0),a}async function M(e,t,i,s){var n;if(!e)return;if(t>e.width||i>e.width)return A(e,t,i);let a=null!==(n=s)&&void 0!==n?n:w(t,i);var r=e.getContext("2d").getImageData(0,0,e.width,e.height).data,o=e.width,h=e.height,c=a.width,l=a.height;for(var d=a.getContext("2d").getImageData(0,0,a.width,a.height),u=d.data,p=o/c,g=h/l,m=Math.ceil(p/2),v=Math.ceil(g/2),f=0;f<l;f++)for(var y=0;y<c;y++){for(var x=4*(y+f*c),b=0,Z=0,k=0,E=0,P=0,S=0,C=(f+.5)*g,L=Math.floor(f*g);L<(f+1)*g;L++)for(var T=Math.abs(C-(L+.5))/v,M=(y+.5)*p,I=T*T,R=Math.floor(y*p);R<(y+1)*p;R++){var _=Math.abs(M-(R+.5))/m,D=Math.sqrt(I+_*_);D>=-1&&D<=1&&(b=2*D*D*D-3*D*D+1)>0&&(k+=b*r[_=4*(R+L*o)],E+=b*r[_+1],P+=b*r[_+2],S+=b*r[_+3],Z+=b)}u[x]=k/Z,u[x+1]=E/Z,u[x+2]=P/Z,u[x+3]=S/Z}return a.getContext("2d").putImageData(d,0,0),a}function A(e,t,i,s=!0,n){if(!e)return;t<1&&(t=1),i<1&&(i=1);let a=null!=n?n:w(t,i);var r=a.getContext("2d");return r.imageSmoothingQuality="high",r.imageSmoothingEnabled=s,r.drawImage(e,0,0,a.width,a.height),r=void 0,a}function I(e,t){let i=w(t.width,t.height),s=i.getContext("2d");return s.drawImage(e,-t.x,-t.y),s=void 0,i}function R(e,t,i){let s=w(i.width,i.height),n=s.getContext("2d");return n.imageSmoothingQuality="high",n.imageSmoothingEnabled=!0,n.drawImage(e,t.x-i.x,t.y-i.y,t.width,t.height),n=void 0,s}function _(e,t){if(e){var i=document.createElement("canvas"),s=i.getContext("2d");return i.width=t.width,i.height=t.height,s.drawImage(e,-t.x,-t.y),s=void 0,i}}function D(e){if(e){var t=document.createElement("canvas"),i=t.getContext("2d");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i=void 0,t}}function F(e,t){if(e){var i=w(e.width,e.height),s=i.getContext("2d");return 180!==t&&(i.width=e.height,i.height=e.width),s.translate(i.width/2,i.height/2),s.rotate(t*Math.PI/180),s.drawImage(e,-e.width/2,-e.height/2),s.setTransform(1,0,0,1,0,0),s=void 0,i}}function z(e,t,i){let s=w(i.width,i.height),n=s.getContext("2d");return n.save(),n.translate(i.width/2,i.height/2),n.rotate(t*Math.PI/180),n.drawImage(e,-e.width/2,-e.height/2),n.restore(),n=null,s}function N(e,t){if(e){var i=w(e.width,e.height),s=i.getContext("2d");return s.save(),t?(s.scale(1,-1),s.drawImage(e,0,-e.height,e.width,e.height)):(s.scale(-1,1),s.drawImage(e,-e.width,0,e.width,e.height)),s.restore(),s=void 0,i}}function O(e){if(!e)return;const t=e.width,i=e.height;return B(e.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,t,i))}function B(e){if(!e)return;const t=e.width,i=e.height;let s,a,r=new Uint32Array(e.data.buffer),o=-1,h=-1,c=-1,l=-1;for(a=0;a<i;++a){for(s=0;s<t;++s)if(r[s+a*t]>0){h=a;break}if(-1!==h)break}if(-1!==h){for(a=i-1;a>=h;--a){for(s=0;s<t;++s)if(r[s+a*t]>0){l=a+1;break}if(-1!==l)break}for(s=0;s<t;++s){for(a=h;a<=l;++a)if(r[s+a*t]>0){o=s;break}if(-1!==o)break}for(s=t-1;s>=o;--s){for(a=h;a<=l;++a)if(r[s+a*t]>0){c=s+1;break}if(-1!==c)break}return new n.Z(o,h,c-o,l-h)}}function U(e){let t=e/1024;return t>1024?(t/1024).toFixed(1)+"mb":t>100?Math.round(t)+"kb":Math.round(10*t)/10+"kb"}function H(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function q(){return"xxxxyxxx4xxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function V(e,t,i){return isNaN(e)?t:Math.min(Math.max(e,t),i)}function $(e){for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}function j(e){let t=!1,i=e.getContext("2d").getImageData(0,0,e.width,e.height).data;for(var s=0;s<i.length;s+=4)if(i[s+3]<255){t=!0;break}return t}function W(e){let t=new a.Z(0,255);var i=Array(256);i.fill(0);var s=e.getContext("2d").getImageData(0,0,e.width,e.height).data;for(let a=0;a<s.length;a+=4)i[s[a]]+=1,i[s[a+1]]+=1,i[s[a+2]]+=1;var n=Math.round(e.width*e.height/1e3);let r;for(r=0;r<256;++r)if(i[r]>n){t.x=r;break}for(r=255;r>=0;--r)if(i[r]>n){t.y=r;break}return t.x>100&&(t.x=100),t.y<155&&(t.y=155),t}function G(e){let t=1,i=1,s=e.width<500&&e.height<500?e:A(e,500,500);const n=s.width,a=s.height;let r,o,h,c,l,d,u,p,g,m=s.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,n,a).data;for(l=a;l--;)for(c=n;c--;)d=4*(l*n+c),r=m[d],o=m[d+1],h=m[d+2],u=Math.min(r,o,h),p=Math.max(r,o,h),i+=p/255,g=p-u,g&&(t+=g/p);return t=(t+i)/(s.width*s.height*2),t}function X(e){if(0===e.length)return;return e[Math.round(Math.random()*(e.length-1))]}const Y={};function K(e,t,i){window.clearTimeout(Y[e]),Y[e]=window.setTimeout((()=>{delete Y[e],i()}),t)}const Q=(e,t)=>{let i;return(...s)=>{clearTimeout(i),i=window.setTimeout((()=>t(...s)),e)}};function J(e){return new Promise(((t,i)=>{setTimeout((()=>t()),e)}))}function ee(){return new Promise(((e,t)=>{window.requestAnimationFrame((()=>{window.requestAnimationFrame((()=>{e()}))}))}))}function te(e){const t=((new Date).getTime()-e.getTime())/1e3;if(t<0)return"It's the future man";const i=Math.floor(t/86400);if(i>=1)return i>1?(0,s.Z)("sinceDays",i):(0,s.Z)("sinceDay");const n=Math.floor(t/3600);if(n>=1)return n>1?(0,s.Z)("sinceHours",n):(0,s.Z)("sinceHour");const a=Math.floor(t/60);return a>=1?a>1?(0,s.Z)("sinceMinutes",a):(0,s.Z)("sinceMinute"):(0,s.Z)("sinceNow")}function ie(e){if(!e)return!1;if("TEXTAREA"===e.nodeName)return!0;if("INPUT"===e.nodeName){const t=e,i=t.type.toLowerCase();return"text"===i||"number"===i||"url"===i||!!t.contentEditable}return!1}function se(e){let t=new a.Z(e.offsetLeft,e.offsetTop);for(;e.offsetParent&&(t.x=t.x+e.offsetParent.offsetLeft,t.y=t.y+e.offsetParent.offsetTop,e!=document.getElementsByTagName("body")[0]);)e=e.offsetParent;return t}class ne{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}}Symbol.toStringTag;class ae extends Error{constructor(){super("Promise canceled")}}class re extends ne{constructor(e,t){super(),this.canceled=!1,this.isCanceled=()=>this.canceled,this.cancel=()=>{this.canceled||(this.canceled=!0,this.cancelCallback(),this.reject(new ae))},this.cancelCallback=t,(async()=>{try{this.resolve(await e())}catch(t){this.reject(t)}})()}}},5182:(e,t,i)=>{i.a(e,(async(e,s)=>{try{i.d(t,{Z:()=>L});var n=i(96548),a=i(78366),r=i(93947),o=i(33655),h=i(99872),c=i(36817),l=i(71030),d=i(27969),u=i(43673),p=i(66792),g=i(4375),m=i(99091),v=i(33506),f=i(64652),y=i(57246),w=i(47163),x=i(77758),b=i(21951),Z=i(75934),k=i(70840),E=i(74820),P=i(47630),S=e([m]);m=(S.then?(await S)():S)[0];var C=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(i){t[i]=e[i]&&function(t){return new Promise((function(s,n){(function(e,t,i,s){Promise.resolve(s).then((function(t){e({value:t,done:i})}),t)})(s,n,(t=e[i](t)).done,t.value)}))}}};class L{constructor(){var e,t,i;this.optimizeForPWA=()=>{if((0,r.ZP)("app-selector")){const e=(0,r.ZP)("app-selector").getElementsByTagName("a");for(let t=0;t<e.length;t++)e[t].setAttribute("target","_blank")}(0,r.ZP)("logo")&&(0,r.ZP)("logo").setAttribute("href","/suite/"),document.title="Pixlr "+E.ZP.product.toUpperCase()},this.navigateHash=e=>{var t;e&&e.preventDefault(),e&&e.stopPropagation();let i=null===(t=location.hash)||void 0===t?void 0:t.replace("#",""),s=null==i?void 0:i.split("&")[0];if(i&&-1!==i.indexOf("tool")){var n=i.split("&").reduce(((e,t)=>{var i=t.split("=");return e[i[0]]=i[1],e}),{});E.ZP.tool=n.tool,this.setInAppBrowseMode()}else"editor"!==s||this.stage.fresco||(s="home");this.navigate(s,!1),e&&(e.returnValue=void 0)},this.navigate=(e,t=!0)=>{if(!e||this.section!==e){if("editor"===e){if(this.section=e,(0,r.ZP)("home").style.display="none",(0,r.ZP)("workspace").style.display="block","e"===E.ZP.product||"x"===E.ZP.product)if("localhost"!==location.hostname&&!(null===v.a||void 0===v.a?void 0:v.a.subscription)&&!(0,r.ZP)("right-space")&&document.body.clientWidth>1024){const e=(0,r.T)("div",{id:"right-space"});document.body.appendChild(e);try{document.body.clientWidth>1600?((0,l.Z)("ads","cut"),e.style.width="300px",(0,r.ZP)("workspace").style.right="304px",e.appendChild((0,r.T)("iframe",{id:"iasriiigh",src:"/dad/cut/",frameBorder:"0",scrolling:"no",style:"width:300px;height:100%;overflow:hidden;"}))):((0,l.Z)("ads","slot"),e.style.width="160px",(0,r.ZP)("workspace").style.right="164px",e.appendChild((0,r.T)("iframe",{id:"iasriiigh",src:"/dad/slot/",frameBorder:"0",scrolling:"no",style:"width:160px;height:100%;overflow:hidden;"})))}catch(i){console.log(i)}const t=()=>{(0,r.ZP)("iasriiigh").src=(0,r.ZP)("iasriiigh").src};window.setInterval(t,18e4)}else(0,r.ZP)("right-space")&&((0,r.ZP)("right-space").style.display="block");document.dispatchEvent(new CustomEvent("resize"))}else(0,r.ZP)("home").style.display="block",(0,r.ZP)("workspace").style.display="none",(0,r.ZP)("right-space")&&((0,r.ZP)("right-space").style.display="none"),this.section=e||(this.home.section?this.home.section:"home"),this.home.activate(this.section);t&&this.section&&history.pushState(null,"","#"+this.section),"e"===E.ZP.product&&(0,r.ZP)("title-bar")&&((0,r.ZP)("title-bar").style.display=this.isHome()?"flex":"none"),this.home.showOrHideBackToEditor()}},this.pollNews=async()=>{const e=new Date(E.ZP.lastNewsCheck);this.news=await fetch(`https://pixlr.com/api/news/poll/?target=web&from=${e.toISOString()}&limit=5`).then((e=>e.json()));const t=await this.news;!1!==t.status?(t.data.unread>0&&!t.data.pop&&(0,r.ZP)("news-button").classList.add("notification"),t.data.pop&&new f.Z(t.data.news.docs)):console.error(t.message)},this.newsClick=async()=>{(0,l.Z)("news-click");const e=await this.news;!1!==e.status&&e.data.news.docs.length?((0,r.ZP)("news-button").classList.remove("notification"),new f.Z(e.data.news.docs)):document.dispatchEvent(new CustomEvent("notification",{detail:"No news :/"}))},this.selectTool=e=>{},this.i18nReplace=(e,...t)=>{const[i]=t;return(0,n.Z)(i)},this.CDNUrlReplace=(e,t)=>e.replace(t,`${E.ZP.cdnUrl}${t}`),this.isHome=()=>"none"===(0,r.ZP)("workspace").style.display,this.tabSelect=e=>{this.stage.select(e)},this.tabClose=(e,t=!1)=>{this.stage.close(e),t||0!==this.stage.tabs.length||this.navigate()},this.center=e=>{const t=this.stage.canvas.getBoundingClientRect();return new u.Z(this.isHome()?Math.round(document.body.clientWidth/2-e.clientWidth/2):Math.round(t.width/2+t.left-e.clientWidth/2),this.isHome()?Math.round(document.body.clientHeight/2-e.clientHeight/2):Math.round(t.height/2+t.top-e.clientHeight/2))},this.notification=e=>{const t=(0,r.ZP)("notification");t&&(this.notiId&&(clearTimeout(this.notiId),t.innerHTML="",t.style.display="none"),requestAnimationFrame((()=>{t.style.display="block",t.innerHTML='<div class="message">'+e.detail+"</div>";const i=this.center(t);t.style.top=i.y+"px",t.style.left=i.x+"px"})),this.notiId=setTimeout((function(){t.innerHTML="",t.style.top="-999px",t.style.left="-999px",t.style.display="none"}),800))},this.legend=e=>{const t=(0,r.ZP)("notification");if(!t)return;if("stop"===e.detail)return t.innerHTML="",t.style.top="-999px",t.style.left="-999px",void(t.style.display="none");t.style.display="block",""===t.innerHTML?t.innerHTML='<div id="legend" class="legend">'+e.detail+"</div>":(0,r.ZP)("legend")&&((0,r.ZP)("legend").innerText=e.detail);const i=this.center(t);t.style.top=Math.round(i.y/3)+"px",t.style.left=i.x+"px"},this.loading=e=>{const t=(0,r.ZP)("notification");if(!t)return;if("stop"===e.detail)return void(this.keepLoading?this.keepLoading=!1:(t.innerHTML="",t.style.display="none"));this.notiId&&(clearTimeout(this.notiId),t.innerHTML="",t.style.display="none"),this.notiId=setTimeout((()=>{this.keepLoading?this.keepLoading=!1:(t.innerHTML="",t.style.top="-999px",t.style.left="-999px",t.style.display="none")}),400),t.style.display="block",t.innerHTML=`\n            <div class="spinner">\n                ${"start"===e.detail?"Loading":e.detail}<span>.</span><span>.</span><span>.</span>\n            </div>\n        `;const i=this.center(t);t.style.top=i.y+"px",t.style.left=i.x+"px",this.keepLoading=!0},this.loadView=(e,t,i)=>{const s=/§([a-zA-Z]{1}[a-zA-Z0-9]*)§/g,n=/<img src="([^'"]+.(?:svg|jpg))"/g;return new Promise(((a,o)=>{let h=new XMLHttpRequest;h.open("GET","/view/"+E.ZP.product+"/"+e+".html",!0),h.onreadystatechange=()=>{if(4!==h.readyState)return;if(!(h.status>=200&&h.status<300))return void o("Non 200 status code");let c=h.responseText.replace(n,this.CDNUrlReplace);c=c.replace(s,this.i18nReplace);const l=document.createElement("section");l.id=e,l.innerHTML=c,i&&(l.className=i),(t?(0,r.ZP)(t):(0,r.ZP)("workspace")).appendChild(l),a(l)},h.send()}))},this.whenLoaded=()=>{var e;let t=null===(e=location.hash)||void 0===e?void 0:e.replace("#","");if(t){t.split("&")[0];const e=null==t?void 0:t.split("&").reduce(((e,t)=>{const i=t.split("=");return e[i[0]]=i[1],e}),{});if("new"==E.ZP.task){const t=parseInt(e.width)||1e3,i=parseInt(e.height)||1e3,s=e.bg||"#ffffff";this.stage.createNew("Black Canvas",t,i,s)}}},this.dragOver=e=>{if(e.preventDefault(),e.stopPropagation(),!this.isModal()&&!(0,r.ZP)("modal-drop")){const e=document.createElement("div");e.id="modal-drop",e.classList.add("modal","dim","vertical-align"),e.innerHTML=`<div id="dim-message">${(0,n.Z)("dropFile")}</div>`,document.body.appendChild(e)}},this.dragOut=e=>{e.preventDefault(),e.stopPropagation(),e.clientX<=0&&(0,r.ZP)("modal-drop")&&(0,r.ZP)("modal-drop").remove()},this.drop=async e=>{if(e.stopPropagation(),e.preventDefault(),(0,r.ZP)("modal-drop")&&(0,r.ZP)("modal-drop").remove(),document.body.style.pointerEvents="auto",this.isModal())return;const t=e.dataTransfer.files;for(var i,s=0;i=t[s];s++)await(0,Z.ZB)(this.stage,i,!0,"drop")},this.cut=async e=>{var t;if(o.PP(document.activeElement))return;if(this.isModal())return;if(null===(t=this.stage.fresco)||void 0===t?void 0:t.block)return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("notAllowed")}));e.stopPropagation(),e.preventDefault();let i=this.stage.cut();i instanceof HTMLCanvasElement?(this.writeClipboard(e,i),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("cut")}))):navigator.clipboard.writeText("")},this.copy=async e=>{var t;if(o.PP(document.activeElement))return;if(this.isModal())return;if(null===(t=this.stage.fresco)||void 0===t?void 0:t.block)return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("notAllowed")}));e.stopPropagation(),e.preventDefault();let i=this.stage.copy();i instanceof HTMLCanvasElement?(this.writeClipboard(e,i),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("copy")}))):navigator.clipboard.writeText("")},this.clear=async()=>{this.stage.clear()&&document.dispatchEvent(new CustomEvent("notification",{detail:"clear"}))},this.writeClipboard=async(e,t)=>{const i=await o._c(t);if(i){this.stage.clipboard=t,this.stage.clipboardSize=new h.Z(t.width,t.height);try{const e={name:"clipboard-write"};await navigator.permissions.query(e)}catch(s){console.log(s)}try{const e=new ClipboardItem({"image/png":i});await navigator.clipboard.write([e]),this.stage.clipboard=void 0}catch(s){console.log(s);try{let e=new DataTransfer;e.items.add("image/png",t.toDataURL()),await navigator.clipboard.write(e),this.stage.clipboard=void 0}catch(n){console.log(n);try{e.clipboardData.setData("image/png",t.toDataURL()),this.stage.clipboard=void 0}catch(a){console.log(a)}}}}},this.pasteActivatedFromMenu=async()=>{try{const e={name:"clipboard-read"};await navigator.permissions.query(e)}catch(e){console.log(e)}try{const e=await navigator.clipboard.read(),t=await e[0].getType("image/png");if(t)(0,Z.ZB)(this.stage,new File([t],"clipboard"),!1,"paste"),this.stage.selectionDeselect(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("paste")}));else{if(this.stage.clipboard)return void this.pasteLocal();document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("noPaste")}))}}catch(e){if(console.log(e),this.stage.clipboard)return void this.pasteLocal();document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("emptyPaste")}))}},this.paste=async e=>{if(!this.isModal()&&!o.PP(document.activeElement)){if(e.clipboardData&&e.clipboardData.items.length>0){const s=e.clipboardData.items;let a;for(var t,i=0;t=s[i];i++)if("file"===t.kind){a=t;break}if(a||(a=s[0]),"string"===a.kind)return void a.getAsString((async t=>{e.preventDefault(),e.stopPropagation();let i=/<img\s[^>]*?src\s*=\s*['\"]([^'\"]*?)['\"][^>]*?>/gi.exec(t);if(i&&i.length>1){let e=await(new g.Z).load(i[1]);return(0,Z.ZB)(this.stage,e,this.isHome()),this.navigate("editor"),void document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("paste")}))}if(this.stage.fresco){t.length>200&&(t=t.substring(0,200));let e=Math.max(16,Math.round(this.stage.fresco.height/20)),i=Math.round(this.stage.fresco.width/1.5),s=Math.round(this.stage.fresco.height/2.5),a=Math.round((this.stage.fresco.width-i)/2),r=new x.Z("verdana",e);this.stage.addText(t,new c.Z(a,s,i,e),r,"paste"),this.navigate("editor"),this.stage.selectionDeselect(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("paste")}))}}));if("file"===a.kind){if(-1==a.type.indexOf("image"))return;e.preventDefault(),e.stopPropagation();const t=a.getAsFile();return(0,Z.ZB)(this.stage,t,this.isHome(),"paste"),this.stage.selectionDeselect(),this.navigate("editor"),void document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("paste")}))}}else if(this.stage.clipboard)return void this.pasteLocal();document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("emptyPasteGlobal")}))}},this.pasteLocal=()=>{Array.isArray(this.stage.clipboard)?this.stage.pasteLayer():this.stage.clipboard instanceof HTMLCanvasElement&&(this.stage.addImage(o.dN(this.stage.clipboard),(this.stage.fresco,this.stage.fresco.nextAddedLayerNumber()),"paste"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("paste")})),this.stage.selectionDeselect())},this.isModal=()=>document.getElementsByClassName("modal").length>0,this.setInAppBrowseMode=()=>{const e=(0,r.T)("div",{className:"modal dim"});e.append((0,r.T)("div",{style:"display:flex;flex-direction:column;"},(0,r.T)("div",{className:"button big positive",onclick:async()=>{await this.home.openClick(),e.remove()}},(0,n.Z)("openImage")),(0,r.T)("div",{className:"button medium negative pad-20",onclick:()=>{this.navigate("home"),e.remove()}},(0,n.Z)("close")))),(0,r.ZP)("workspace").append(e)},this.quickExport=async(e=!1,t="png")=>{var i,s,a,r;if(this.stage.fresco.block)return!1;if(!(null===v.a||void 0===v.a?void 0:v.a.subscription)&&(0,E.X6)())return new y.Z,!1;let o,h,c;if(e){if(h=null===(s=null===(i=this.stage.fresco)||void 0===i?void 0:i.getSelected())||void 0===s?void 0:s.canvas,!h)return!1;o=(null===(r=null===(a=this.stage.fresco)||void 0===a?void 0:a.getSelected())||void 0===r?void 0:r.settings.name)||"untitled"}else h=this.stage.getOutputCanvas(),o=this.stage.fresco.name||"untitled",this.stage.fresco.savedTimesCounterForUserEase>0&&(o+="("+this.stage.fresco.savedTimesCounterForUserEase+")"),this.stage.fresco.savedTimesCounterForUserEase++;return o=o.replace(".png","").replace(".jpg",""),!(!E.ZP.useLegacySave&&(0,P.Zp)()&&(c=await(0,P.f1)(o,t,t.toUpperCase()+" image","image/"+t.replace("jpg","jpeg")),!1===c))&&(h.toBlob((async e=>{const i=new File([e],o+"."+t,{type:"image/"+t.replace("jpg","jpeg")});c?(await(0,P.BI)(c,i),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("fileSaved")}))):(0,P.vV)(i,o,t)}),"image/png","100"),(0,E.ru)(),(0,l.Z)("quick-export",e?"layer":"page"),!0)},this.closeClick=()=>{(0,l.Z)("close"),this.selectTool(),this.tabClose()},this.saveClick=()=>{(0,l.Z)("save"),this.selectTool(),this.stage.fresco.block?new k.Z(this.stage):new m.Z(this.stage)},document.documentElement.classList.add(E.ZP.workspace,E.ZP.accent),null===(e=(0,r.ZP)("login"))||void 0===e||e.addEventListener("click",(()=>new d.ZP)),null===(t=(0,r.ZP)("news-button"))||void 0===t||t.addEventListener("click",this.newsClick),null===(i=(0,r.ZP)("try-premium"))||void 0===i||i.addEventListener("click",(()=>new b.Z("HOME"))),(window.matchMedia("(display-mode: standalone)").matches||document.referrer.includes("android-app://"))&&(document.documentElement.classList.add("standalone"),this.optimizeForPWA()),document.addEventListener("cut",this.cut,!0),document.addEventListener("copy",this.copy,!0),document.addEventListener("paste",this.paste,!0),document.addEventListener("cut-menu",(()=>document.execCommand("cut")),!0),document.addEventListener("copy-menu",(()=>document.execCommand("copy")),!0),document.addEventListener("paste-menu",this.pasteActivatedFromMenu,!0),document.addEventListener("clear-menu",(()=>this.clear()),!0),document.addEventListener("dragover",this.dragOver,!0),document.addEventListener("dragleave",this.dragOut,!0),document.addEventListener("drop",this.drop,!0),document.addEventListener("legend",(e=>this.legend(e)),!0),document.addEventListener("loading",(e=>this.loading(e)),!0),document.addEventListener("notification",(e=>this.notification(e)),!0),window.addEventListener("popstate",(e=>this.navigateHash(e))),document.addEventListener("navigate",(e=>this.navigate(e.detail,!0))),this.stage=new p.Z((0,r.ZP)("workspace"));let s=location.hash.replace("#","");if(location.hash){const e=s.split("&")[0],t=s.split("&").reduce(((e,t)=>{const i=t.split("=");return e[i[0]]=i[1],e}),{});"editor"===e&&(t.tool&&(E.ZP.tool=t.tool,this.setInAppBrowseMode()),t.task&&(E.ZP.task=t.task),t.task||t.tool||(history.replaceState(null,null," "),s=void 0))}if("m"!==E.ZP.product){const e=null==s?void 0:s.split("&")[0];this.home=new a.Z(this,e);const t=null==s?void 0:s.split("&").reduce(((e,t)=>{const i=t.split("=");return e[i[0]]=i[1],e}),{});"editor"!==e||t.task||this.navigate("editor")}if(E.ZP.template&&(0,Z.Hi)(this.stage,E.ZP.template),E.ZP.file){new g.Z({title:E.ZP.name,referrer:E.ZP.referrer}).load("/proxy/?url="+encodeURIComponent(E.ZP.file)).then((e=>{(0,Z.ZB)(this.stage,e,void 0,"api")}))}!async function(){var e,t,i,s;const n=await w.Z.loadSaved();try{for(var a,r=!0,o=C(n);!(e=(a=await o.next()).done);r=!0){s=a.value,r=!1;const e=s;w.Z.fontList.unshift(e)}}catch(h){t={error:h}}finally{try{r||e||!(i=o.return)||await i.call(o)}finally{if(t)throw t.error}}}(),this.pollNews()}}s()}catch(L){s(L)}}))},87282:(e,t,i)=>{i.d(t,{$p:()=>n,Bm:()=>a,Y3:()=>r});class s{constructor(e){this.internal=e}send(e,t){this.internal.postMessage(e,t)}async receive(){return await new Promise(((e,t)=>{this.internal.onmessage=t=>{this.internal.onerror=void 0,this.internal.onmessage=void 0,e(t.data)},this.internal.onerror=t}))}terminate(){var e;null===(e=this.internal)||void 0===e||e.terminate(),this.internal=null}}class n extends s{constructor(){super(new Worker(new URL(i.p+i.u(7346),i.b)))}}class a extends s{constructor(){super(new Worker(new URL(i.p+i.u(4200),i.b)))}}class r extends s{constructor(){super(new Worker(new URL(i.p+i.u(8155),i.b)))}}},94424:(e,t,i)=>{i.a(e,(async(e,s)=>{try{i.r(t);var n=i(94545),a=i(74820),r=e([n]);if(n=(r.then?(await r)():r)[0],"cGl4bHIuY29t"!==window.btoa(document.location.hostname.split(".").slice(-2).join(".")))throw new Error;a.ZP.product="x";new n.Z;s()}catch(o){s(o)}}))},40147:(e,t,i)=>{i.d(t,{Z:()=>g});var s=i(96548),n=i(93947),a=i(33655),r=i(71030),o=i(18203),h=i(33506),c=i(77664),l=i(75934),d=i(95574),u=i(21951);async function p(e){const t=await fetch(`https://pixlr.com/api/assets/${e}/download`),i=await t.json();if(!i.status)throw new Error(i.message);return i.data.url}class g extends o.Z{constructor(e){super("add-element",e),this.SERVER_URL="https://pixlr.com/api/assets/collections/",this.searchTag=e=>{const t=e.target.innerText.toLowerCase();(0,n.ZP)("element-search").value=t,"overlay"===t?this.get("overlay"):this.search(t)},this.searchInput=e=>{if("Enter"===e.key){const e=(0,n.ZP)("element-search").value.toLowerCase();this.search(e)}},this.get=async(e,t=1)=>{1===t&&(this.oneholder.style.display="none",this.twoholder.style.display="none",this.oneholder.innerHTML=""),(0,n.ZP)("element-loading").style.display="block";try{const i=await fetch(this.SERVER_URL+"?platform=web&category="+e+"&page="+t),s=await i.json();if(!s.status)throw new Error("server_error");let n=s.data;this.result={name:e,total:n.total,page:n.page,pages:n.pages},this.renderSearchResult(n.collections)}catch(i){(0,n.ZP)("element-loading").style.display="none",console.log(i)}},this.search=async e=>{if("overlay"!==e){this.result=void 0,this.oneholder.innerHTML="",this.oneholder.style.display="none",this.twoholder.style.display="none",(0,n.ZP)("element-loading").style.display="block";try{const t=await fetch(this.SERVER_URL+"keyword/"+e+"/?platform=web"),i=await t.json();if(!i.status)throw new Error("server_error");let s=i.data;this.renderSearchResult(s)}catch(t){(0,n.ZP)("element-loading").style.display="none",console.log(t)}}else this.get("overlay")},this.renderSearchResult=e=>{if(this.back(),(0,n.ZP)("element-loading").style.display="none",e.forEach((e=>{let t=(0,n.T)("div",{className:"element-title",onclick:()=>this.renderCollection(e.name,e.assets)},e.name.replace(/_/g," ")+" ("+e.assets.length+")",(0,n.T)("a",{className:"link"},(0,s.Z)("viewAll"))),i=(0,n.T)("div",{className:"element-group"});for(let s=0;s<e.assets.length&&s<6;s++){let t=(0,n.T)("div",{className:"wrap"},(0,n.T)("img",{src:e.assets[s].thumbnailSmall}));t.addEventListener("click",(i=>{var n,a,r,o;e.assets[s].premium&&"premium"!==(null===h.a||void 0===h.a?void 0:h.a.subscriptionAccess)?new u.Z("ELEMENT"):(this.setLoading(t),this.addElement(e.assets[s].id,e.assets[s].id,p(e.assets[s].id),null===(a=null===(n=e.assets[s])||void 0===n?void 0:n.metaData)||void 0===a?void 0:a.blendmode,null===(o=null===(r=e.assets[s])||void 0===r?void 0:r.metaData)||void 0===o?void 0:o.scalemode))}),!1),e.assets[s].premium&&t.classList.add("premium"),i.append(t)}this.oneholder.append(t,i)})),this.result&&this.result.page!==this.result.pages){const e=(0,n.T)("div",{className:"button big positive",style:"margin:0 auto"},(0,s.Z)("loadMore"));e.addEventListener("click",(()=>{this.get(this.result.name,this.result.page+1),e.remove()})),this.oneholder.append(e)}else this.result&&1!==this.result.page||(0,n.ZP)("add-element-content").getElementsByClassName("ss-content")[0].scrollTo(0,0)},this.renderCollection=(e,t)=>{this.scrollTop=(0,n.ZP)("add-element-content-ss-content").scrollTop,this.oneholder.style.display="none",this.twoholder.style.display="flex",this.twoholder.innerHTML="",(0,n.ZP)("element-back").style.display="inline-flex",t.forEach((e=>{let t=(0,n.T)("div",{id:e.id,className:"element-box"});t.addEventListener("click",(i=>{var s,n;e.premium&&"premium"!==(null===h.a||void 0===h.a?void 0:h.a.subscriptionAccess)?new u.Z("ELEMENT"):(this.setLoading(t),this.addElement(t.id,e.id,p(e.id),null===(s=null==e?void 0:e.metaData)||void 0===s?void 0:s.blendmode,null===(n=null==e?void 0:e.metaData)||void 0===n?void 0:n.scalemode))}),!1);let i=(0,n.T)("div",{className:"wrap"},(0,n.T)("img",{src:e.thumbnailSmall}));e.premium&&i.classList.add("premium"),t.appendChild(i),this.twoholder.appendChild(t)})),(0,n.ZP)("add-element-content").getElementsByClassName("ss-content")[0].scrollTo(0,0)},this.setLoading=e=>{this.over=(0,n.T)("div",{id:"element-over"},(0,n.T)("progress",{id:"element-progress",value:0,max:100}));let t=(0,n.T)("img",{id:"element-cancel-loading",className:"close",src:"/img/icon/close.svg"});t.addEventListener("click",this.cancelLoading),this.over.append(t),e.append(this.over)},this.back=e=>{this.oneholder.style.display="flex",this.twoholder.style.display="none",(0,n.ZP)("element-back").style.display="none",e&&((0,n.ZP)("add-element-content-ss-content").scrollTop=this.scrollTop)},this.cancelLoading=e=>{e.preventDefault(),e.stopPropagation(),this.canceled=!0,this.over.remove()},this.addElement=async(e,t,i,s="",r=c.Z.SCALE_METHOD_NONE)=>{this.canceled=!1,this.loading=!0;const o=(0,n.ZP)("element-progress");o.value=0;try{const e=await i,n=await(0,d.c6)(e,(e=>{this.canceled||(-1==e?o.removeAttribute("value"):o.value=e)}));if(this.canceled)return;const h=await(0,d.s4)(n);if(this.canceled)return;this.loading=!1,this.over.remove(),this.stage.addElement(a.qT(h,4096),t,e,s,r)}catch(h){console.log("Error",h),this.over.remove()}},this.addImage=e=>{let t=a.qT(e,"premium"===(null===h.a||void 0===h.a?void 0:h.a.subscriptionAccess)?8196:4096),i=e.name?e.name:e.src.replace(/^.*[\\\/]/,"");this.stage.addImage(t,i,"add")},this.browseClick=async e=>{(0,r.Z)("open-browse"),await(0,l.Q0)(!0).then((async e=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let t=0;t<e.length;t++)await(0,l.ZB)(this.stage,e[t],!1);document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}))},this.cancelClick=e=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.cleanUp=()=>{let e=(0,n.ZP)("element-tag-cloud").getElementsByTagName("a");for(var t=0;t<e.length;t++)e[t].removeEventListener("click",this.searchTag,!1);(0,n.ZP)("element-back").removeEventListener("click",this.back,!1),(0,n.ZP)("add-element-close").removeEventListener("click",this.cancelClick,!1),(0,n.ZP)("element-search").removeEventListener("keydown",this.searchInput,!1),(0,n.ZP)("element-browse").removeEventListener("click",this.browseClick,!1)},this.oneholder=(0,n.ZP)("one-element-list"),this.twoholder=(0,n.ZP)("two-element-list"),(0,n.ZP)("add-element-close").addEventListener("click",this.cancelClick,!1),(0,n.ZP)("element-search").addEventListener("keydown",this.searchInput,!1),(0,n.ZP)("element-browse").addEventListener("click",this.browseClick,!1);let t=(0,n.ZP)("element-tag-cloud").getElementsByTagName("a");for(var i=0;i<t.length;i++)t[i].addEventListener("click",this.searchTag,!1);(0,n.ZP)("element-back").addEventListener("click",this.back,!1),this.get("element")}}},877:(e,t,i)=>{i.d(t,{Z:()=>c});var s=i(93947),n=i(71030),a=i(18203),r=i(75934),o=i(33506),h=i(21951);class c extends a.Z{constructor(e){super("add-text",e),this.SERVER_URL="/",this.cancelClick=e=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.addText=()=>{this.stage.addText(),this.stage.reform.dblClick(),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"}))},this.populatePresets=async()=>{const e=await fetch("/text/index.json"),t=await e.json(),i=(0,s.ZP)("add-text-presets");i.innerHTML="",t.presets.forEach((e=>{const t="/text/"+e.id+"/thumbnail.webp",n=(0,s.T)("div",{id:e.id,className:"text-box"});n.setAttribute("loading","lazy"),e.premium&&n.classList.add("premium"),n.addEventListener("click",this.selectPreset,!0),n.style.backgroundImage="url("+t+")",i.append(n)}))},this.selectPreset=async e=>{if(this.working)return;if(e.currentTarget.classList.contains("premium")&&"premium"!==(null===o.a||void 0===o.a?void 0:o.a.subscriptionAccess))return void new h.Z("FONT");this.working=!0;const t=e.currentTarget.getAttribute("id");await(0,r.d3)(this.stage,"/text/"+t+"/manifest.json"),this.working=!1,(0,n.Z)("text-preset",t),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"}))},this.cleanUp=()=>{(0,s.ZP)("add-text-presets").innerHTML="",(0,s.ZP)("add-text-close").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("add-text-button").removeEventListener("click",this.addText,!1)},(0,s.ZP)("add-text-close").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("add-text-button").addEventListener("click",this.addText,!1),this.populatePresets()}}},16557:(e,t,i)=>{i.d(t,{Z:()=>u});var s=i(93947),n=i(96548),a=i(33655),r=i(36817),o=i(18203),h=i(74820),c=i(71662),l=i(4256),d=i(4188);class u extends o.Z{constructor(e){super("adjust",e),this.applyClick=()=>{document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.toggle=!1,this.toggleClick=()=>{this.toggle=!this.toggle,(0,s.ZP)("color").checked=this.toggle,(0,s.ZP)("light").checked=this.toggle,(0,s.ZP)("details").checked=this.toggle,(0,s.ZP)("scene").checked=this.toggle},this.compareDown=()=>{this.scratch.canvas=this.cached,window.requestAnimationFrame((()=>this.stage.render()))},this.compareUp=()=>{this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render()))},this.layerSelect=async()=>{const e=this.selected===this.stage.fresco.getSelected();if(this.selected&&!e&&this.apply(),!this.stage.fresco.isSelectedShaderbleWithCanvas())return(0,s.ZP)("adjust-layer-locked").style.display="block",(0,s.ZP)("adjust-settings").style.display="none",void(this.selected=null);(0,s.ZP)("adjust-layer-locked").style.display="none",(0,s.ZP)("adjust-settings").style.display="block",e?setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render()))}),0):(this.selected=this.stage.fresco.getSelected(),this.cached=this.selected.baked?this.selected.baked:this.selected.canvas,this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"replace",this.cached)),this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.setValues(this.shaders.chain),this.checkStateChanges()},this.setValues=e=>{this.reset(),e&&e.forEach((e=>{if("levels"===e.type)this.levelSet=e.value,255!=this.levelSet.maxout?this.sliders.white.setValue(Math.round(this.levelSet.maxout-255)):255!=this.levelSet.maxin&&this.sliders.white.setValue(Math.round(255-this.levelSet.maxin)),0!=this.levelSet.minout?this.sliders.black.setValue(Math.round(-this.levelSet.minout)):0!=this.levelSet.minin&&this.sliders.black.setValue(Math.round(this.levelSet.minin));else this.sliders[e.type]&&this.sliders[e.type].setValue(e.value)}))},this.reset=()=>{for(const e in this.sliders)this.sliders[e].reset()},this.resetClick=()=>{const e=this.shaders.cloneChain();0!==e.length&&(this.reset(),this.shaders.reset(),this.stage.history.add({type:"adjust",layer:this.selected,kind:"reset",shaders:this.shaders,chain:e}),this.execute(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("reset")})))},this.autoFix=()=>{const e=this.shaders.cloneChain();this.reset(),this.shaders.reset();let t=a.gr(this.selected.canvas);this.blackOrWhiteChange(Math.round(255-t.y),Math.round(t.x)),this.sliders.white.setValue(Math.round(255-t.y)),this.sliders.black.setValue(Math.round(t.x));let i=a.fu(this.selected.canvas);if(i<.7){const e=.7-i;this.sliders.vibrance.setValue(e),this.adjust("vibrance",e,!1)}this.stage.history.add({type:"adjust",layer:this.selected,kind:"auto",shaders:this.shaders,chain:e}),this.execute(),document.dispatchEvent(new CustomEvent("notification",{detail:"auto fix"}))},this.autoBW=()=>{const e=this.shaders.cloneChain();this.reset(),this.shaders.reset(),this.sliders.saturation.setValue(-1),this.adjust("saturation",-1,!1),this.sliders.contrast.setValue(.2),this.adjust("contrast",.25,!1),this.sliders.exposure.setValue(.1),this.adjust("exposure",.2,!1),this.sliders.clarity.setValue(.1),this.adjust("clarity",.2,!1),this.stage.history.add({type:"adjust",layer:this.selected,kind:"bw",shaders:this.shaders,chain:e}),this.execute(),document.dispatchEvent(new CustomEvent("notification",{detail:"black & white"}))},this.autoPop=()=>{const e=this.shaders.cloneChain();this.reset(),this.shaders.reset(),this.sliders.highlights.setValue(.5),this.adjust("highlights",.5,!1),this.sliders.shadows.setValue(-.5),this.adjust("shadows",-.5,!1),this.sliders.vibrance.setValue(.5),this.adjust("vibrance",.5,!1),this.sliders.saturation.setValue(.2),this.adjust("saturation",.2,!1),this.sliders.exposure.setValue(.2),this.adjust("exposure",.2,!1),this.sliders.clarity.setValue(.2),this.adjust("clarity",.2,!1),this.stage.history.add({type:"adjust",layer:this.selected,kind:"pop",shaders:this.shaders,chain:e}),this.execute(),document.dispatchEvent(new CustomEvent("notification",{detail:"auto pop"}))},this.adjust=(e,t,i=!0)=>{this.selected&&(this.shaders.addShader(e,t),i&&this.execute())},this.execute=()=>{setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render()))}),0)},this.checkStateChanges=()=>{(0,s.ZP)("adjust-color").classList.toggle("changed",this.isGroupChanged(["vibrance","saturation","temperature","tint","hue"])),(0,s.ZP)("adjust-light").classList.toggle("changed",this.isGroupChanged(["brightness","exposure","contrast","black","white","highlights","shadows"])),(0,s.ZP)("adjust-detail").classList.toggle("changed",this.isGroupChanged(["sharpen","smooth","grain","clarity"])),(0,s.ZP)("adjust-scene").classList.toggle("changed",this.isGroupChanged(["vignette","bloom","glamour","dehaze"]))},this.isGroupChanged=e=>{for(let t=0;t<e.length;t++)if(this.sliders[e[t]].isChanged())return!0;return!1},this.printPreset=e=>{if(!this.shaders||!this.shaders.chain)return;let t='"your-preset-name": [\n';this.shaders.chain.forEach((e=>{if("levels"===e.type)this.levelSet=e.value,t+='\tnew Setting("'+e.type+'", new ChannelMap(',t+=this.levelSet.minin+","+this.levelSet.maxin+","+this.levelSet.minout+","+this.levelSet.maxout,t+=")),\n";else t+='\tnew Setting("'+e.type+'",'+e.value+"),\n"})),t=t.slice(0,-2),t+="\n],",console.log(t)},this.blackOrWhiteChange=(e,t,i=!0)=>{this.levelSet=new c.Z(t>0?t:void 0,e>0?255-e:void 0,t<0?-1*t:void 0,e<0?e+255:void 0),this.adjust("levels",this.levelSet,i)},this.cancel=()=>{this.shaders.chain=[],this.stage.history.abortTransaction()},this.apply=()=>{if(!this.selected||!this.stage.fresco.hasLayer(this.selected)||!this.shaders||0===this.shaders.chain.length)return;const e=new r.Z(0,0,this.selected.rect.width,this.selected.rect.height),t=a.$E(this.selected.canvas);this.selected.replaceCanvas(this.shaders.apply(this.selected.canvas)),this.selected.render(),this.shaders.reset(),this.stage.history.add({type:"bitmapChange",kind:"adjust",layer:this.selected,patchRect:e,patch:t,rect:this.selected.rect.clone()})},this.cleanUp=()=>{var e;this.stage.fresco.removeScratch(),null===(e=this.shaders)||void 0===e||e.cleanUp(),(0,s.ZP)("auto-fix").removeEventListener("click",this.autoFix,!1),(0,s.ZP)("auto-bw").removeEventListener("click",this.autoBW,!1),(0,s.ZP)("auto-pop").removeEventListener("click",this.autoPop,!1),(0,s.ZP)("preset-print").removeEventListener("click",this.printPreset,!1);for(const t in this.sliders)this.sliders[t].cleanUp();(0,s.ZP)("adjust-apply").removeEventListener("click",this.applyClick,!1),(0,s.ZP)("adjust-close").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("adjust-cancel").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("adjust-toggle-all").removeEventListener("click",this.toggleClick,!1),(0,s.ZP)("adjust-compare").removeEventListener("mousedown",this.compareDown,!1),(0,s.ZP)("adjust-compare").removeEventListener("mouseup",this.compareUp,!1),(0,s.ZP)("adjust-reset").removeEventListener("mouseup",this.resetClick,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("history-update",this.checkStateChanges,!1),this.stage.render()},this.shaders=new l.Z,h.ZP.debug&&((0,s.ZP)("adjust-debug").style.display="block",(0,s.ZP)("preset-print").addEventListener("click",this.printPreset,!1));const t={range:[-1,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:(e,t)=>this.adjust(t,e),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.stage.history.add({type:"adjust",layer:this.selected,kind:i,shaders:this.shaders,chain:this.cacheChain})}},i=Object.assign(Object.assign({},t),{range:[0,1]}),o=Object.assign(Object.assign({},t),{range:[-100,100],step:2,labelFormat:e=>String(e),labelParse:e=>parseInt(e,10),onChange:()=>{const e=this.sliders.white.getValue(),t=this.sliders.black.getValue();this.blackOrWhiteChange(e,t)}}),u=Object.assign(Object.assign({},t),{range:[-180,180],step:1,labelFormat:e=>String(e),labelParse:e=>parseInt(e,10)});this.sliders={vibrance:new d.Z("vibrance",Object.assign(Object.assign({},t),{label:(0,n.Z)("vibrance")})),saturation:new d.Z("saturation",Object.assign(Object.assign({},t),{label:(0,n.Z)("saturation")})),temperature:new d.Z("temperature",Object.assign(Object.assign({},t),{label:(0,n.Z)("temperature")})),tint:new d.Z("tint",Object.assign(Object.assign({},t),{label:(0,n.Z)("tint")})),hue:new d.Z("hue",Object.assign(Object.assign({},u),{label:(0,n.Z)("hue")})),brightness:new d.Z("brightness",Object.assign(Object.assign({},t),{label:(0,n.Z)("brightness")})),exposure:new d.Z("exposure",Object.assign(Object.assign({},t),{label:(0,n.Z)("exposure")})),contrast:new d.Z("contrast",Object.assign(Object.assign({},t),{label:(0,n.Z)("contrast")})),black:new d.Z("black",Object.assign(Object.assign({},o),{label:(0,n.Z)("black")})),white:new d.Z("white",Object.assign(Object.assign({},o),{label:(0,n.Z)("white")})),highlights:new d.Z("highlights",Object.assign(Object.assign({},t),{label:(0,n.Z)("highlights")})),shadows:new d.Z("shadows",Object.assign(Object.assign({},t),{label:(0,n.Z)("shadows")})),sharpen:new d.Z("sharpen",Object.assign(Object.assign({},i),{label:(0,n.Z)("sharpen")})),smooth:new d.Z("smooth",Object.assign(Object.assign({},i),{label:(0,n.Z)("smooth")})),grain:new d.Z("grain",Object.assign(Object.assign({},i),{label:(0,n.Z)("grain")})),clarity:new d.Z("clarity",Object.assign(Object.assign({},t),{label:(0,n.Z)("clarity")})),blur:new d.Z("blur",Object.assign(Object.assign({},i),{label:(0,n.Z)("blur")})),vignette:new d.Z("vignette",Object.assign(Object.assign({},t),{label:(0,n.Z)("vignette")})),bloom:new d.Z("bloom",Object.assign(Object.assign({},i),{label:(0,n.Z)("bloom")})),glamour:new d.Z("glamour",Object.assign(Object.assign({},i),{label:(0,n.Z)("glamour")})),dehaze:new d.Z("dehaze",Object.assign(Object.assign({},i),{label:(0,n.Z)("dehaze")}))},(0,s.ZP)("adjust-apply").addEventListener("click",this.applyClick,!1),(0,s.ZP)("adjust-close").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("adjust-cancel").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("adjust-toggle-all").addEventListener("click",this.toggleClick,!1),(0,s.ZP)("adjust-compare").addEventListener("mousedown",this.compareDown,!1),(0,s.ZP)("adjust-compare").addEventListener("mouseup",this.compareUp,!1),(0,s.ZP)("adjust-reset").addEventListener("mouseup",this.resetClick,!1),(0,s.ZP)("auto-fix").addEventListener("click",this.autoFix,!1),(0,s.ZP)("auto-bw").addEventListener("click",this.autoBW,!1),(0,s.ZP)("auto-pop").addEventListener("click",this.autoPop,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("history-update",this.checkStateChanges,!1),this.layerSelect()}}},66246:(e,t,i)=>{i.d(t,{Z:()=>f});var s=i(93947),n=i(18203),a=i(71030),r=i(47339),o=i(21951),h=i(71750);class c{constructor(e,t,i=1,s=0,n=0,a=!1,r=h.Z.EASE_LINEAR,o=c.DIRECTION_FORWARD,l="center",d="all"){this.method=e,this.value=t,this.iterations=i,this.duration=s,this.delay=n,this.fill=a,this.easing=r,this.direction=o,this.manner=l,this.filter=d}}c.INFINITE=0,c.DIRECTION_FORWARD=1,c.DIRECTION_REVERSE=2,c.DIRECTION_ALTERNATE=3,c.DIRECTION_ALTERNATE_REVERSE=4;const l=c;var d=i(87318),u=i(83990);class p{static getOption(e,t,i){return void 0===e||void 0===e[t]?i:e[t]}static flipOption(e){switch(e){case"up":return"down";case"down":return"up";case"left":return"right";case"right":return"left"}return e}static getLayerAnimation(e,t){switch(e){case"fade-in":return{enter:new u.Z(e,[new l("opacity",{from:0},1,750,0,!0,h.Z.EASE_LINEAR)])};case"grow-in":{const i=p.getOption(t,"anchor","center");return{enter:new u.Z(e,[new l("opacity",{from:0},1,1e3,0,!0,h.Z.EASE_LINEAR),new l("scale",{from:.5},1,1e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{anchor:i})}}case"shrink-in":{const i=p.getOption(t,"anchor","center");return{enter:new u.Z(e,[new l("opacity",{from:0},1,1e3,0,!0,h.Z.EASE_LINEAR),new l("scale",{from:1.2},1,1e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{anchor:i})}}case"rise-in":return{enter:new u.Z(e,[new l("opacity",{from:0},1,750,0,!0,h.Z.EASE_LINEAR),new l("offset-y",{from:.2},1,750,0,!0,h.Z.EASE_OUT_CIRC)])};case"sink-in":return{enter:new u.Z(e,[new l("opacity",{from:0},1,750,0,!0,h.Z.EASE_LINEAR),new l("offset-y",{from:-.2},1,750,0,!0,h.Z.EASE_OUT_CIRC)])};case"vertical-in":return{enter:new u.Z(e,[new l("scale-height",{from:0},1,500,0,!0,h.Z.EASE_OUT_BACK)])};case"horizontal-in":return{enter:new u.Z(e,[new l("scale-width",{from:0},1,500,0,!0,h.Z.EASE_OUT_BACK)])};case"flicker-in":return{enter:new u.Z(e,[new l("opacity",{from:0},1,50,0,!0),new l("opacity",{to:0},1,100,100),new l("opacity",{to:1},1,50,200),new l("opacity",{to:0},1,100,300),new l("opacity",{to:1},1,50,400),new l("opacity",{to:0},1,100,600),new l("opacity",{to:1},1,50,800)])};case"tumble-in":{let i,s=p.getOption(t,"fourway","left");switch(s){case"right":i=new l("offset-x",{from:-1},1,400,0,!0,h.Z.EASE_LINEAR);break;case"left":i=new l("offset-x",{from:2},1,400,0,!0,h.Z.EASE_LINEAR);break;case"up":i=new l("offset-y",{from:2},1,400,0,!0,h.Z.EASE_LINEAR);break;case"down":i=new l("offset-y",{from:-1},1,400,0,!0,h.Z.EASE_LINEAR)}return{enter:new u.Z(e,[new l("rotate",{from:.2},1,380,0,!0,h.Z.EASE_LINEAR),i,new l("rotate",{to:.01},2,300,380,!1,h.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE)],{fourway:s})}}case"8-bit-in":{let i=p.getOption(t,"eightway","upleft");const s={enter:new u.Z(e,[new l("rotate",{from:.1,to:-.1},1,500,0,!0,h.Z.EASE_FIVE_LADDER),new l("rotate",{from:-.1,to:.1},1,500,500,!1,h.Z.EASE_FIVE_LADDER),new l("rotate",{set:0},1,0,1e3,!1)],{eightway:i})};switch(i){case"up":s.enter.motions.push(new l("offset-y",{from:.5},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"down":s.enter.motions.push(new l("offset-y",{from:-.5},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"left":s.enter.motions.push(new l("offset-x",{from:.5},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"right":s.enter.motions.push(new l("offset-x",{from:-.5},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"upleft":s.enter.motions.push(new l("offset-y",{from:.5},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER),new l("offset-x",{from:.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"upright":s.enter.motions.push(new l("offset-y",{from:.5},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER),new l("offset-x",{from:-.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"downleft":s.enter.motions.push(new l("offset-y",{from:-.5},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER),new l("offset-x",{from:.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"downright":s.enter.motions.push(new l("offset-y",{from:-.5},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER),new l("offset-x",{from:-.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER))}return s}case"whoa-in":return{enter:new u.Z(e,[new l("scale",{from:.5},1,500,0,!0,h.Z.EASE_LINEAR),new l("opacity",{from:0},1,750,0,!0,h.Z.EASE_LINEAR),new l("rotate",{to:-.075},2,750,0,!0,h.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE)])};case"drop-in":return{enter:new u.Z(e,[new l("offset-y",{from:-1,to:0},1,750,0,!0,h.Z.EASE_OUT_BOUNCE)])};case"action-in":{let i=p.getOption(t,"twoway","right");return{enter:new u.Z(e,[new l("offset-x","right"===i?{from:-1,to:-.2}:{from:1,to:.2},1,350,0,!0,h.Z.EASE_LINEAR),new l("offset-x",{to:0},1,2e3,350,!1,h.Z.EASE_LINEAR)],{twoway:i})}}case"pop-in":return{enter:new u.Z(e,[new l("opacity",{from:0},1,300,0,!0,h.Z.EASE_LINEAR),new l("scale",{from:0},1,750,0,!0,h.Z.EASE_OUT_ELASTIC)])};case"stomp-in":return{enter:new u.Z(e,[new l("opacity",{from:0},1,300,0,!0,h.Z.EASE_LINEAR),new l("scale",{from:4},1,800,0,!0,h.Z.EASE_OUT_BOUNCE)])};case"spring-in":return{enter:new u.Z(e,[new l("self-x",{set:-1},0,1,0,!0,h.Z.EASE_LINEAR),new l("scale-width",{to:2},1,300,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"left"),new l("self-x",{set:0},0,1,300,!1,h.Z.EASE_LINEAR),new l("scale-width",{to:1},1,200,300,!1,h.Z.EASE_IN_OUT_ELASTIC,l.DIRECTION_FORWARD,"right")])};case"backdown-in":return{enter:new u.Z(e,[new l("scale",{set:.6},1,1,0,!0),new l("offset-y",{from:-1},1,500,0,!0,h.Z.EASE_OUT_CUBIC),new l("scale",{to:1},1,200,400,!1,h.Z.EASE_OUT_BACK)])};case"backup-in":return{enter:new u.Z(e,[new l("scale",{set:.6},1,1,0,!0),new l("offset-y",{from:2},1,500,0,!0,h.Z.EASE_OUT_CUBIC),new l("scale",{to:1},1,200,400,!1,h.Z.EASE_OUT_BACK)])};case"pixelate-in":return{enter:new u.Z(e,[new l("pixelate",{from:1,to:0},1,1500,0,!0,h.Z.EASE_IN_CIRC)])};case"mosaic-in":return{enter:new u.Z(e,[new l("mosaic",{from:1,to:0},1,1500,0,!0,h.Z.EASE_IN_CIRC)])};case"fringe-in":return{enter:new u.Z(e,[new l("opacity",{from:0,to:1},1,500,0,!0,h.Z.EASE_LINEAR),new l("fringe",{from:1,to:0},1,500,0,!0,h.Z.EASE_IN_OUT_BOUNCE)])};case"melt-in":{let i=p.getOption(t,"fiveway","center");return{enter:new u.Z(e,[new l("melt",{from:1,to:0},1,1e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{fiveway:i})}}case"gooey-in":return{enter:new u.Z(e,[new l("gooey",{from:1,to:0},1,1e3,0,!0,h.Z.EASE_LINEAR)])};case"block-in":return{enter:new u.Z(e,[new l("block",{from:1,to:0},1,1e3,0,!0,h.Z.EASE_LINEAR)])};case"curtain-in":{let i=p.getOption(t,"plane","horizontal");return{enter:new u.Z(e,[new l("curtain",{from:1,to:0},1,1e3,0,!0,h.Z.EASE_OUT_QUART,l.DIRECTION_FORWARD,i)],{plane:i})}}case"blinds-in":{let i=p.getOption(t,"fourway","right");return{enter:new u.Z(e,[new l("blinds",{from:1,to:0},1,1e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{fourway:i})}}case"wipe-in":{let i=p.getOption(t,"fourway","left");return{enter:new u.Z(e,[new l("wipe",{from:1,to:0},1,800,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{fourway:i})}}case"swipe-in":{let i=p.getOption(t,"fourway","left");return{enter:new u.Z(e,[new l("swipe",{from:1,to:0},1,600,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{fourway:i})}}case"slot-in":{let i=p.getOption(t,"fourway","left");return{enter:new u.Z(e,[new l("slot",{from:1,to:0},1,800,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{fourway:i})}}case"split-in":{let i=p.getOption(t,"plane","vertical");return{enter:new u.Z(e,[new l("split",{from:1,to:0},1,500,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{plane:i})}}case"line-in":{let i=p.getOption(t,"plane","vertical");return{enter:new u.Z(e,[new l("line",{from:1,to:0},1,500,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{plane:i})}}case"circular-in":return{enter:new u.Z(e,[new l("circular",{from:1,to:0},1,1e3,0,!0,h.Z.EASE_LINEAR)])};case"ripple-in":return{enter:new u.Z(e,[new l("ripple",{from:1,to:0},1,1e3,0,!0,h.Z.EASE_LINEAR)])};case"warp-in":{let i=p.getOption(t,"fourway","left");return{enter:new u.Z(e,[new l("warp",{from:1,to:0},1,1e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{fourway:i})}}case"rotate":{let i=p.getOption(t,"rotation","right");return{scene:new u.Z(e,[new l("rotate","right"===i?{from:0,to:1}:{from:1,to:0},1,2e3,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD)],{rotation:i})}}case"jiggle":return{scene:new u.Z(e,[new l("rotate",{from:-.05,to:.05},12,2e3,0,!1,h.Z.EASE_LINEAR)])};case"wave":{let i=p.getOption(t,"anchor","bottom");return{scene:new u.Z(e,[new l("rotate",{to:-.075},1,500,0,!1,h.Z.EASE_OUT_CUBIC,l.DIRECTION_FORWARD,i),new l("rotate",{from:-.075,to:.075},1,1e3,500,!1,h.Z.EASE_IN_OUT_CUBIC,l.DIRECTION_ALTERNATE,i),new l("rotate",{to:0},1,500,1500,!1,h.Z.EASE_IN_CUBIC,l.DIRECTION_FORWARD,i)],{anchor:i})}}case"marquee":{let i=p.getOption(t,"fourway","right");return{scene:new u.Z(e,[new l("marquee",{from:0,to:1},1,1500,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{fourway:i})}}case"floating":return{scene:new u.Z(e,[new l("self-y",{to:-.2},1,400,0,!1,h.Z.EASE_OUT_CUBIC),new l("self-y",{from:-.2,to:.2},1,800,400,!1,h.Z.EASE_IN_OUT_CUBIC,l.DIRECTION_ALTERNATE),new l("self-y",{to:0},1,400,1200,!1,h.Z.EASE_IN_CUBIC)])};case"flip":{const i=p.getOption(t,"plane","vertical");return"vertical"===i?{scene:new u.Z(e,[new l("scale-height",{from:1,to:0},1,200,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD),new l("scale-height",{from:0,to:-1},1,200,200,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD),new l("scale-height",{from:-1,to:1},1,400,400,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD)],{plane:i})}:{scene:new u.Z(e,[new l("scale-width",{from:1,to:0},1,200,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD),new l("scale-width",{from:0,to:-1},1,200,200,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD),new l("scale-width",{from:-1,to:1},1,400,400,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD)],{plane:i})}}case"drift":return{scene:new u.Z(e,[new l("offset-x",{to:.2},1,2e3,0,!1,h.Z.EASE_LINEAR),new l("offset-x",{to:-.2},1,4e3,2e3,!1,h.Z.EASE_LINEAR),new l("offset-x",{to:0},1,2e3,6e3,!1,h.Z.EASE_LINEAR)])};case"gelatine":return{scene:new u.Z(e,[new l("scale-width",{to:.9},1,100,0),new l("scale-width",{to:1.1},1,100,100),new l("scale-width",{to:.95},1,100,200),new l("scale-width",{to:1},1,100,300),new l("scale-height",{to:1.1},1,100,0),new l("scale-height",{to:.9},1,100,100),new l("scale-height",{to:1.05},1,100,200),new l("scale-height",{to:1},1,100,300)])};case"bounce":return{scene:new u.Z(e,[new l("scale-width",{to:1.1},1,100,0),new l("scale-height",{to:.9},1,100,0),new l("self-y",{to:.1},1,100,0),new l("scale-width",{to:.9},1,300,100),new l("scale-height",{to:1.1},1,300,100),new l("self-y",{to:-1.5},1,300,100,!1,h.Z.EASE_OUT_CUBIC),new l("scale-width",{to:1},1,300,410),new l("scale-height",{to:1},1,300,410),new l("self-y",{to:0},1,500,410,!1,h.Z.EASE_OUT_BOUNCE)])};case"vibrate":return{scene:new u.Z(e,[new l("self-x",{to:-.01},1,30,0,!1,h.Z.EASE_LINEAR),new l("self-y",{to:.01},1,30,0,!1,h.Z.EASE_LINEAR),new l("self-y",{to:-.01},1,30,30,!1,h.Z.EASE_LINEAR),new l("self-x",{to:.01},1,50,60,!1,h.Z.EASE_LINEAR),new l("self-y",{to:.01},1,50,60,!1,h.Z.EASE_LINEAR),new l("self-x",{to:0},1,30,110,!1,h.Z.EASE_LINEAR),new l("self-y",{to:0},1,30,120,!1,h.Z.EASE_LINEAR),new l("self-x",{to:-.01},1,30,120,!1,h.Z.EASE_LINEAR),new l("self-y",{to:.01},1,30,120,!1,h.Z.EASE_LINEAR),new l("self-y",{to:-.01},1,30,150,!1,h.Z.EASE_LINEAR),new l("self-x",{to:.01},1,50,180,!1,h.Z.EASE_LINEAR),new l("self-y",{to:.01},1,50,180,!1,h.Z.EASE_LINEAR),new l("self-x",{to:0},1,30,230,!1,h.Z.EASE_LINEAR),new l("self-y",{to:0},1,30,250,!1,h.Z.EASE_LINEAR)])};case"flicker":return{scene:new u.Z(e,[new l("opacity",{to:0},1,30,500),new l("opacity",{to:1},1,30,550),new l("opacity",{to:0},1,30,650),new l("opacity",{to:1},1,50,690),new l("opacity",{to:0},1,30,1300),new l("opacity",{to:1},1,30,1350),new l("opacity",{to:0},1,30,1700),new l("opacity",{to:1},1,30,1750),new l("opacity",{to:0},1,30,1900),new l("opacity",{to:1},1,50,1950)])};case"beat":return{scene:new u.Z(e,[new l("scale",{to:.91},1,150,0,!1,h.Z.EASE_OUT_QUAD),new l("scale",{to:.98},1,150,150,!1,h.Z.EASE_OUT_QUAD),new l("scale",{to:.91},1,150,400,!1,h.Z.EASE_OUT_QUAD),new l("scale",{to:1},1,200,600,!1,h.Z.EASE_OUT_QUAD)])};case"fade-out":return{exit:new u.Z(e,[new l("opacity",{to:0},1,750,0,!1,h.Z.EASE_LINEAR)])};case"grow-out":{const i=p.getOption(t,"anchor","center");return{exit:new u.Z(e,[new l("opacity",{to:0},1,1e3,0,!1,h.Z.EASE_LINEAR),new l("scale",{to:1.2},1,1e3,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{anchor:i})}}case"shrink-out":{const i=p.getOption(t,"anchor","center");return{exit:new u.Z(e,[new l("opacity",{to:0},1,1e3,0,!1,h.Z.EASE_LINEAR),new l("scale",{to:.5},1,1e3,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{anchor:i})}}case"rise-out":return{exit:new u.Z(e,[new l("opacity",{to:0},1,750,0,!1,h.Z.EASE_LINEAR),new l("offset-y",{to:-.2},1,750,0,!1,h.Z.EASE_IN_CIRC)])};case"sink-out":return{exit:new u.Z(e,[new l("opacity",{to:0},1,750,0,!1,h.Z.EASE_LINEAR),new l("offset-y",{to:.2},1,750,0,!1,h.Z.EASE_IN_CIRC)])};case"vertical-out":return{exit:new u.Z(e,[new l("scale-height",{to:0},1,500,0,!1,h.Z.EASE_IN_BACK)])};case"horizontal-out":return{exit:new u.Z(e,[new l("scale-width",{to:0},1,500,0,!1,h.Z.EASE_IN_BACK)])};case"flicker-out":return{exit:new u.Z(e,[new l("opacity",{to:0},1,50,0,!1),new l("opacity",{to:1},1,100,100),new l("opacity",{to:0},1,50,200),new l("opacity",{to:1},1,100,300),new l("opacity",{to:0},1,50,400),new l("opacity",{to:1},1,100,600),new l("opacity",{to:0},1,50,700)])};case"tumble-out":{let i,s=p.getOption(t,"fourway","right");switch(s){case"right":i=new l("offset-x",{to:1.5},1,400,300,!1,h.Z.EASE_LINEAR);break;case"left":i=new l("offset-x",{to:-1.5},1,400,300,!1,h.Z.EASE_LINEAR);break;case"up":i=new l("offset-y",{to:-1.5},1,400,300,!1,h.Z.EASE_LINEAR);break;case"down":i=new l("offset-y",{to:1.5},1,400,300,!1,h.Z.EASE_LINEAR)}return{exit:new u.Z(e,[new l("rotate",{to:.01},2,300,0,!1,h.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE),new l("rotate",{to:.2},2,500,300,!1,h.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE),i],{fourway:s})}}case"8-bit-out":{let i=p.getOption(t,"eightway","upleft");const s={exit:new u.Z(e,[new l("rotate",{from:.1,to:-.1},1,500,0,!0,h.Z.EASE_FIVE_LADDER),new l("rotate",{from:-.1,to:.1},1,500,500,!1,h.Z.EASE_FIVE_LADDER),new l("rotate",{set:0},1,0,1e3,!1)],{eightway:i})};switch(i){case"up":s.exit.motions.push(new l("offset-y",{to:-1.2},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"down":s.exit.motions.push(new l("offset-y",{to:1.2},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"left":s.exit.motions.push(new l("offset-x",{to:-1.2},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"right":s.exit.motions.push(new l("offset-x",{to:1.2},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"upleft":s.exit.motions.push(new l("offset-y",{to:-1.2},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER),new l("offset-x",{to:-.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"upright":s.exit.motions.push(new l("offset-y",{to:-1.2},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER),new l("offset-x",{to:.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"downleft":s.exit.motions.push(new l("offset-y",{to:1.2},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER),new l("offset-x",{to:-.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER));break;case"downright":s.exit.motions.push(new l("offset-y",{to:1.2},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER),new l("offset-x",{to:.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER))}return s}case"whoa-out":return{exit:new u.Z(e,[new l("scale",{to:1.5},1,500,0,!1,h.Z.EASE_LINEAR),new l("opacity",{to:0},1,750,0,!1,h.Z.EASE_LINEAR),new l("rotate",{to:-.075},2,750,0,!1,h.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE)])};case"drop-out":return{exit:new u.Z(e,[new l("rotate",{to:.01},2,300,0,!1,h.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE),new l("offset-y",{to:1},1,750,250,!1,h.Z.EASE_OUT_BOUNCE)])};case"action-out":{let i=p.getOption(t,"twoway","right");return{exit:new u.Z(e,[new l("offset-x","right"===i?{to:.1}:{to:-.1},1,1e3,0,!1,h.Z.EASE_LINEAR),new l("offset-x","right"===i?{to:1.5}:{to:-1.5},1,350,1e3,!1,h.Z.EASE_LINEAR)],{twoway:i})}}case"spring-out":return{exit:new u.Z(e,[new l("scale-width",{to:2},1,300,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"right"),new l("scale-width",{to:1},1,200,300,!1,h.Z.EASE_IN_OUT_ELASTIC,l.DIRECTION_FORWARD,"left"),new l("self-x",{set:1},0,1,300,!1,h.Z.EASE_LINEAR)])};case"backup-out":return{exit:new u.Z(e,[new l("scale",{to:.6},1,200,0,!1,h.Z.EASE_IN_BACK),new l("offset-y",{to:-1},1,500,150,!1,h.Z.EASE_IN_CUBIC)])};case"backdown-out":return{exit:new u.Z(e,[new l("scale",{to:.6},1,200,0,!1,h.Z.EASE_IN_BACK),new l("offset-y",{to:1},1,500,150,!1,h.Z.EASE_IN_CUBIC)])};case"pixelate-out":return{exit:new u.Z(e,[new l("pixelate",{from:0,to:1},1,1500,0,!1,h.Z.EASE_OUT_CIRC)])};case"mosaic-out":return{exit:new u.Z(e,[new l("mosaic",{from:0,to:1},1,1500,0,!1,h.Z.EASE_OUT_CIRC)])};case"fringe-out":return{exit:new u.Z(e,[new l("opacity",{from:1,to:0},1,500,0,!0,h.Z.EASE_LINEAR),new l("fringe",{from:0,to:1},1,500,0,!0,h.Z.EASE_IN_OUT_BOUNCE)])};case"melt-out":{let i=p.getOption(t,"fiveway","center");return{exit:new u.Z(e,[new l("melt",{from:0,to:1},1,1e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,p.flipOption(i))],{fiveway:i})}}case"gooey-out":return{exit:new u.Z(e,[new l("gooey",{from:0,to:1},1,1e3,0,!1,h.Z.EASE_LINEAR)])};case"block-out":return{exit:new u.Z(e,[new l("block",{from:0,to:1},1,1e3,0,!1,h.Z.EASE_LINEAR)])};case"curtain-out":{let i=p.getOption(t,"plane","horizontal");return{exit:new u.Z(e,[new l("curtain",{from:0,to:1},1,1e3,0,!0,h.Z.EASE_IN_QUART,l.DIRECTION_FORWARD,i)],{plane:i})}}case"blinds-out":let i=p.getOption(t,"fourway","right");return{exit:new u.Z(e,[new l("blinds",{from:0,to:1},1,1e3,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,p.flipOption(i))],{fourway:i})};case"wipe-out":{let i=p.getOption(t,"fourway","right");return{exit:new u.Z(e,[new l("wipe",{from:0,to:1},1,800,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,p.flipOption(i))],{fourway:i})}}case"swipe-out":{let i=p.getOption(t,"fourway","right");return{exit:new u.Z(e,[new l("swipe",{from:0,to:1},1,600,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,p.flipOption(i))],{fourway:i})}}case"slot-out":{let i=p.getOption(t,"fourway","right");return{exit:new u.Z(e,[new l("slot",{from:0,to:1},1,800,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,p.flipOption(i))],{fourway:i})}}case"split-out":{let i=p.getOption(t,"plane","vertical");return{exit:new u.Z(e,[new l("split",{from:0,to:1},1,500,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{plane:i})}}case"line-out":{let i=p.getOption(t,"plane","vertical");return{exit:new u.Z(e,[new l("line",{from:0,to:1},1,500,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,i)],{plane:i})}}case"circular-out":return{exit:new u.Z(e,[new l("circular",{from:0,to:1},1,1e3,0,!1,h.Z.EASE_LINEAR)])};case"ripple-out":return{exit:new u.Z(e,[new l("ripple",{from:0,to:1},1,1e3,0,!1,h.Z.EASE_LINEAR)])};case"warp-out":{let i=p.getOption(t,"fourway","left");return{exit:new u.Z(e,[new l("warp",{from:0,to:1},1,1e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,p.flipOption(i))],{fourway:i})}}}console.log("No such layer animation preset")}static getPageAnimation(e){switch(e){case"fade":return{stagger:new d.Z(1500,"top"),enter:new u.Z(e,[new l("scale",{set:1.05},1,0,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","background"),new l("viewport-box-y",{from:0,to:1},1,7e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","background"),new l("opacity",{from:0},1,750,0,!0,h.Z.EASE_LINEAR)],void 0,750),scene:new u.Z(e,void 0,void 0,5e3),exit:new u.Z(e,[new l("opacity",{to:0},1,750,0,!1,h.Z.EASE_LINEAR)])};case"rise":return{stagger:new d.Z(1500,"top"),enter:new u.Z(e,[new l("opacity",{from:0},1,800,0,!0,h.Z.EASE_LINEAR),new l("offset-y",{from:.3},1,800,0,!0,h.Z.EASE_LINEAR)]),scene:new u.Z(e,void 0,void 0,5e3),exit:new u.Z(e,[new l("opacity",{to:0},1,800,0,!1,h.Z.EASE_LINEAR),new l("offset-y",{to:-.3},1,800,0,!1,h.Z.EASE_LINEAR)])};case"tumble":return{stagger:new d.Z(1500,"top"),enter:new u.Z(e,[new l("rotate",{from:.2},1,380,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"bottom","odd"),new l("offset-x",{from:2},1,400,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","odd"),new l("rotate",{to:.01},2,300,380,!1,h.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE,"bottom","odd"),new l("rotate",{from:-.2},1,380,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"top","even"),new l("offset-x",{from:-2},1,400,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","even"),new l("rotate",{to:-.01},2,300,380,!1,h.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE,"top","even")]),scene:new u.Z(e,void 0,void 0,3e3),exit:new u.Z(e,[new l("rotate",{to:.01},2,300,0,!1,h.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE,"center","odd"),new l("rotate",{to:.2},2,500,300,!1,h.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","odd"),new l("offset-x",{to:1.5},1,400,300,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","odd"),new l("rotate",{to:-.01},2,300,0,!1,h.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE,"center","even"),new l("rotate",{to:-.2},2,500,300,!1,h.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","even"),new l("offset-x",{to:-1.5},1,400,300,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","even")])};case"scrap":return{stagger:new d.Z(1500,"top"),enter:new u.Z(e,[new l("rotate",{from:.1,to:-.1},1,500,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","1-four"),new l("rotate",{from:-.1,to:.1},1,500,500,!1,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","1-four"),new l("rotate",{set:0},1,0,1e3,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","1-four"),new l("offset-y",{from:.5},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","1-four"),new l("offset-x",{from:.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","1-four"),new l("rotate",{from:.1,to:-.1},1,500,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","2-four"),new l("rotate",{from:-.1,to:.1},1,500,500,!1,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","2-four"),new l("rotate",{set:0},1,0,1e3,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","2-four"),new l("offset-y",{from:.5},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","2-four"),new l("offset-x",{from:-.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","2-four"),new l("rotate",{from:.1,to:-.1},1,500,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","3-four"),new l("rotate",{from:-.1,to:.1},1,500,500,!1,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","3-four"),new l("rotate",{set:0},1,0,1e3,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","3-four"),new l("offset-y",{from:-.5},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","3-four"),new l("offset-x",{from:.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","3-four"),new l("rotate",{from:.1,to:-.1},1,500,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","4-four"),new l("rotate",{from:-.1,to:.1},1,500,500,!1,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","4-four"),new l("rotate",{set:0},1,0,1e3,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","4-four"),new l("offset-y",{from:-.5},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","4-four"),new l("offset-x",{from:-.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","4-four")]),scene:new u.Z(e,void 0,void 0,3e3),exit:new u.Z(e,[new l("rotate",{from:.1,to:-.1},1,500,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","1-four"),new l("rotate",{from:-.1,to:.1},1,500,500,!1,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","1-four"),new l("rotate",{set:0},1,0,1e3,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","1-four"),new l("offset-y",{to:-1.2},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","1-four"),new l("offset-x",{to:-.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","1-four"),new l("rotate",{from:.1,to:-.1},1,500,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","2-four"),new l("rotate",{from:-.1,to:.1},1,500,500,!1,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","2-four"),new l("rotate",{set:0},1,0,1e3,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","2-four"),new l("offset-y",{to:-1.2},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","2-four"),new l("offset-x",{to:.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","2-four"),new l("rotate",{from:.1,to:-.1},1,500,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","3-four"),new l("rotate",{from:-.1,to:.1},1,500,500,!1,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","3-four"),new l("rotate",{set:0},1,0,1e3,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","3-four"),new l("offset-y",{to:1.2},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","3-four"),new l("offset-x",{to:-.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","3-four"),new l("rotate",{from:.1,to:-.1},1,500,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","4-four"),new l("rotate",{from:-.1,to:.1},1,500,500,!1,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","4-four"),new l("rotate",{set:0},1,0,1e3,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","4-four"),new l("offset-y",{to:1.2},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","4-four"),new l("offset-x",{to:.4},1,1e3,0,!0,h.Z.EASE_FIVE_LADDER,l.DIRECTION_FORWARD,"center","4-four")])};case"soothe":return{stagger:new d.Z(1500,"top"),enter:new u.Z(e,[new l("scale",{set:1.05},1,0,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","background"),new l("viewport-box-x",{from:0,to:1},1,8e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","background"),new l("viewport-box-y",{from:0,to:1},1,8e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","background"),new l("opacity",{from:0},1,2e3,0,!0,h.Z.EASE_LINEAR),new l("scale",{from:.9},1,2e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","large"),new l("scale",{from:.9},1,2e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","medium"),new l("scale",{from:.7},1,2e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","small")],void 0,2e3),scene:new u.Z(e,void 0,void 0,4e3),exit:new u.Z(e,[new l("opacity",{to:0},1,1e3,0,!1,h.Z.EASE_LINEAR)])};case"action":return{stagger:new d.Z(2e3,"top"),enter:new u.Z(e,[new l("viewport-x",{from:-1,to:.4},1,350,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text")]),scene:new u.Z(e,[new l("viewport-x",{from:.4,to:.6},1,3e3,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text")]),exit:new u.Z(e,[new l("viewport-x",{from:.6,to:2},1,350,0,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text")])};case"parallax":return{enter:new u.Z(e,[new l("scale",{to:1.1},1,6e3,0,!0,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","background"),new l("self-x",{from:.5,to:0},1,2e3,0,!0,h.Z.EASE_OUT_CUBIC,l.DIRECTION_FORWARD,"center","odd"),new l("self-x",{from:-.5,to:0},1,2e3,0,!0,h.Z.EASE_OUT_CUBIC,l.DIRECTION_FORWARD,"center","even")],void 0,2e3),scene:new u.Z(e,void 0,void 0,2e3),exit:new u.Z(e,[new l("self-x",{to:-.8},1,2e3,0,!1,h.Z.EASE_IN_CUBIC,l.DIRECTION_FORWARD,"center","odd"),new l("self-x",{to:.8},1,2e3,0,!1,h.Z.EASE_IN_CUBIC,l.DIRECTION_FORWARD,"center","even")])};case"stomp":return{enter:new u.Z(e,[new l("scale",{from:4,to:1},1,300,0,!1,h.Z.EASE_IN_CUBIC,l.DIRECTION_FORWARD,"center","foreground"),new l("scale",{to:1.05},4,400,300,!1,h.Z.EASE_OUT_CUBIC,l.DIRECTION_ALTERNATE,"center","odd"),new l("rotate",{to:.01},1,100,300,!1,h.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","odd"),new l("rotate",{from:.01,to:-.01},1,200,400,!1,h.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","odd"),new l("rotate",{to:0},1,100,600,!1,h.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","odd"),new l("scale",{to:1.05},4,400,300,!1,h.Z.EASE_OUT_CUBIC,l.DIRECTION_ALTERNATE,"center","even"),new l("rotate",{to:-.01},1,100,300,!1,h.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","even"),new l("rotate",{from:-.01,to:.01},1,200,400,!1,h.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","even"),new l("rotate",{to:0},1,100,600,!1,h.Z.EASE_LINEAR,l.DIRECTION_ALTERNATE,"center","even")]),scene:new u.Z(e,void 0,void 0,4e3),exit:new u.Z(e,[new l("rotate",{to:.01},2,300,0,!1,h.Z.EASE_OUT_BACK,l.DIRECTION_ALTERNATE,"center","foreground"),new l("offset-y",{to:1},1,750,250,!1,h.Z.EASE_OUT_BOUNCE,l.DIRECTION_FORWARD,"center","foreground")])};case"neon":return{stagger:new d.Z(1e3,"top"),enter:new u.Z(e,[new l("opacity",{to:1},1,50,200,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","all"),new l("opacity",{to:0},1,100,300,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","all"),new l("opacity",{to:1},1,50,400,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","all"),new l("opacity",{to:0},1,100,600,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","all"),new l("opacity",{to:1},1,50,800,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","all")]),scene:new u.Z(e,[new l("opacity",{to:0},1,30,500,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","foreground"),new l("opacity",{to:1},1,30,550,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","foreground"),new l("opacity",{to:0},1,30,650,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","small"),new l("opacity",{to:1},1,50,690,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","small"),new l("opacity",{to:0},1,30,1300,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","small"),new l("opacity",{to:1},1,30,1350,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","small"),new l("opacity",{to:0},1,30,1700,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text"),new l("opacity",{to:1},1,30,1750,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text"),new l("opacity",{to:0},1,30,1900,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text"),new l("opacity",{to:1},1,50,1950,!1,h.Z.EASE_LINEAR,l.DIRECTION_FORWARD,"center","text")],void 0,void 0,2e3),exit:new u.Z(e,[new l("opacity",{to:0},1,50,0),new l("opacity",{to:1},1,100,100),new l("opacity",{to:0},1,50,200),new l("opacity",{to:1},1,100,300),new l("opacity",{to:0},1,50,400),new l("opacity",{to:1},1,100,600)],void 0,void 0,1e3)}}console.log("No such page animation preset")}}p.layerEnterAnimations=[["fade-in",!1],["grow-in",!1,!0],["shrink-in",!1,!0],["rise-in",!1],["sink-in",!1],["vertical-in",!1],["horizontal-in",!1],["flicker-in",!0],["tumble-in",!0,!0],["8-bit-in",!0,!0],["whoa-in",!0],["drop-in",!0],["action-in",!0,!0],["pop-in",!0],["stomp-in",!0],["spring-in",!0],["backdown-in",!0],["backup-in",!0],["pixelate-in",!1],["mosaic-in",!0],["fringe-in",!0],["melt-in",!0,!0],["gooey-in",!0],["block-in",!0],["curtain-in",!0,!0],["blinds-in",!0,!0],["wipe-in",!1,!0],["swipe-in",!0,!0],["slot-in",!1,!0],["split-in",!0,!0],["line-in",!0,!0],["circular-in",!0],["ripple-in",!0],["warp-in",!0,!0]],p.layerSceneAnimations=[["rotate",!1,!0],["jiggle",!1],["wave",!1,!0],["marquee",!1],["flip",!1,!0],["floating",!0],["drift",!0],["gelatine",!0],["bounce",!0],["vibrate",!0],["flicker",!0],["beat",!0]],p.layerExitAnimations=[["fade-out",!1],["grow-out",!1,!0],["shrink-out",!1,!0],["rise-out",!1],["sink-out",!1],["vertical-out",!1],["horizontal-out",!1],["flicker-out",!0],["tumble-out",!0,!0],["8-bit-out",!0,!0],["whoa-out",!0],["drop-out",!0],["action-out",!0,!0],["spring-out",!0],["backdown-out",!0],["backup-out",!0],["pixelate-out",!1],["mosaic-out",!0],["fringe-out",!0],["melt-out",!0,!0],["gooey-out",!0],["block-out",!0],["curtain-out",!0,!0],["blinds-out",!0,!0],["wipe-out",!1,!0],["swipe-out",!0,!0],["slot-out",!1,!0],["split-out",!0,!0],["line-out",!0,!0],["circular-out",!0],["ripple-out",!0],["warp-out",!0,!0]],p.pageFullAnimations=[["none",!1],["fade",!1],["rise",!1],["tumble",!1],["scrap",!0],["soothe",!1],["action",!1],["parallax",!0],["stomp",!0],["neon",!0]];const g=p;var m=i(92396),v=i(33506);class f extends n.Z{constructor(e){super("animation",e),this.enter=e=>{this.stage.stopAnimation();const t=e.currentTarget.id;if("none"===t)return;const i=g.getPageAnimation(t),s=this.prepareAnimators(i,!1);this.stage.playAnimation(24,s)},this.leave=e=>{this.stage.stopAnimation()},this.prepareAnimators=(e,t=!0)=>{const i=new Array,s=m.Z.fromInjection(e);for(const n of this.stage.fresco.layers)if(n.animation)n.animation.block||i.push(new r.Z(n,r.Z.createLayerTransitions(n.animation)));else{const e=r.Z.createPageTransitions(n,this.stage.fresco,s);e.length>0&&i.push(new r.Z(n,e))}return i},this.selectPreset=e=>{this.stage.stopAnimation();let t=e.currentTarget;if("premium"!==(null===v.a||void 0===v.a?void 0:v.a.subscriptionAccess)&&t.classList.contains("premium"))return void new o.Z("animation");t.classList.add("selected");let i=(0,s.ZP)("animation-presets").getElementsByClassName("apreset-page");for(var n=0;n<i.length;n++)i[n].classList.remove("selected");t.classList.add("selected");const r=t.id,h=this.stage.fresco.animation;this.stage.fresco.animation="none"===r?void 0:m.Z.fromInjection(g.getPageAnimation(r)),(0,a.Z)("page-animation",r),this.stage.history.add({type:"pageAnimation",kind:r,animation:h})},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.cleanUp=()=>{(0,s.ZP)("animation-presets").innerHTML="",(0,s.ZP)("animation-close").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("animation-cancel").removeEventListener("click",this.cancelClick,!1)},(0,s.ZP)("animation-close").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("animation-cancel").addEventListener("click",this.cancelClick,!1);let t="none",i=g.pageFullAnimations,n=(0,s.ZP)("animation-presets");t=this.stage.fresco.animation&&this.stage.fresco.animation.enter?this.stage.fresco.animation.enter.name:"none";for(const[a,r]of i){const e=(0,s.T)("div",{id:a,className:"apreset-page"});r&&e.classList.add("premium"),"none"!==a&&(e.addEventListener("pointerenter",this.enter,!1),e.addEventListener("pointerleave",this.leave,!1)),e.addEventListener("click",this.selectPreset,!1),t===a&&e.classList.add("selected"),e.append((0,s.T)("img",{src:"/img/icon/animation/"+a+".svg",className:"ic"}),(0,s.T)("span",{},a.replace("-"," "))),n.appendChild(e)}}}},71956:(e,t,i)=>{i.d(t,{Z:()=>H});var s=i(93947),n=i(96548),a=i(36817),r=i(18203),o=i(4188),h=i(44170),c=i(78685),l=i(51294),d=i(87108),u=i(77664);class p{constructor(e){this.cleanUp=()=>{},this.stage=e}}var g=i(9591),m=i(33655),v=i(98776),f=i(77359),y=i(9067),w=i(43673),x=i(74820);class b{constructor(e,t,i=!1){this.docked=!1,this.setTitle=(e,t=40)=>{e=e.length>t?`${e.substring(0,5)}...`:e,(0,s.ZP)("float-title-"+this.mid).innerHTML=e},this.position=()=>{if(this.parent)if("x"===x.ZP.product)this.float.style.left="400px",this.float.style.top=Math.round(((0,s.ZP)("workspace").clientHeight-this.float.clientHeight)/3)+"px";else{let e=this.parent.getBoundingClientRect();this.float.style.left=~~(e.right-this.float.clientWidth/2-e.width/2)+"px",this.float.style.top=e.top+30+"px"}else{const e=(0,s.ZP)("workspace").getBoundingClientRect();this.docked?(this.float.style.left="unset",this.float.style.right="0",this.float.style.top="77px",this.float.style.height=e.height-77+"px"):(this.float.style.left=e.width-~~(this.float.offsetWidth/2)-400+"px",this.float.style.height="600px",this.float.style.top="120px"),this.float.classList.toggle("docked",this.docked)}},this.setContent=(...e)=>{e[0]instanceof HTMLElement?this.content.append(...e):this.content.innerHTML+=e[0],this.position()},this.dragStart=e=>{this.docked||(this.p=e,this.d=new w.Z(this.float.offsetLeft,this.float.offsetTop))},this.dragMove=e=>{this.docked||(this.float.style.left=Math.round(this.d.x+(e.x-this.p.x))+"px",this.float.style.top=Math.round(this.d.y+(e.y-this.p.y))+"px")},this.dragEnd=e=>{if(this.docked)return;let t=Math.round(this.d.y+(e.y-this.p.y)),i=Math.round(this.d.x+(e.x-this.p.x)),n=this.float.offsetWidth;t<20&&(t=20),i<-n/2&&(i=0),i+n/2>(0,s.ZP)("workspace").offsetWidth&&(i=(0,s.ZP)("workspace").offsetWidth-n),this.float.style.left=i+"px",this.float.style.top=t+"px"},this.resizeStart=e=>{this.d=new w.Z(this.float.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.float.style.height=(t<320?320:t)+"px"},this.keyDown=e=>{"Enter"!==e.key&&"Escape"!==e.key||this.cleanUp()},this.superClean=()=>{var e;document.removeEventListener("keydown",this.keyDown,!1),this.float.remove(),this.float=null,null===(e=this.modal)||void 0===e||e.remove(),this.modal=null},this.cleanUp=()=>{this.superClean()},this.parent=e,this.mid=m.Zd(),this.parent&&(document.addEventListener("keydown",this.keyDown,!1),this.modal=(0,s.T)("div",{id:"modal-"+this.mid,className:"modal"}),this.modal.addEventListener("click",(e=>{e.target===this.modal&&this.cleanUp()})),document.body.appendChild(this.modal)),this.float=(0,s.T)("div",{className:"float"}),this.modal?this.modal.appendChild(this.float):(0,s.ZP)("workspace").append(this.float),this.content=(0,s.T)("div",{className:"content"});const n=(0,s.T)("div",{id:"float-title-"+this.mid,className:"title"},t);if((0,s.Rg)(n,this.dragStart,this.dragMove,this.dragEnd),this.float.append(n,(0,s.T)("img",{id:"float-close"+this.mid,className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.cleanUp()}),(0,s.T)("div",{className:"splitter small"}),this.content),i){const e=(0,s.T)("img",{id:"resize-"+this.mid,src:"/img/icon/three-dot.svg",className:"resize ic"});(0,s.Rg)(e,this.resizeStart,this.resizeMove),this.float.append(e)}this.position()}}var Z=i(74211),k=i(94178);class E{constructor(e,t,i,a=!1){this.populatePresets=()=>{let e=[new f.Rt([x.ZP.mainColor+"FF",x.ZP.altColor+"FF"],[0,1]),new f.Rt(["#000000FF","#FFFFFFFF"],[0,1]),new f.Rt(["#999999FF","#03205AFF","#000000FF"],[0,.5,1]),new f.Rt(["#000000FF","#00000000"],[0,1]),new f.Rt(["#FFFFFFFF","#FFFFFF00"],[0,1]),new f.Rt(["#00A8DFFF","#323496FF","#CA1688FF","#EB2E2EFF","#FDE92DFF","#009E54FF"],[0,.2,.4,.6,.8,1]),new f.Rt(["#0B01B8FF","#DE9E31FF","#0B01B8FF"],[.25,.5,.75]),new f.Rt(["#000000FF","#FF0000FF"],[0,1]),new f.Rt(["#FFFFFFFF","#FF0000FF"],[0,1]),new f.Rt(["#FFFFFFFF","#00FF00FF"],[0,1]),new f.Rt(["#FFFFFFFF","#0000FFFF"],[0,1]),new f.Rt(["#00FFFFFF","#FF8000FF"],[0,1]),new f.Rt(["#c2e59cff","#64b3f4ff"],[0,1]),new f.Rt(["#8E0E00FF","#1F1C18FF"],[0,1]),new f.Rt(["#f46b45FF","#eea849FF"],[0,1]),new f.Rt(["#fc00ffff","#00dbdeff"],[0,1]),new f.Rt(["#CCCCB2ff","#757519ff"],[0,1]),new f.Rt(["#F1F2B5FF","#135058FF"],[0,1]),new f.Rt(["#7b4397FF","#dc2430FF"],[0,1]),new f.Rt(["#8e9eabFF","#eef2f3FF"],[0,1]),new f.Rt(["#00bf8fFF","#001510FF"],[0,1]),new f.Rt(["#ff0084FF","#33001bFF"],[0,1]),new f.Rt(["#833ab4FF","#fd1d1dFF","#fcb045FF"],[0,.5,1]),new f.Rt(["#FEAC5EFF","#C779D0FF","#fcb045FF"],[0,.5,1]),new f.Rt(["#6441A5FF","#2a0845FF"],[0,1]),new f.Rt(["#43cea2FF","#185a9dFF"],[0,1]),new f.Rt(["#FFA17FFF","#00223EFF"],[0,1]),new f.Rt(["#360033FF","#0b8793FF"],[0,1]),new f.Rt(["#948E99FF","#2E1437FF"],[0,1]),new f.Rt(["#1e130cFF","#9a8478FF"],[0,1]),new f.Rt(["#D38312FF","#A83279FF"],[0,1]),new f.Rt(["#70e1f5FF","#ffd194FF"],[0,1]),new f.Rt(["#556270FF","#ff6b6bFF"],[0,1]),new f.Rt(["#000000FF","#e74c3cFF"],[0,1]),new f.Rt(["#f0c27bff","#4b1248ff"],[0,1]),new f.Rt(["#fbd3e9ff","#bb377dff"],[0,1]),new f.Rt(["#649173ff","#dbd5a4ff"],[0,1]),new f.Rt(["#b993d6ff","#8ca6dbff"],[0,1]),new f.Rt(["#d3959bff","#bfe6baff"],[0,1]),new f.Rt(["#dad299ff","#b0dab9ff"],[0,1]),new f.Rt(["#f2709cff","#ff9472ff"],[0,1]),new f.Rt(["#5d4157ff","#a8cabaff"],[0,1]),new f.Rt(["#ddd6f3ff","#faaca8ff"],[0,1]),new f.Rt(["#fc354cff","#0abfbcff"],[0,1]),new f.Rt(["#414d0bff","#727a17ff"],[0,1]),new f.Rt(["#134e5eff","#71b280ff"],[0,1]),new f.Rt(["#2bc0e4ff","#eaecc6ff"],[0,1]),new f.Rt(["#603813ff","#b29f94ff"],[0,1]),new f.Rt(["#bbd2c5FF","#536976FF","#292e49FF"],[0,.5,1]),new f.Rt(["#1e9600FF","#fff200FF","#ff0000FF"],[0,.5,1]),new f.Rt(["#06beb6ff","#48b1bfff"],[0,1]),new f.Rt(["#eb3349ff","#f45c43ff"],[0,1]),new f.Rt(["#56ab2fff","#a8e063ff"],[0,1]),new f.Rt(["#614385ff","#516395ff"],[0,1]),new f.Rt(["#ddd6f3ff","#faaca8ff"],[0,1]),new f.Rt(["#3a1c71FF","#d76d77FF","#ffaf7bFF"],[0,.5,1]),new f.Rt(["#4ca1afff","#c4e0e5ff"],[0,1]),new f.Rt(["#dbdcd7ff","#b8235aff","#801357ff","#3d1635ff","#1c1a27ff"],[0,.59,.71,.84,1]),new f.Rt(["#f83600ff","#f9d423ff"],[0,1]),new f.Rt(["#71a192ff","#b7bb81ff","#f5b752ff","#db6549ff","#7b4163ff"],[0,.25,.5,.8,1]),new f.Rt(["#00737AFF","#DE5159FF","#7F3038ff","#150C14FF"],[0,.5,.75,1]),new f.Rt(["#8FB9A8FF","#FEFAD4FF","#FCD0BAff","#F1828DFF","#765D69FF"],[0,.4,.5,.75,1]),new f.Rt(["#F26627FF","#F9A26CFF","#EFEEEEff","#98D7D1FF","#325D79FF"],[0,.3,.5,.75,1]),new f.Rt(["#F18C8EFF","#F0B7A4FF","#F1D1B5ff","#568EA6FF","#305F72FF"],[0,.3,.5,.75,1]),new f.Rt(["#FCBB6DFF","#D8737FFF","#AB6CB2FF","#685D79FF","#475C7AFF"],[0,.3,.5,.75,1]),new f.Rt(["#CC2A49FF","#F99E4CFF","#F36F38FF","#EF4648FF","#582841FF"],[0,.3,.5,.75,1]),new f.Rt(["#092B38FF","#9C5773FF","##CDCDC5FF"],[0,.5,1]),new f.Rt(["#009e00FF","#ffff96FF"],[0,1]),new f.Rt(["#fcce78FF","#7e2d02FF"],[0,1]),new f.Rt(["#ffdb01FF","#0e197dFF"],[0,1]),new f.Rt(["#B4C6CCFF","#FE4929FF"],[0,1]),new f.Rt(["#B71970FF","#01416DFF"],[0,1]),new f.Rt(["#471B0DFF","#F0E867FF"],[0,1]),new f.Rt(["#1A2713FF","#E2EAB1FF"],[0,1]),new f.Rt(["#B03F2AFF","#FFEBB0FF"],[0,1])];const t=(0,s.ZP)("grad-selector-presets-ss-content");if(this.extended){const e=(0,s.T)("div",{className:"grad-pod square empty"});e.setAttribute("data","empty"),e.addEventListener("click",this.selectPreset,!0),t.append(e)}e.forEach((e=>{const i=(0,s.T)("div",{className:"grad-pod square",style:"background:"+e.toCSS()});i.setAttribute("data",JSON.stringify(e)),i.addEventListener("click",this.selectPreset,!0),t.append(i)}))},this.selectPreset=e=>{this.removeHandlers(),this.marked&&this.marked.classList.remove("selected"),this.marked=e.currentTarget,this.marked.classList.add("selected"),"empty"!==this.marked.getAttribute("data")?(this.grad=f.ZP.fromPreset(m.mS(f.Rt,JSON.parse(this.marked.getAttribute("data")))),this.extended&&(this.grad.direction=this.direction.getValue(),this.grad.type=(0,s.ZP)("grad-type-linear").checked?"linear":"radial"),this.populateStops(),this.updatePreview()):this.callback&&this.callback(void 0)},this.setGrad=e=>{this.grad=e,this.extended&&((0,s.ZP)("grad-type-linear").checked="linear"===this.grad.type,(0,s.ZP)("grad-type-radial").checked="radial"===this.grad.type,this.direction.setValue(this.grad.direction)),this.removeHandlers(),this.populateStops(),this.updatePreview(!1)},this.directionChange=()=>{this.grad.direction=this.direction.getValue(),this.updatePreview()},this.typeChange=e=>{let t=e.target;this.grad.type="linear"===t.value?"linear":"radial",(0,s.ZP)("grad-direction").style.display="linear"===this.grad.type?"flex":"none",this.updatePreview()},this.updatePreview=(e=!0)=>{this.preview.style.backgroundImage=this.grad.toCSS(),this.callback&&e&&this.callback(this.grad)},this.populateStops=()=>{this.stoplist.innerHTML="";for(let e=0;e<this.grad.stops.length;++e){const t=Math.round(300*this.grad.stops[e].position);this.stoplist.append((0,s.T)("div",{id:this.grad.stops[e].id,className:"knob",style:"left:"+t+"px"},(0,s.T)("div",{className:"bg ic"}),(0,s.T)("div",{className:"color",id:this.grad.stops[e].id+"-color",style:"background:"+this.grad.stops[e].color.toHEX()})))}this.setHandlers()},this.addStop=e=>{e.stopPropagation(),e.preventDefault();const t=this.grad.addStop(this.colorpod.getColor().clone(),Math.round(e.offsetX)/300),i=Math.round(300*t.position),n=(0,s.T)("div",{id:t.id,className:"knob",style:"left:"+i+"px"},(0,s.T)("div",{className:"bg ic"}),(0,s.T)("div",{className:"color",id:t.id+"-color",style:"background:"+t.color.toHEX()}));n.addEventListener("mousedown",this.mouseDown,!0),n.addEventListener("touchstart",this.touchStart,{passive:!0}),this.stoplist.append(n),this.selectStop(t.id),this.updatePreview()},this.removeStop=()=>{if(this.grad.stops.length>2){(0,s.ZP)(this.selected.id)&&(0,s.ZP)(this.selected.id).remove();const e=this.grad.removeStop(this.selected.id);this.selected=void 0,this.selectStop(e),this.updatePreview()}},this.selectStop=e=>{this.selected&&this.selected.id===e||(this.selected&&(0,s.ZP)(this.selected.id)&&(0,s.ZP)(this.selected.id).classList.remove("selected"),this.selected=this.grad.getStop(e),(0,s.ZP)(this.selected.id).classList.add("selected"),this.colorpod.setColor(this.selected.color),this.opacity.setValue(this.selected.color.a/255),(0,s.ZP)("grad-selector-remove").classList.toggle("disabled",this.grad.stops.length<3))},this.down=(e,t,i)=>{this.selectStop(i.id),this.downX=e,this.target=i,this.start=i.offsetLeft+6},this.move=(e,t,i=!0)=>{let s=m.uZ(this.start+(e-this.downX),0,300);this.target.style.left=s+"px",this.selected.position=s/300,this.grad.sort(),this.updatePreview(i)},this.setHandlers=()=>{const e=document.querySelectorAll("#grad-selector-stoplist > .knob");for(let t=0;t<e.length;t++)e[t].addEventListener("mousedown",this.mouseDown,!0),e[t].addEventListener("touchstart",this.touchStart,{passive:!0}),0===t&&this.selectStop(e[t].id)},this.removeHandlers=()=>{const e=document.querySelectorAll("#grad-selector-stoplist > .knob");for(let t=0;t<e.length;t++)e[t].removeEventListener("mousedown",this.mouseDown,!0),e[t].removeEventListener("touchstart",this.touchStart)},this.touchStart=e=>{e.preventDefault(),e.stopPropagation(),this.down(e.changedTouches[0].clientX,e.changedTouches[0].clientY,e.currentTarget),document.addEventListener("touchmove",this.touchMove,{passive:!0}),document.addEventListener("touchend",this.touchEnd,{passive:!0})},this.touchMove=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.changedTouches[0].clientX,e.changedTouches[0].clientY,!1)},this.touchEnd=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.changedTouches[0].clientX,e.changedTouches[0].clientY,!0),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=e=>{e.preventDefault(),e.stopPropagation(),this.down(e.clientX,e.clientY,e.currentTarget),document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0)},this.mouseMove=e=>{e.stopPropagation(),this.move(e.clientX,e.clientY,!1)},this.mouseUp=e=>{e.stopPropagation(),e.preventDefault(),this.move(e.clientX,e.clientY,!0),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.resizeStart=e=>{this.d=new w.Z(this.container.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.container.style.height=(t<320?320:t)+"px"},this.cleanUp=()=>{var e;this.removeHandlers(),this.addlist.removeEventListener("click",this.addStop,!0),(0,s.ZP)("grad-selector-remove").removeEventListener("click",this.removeStop,!0),this.container.remove(),null===(e=this.modal)||void 0===e||e.remove()},this.extended=a,this.gradpod=e,this.grad=e?e.grad:f.ZP.fromColors(v.Z.fromHEX(x.ZP.mainColor),v.Z.fromHEX(x.ZP.altColor)),this.callback=i,this.asControl=!e,this.asControl||(this.modal=(0,s.ZP)("workspace").appendChild((0,s.T)("div",{id:"grad-selector-modal",className:"modal"})));let r=(0,s.T)("div",{style:"position:relative"}),h=(0,s.T)("div",{className:"option",style:"display:flex;justify-content: space-between"}),c=(0,s.T)("div",{id:"grad-selector-presets",className:"pad-10"});if(this.container=(0,s.T)("div",{id:"grad-selector"},r,h),t?t.appendChild(this.container):(this.container.classList.add("grad-selector-float"),(0,s.ZP)("workspace").appendChild(this.container)),this.preview=(0,s.T)("div",{id:"grad-selector-preview"}),this.stoplist=(0,s.T)("div",{id:"grad-selector-stoplist"}),this.addlist=(0,s.T)("div",{id:"grad-selector-addlist"}),r.append((0,s.T)("div",{id:"grad-selector-preview-holder"},this.preview),this.stoplist,this.addlist),h.append((0,s.T)("div",{id:"grad-selector-opacity"}),(0,s.T)("label",{className:"tab-30",style:"width:unset"},(0,n.Z)("color")+":"),(0,s.T)("div",{id:"grad-selector-color",className:"tab-5"}),(0,s.T)("ul",{className:"icon-button-set",style:"margin-left:auto"},(0,s.T)("li",{id:"grad-selector-remove"},(0,s.T)("img",{src:"/img/icon/delete.svg",className:"ic"})))),this.container.append((0,s.T)("div",{className:"splitter pad-8"})),a){let e=(0,s.T)("div",{className:"option pad-10",style:"display:flex;justify-content: space-between"});e.innerHTML+=`\n                    <div id="gradient-type" class="switch-field">\n                        <input type="radio" id="grad-type-linear" name="grad-type" value="linear" checked/><label for="grad-type-linear">${(0,n.Z)("linear")}</label>\n                        <input type="radio" id="grad-type-radial" name="grad-type" value="radial" /><label for="grad-type-radial">${(0,n.Z)("radial")}</label>\n                    </div>\n                    <div id="grad-direction"></div>\n                    `,this.container.append(e),(0,s.ZP)("grad-type-linear").addEventListener("click",this.typeChange,!0),(0,s.ZP)("grad-type-radial").addEventListener("click",this.typeChange,!0),this.direction=new o.Z("grad-direction",{label:(0,n.Z)("direction")+":",compact:!0,range:[0,360],defaultValue:0,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onChange:this.directionChange})}this.container.append(c);const l=(0,s.ZP)("grad-selector-remove");if(l.setAttribute("tooltip",(0,n.Z)("removeStop")),l.setAttribute("flow","down"),l.addEventListener("click",this.removeStop,!0),this.asControl)(0,s.ZP)("grad-selector-presets").style.height="180px";else{let e=this.gradpod.container.getBoundingClientRect();this.modal.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),e.target===e.currentTarget&&this.cleanUp()}),!1),this.container.style.top=e.bottom+5+"px",this.container.style.left=e.left-~~(this.container.offsetWidth/2)+40+"px",this.container.style.display="flex",this.container.style.height="360px";const t=(0,s.T)("img",{src:"/img/icon/three-dot.svg",className:"resize ic"});(0,s.Rg)(t,this.resizeStart,this.resizeMove),this.container.append(t)}this.preview=(0,s.ZP)("grad-selector-preview"),this.opacity=new o.Z("grad-selector-opacity",{label:(0,n.Z)("opacity")+":",compact:!0,defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onChange:e=>{this.selected.color.a=Math.round(255*e),this.updatePreview()}}),this.colorpod=new Z.Z("grad-selector-color",new v.Z,(e=>{e.a=this.selected.color.a,this.selected.color=e,(0,s.ZP)(this.selected.id+"-color").style.background=e.toHEX(),this.updatePreview()})),this.addlist.addEventListener("click",this.addStop,!1),this.populateStops(),this.setHandlers(),this.updatePreview(!1),new k.Z((0,s.ZP)("grad-selector-presets")),this.populatePresets()}}var P=i(92397),S=i(95574),C=i(15181);class L{constructor(e,t){this.populatePresets=async()=>{const e=await fetch("/pattern/index.json"),t=await e.json(),i=(0,s.ZP)("pattern-selector-presets-ss-content"),n=(0,s.T)("div",{className:"pattern-pod empty"});n.setAttribute("data","empty"),n.addEventListener("click",this.selectPreset,!0),i.append(n),t.packs.forEach((e=>{e.assets.forEach((t=>{const n="/pattern/"+e.name+"/"+t,a=(0,s.T)("div",{className:"pattern-pod"});a.setAttribute("data",n),a.addEventListener("click",this.selectPreset,!0),a.style.backgroundImage="url("+n+")",i.append(a)}))}))},this.populatePack=()=>{},this.selectPreset=async e=>{this.marked&&this.marked.classList.remove("selected"),this.marked=e.currentTarget,this.marked.classList.add("selected");let t=this.marked.getAttribute("data");if("empty"===t)this.pattern=void 0;else{if(!this.pattern){let e=this.scale.getValue();this.pattern=new y.Z(void 0,e<0?1+e/12.5:1+e,this.direction.getValue())}this.pattern.svg=await fetch(t+"?ref").then((e=>e.text()));let e=new Blob([this.pattern.svg],{type:"image/svg+xml"});this.pattern.image=await(0,S.s4)(e),this.extractColors()}this.updatePreview()},this.changeColor=e=>{this.colorPod=e.currentTarget,new C.Z(v.Z.fromHEX(this.colorPod.title),this.setColor)},this.extractColors=()=>{let e=[];this.pattern.svg.replace(/fill:?=?"?(#[abcdef0-9]{3,8})/gi,(function(t,i){return e.push(i),t})),this.pattern.svg.replace(/stroke:?=?"?(#[abcdef0-9]{3,8})/gi,(function(t,i){return e.push(i),t}));e=e.filter(((e,t,i)=>i.indexOf(e)===t)).slice(0,10);let t=(0,s.ZP)("pattern-color-list");t.innerHTML="",e.forEach((e=>{t.appendChild((0,s.T)("div",{onclick:this.changeColor,className:"color-pod small",title:e,style:"border:none;border-radius:3px;display:inline-block;margin:5px 5px 5px 0px;background-color:"+e}))}))},this.setColor=async e=>{let t=this.colorPod.title,i=e.toHEX();this.colorPod.title=i,this.colorPod.style.backgroundColor=i;var s=new RegExp(t,"g");this.pattern.svg=this.pattern.svg.replace(s,i);let n=new Blob([this.pattern.svg],{type:"image/svg+xml"});this.pattern.image=await(0,S.s4)(n),this.updatePreview()},this.setPattern=e=>{this.pattern=e;let t=this.pattern.scale;this.scale.setValue(t<1?-12.5*(1-t):t-1),this.direction.setValue(this.pattern.direction),this.extractColors(),this.updatePreview()},this.scaleChange=e=>{this.pattern&&(e=e<0?1+e/12.5:1+e,this.pattern.scale=e,this.updatePreview(!1))},this.directionChange=e=>{this.pattern&&(this.pattern.direction=e,this.updatePreview(!1))},this.updatePreview=(e=!0)=>{this.pattern?(this.ctx.save(),this.ctx.fillStyle=this.pattern.createCanvasPattern(this.ctx),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.callback&&e&&this.callback(this.pattern)},this.callback=t,this.canvas=m.vL(300,120),this.canvas.classList.add("transparent"),this.canvas.style.borderRadius="2px",this.ctx=this.canvas.getContext("2d");let i=(0,s.T)("div",{className:"option",style:"display:flex;"},(0,s.T)("div",{id:"pattern-scale"}),(0,s.T)("div",{id:"pattern-direction",className:"tab-20"})),a=(0,s.T)("div",{id:"pattern-color-list",style:"display:block;"}),r=(0,s.T)("div",{id:"pattern-selector-top"},this.canvas,a,i),h=(0,s.T)("div",{id:"pattern-selector-presets",className:"pad-10"});this.container=(0,s.T)("div",{id:"pattern-selector"},r,(0,s.T)("div",{className:"splitter pad-8"}),h),e.appendChild(this.container),new k.Z((0,s.ZP)("pattern-selector-presets")),this.scale=new o.Z("pattern-scale",{label:(0,n.Z)("scale")+":",compact:!0,range:[-10,10],defaultValue:0,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onChange:this.scaleChange,onEnd:()=>this.updatePreview()}),this.direction=new o.Z("pattern-direction",{label:(0,n.Z)("direction")+":",compact:!0,range:[0,360],defaultValue:0,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onChange:this.directionChange,onEnd:()=>this.updatePreview()}),this.populatePresets()}}class T extends b{constructor(e,t,i,a){super(e,(0,n.Z)("fill"),!1),this.setSectionEvent=e=>{let t=e.target;this.setSection(t.value)},this.setSection=(e="color")=>{switch(this.holder.innerHTML="",this.patternselector=void 0,this.colorselector=void 0,this.gradselector=void 0,(0,s.ZP)("fill-type-"+e).checked=!0,e){case"color":this.colorselector=new P.Z(this.holder,[...x.ZP.oldColor.slice(),"#ffffff","#888888","#000000"],this.setFill,!0,300,120,!0);break;case"gradient":this.gradselector=new E(void 0,this.holder,this.setFill,!0);break;case"pattern":this.patternselector=new L(this.holder,this.setFill)}this.fill&&(this.patternselector&&this.fill.value instanceof y.Z&&this.patternselector.setPattern(this.fill.value),this.colorselector&&this.fill.value instanceof v.Z&&this.colorselector.setColor(this.fill.value),this.gradselector&&this.fill.value instanceof f.ZP&&this.gradselector.setGrad(this.fill.value))},this.setFill=e=>{this.fill=new g.Z(e),this.preview&&this.preview(this.fill)},this.cleanUp=()=>{this.callback&&(this.fill&&this.fill.value instanceof v.Z&&(0,x.nS)(this.fill.value),this.callback(this.fill)),this.superClean()},this.fill=t,this.preview=a,this.callback=i,this.float.style.width="320px",this.content.style.padding="10px";let r=(0,s.T)("div",{style:"position:relative"});this.holder=(0,s.T)("div",{id:"fill-selector-presets",className:"pad-10"}),this.setContent(r,(0,s.T)("div",{className:"splitter pad-10"}),this.holder),r.innerHTML+=`\n        <div id="fill-type" class="switch-field" style="display:flex;margin:0;">\n            <input type="radio" id="fill-type-color" name="fill-type" value="color"/><label for="fill-type-color">${(0,n.Z)("color")}</label>\n            <input type="radio" id="fill-type-gradient" name="fill-type" value="gradient" /><label for="fill-type-gradient">${(0,n.Z)("gradient")}</label>\n            <input type="radio" id="fill-type-pattern" name="fill-type" value="pattern" /><label for="fill-type-pattern">${(0,n.Z)("pattern")}</label>\n        </div>\n        `,(0,s.ZP)("fill-type-color").addEventListener("change",this.setSectionEvent,!0),(0,s.ZP)("fill-type-gradient").addEventListener("change",this.setSectionEvent,!0),(0,s.ZP)("fill-type-pattern").addEventListener("change",this.setSectionEvent,!0),this.setSection(null==t?void 0:t.getType())}}class M{constructor(e,t,i,n){this.previewFill=e=>{this.setFill(e),this.preview&&this.preview(this.fill)},this.callbackFill=e=>{this.setFill(e),this.callback&&this.callback(this.fill)},this.setFill=e=>{this.fill=e,this.holder.classList.remove("empty"),this.holder.style.backgroundColor="unset",this.holder.style.backgroundImage="unset",this.fill&&this.fill.value?this.fill.value instanceof v.Z?this.holder.style.backgroundColor=this.fill.value.toHEX():(this.fill.value instanceof f.ZP||this.fill.value instanceof y.Z)&&(this.holder.style.backgroundImage=this.fill.value.toCSS()):this.holder.classList.add("empty")},this.getFill=()=>this.fill,this.picker=()=>{new T(this.container,this.fill,this.callbackFill,this.previewFill)},this.cleanUp=()=>{this.container.removeEventListener("click",this.picker,!1)},this.fill=t,this.preview=n,this.callback=i,this.container=(0,s.ZP)(e),this.container.hasChildNodes()?this.holder=(0,s.ZP)(e+"-holder"):(this.holder=(0,s.T)("div",{id:e+"-holder"}),this.container.appendChild(this.holder)),this.container.classList.add("fill-pod"),this.container.addEventListener("click",this.picker,!1),this.setFill(t)}}var A=i(47163),I=i(75934),R=i(33506),_=i(21951);class D{constructor(e,t,i,a){if(this.addLocalFont=()=>{(0,I.Q0)(!0).then((async e=>{for(var t,i=0;t=e[i];i++)await(0,I.ZB)(this.stage,t);this.removeEventHandlers(),this.showFontList()}))},this.showFontList=()=>{(0,s.ZP)("font-wrap").classList.add("show"),(0,s.ZP)("font-wrap").classList.add("modal"),this.populateFonts(),this.setEventHandlers(),this.selected&&this.setFont(this.selected)},this.hideFontList=(e=!0)=>{(0,s.ZP)("font-wrap").classList.remove("show"),(0,s.ZP)("font-wrap").classList.remove("modal"),e&&this.inFocus&&this.inFocus.getAttribute("data")!==this.selected&&this.loadFont(this.selected,!0),this.selected&&(0,s.ZP)("font:"+this.selected)&&(0,s.ZP)("font:"+this.selected).classList.remove("selected"),this.removeEventHandlers()},this.populateFonts=()=>{const e=(0,s.ZP)("font-list-holder-ss-content");e.childElementCount!==A.Z.fontList.length&&(e.innerHTML="",A.Z.fontList.forEach((t=>{let i=document.createElement("div");t.local?i.append((0,s.T)("img",{src:URL.createObjectURL(t.thumb),title:t.name,className:"thumb ic",loading:"lazy",width:200,height:40}),(0,s.T)("img",{src:"/img/icon/close.svg",title:"Remove font",className:"close ic",onclick:e=>this.removeFont(e,"font:"+t.name)})):i.append((0,s.T)("img",{src:"/font/"+t.short+".png",title:t.name,className:"thumb ic",loading:"lazy",width:200,height:40})),i.setAttribute("data",t.name),i.setAttribute("id","font:"+t.name),i.classList.add("font-pod"),t.premium&&i.classList.add("premium"),e.appendChild(i)})))},this.setEventHandlers=()=>{document.addEventListener("keydown",this.keyPress,!0);const e=document.querySelectorAll("#font-list-holder div.font-pod");for(let t=0;t<e.length;t++)e[t].addEventListener("click",this.selectFont,!1),e[t].addEventListener("mouseenter",this.enterFont,!1)},this.removeEventHandlers=()=>{document.removeEventListener("keydown",this.keyPress,!0);const e=document.querySelectorAll("#font-list-holder div.font-pod");for(let t=0;t<e.length;t++)e[t].removeEventListener("click",this.selectFont,!1),e[t].removeEventListener("mouseenter",this.enterFont,!1)},this.dragStart=e=>{e.stopPropagation(),this.p=new w.Z(e.clientX,e.clientY),this.d=new w.Z(this.fontList.offsetLeft,this.fontList.offsetTop),document.addEventListener("mousemove",this.dragMove,!0),document.addEventListener("mouseup",this.dragEnd,!0)},this.dragMove=e=>{e.stopPropagation(),this.fontList.style.left=Math.round(this.d.x+(e.clientX-this.p.x))+"px",this.fontList.style.top=Math.round(this.d.y+(e.clientY-this.p.y))+"px"},this.dragEnd=e=>{e.stopPropagation(),this.p=void 0,document.removeEventListener("mousemove",this.dragMove,!0),document.removeEventListener("mouseup",this.dragEnd,!0)},this.keyPress=e=>{var t;if(e.preventDefault(),e.stopPropagation(),null===(t=this.inFocus)||void 0===t||t.classList.remove("focus"),!this.inFocus){const e=document.querySelectorAll("#font-list-holder div.font-pod");this.inFocus=e[0]}if("ArrowUp"===e.key){for(this.inFocus=this.inFocus.previousElementSibling;this.inFocus&&"none"===this.inFocus.style.display;)this.inFocus=this.inFocus.previousElementSibling;if(!this.inFocus){const e=document.querySelectorAll("#font-list-holder div.font-pod");this.inFocus=e[e.length-1]}}else if("ArrowDown"===e.key){for(this.inFocus=this.inFocus.nextElementSibling;this.inFocus&&"none"===this.inFocus.style.display;)this.inFocus=this.inFocus.nextElementSibling;if(!this.inFocus){const e=document.querySelectorAll("#font-list-holder div.font-pod");this.inFocus=e[0]}}else{if("Escape"===e.key)return void this.hideFontList();if("Enter"===e.key)this.inFocus&&this.inFocus.getAttribute("data")!==this.selected&&(this.inFocus.classList.contains("premium")&&"premium"!==(null===R.a||void 0===R.a?void 0:R.a.subscriptionAccess)&&!this.stage.fresco.block||(this.loadFont(this.inFocus.getAttribute("data")),this.hideFontList(!1)),this.hideFontList(!0));else{let t=(0,s.ZP)("font-search").value;if("Backspace"===e.key)t=t.substring(0,t.length-1);else if("Delete"===e.key)t="";else{if(e.key.length>1)return;t+=e.key}(0,s.ZP)("font-search").value=t;const i=document.querySelectorAll("#font-list-holder div.font-pod"),n=(0,s.ZP)("font-search").value;this.inFocus=void 0;for(let e=0;e<i.length;e++){i[e].getAttribute("data").toLowerCase().startsWith(n)?(i[e].style.display="block",this.inFocus||(this.inFocus=i[e])):i[e].style.display="none"}}}if(this.inFocus){this.inFocus.classList.add("focus");const e=this.inFocus.getAttribute("data");this.inFocus.scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"}),m.Ds("preview",200,(()=>{this.loadFont(e,!0)}))}},this.lx=0,this.ly=0,this.enterFont=e=>{var t;if(e.clientX===this.lx&&e.clientY===this.ly)return;this.lx=e.clientX,this.ly=e.clientY,null===(t=this.inFocus)||void 0===t||t.classList.remove("focus"),this.inFocus=e.currentTarget,this.inFocus.classList.add("focus");const i=this.inFocus.getAttribute("data");m.Ds("preview",200,(()=>{this.loadFont(i,!0)}))},this.selectFont=e=>{let t=e.currentTarget,i=t.classList.contains("premium"),s=t.getAttribute("data");!i||"premium"===(null===R.a||void 0===R.a?void 0:R.a.subscriptionAccess)||this.stage.fresco.block?(this.loadFont(s),this.hideFontList(!1)):new _.Z("FONT")},this.removeFont=(e,t)=>{e.preventDefault(),e.stopPropagation();let i=(0,s.ZP)(t);A.Z.removeLocalFontDesc(i.getAttribute("data")),i.remove()},this.loadFont=async(e,t=!1)=>{try{await A.Z.loadFont(e);if(t)this.preview(e);else{const t=this.selected;t!==e&&(this.setFont(e),this.callback(e,t))}}catch(i){console.error("Could not load font",e,i)}},this.cleanUp=()=>{this.removeEventHandlers(),this.holder.removeEventListener("click",this.showFontList,!1),this.hideFontList()},this.stage=e,this.holder=t,this.preview=a,this.callback=i,this.holder.addEventListener("click",this.showFontList,!1),this.selected=A.Z.fontList[0].name,!(0,s.ZP)("font-list")){let e=(0,s.T)("div",{id:"font-wrap",onmousedown:e=>{e.target===(0,s.ZP)("font-wrap")&&this.hideFontList()}},(0,s.T)("div",{id:"font-list"},(0,s.T)("img",{id:"font-close",className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.hideFontList()}),(0,s.T)("div",{id:"font-list-title",className:"title",onmousedown:e=>this.dragStart(e)},(0,n.Z)("font")),(0,s.T)("div",{className:"splitter"}),(0,s.T)("div",{style:"position:relative"},(0,s.T)("input",{id:"font-search",className:"font-search",type:"text",placeholder:(0,n.Z)("search")}),(0,s.T)("img",{id:"font-search-icon",className:"search-icon ic",src:"/img/tool/thick/zoom.svg"})),(0,s.T)("div",{id:"font-list-holder"}),(0,s.T)("div",{id:"font-list-add"},(0,s.T)("a",{className:"button positive",onclick:()=>this.addLocalFont()},(0,n.Z)("addLocalFont")))));(0,s.ZP)("workspace").appendChild(e),new k.Z((0,s.ZP)("font-list-holder"))}this.fontList=(0,s.ZP)("font-list")}setFont(e){this.selected&&(0,s.ZP)("font:"+this.selected)&&(0,s.ZP)("font:"+this.selected).classList.remove("selected");let t=(0,s.ZP)("font:"+e);if(t){t.classList.add("selected");let e=t.childNodes[0];this.holder.innerHTML='<img src="'+e.src+'" class="ic" title="'+e.title+'" />'}else{let t=A.Z.getFontDesc(e);t&&(t.local?this.holder.innerHTML='<img src="'+URL.createObjectURL(t.thumb)+'" class="ic" title="'+t.name+'" />':this.holder.innerHTML='<img src="/font/'+t.short+'.png" class="ic" title="'+t.name+'" />')}this.selected=e}}var F=i(77758);class z extends p{constructor(e){let t;super(e),this.setLayer=e=>{this.selected=e,this.updateInputs()},this.updateInputs=()=>{let e=(0,s.ZP)("text-input");e.value=this.selected.text,this.resizeTextInput(e),this.font.setFont(this.selected.textSettings.font),this.opacity.setValue(this.selected.settings.opacity),this.textSize.setValue(this.selected.textSettings.size),this.lineSpace.setValue(this.selected.textSettings.lineSpace),this.letterSpace.setValue(this.selected.textSettings.letterSpace),this.fill.setFill(this.selected.fill),(0,s.ZP)("text-background").checked=this.selected.textSettings.background,(0,s.ZP)("text-background-punch").checked=this.selected.textSettings.backgroundPunch,this.backgroundColor.setHex(this.selected.textSettings.backgroundColor),this.backgroundOffset.setValue(this.selected.textSettings.backgroundOffset),(0,s.ZP)("text-background-type-full").checked=this.selected.textSettings.backgroundType===F.Z.BACKGROUND_FULL,(0,s.ZP)("text-background-type-line").checked=this.selected.textSettings.backgroundType===F.Z.BACKGROUND_LINE,(0,s.ZP)("text-background-type-word").checked=this.selected.textSettings.backgroundType===F.Z.BACKGROUND_WORD,(0,s.ZP)("text-outline").checked=this.selected.textSettings.outline,(0,s.ZP)("text-outline-punch").checked=this.selected.textSettings.outlinePunch,this.outlineColor.setHex(this.selected.textSettings.outlineColor),this.outlineSize.setValue(this.selected.textSettings.outlineSize),this.outlineDistance.setValue(this.selected.textSettings.outlineDistance),this.outlineDirection.setValue(this.selected.textSettings.outlineDirection),(0,s.ZP)("text-shadow").checked=this.selected.textSettings.shadow,this.shadowColor.setHex(this.selected.textSettings.shadowColor),this.shadowBlur.setValue(this.selected.textSettings.shadowBlur),this.shadowAlpha.setValue(this.selected.textSettings.shadowAlpha),this.shadowDistance.setValue(this.selected.textSettings.shadowDistance),this.shadowDirection.setValue(this.selected.textSettings.shadowDirection),(0,s.ZP)("text-curve").checked=this.selected.textSettings.curve,this.curveAmount.setValue(this.selected.textSettings.curveAmount),(0,s.ZP)("text-curve-flip").checked=this.selected.textSettings.curveFlip,(0,s.ZP)("text-curve-spread").checked=this.selected.textSettings.curveSpread,(0,s.ZP)("text-curve-type-arc").checked="arc"===this.selected.textSettings.curveType,(0,s.ZP)("text-curve-type-circle").checked="circle"===this.selected.textSettings.curveType,(0,s.ZP)("text-curve-type-half").checked="half"===this.selected.textSettings.curveType,(0,s.ZP)("text-curve-amount").style.display="arc"!==this.selected.textSettings.curveType?"none":"block",(0,s.ZP)("text-curve-flip-label").style.display="arc"!==this.selected.textSettings.curveType?"block":"none",(0,s.ZP)("text-curve-spread-label").style.display="arc"!==this.selected.textSettings.curveType?"block":"none",(0,s.ZP)("text-warp").checked=this.selected.textSettings.warp,(0,s.ZP)("text-warp-type-circular").checked=this.selected.textSettings.warpType===F.Z.WARP_CIRCULAR,(0,s.ZP)("text-warp-type-angular").checked=this.selected.textSettings.warpType===F.Z.WARP_ANGULAR,(0,s.ZP)("text-warp-mode-upper").checked=this.selected.textSettings.warpMode===F.Z.WARP_UPPER,(0,s.ZP)("text-warp-mode-middle").checked=this.selected.textSettings.warpMode===F.Z.WARP_MIDDLE,(0,s.ZP)("text-warp-mode-lower").checked=this.selected.textSettings.warpMode===F.Z.WARP_LOWER,this.warpEdgeSize.setValue(this.selected.textSettings.warpEdgeSize),this.warpCenterSize.setValue(this.selected.textSettings.warpCenterSize),this.warpHorizontalOffset.setValue(this.selected.textSettings.warpHorizontalOffset),this.warpVerticalOffset.setValue(this.selected.textSettings.warpVerticalOffset),(0,s.ZP)("text-uppercase").classList.toggle("selected",this.selected.textSettings.uppercase),(0,s.ZP)("text-italic").classList.toggle("selected",this.selected.textSettings.italic),(0,s.ZP)("text-bold").classList.toggle("selected",this.selected.textSettings.bold),(0,s.ZP)("text-underline").classList.toggle("selected",this.selected.textSettings.underline),(0,s.ZP)("text-align-left").checked="left"===this.selected.textSettings.align,(0,s.ZP)("text-align-center").checked="center"===this.selected.textSettings.align,(0,s.ZP)("text-align-right").checked="right"===this.selected.textSettings.align,(0,s.ZP)("text-align-justify").checked="justify"===this.selected.textSettings.align},this.paste=e=>{e.preventDefault();var t=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)},this.resizeTextInput=e=>{window.setTimeout((()=>{let t=e.cloneNode();t.style.visibility="false",e.parentNode.insertBefore(t,e),t.style.height="auto",t.value=e.value,e.style.height=t.scrollTop+t.scrollHeight+16+"px",e.parentNode.removeChild(t)}),0)},this.textActive=()=>{this.textBefore=this.selected.text},this.textBlur=()=>{void 0!==this.textBefore&&this.stage.history.add({type:"textChange",text:this.textBefore,layer:this.selected})},this.changeText=e=>{this.resizeTextInput((0,s.ZP)("text-input")),this.selected.setText((0,s.ZP)("text-input").value),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeAlign=e=>{const t=this.selected.textSettings.clone(),i=document.querySelector('input[name="text-align"]:checked').value;this.selected.setTextAlign(i),t.align!==this.selected.textSettings.align&&this.stage.history.add({type:"textSettings",kind:"align",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeUppercase=()=>{const e=this.selected.textSettings.clone();this.selected.setTextUpperCase(!this.selected.textSettings.uppercase),(0,s.ZP)("text-align-left").addEventListener("click",this.changeAlign,!1),(0,s.ZP)("text-align-center").addEventListener("click",this.changeAlign,!1),(0,s.ZP)("text-align-right").addEventListener("click",this.changeAlign,!1),(0,s.ZP)("text-uppercase").classList.toggle("selected",this.selected.textSettings.uppercase),this.stage.history.add({type:"textSettings",kind:"uppercase",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeItalic=()=>{const e=this.selected.textSettings.clone();this.selected.setTextItalic(!this.selected.textSettings.italic),(0,s.ZP)("text-italic").classList.toggle("selected",this.selected.textSettings.italic),this.stage.history.add({type:"textSettings",kind:"italic",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeBold=()=>{const e=this.selected.textSettings.clone();this.selected.setTextBold(!this.selected.textSettings.bold),(0,s.ZP)("text-bold").classList.toggle("selected",this.selected.textSettings.bold),this.stage.history.add({type:"textSettings",kind:"bold",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeUnderline=()=>{const e=this.selected.textSettings.clone();this.selected.setTextUnderline(!this.selected.textSettings.underline),(0,s.ZP)("text-underline").classList.toggle("selected",this.selected.textSettings.underline),this.stage.history.add({type:"textSettings",kind:"underline",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLineSpace=e=>{this.selected.textSettings.lineSpace=e,m.Ds("text-change",50,(()=>{this.selected.setLineSpace(e),document.dispatchEvent(new CustomEvent("viewport-render"))}))},this.changeLetterSpace=e=>{this.selected.textSettings.letterSpace=e,m.Ds("text-change",50,(()=>{this.selected.setLetterSpace(e),document.dispatchEvent(new CustomEvent("viewport-render"))}))},this.changeSize=e=>{this.selected.textSettings.size=e,m.Ds("text-change",50,(()=>{this.selected.setTextSize(e),document.dispatchEvent(new CustomEvent("viewport-render"))}))},this.previewFill=e=>{this.selected.setTextFill(e,!0),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeFill=e=>{console.log("here");const t=this.selected.textSettings.clone();this.selected.setTextFill(e),this.stage.history.add({type:"textSettings",kind:"fill",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.previewFont=e=>{this.selected&&(this.selected.setTextFont(e,!0),document.dispatchEvent(new CustomEvent("viewport-render")))},this.changeFont=(e,t)=>{if(!this.selected)return;const i=this.selected.textSettings.clone();i.font=t,this.selected.setTextFont(e),this.stage.history.add({type:"textSettings",kind:"font",layer:this.selected,settings:i}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeBackground=e=>{const t=this.selected.textSettings.clone();let i=(0,s.ZP)("text-background").checked,n=(0,s.ZP)("text-background-punch").checked,a=this.backgroundOffset.getValue(),r=this.backgroundColor.getHex(),o="";o=(0,s.ZP)("text-background-type-full").checked?F.Z.BACKGROUND_FULL:(0,s.ZP)("text-background-type-line").checked?F.Z.BACKGROUND_LINE:F.Z.BACKGROUND_WORD,this.selected.setBackground(i,o,r,n,a),this.stage.history.add({type:"textSettings",kind:"background",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeBackroundColor=e=>{this.changeBackground()},this.changeOutlineState=()=>{const e=this.selected.textSettings.clone();this.changeOutline(),this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:e})},this.changeOutline=()=>{let e=(0,s.ZP)("text-outline").checked,t=(0,s.ZP)("text-outline-punch").checked,i=this.outlineColor.getHex(),n=this.outlineSize.getValue(),a=this.outlineDistance.getValue(),r=this.outlineDirection.getValue();this.selected.setOutline(e,n,i,t,a,r),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeCurveState=()=>{const e=this.selected.textSettings.clone();this.changeCurve(),this.stage.history.add({type:"textSettings",kind:"curve",layer:this.selected,settings:e})},this.changeCurve=()=>{let e=this.curveAmount.getValue(),t=(0,s.ZP)("text-curve").checked,i=(0,s.ZP)("text-curve-flip").checked,n=(0,s.ZP)("text-curve-spread").checked,a=document.querySelector('input[name="curve-type"]:checked').value;(0,s.ZP)("text-curve-amount").style.display="arc"!==a?"none":"block",(0,s.ZP)("text-curve-flip-label").style.display="arc"!==a?"block":"none",(0,s.ZP)("text-curve-spread-label").style.display="arc"!==a?"block":"none",this.selected.setCurve(t,a,e,n,i),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeWarpState=()=>{const e=this.selected.textSettings.clone();this.changeWarp(),this.stage.history.add({type:"textSettings",kind:"warp",layer:this.selected,settings:e})},this.changeWarp=()=>{let e=(0,s.ZP)("text-warp").checked,t=this.warpEdgeSize.getValue(),i=this.warpCenterSize.getValue(),n=this.warpHorizontalOffset.getValue(),a=this.warpVerticalOffset.getValue(),r=document.querySelector('input[name="warp-type"]:checked').value,o=document.querySelector('input[name="warp-mode"]:checked').value;this.selected.setWarp(e,r,o,t,i,n,a),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowState=()=>{const e=this.selected.textSettings.clone();this.changeShadow(),this.stage.history.add({type:"textSettings",kind:"shadow",layer:this.selected,settings:e})},this.changeShadow=()=>{this.selected.setShadow((0,s.ZP)("text-shadow").checked,this.shadowBlur.getValue(),this.shadowAlpha.getValue(),this.shadowColor.getHex(),this.shadowDistance.getValue(),this.shadowDirection.getValue()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowColor=e=>{const t=this.selected.textSettings.clone();this.changeShadow(),this.stage.history.add({type:"textSettings",kind:"shadow",layer:this.selected,settings:t})},this.cleanUp=()=>{this.font.cleanUp(),this.font=null,this.fill.cleanUp(),this.fill=null,this.backgroundColor=null,this.backgroundOffset.cleanUp(),this.textSize.cleanUp(),this.lineSpace.cleanUp(),this.letterSpace.cleanUp(),this.curveAmount.cleanUp(),this.opacity.cleanUp(),this.outlineSize.cleanUp(),this.outlineDistance.cleanUp(),this.outlineDirection.cleanUp(),this.shadowBlur.cleanUp(),this.shadowAlpha.cleanUp(),this.shadowDistance.cleanUp(),this.shadowDirection.cleanUp(),this.warpEdgeSize.cleanUp(),this.warpCenterSize.cleanUp(),this.warpVerticalOffset.cleanUp(),this.warpHorizontalOffset.cleanUp(),(0,s.ZP)("text-input").removeEventListener("paste",this.paste,!0),(0,s.ZP)("text-input").removeEventListener("input",this.changeText,!0),(0,s.ZP)("text-input").removeEventListener("active",this.textActive,!0),(0,s.ZP)("text-input").removeEventListener("blur",this.textBlur,!0),(0,s.ZP)("text-align-left").removeEventListener("click",this.changeAlign,!1),(0,s.ZP)("text-align-center").removeEventListener("click",this.changeAlign,!1),(0,s.ZP)("text-align-right").removeEventListener("click",this.changeAlign,!1),(0,s.ZP)("text-align-justify").removeEventListener("click",this.changeAlign,!1),(0,s.ZP)("text-background").removeEventListener("change",this.changeBackground,!1),(0,s.ZP)("text-background-punch").removeEventListener("change",this.changeBackground,!1),(0,s.ZP)("text-background-type-full").removeEventListener("change",this.changeBackground,!1),(0,s.ZP)("text-background-type-line").removeEventListener("change",this.changeBackground,!1),(0,s.ZP)("text-background-type-word").removeEventListener("change",this.changeBackground,!1),(0,s.ZP)("text-outline").removeEventListener("change",this.changeOutlineState,!1),(0,s.ZP)("text-outline-punch").removeEventListener("change",this.changeOutlineState,!1),(0,s.ZP)("text-shadow").removeEventListener("change",this.changeShadowState,!1),(0,s.ZP)("text-curve").removeEventListener("change",this.changeCurveState,!1),(0,s.ZP)("text-curve-flip").removeEventListener("change",this.changeCurveState,!1),(0,s.ZP)("text-curve-spread").removeEventListener("change",this.changeCurveState,!1),(0,s.ZP)("text-curve-type-arc").removeEventListener("change",this.changeCurveState,!1),(0,s.ZP)("text-curve-type-circle").removeEventListener("change",this.changeCurveState,!1),(0,s.ZP)("text-curve-type-half").removeEventListener("change",this.changeCurveState,!1),(0,s.ZP)("text-warp").removeEventListener("change",this.changeWarpState,!1),(0,s.ZP)("text-warp-type-circular").removeEventListener("change",this.changeWarpState,!1),(0,s.ZP)("text-warp-type-angular").removeEventListener("change",this.changeWarpState,!1),(0,s.ZP)("text-warp-mode-upper").removeEventListener("change",this.changeWarpState,!1),(0,s.ZP)("text-warp-mode-middle").removeEventListener("change",this.changeWarpState,!1),(0,s.ZP)("text-warp-mode-lower").removeEventListener("change",this.changeWarpState,!1),(0,s.ZP)("text-uppercase").removeEventListener("click",this.changeUppercase,!1),(0,s.ZP)("text-italic").removeEventListener("click",this.changeItalic,!1),(0,s.ZP)("text-bold").removeEventListener("click",this.changeBold,!1),(0,s.ZP)("text-underline").removeEventListener("click",this.changeUnderline,!1)},this.fill=new M("text-fill",new g.Z(new v.Z(255,255,255)),this.changeFill,this.previewFill),this.backgroundColor=new P.Z((0,s.ZP)("text-background-color"),void 0,this.changeBackroundColor,!0,280,120),this.outlineColor=new P.Z((0,s.ZP)("text-outline-color"),void 0,this.changeOutlineState,!0,280,120),this.shadowColor=new P.Z((0,s.ZP)("text-shadow-color"),void 0,this.changeShadowColor,!0,280,120),this.font=new D(this.stage,(0,s.ZP)("text-font"),this.changeFont,this.previewFont),(0,s.ZP)("text-input").addEventListener("paste",this.paste,!0),(0,s.ZP)("text-input").addEventListener("input",this.changeText,!0),(0,s.ZP)("text-input").addEventListener("focus",this.textActive,!0),(0,s.ZP)("text-input").addEventListener("blur",this.textBlur,!0);const i={onStart:()=>{t=this.selected.textSettings.clone()},labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100};this.textSize=new o.Z("text-size",Object.assign(Object.assign({},i),{label:(0,n.Z)("size"),range:[4,100,1e3],defaultValue:60,step:[2,5],stops:[0,.4,1],labelFormat:e=>e.toString(),labelParse:e=>parseInt(e),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"size",layer:this.selected,settings:t})},onChange:this.changeSize})),this.lineSpace=new o.Z("line-space",Object.assign(Object.assign({},i),{label:(0,n.Z)("lineSpacing"),range:[-1,1],onChange:this.changeLineSpace,onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"linespace",layer:this.selected,settings:t})}})),this.letterSpace=new o.Z("letter-space",Object.assign(Object.assign({},i),{label:(0,n.Z)("letterSpacing"),range:[-.2,1],onChange:this.changeLetterSpace,onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"letterspace",layer:this.selected,settings:t})}})),this.outlineSize=new o.Z("text-outline-size",Object.assign(Object.assign({},i),{label:(0,n.Z)("size"),range:[.01,1],defaultValue:.3,onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:t})}})),this.outlineDistance=new o.Z("text-outline-distance",Object.assign(Object.assign({},i),{label:(0,n.Z)("distance"),range:[0,1],onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:t})}})),this.outlineDirection=new o.Z("text-outline-direction",Object.assign(Object.assign({},i),{label:(0,n.Z)("direction"),range:[0,360],defaultValue:180,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:t})}})),this.curveAmount=new o.Z("text-curve-amount",Object.assign(Object.assign({},i),{label:(0,n.Z)("amount"),range:[-1,1],onChange:()=>this.changeCurve(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"curve",layer:this.selected,settings:t})}})),this.warpEdgeSize=new o.Z("text-warp-edge-size",Object.assign(Object.assign({},i),{label:(0,n.Z)("viewAddTextWarpEdgeSize"),range:[-1,1],onChange:()=>this.changeWarp(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"warp",layer:this.selected,settings:t})}})),this.warpCenterSize=new o.Z("text-warp-center-size",Object.assign(Object.assign({},i),{label:(0,n.Z)("viewAddTextWarpCenterSize"),range:[-1,1],onChange:()=>this.changeWarp(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"warp",layer:this.selected,settings:t})}})),this.warpHorizontalOffset=new o.Z("text-warp-horizontal-offset",Object.assign(Object.assign({},i),{label:(0,n.Z)("viewAddTextWarpHorizontalOffset"),range:[-1,1],onChange:()=>this.changeWarp(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"warp",layer:this.selected,settings:t})}})),this.warpVerticalOffset=new o.Z("text-warp-vertical-offset",Object.assign(Object.assign({},i),{label:(0,n.Z)("viewAddTextWarpVerticalOffset"),range:[-1,1],onChange:()=>this.changeWarp(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"warp",layer:this.selected,settings:t})}}));const a=Object.assign(Object.assign({},i),{range:[0,1],onChange:()=>this.changeShadow(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"shadow",layer:this.selected,settings:t})}});this.opacity=new o.Z("text-opacity",{defaultValue:1,label:(0,n.Z)("opacity"),labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100,onChange:e=>{this.selected.settings.opacity=e,document.dispatchEvent(new CustomEvent("viewport-render"))},onEnd:(e,t)=>{this.stage.history.add({type:"layerSettings",kind:"opacity",layer:this.selected,settings:Object.assign(Object.assign({},this.selected.settings),{opacity:t})})}}),this.backgroundOffset=new o.Z("text-background-offset",Object.assign(Object.assign({},i),{label:(0,n.Z)("offset"),range:[-1,1],onEnd:()=>{this.changeBackground()}})),this.shadowBlur=new o.Z("text-shadow-blur",Object.assign(Object.assign({},a),{label:(0,n.Z)("blur")})),this.shadowAlpha=new o.Z("text-shadow-alpha",Object.assign(Object.assign({},a),{label:(0,n.Z)("opacity"),defaultValue:1})),this.shadowDistance=new o.Z("text-shadow-distance",Object.assign(Object.assign({},a),{label:(0,n.Z)("distance"),range:[0,1]})),this.shadowDirection=new o.Z("text-shadow-direction",Object.assign(Object.assign({},a),{label:(0,n.Z)("direction"),range:[0,360],defaultValue:180,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10)})),(0,s.ZP)("text-align-left").addEventListener("click",this.changeAlign,!1),(0,s.ZP)("text-align-center").addEventListener("click",this.changeAlign,!1),(0,s.ZP)("text-align-right").addEventListener("click",this.changeAlign,!1),(0,s.ZP)("text-align-justify").addEventListener("click",this.changeAlign,!1),(0,s.ZP)("text-uppercase").addEventListener("click",this.changeUppercase,!1),(0,s.ZP)("text-italic").addEventListener("click",this.changeItalic,!1),(0,s.ZP)("text-bold").addEventListener("click",this.changeBold,!1),(0,s.ZP)("text-underline").addEventListener("click",this.changeUnderline,!1),(0,s.ZP)("text-background").addEventListener("change",this.changeBackground,!1),(0,s.ZP)("text-background-punch").addEventListener("change",this.changeBackground,!1),(0,s.ZP)("text-background-type-full").addEventListener("change",this.changeBackground,!1),(0,s.ZP)("text-background-type-line").addEventListener("change",this.changeBackground,!1),(0,s.ZP)("text-background-type-word").addEventListener("change",this.changeBackground,!1),(0,s.ZP)("text-outline").addEventListener("change",this.changeOutlineState,!1),(0,s.ZP)("text-outline-punch").addEventListener("change",this.changeOutlineState,!1),(0,s.ZP)("text-shadow").addEventListener("change",this.changeShadowState,!1),(0,s.ZP)("text-curve").addEventListener("change",this.changeCurveState,!1),(0,s.ZP)("text-curve-flip").addEventListener("change",this.changeCurveState,!1),(0,s.ZP)("text-curve-spread").addEventListener("change",this.changeCurveState,!1),(0,s.ZP)("text-curve-type-arc").addEventListener("change",this.changeCurveState,!1),(0,s.ZP)("text-curve-type-circle").addEventListener("change",this.changeCurveState,!1),(0,s.ZP)("text-curve-type-half").addEventListener("change",this.changeCurveState,!1),(0,s.ZP)("text-warp").addEventListener("change",this.changeWarpState,!1),(0,s.ZP)("text-warp-type-circular").addEventListener("change",this.changeWarpState,!1),(0,s.ZP)("text-warp-type-angular").addEventListener("change",this.changeWarpState,!1),(0,s.ZP)("text-warp-mode-upper").addEventListener("change",this.changeWarpState,!1),(0,s.ZP)("text-warp-mode-middle").addEventListener("change",this.changeWarpState,!1),(0,s.ZP)("text-warp-mode-lower").addEventListener("change",this.changeWarpState,!1)}}class N{constructor(e,t,i,n){this.resizeStart=e=>{this.d=new w.Z(this.container.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.container.style.height=(t<200?200:t)+"px"},this.populatePresets=()=>{const e=(0,s.ZP)("shape-selector-presets-ss-content");e.style.paddingTop="6px",["M 0,0 H 100 V 100 H 0 Z","m3 0h94c1.66 0 3 1.34 3 3v94c0 1.66-1.34 3-3 3h-94c-1.66 0-3-1.34-3-3v-94c0-1.66 1.34-3 3-3z","m 6,0 h 88 c 3.324,0 6,2.676 6,6 v 88 c 0,3.324 -2.676,6 -6,6 H 6 C 2.676,100 0,97.324 0,94 V 6 C 0,2.676 2.676,0 6,0 Z","m 10,0 h 80 c 5.54,0 10,4.46 10,10 v 80 c 0,5.54 -4.46,10 -10,10 H 10 C 4.46,100 0,95.54 0,90 V 10 C 0,4.46 4.46,0 10,0 Z","m 20,0 h 60 c 11.08,0 20,8.92 20,20 v 60 c 0,11.08 -8.92,20 -20,20 H 20 C 8.92,100 0,91.08 0,80 V 20 C 0,8.92 8.92,0 20,0 Z","M 0,50 C 0,0 0,0 50,0 c 50,0 50,0 50,50 0,50 0,50 -50,50 C 0,100 0,100 0,50","m80 0c11.1 0 20 8.92 20 20v80h-80c-11.1 0-20-8.92-20-20v-80h80z","m80 100c11.1 0 20-8.92 20-20v-80h-80c-11.1 0-20 8.92-20 20v80h80z","m 100,50.000001 c 0,0 -3.52,6.8 -3.52,22.281 0,15.078 -5.18,18.578 -5.446,18.75 -0.144,0.228 -3.604,5.451 -18.753,5.451 C 56.8,96.482001 50,100 50,100 c 0,0 -6.801,-3.517999 -22.282,-3.517999 -15.131,0 -18.603,-5.217 -18.752,-5.45 -0.256,-0.164 -5.448,-3.65 -5.448,-18.751 C 3.518,56.8 0,50 0,50 0,50 3.518,43.200001 3.518,27.718001 3.518,12.594 8.729,9.118 8.968,8.966 8.971,8.961 8.975,8.955 8.982,8.945 9.293,8.48 12.96,3.518 27.719,3.518 43.199,3.518 50,0 50,0 c 0,0 6.828,3.518 22.309,3.518 14.756,0 18.425,4.962 18.736,5.427 v 0 0 c 0,0 5.435,3.892001 5.435,18.773 0,15.483 3.52,22.282 3.52,22.282001 z","m 11.538461,11.538461 c 15.384615,-15.3846148 61.538462,-15.3846148 76.923076,0 15.384613,15.384615 15.384613,61.538464 0,76.923079 -15.384614,15.38461 -61.538461,15.38461 -76.923076,0 -15.3846147,-15.384615 -15.3846147,-61.538464 0,-76.923079","M 0,50 C 0,14.5 14.500003,0 50,0 85.5,0 100,14.5 100,50 100,85.5 85.5,100 50,100 14.500003,100 0,85.5 0,50","m100 50a50 50 0 0 1-50 50 50 50 0 0 1-50-50 50 50 0 0 1 50-50 50 50 0 0 1 50 50z","m7.58 76.5 8.5-5.3c1.6 2.5 3.4 4.9 5.6 7.1 2.2 2.2 4.6 4.1 7.1 5.6l-5.3 8.5c16.2 10.1 36.8 10.1 53 0l-5.3-8.5c2.5-1.6 4.9-3.4 7.1-5.6 2.2-2.2 4.1-4.6 5.6-7.1l8.5 5.3c10.1-16.2 10.1-36.8 0-53l-8.5 5.3c-1.6-2.5-3.4-4.9-5.6-7.1-2.2-2.2-4.6-4.1-7.1-5.6l5.3-8.5c-16.2-10.1-36.8-10.1-53 0l5.3 8.5c-2.5 1.6-4.9 3.4-7.1 5.6-2.2 2.2-4.1 4.6-5.6 7.1l-8.5-5.3c-10.1 16.2-10.1 36.8 0 53z","m 80.100004,19.9 c -6.2,-6.2 -13.8,-9.9999998 -21.7,-11.5999998 L 50.000004,0 l -8.3,8.3000002 c -8,1.6 -15.6,5.4999998 -21.7,11.5999998 -6.1,6.1 -10.1,13.8 -11.7,21.8 L 0,50 8.300004,58.3 c 1.6,8 5.5,15.6 11.6,21.7 6.2,6.2 13.8,10 21.7,11.6 l 8.4,8.4 8.3,-8.3 c 8,-1.6 15.6,-5.5 21.7,-11.6 6.2,-6.2 10,-13.8 11.6,-21.7 L 100,50 91.700004,41.7 c -1.6,-8 -5.5,-15.6 -11.6,-21.8 z","M 31.278462,0.01959957 C 23.186769,-0.27097901 15.000275,2.6696037 8.8346993,8.8330525 -2.1173026,19.781307 -2.8922296,37.108219 6.5404597,48.953281 c 0.2422598,0.315753 0.3671413,0.681873 0.3705912,1.047372 -0.00343,0.3655 -0.1283314,0.73162 -0.3705912,1.047373 -9.4326893,11.845059 -8.6577623,29.171972 2.2942396,40.120231 10.9610277,10.957253 28.3079167,11.724463 40.1575537,2.269882 0.309131,-0.23713 0.666341,-0.332857 1.024148,-0.330053 0.366744,0.0034 0.734111,0.110187 1.051116,0.353625 11.847133,9.426729 29.131837,8.654389 40.083427,-2.293454 10.943446,-10.939723 11.751726,-28.273568 2.341393,-40.120231 -0.242377,-0.315753 -0.367656,-0.681856 -0.370591,-1.047373 0.0034,-0.365516 0.12816,-0.731619 0.370591,-1.047372 C 102.90267,37.106616 102.09439,19.772771 91.150944,8.8330525 80.199354,-2.1147875 62.91465,-2.8871348 51.067517,6.5395994 50.750512,6.7830358 50.383145,6.8897696 50.016401,6.8932183 49.658594,6.8966464 49.301384,6.8002786 48.992253,6.5631705 43.808027,2.4268049 37.571993,0.24560339 31.278462,0.01959957 Z","m87.074 36.937h-5.1102l3.6072-3.6036c5.1102-5.1051 5.1102-13.413 0-18.619-5.1102-5.2052-13.427-5.1051-18.637 0l-3.6072 3.6036v-5.1051c-0.1002-7.3073-5.9118-13.213-13.226-13.213s-13.126 5.9059-13.126 13.113v5.1051l-3.6072-3.6036c-5.1102-5.1051-13.427-5.1051-18.637 0-5.2104 5.1051-5.1102 13.413 0 18.619l3.6072 3.6036h-5.1102c-7.3146 0.1001-13.226 5.9059-13.226 13.213s5.9118 13.113 13.126 13.113h5.1102l-3.6072 3.6036c-5.1102 5.1051-5.1102 13.413 0 18.619 5.1102 5.1051 13.427 5.1051 18.637 0l3.6072-3.6036v5.1051c0 7.3073 5.9118 13.113 13.126 13.113 7.2144 0 13.126-5.9059 13.126-13.113v-5.1051l3.6072 3.6036c5.1102 5.1051 13.427 5.1051 18.637 0 5.1102-5.1051 5.1102-13.413 0-18.619l-3.6072-3.6036h5.1102c7.3146 0 13.126-5.9059 13.126-13.113s-5.7114-13.113-12.926-13.113z","m86.987 36.903h-0.4004c-1.7017 0-2.6026-2.1009-1.4014-3.3014 4.9049-4.9021 5.5055-12.806 1.1011-18.008-5.005-6.0026-14.014-6.3027-19.419-0.90039l-0.3003 0.30013c-1.2012 1.2005-3.3033 0.40017-3.3033-1.4006v-0.10004c0-6.8029-4.9049-12.706-11.712-13.406-7.9079-0.90039-14.615 5.3023-14.615 13.106v0.40017c0 1.7007-2.1021 2.6011-3.3033 1.4006-4.9049-4.9021-12.813-5.5024-18.018-1.1005-6.006 5.0022-6.3063 14.006-0.9009 19.408l0.3003 0.30013c1.2012 1.2005 0.4004 3.3014-1.4014 3.3014h-0.4004c-7.3073 0-13.213 5.8025-13.213 13.106s5.9059 13.106 13.113 13.106h0.4004c1.7017 0 2.6026 2.1009 1.4014 3.3014l-0.3003 0.30013c-5.4054 5.4023-5.1051 14.306 0.9009 19.408 5.3053 4.4019 13.213 3.8016 18.018-1.1005 1.2012-1.2005 3.3033-0.40017 3.3033 1.4006v0.40017c0 7.7033 6.7067 13.906 14.615 13.106 6.7067-0.7003 11.712-6.7029 11.712-13.406v-0.10004c0-1.7007 2.1021-2.6011 3.3033-1.4006l0.3003 0.30013c5.4054 5.4023 14.314 5.1022 19.419-0.90039 4.4044-5.3023 3.8038-13.206-1.1011-18.008-1.2012-1.2005-0.4004-3.3014 1.4014-3.3014h0.4004c7.3073 0 13.113-5.9026 13.113-13.106 0-7.2031-5.8058-13.106-13.013-13.106z","m 50.094148,0 c -2.77536,0 -5.553405,0.64778966 -8.038073,1.9436751 -4.969341,2.5917545 -8.12526,7.3889096 -8.12526,12.5724349 v 7.453361 c 0,0.578822 -0.337936,1.109289 -0.889248,1.398692 -0.551335,0.289419 -1.220173,0.289419 -1.771503,0 L 24.103777,19.55012 C 19.134436,16.958365 13.003954,16.956091 8.034594,19.546895 3.0652529,22.138666 0,26.935805 0,32.11933 c 0,5.183526 3.0652529,9.980681 8.034594,12.572435 l 7.372024,3.909398 c 0.551335,0.289402 0.889252,0.819867 0.889252,1.398693 0,0.578822 -0.34142,1.109269 -0.892736,1.398689 L 8.017166,55.27643 C 3.047806,57.868183 0,62.696853 0,67.88038 c 0,5.183523 3.0687318,9.980663 8.0380919,12.572433 4.9693411,2.591774 11.0963441,2.591757 16.0656851,0 l 7.270897,-3.821188 c 0.551331,-0.28942 1.223686,-0.28942 1.775002,0 0.551349,0.289402 0.781158,0.816711 0.781139,1.395533 v 7.4566 c 0,5.183527 3.159398,9.98068 8.128739,12.572437 2.464461,1.285337 5.187223,1.933208 7.940444,1.943659 2.798399,0.01131 5.627343,-0.637226 8.132242,-1.943659 4.969341,-2.591757 8.031091,-7.38891 8.031091,-12.572437 L 66.069191,78.0304 c -0.0071,-0.578792 0.233307,-1.109291 0.784623,-1.398693 0.55133,-0.28942 1.220187,-0.28942 1.771518,0 l 7.270897,3.814881 c 4.969341,2.59177 11.099823,2.59177 16.069183,0 C 96.934748,77.854835 100,73.057677 100,67.874155 c 0,-5.183527 -3.065252,-9.97752 -8.034593,-12.56929 l -7.372024,-3.909398 c -0.551335,-0.289403 -0.889252,-0.816712 -0.889252,-1.395533 0,-0.578822 0.34142,-1.109274 0.892736,-1.398689 L 91.986314,44.72336 C 96.955712,42.131607 100,37.302935 100,32.11941 c 0,-5.183526 -3.065252,-9.980665 -8.034593,-12.572436 -4.96936,-2.59177 -11.099842,-2.589496 -16.069183,0.0032 l -7.166287,3.818043 c -0.55133,0.289419 -1.220168,0.289419 -1.771504,0 -0.553971,-0.290258 -0.889247,-0.819951 -0.889247,-1.398772 v -7.45336 c 0,-5.1835253 -2.971084,-9.9806804 -7.940444,-12.5724349 C 55.644069,0.64778966 52.869527,0 50.094148,0 Z","m91.1 35c-5.89-2.87-9.49-9.71-8.79-16.8 1.4-14.2-13.1-23.5-23.5-15-5.2 4.19-12.3 4.19-17.6 0-10.4-8.39-25 0.883-23.6 15 0.699 7.06-2.9 13.9-8.79 16.8-11.8 5.74-11.8 24.3 0.0999 30 5.89 2.87 9.49 9.71 8.79 16.8-1.4 14.1 13.1 23.4 23.6 15 5.2-4.19 12.3-4.19 17.6 0 10.4 8.39 25-0.883 23.6-15-0.699-7.06 2.9-13.9 8.79-16.8 11.7-5.74 11.7-24.3-0.2-30z","m3.17 48.6 11.9 12.1c2.5 2.5 3.6 6.04 3 9.57l-2.8 17.1c-1.5 8.85 7.5 15.6 15.1 11.4l14.8-8.12c3-1.67 6.7-1.67 9.7 0l14.8 8.12c7.6 4.16 16.6-2.6 15.1-11.4l-2.8-17.1c-0.6-3.54 0.5-7.08 3-9.57l11.9-12.1c6.2-6.24 2.8-17.2-5.8-18.5l-16.5-2.5c-3.4-0.52-6.3-2.71-7.8-5.93l-7.4-15.6c-3.9-8.01-14.9-8.01-18.7 0l-7.4 15.6c-1.5 3.23-4.4 5.41-7.8 5.93l-16.6 2.5c-8.5 1.25-11.9 12.2-5.7 18.5z","m32 0v32h-32v36h32v32h36v-32h32v-36h-32v-32h-36z","m34 0v34h-34v32h34v34h32v-34h34v-32h-34v-34h-32z","m36 0v36h-36v28h36v36h28v-36h36v-28h-36v-36h-28z","m38 0v38h-38v24h38v38h24v-38h38v-24h-38v-38h-24z","m100 99.9-50-35.8-49.9 35.9 35.8-50-35.9-49.9 50 35.8 49.9-35.9-35.8 50z","m100 100-50-28.8-50 28.8 28.8-50-28.8-50 50 28.8 50-28.8-28.8 50z","M 49.999984,0 C 45.722878,0 41.617373,1.6978034 38.592988,4.7221408 35.56864,7.7464783 33.8708,11.851959 33.8708,16.129017 v 10.817782 c 0,0.536631 -0.264632,1.034533 -0.708796,1.335693 C 32.71784,28.583556 32.157866,28.64491 31.659343,28.4463 28.200473,27.227976 25.094977,26.165382 21.110455,24.796091 16.086103,23.159917 10.543614,24.078997 6.3094312,27.327976 1.7398721,30.834282 -0.61368155,36.514793 0.13813101,42.225271 0.88981729,47.934817 4.6342391,52.819843 9.9542542,55.02452 l 12.8340388,4.624495 c 0.454071,0.188081 0.796007,0.570582 0.932461,1.042725 0.136616,0.47213 0.05049,0.975225 -0.233116,1.376628 l -9.469586,11.983363 c -0.0016,0.0032 -0.0032,0.0064 -0.0064,0.0097 l -0.01292,0.01612 c -3.490018,4.566738 -4.2856042,10.656816 -2.085454,15.968359 2.204181,5.32135 7.082548,9.064235 12.793085,9.816024 5.700862,0.750526 11.377026,-1.594919 14.884848,-6.149189 0.0013,-0.0016 0.0016,-0.0048 0.0032,-0.0064 l 0.01612,-0.01612 9.110474,-11.532877 C 49.02707,81.758415 49.49722,81.527221 50,81.527253 c 0.50278,-3.2e-5 0.972926,0.231162 1.278995,0.630033 l 9.110471,11.532877 0.01612,0.01612 c 0.0016,0.0016 0.0016,0.0048 0.0032,0.0064 3.507825,4.55427 9.18399,6.899717 14.884849,6.149189 5.710536,-0.751789 10.588906,-4.494674 12.793088,-9.816024 2.20015,-5.311543 1.40456,-11.401621 -2.085454,-15.968359 l -0.01292,-0.01612 c -0.0032,-0.0032 -0.0048,-0.0064 -0.0064,-0.0097 L 76.51236,62.068368 c -0.283599,-0.401403 -0.369729,-0.904498 -0.233117,-1.376628 0.136454,-0.472143 0.478394,-0.854644 0.932462,-1.042725 L 90.045743,55.02452 c 5.320019,-2.204677 9.06444,-7.089703 9.816127,-12.799249 0.75181,-5.710478 -1.601741,-11.390989 -6.171301,-14.897295 -4.191331,-3.216093 -9.664607,-4.149222 -14.648313,-2.580787 -3.387709,1.174531 -7.124923,2.472013 -10.701602,3.699111 -0.498519,0.19861 -1.058493,0.137256 -1.502657,-0.163808 -0.4442,-0.30116 -0.708832,-0.799062 -0.708832,-1.335693 V 16.129017 c 0,-4.277058 -1.697837,-8.3825387 -4.722188,-11.4068762 C 58.382588,1.6978034 54.277082,0 49.999977,0 Z","m 95.097846,4.9018824 c -6.5362,-6.5358435 -17.184353,-6.5358426 -23.720548,-1.2e-6 L 50.028804,26.249213 c -0.425617,0.425594 -1.040135,0.586638 -1.621513,0.430837 L 21.08856,19.627522 c -5.785619,-1.55016 -11.9599597,0.09643 -16.1897377,4.310702 -2.1146391,2.107408 -3.5852443,4.695818 -4.33177648,7.481767 -0.74652914,2.785944 -0.76864986,5.766964 0.009252,8.649189 0.75867638,2.810944 2.22358978,5.323667 4.19641438,7.340366 2.0728318,2.11897 4.7064751,3.690254 7.6708358,4.484488 l 28.056935,6.416262 c 0.28639,0.0767 0.547033,0.231845 0.750533,0.435477 0.209661,0.209842 0.356755,0.473669 0.435495,0.769013 l 6.418482,28.038807 c 0.78666,2.935694 2.306363,5.484426 4.3105,7.49614 4.090458,4.10683 10.194583,5.980987 16.162376,4.38201 2.921791,-0.782839 5.455367,-2.303208 7.455498,-4.308661 4.086164,-4.097795 5.946157,-10.219785 4.339911,-16.214049 l -7.0571,-27.321448 c -0.155477,-0.581682 0.0075,-1.193522 0.433183,-1.619113 L 95.097852,28.621141 c 6.536198,-6.535842 6.536198,-17.183416 3e-6,-23.7192562 z","m 66.400001,0 -16.4,16.4 L 33.600001,0 0,33.6 16.400001,50 0,66.4 33.600001,100 l 16.4,-16.4 16.4,16.4 L 100,66.4 83.600001,50 100,33.6 Z","m 19.630485,54.1 -7.3903,7.8 v 0 L 0,75 30.715935,70.7 c 3.464203,-0.5 6.928406,1.2 8.083141,4.1 l 2.309469,5.2 1.847575,4.2 v 0 l 6.928406,15.8 6.928406,-15.8 v 0 l 1.847576,-4.2 2.309468,-5.2 c 1.270208,-2.9 4.618938,-4.6 8.083141,-4.1 L 99.999999,75 87.644341,61.9 v 0 l -7.3903,-7.8 c -2.193996,-2.4 -2.193996,-5.8 0,-8.1 l 5.889145,-6.3 1.385682,-1.5 v 0 L 99.999999,25 80.715935,27.7 v 0 L 69.168591,29.3 C 65.704387,29.8 62.240184,28.1 61.08545,25.2 L 58.775981,20 56.928406,15.8 v 0 L 50,0 43.071593,15.8 v 0 l -1.847575,4.2 -2.309469,5.2 c -1.270208,2.9 -4.618937,4.6 -8.083141,4.1 L 19.284064,27.7 v 0 L 0,25 12.355658,38.1 v 0 l 1.385681,1.5 5.889146,6.3 c 2.309469,2.4 2.309469,5.8 0,8.2 z","M 50,0 30.1,30.1 0,50 30.1,69.9 50,100.00001 69.9,69.9 100,50 69.9,30.1 Z","m73 64.6c-8.69 12.7-19.4 23.3-29.9 29.5-10.4 6.23-19.7 7.55-25.8 3.68-6.09-3.87-8.48-12.6-6.64-24.3 1.84-11.7 7.75-25.4 16.4-38.1 8.69-12.7 19.4-23.3 29.9-29.5 10.4-6.23 19.7-7.55 25.8-3.68 12.7 8.07 8.3 36-9.79 62.4z","M 33.606558,75.300005 50,100 66.393446,75.300005 H 100 L 83.255273,50 100,24.7 H 66.393446 L 50.000001,0 33.606558,24.7 H 0 L 16.744731,50 0,75.300005 Z","M 85.4,14.6 62.7,19.3 50,0 37.3,19.3 14.6,14.6 19.3,37.3 0,50 19.3,62.7 14.6,85.4 37.3,80.7 50,100 62.7,80.7 85.4,85.4 80.7,62.7 99.999999,50 80.7,37.3 Z","M 93.3,25 78.3,21.7 75,6.7 60.4,11.4 50,0 39.6,11.4 25,6.7 21.7,21.7 6.7,25 11.4,39.6 0,50 11.4,60.4 6.7,75 21.7,78.3 25,93.3 39.6,88.6 50,99.999997 60.4,88.6 75,93.3 78.3,78.3 93.3,75 88.6,60.4 100,50 88.6,39.6 Z","m 93.300004,25 -21.8,3.5 3.5,-21.8 -17.1,13.9 -7.9,-20.6 -7.9,20.6 L 25,6.7 28.5,28.5 6.7,25 20.6,42.1 0,50 20.6,57.9 6.7,75 28.5,71.5 25,93.3 42.100004,79.4 l 7.9,20.6 7.9,-20.6 17.1,13.9 -3.5,-21.8 21.8,3.5 -13.9,-17.1 L 100,50 79.400004,42.1 Z","m97.5 66.2-8.94 2.39 3.67 8.47-9.25 0.188 1.53 9.1-9.03-2.02-0.701 9.2-8.28-4.12-2.89 8.76-7.05-5.97-4.91 7.82-5.41-7.48-6.64 6.42-3.46-8.56-7.99 4.65-1.3-9.13-8.88 2.6 0.927-9.18-9.24 0.419 3.1-8.69-9.08-1.8 5.1-7.7-8.38-3.91 6.8-6.26-7.2-5.79 8.1-4.45-5.6-7.35 8.94-2.39-3.67-8.47 9.25-0.189-1.53-9.1 9.03 2.02 0.7-9.2 8.28 4.12 2.89-8.76 7.05 5.97 4.91-7.82 5.41 7.48 6.64-6.42 3.46 8.56 7.99-4.65 1.3 9.13 8.88-2.61-0.926 9.18 9.24-0.418-3.1 8.69 9.08 1.8-5.1 7.69 8.38 3.91-6.8 6.26 7.2 5.79-8.1 4.45z","m 0,43.5 v 0 C 0,67.5 22.413793,87 50.000001,87 v 13 C 77.586208,100 100,80.5 100,56.5 v 0 C 100,32.5 77.586208,13 50.000001,13 V 0 C 22.413793,0 0,19.5 0,43.5 Z","M 89.108383,36.593295 C 84.406622,31.890944 78.804523,28.789393 72.902312,27.088543 L 89.108383,10.88044 c -14.505434,-14.5072533 -38.01424,-14.5072533 -52.619712,0 v 0 c -4.701762,4.702351 -7.702886,10.305152 -9.403523,16.208103 L 10.879076,10.88044 c -14.5054345,14.507253 -14.5054345,38.019007 0,52.62631 v 0 c 4.701762,4.702351 10.30386,7.803902 16.206072,9.504752 L 10.879076,89.119555 c 14.505435,14.507255 38.014242,14.507255 52.619712,0 v 0 C 68.20055,84.417204 71.301712,78.814403 73.002349,72.911452 L 89.208421,89.119555 C 103.61382,74.612302 103.61382,51.100548 89.108383,36.593295 Z","m 86.783481,22.786394 c -1.602002,-1.6008 -3.30413,-3.101551 -5.106383,-4.402201 l 5.106383,-5.102552 c -17.722153,-17.7088548 -46.357948,-17.7088548 -63.979976,0 v 0 c -1.602002,1.600801 -3.10388,3.301651 -4.405507,5.102552 l -5.106383,-5.102552 c -17.7221533,17.708856 -17.7221533,46.323164 0,63.93197 v 0 c 1.602003,1.6008 3.30413,3.101551 5.106383,4.402201 l -5.106383,5.102552 c 17.722153,17.708856 46.357949,17.708856 63.979976,0 1.602003,-1.600801 3.10388,-3.301651 4.405507,-5.102552 l 5.106383,5.102552 c 17.622029,-17.608806 17.622029,-46.223114 0,-63.93197 z","m 80.419581,19.480519 4.895104,-4.895104 C 75.724276,5.0949053 61.838162,2.4975027 49.95005,6.8931071 V 0 C 36.463537,0 24.775225,7.9920082 19.480519,19.480519 L 14.585415,14.585415 C 5.0949051,24.175824 2.4975025,38.061938 6.8931069,49.95005 H 0 c 0,13.486513 7.992008,25.174825 19.480519,30.469531 l -4.895104,4.895104 c 9.590409,9.59041 23.376623,12.087912 35.364635,7.792208 V 100 c 13.486513,0 25.174825,-7.992008 30.469531,-19.480519 l 4.895104,4.895105 C 94.905099,75.824176 97.402601,62.037962 93.106897,50.04995 H 100 C 99.9001,36.463537 91.908096,24.775225 80.419581,19.480519 Z","m 50,83.6 16.4,16.4 H 100 V 66.4 L 83.600005,50 100.00001,33.6 V 0 H 66.400005 l -16.4,16.4 -16.4,-16.4 H 0 V 33.6 L 16.4,50 0,66.4 V 100 h 33.600005 z","m 84.915847,65.690376 c -23.436956,26.022959 -34.915933,34.30962 -34.915933,34.30962 0,0 -11.478977,-8.289949 -34.915929,-34.30962 C -8.3509667,39.671797 -2.4009791,6.9318151 18.693978,1.0456555 39.788935,-4.840504 49.999914,16.043854 49.999914,16.043854 c 0,0 10.210979,-20.884358 31.306936,-14.9981985 21.09296,5.8861596 27.04495,38.6261415 3.608997,64.6447205 z","M 100,61.688 C 100,82.848 77.615954,99.999996 50.000003,99.999996 22.385351,99.999996 0,82.848 0,61.687 0,40.526 50.000003,0 50.000003,0 50.000003,0 100,40.526 100,61.688 Z","m 100,25.001 v 50 L 50,100 0,75 V 25 L 50,0 Z","M 100,0 50,10.2 1e-5,0 10.2,50 0,100 50,90 100,100 90,50 Z","m0 100 50-100 50 100z","m0 100 100-100v100z","M 100,0 0,100 V 0 Z","m0 0 5 50-5 50h100l-5-50 5-50z","m0 0 10 50-10 50h100l-10-50 10-50z","m0 0 15 50-15 50h100l-15-50 15-50z","m0 0 20 50-20 50h100l-20-50 20-50z","m0 0v100h100l-20-50 20-50z","m0 0c23.7 41.8 16.7 58.2 0 100h100l-20-50 20-50z","m26.5 13.9c14.6-16 35-18.1 52.7-6.76 4.84 3.1 9 7.46 12.6 12.3 3.26 4.33 6.16 9.19 7.45 14.7 3.35 14.4-5.42 38.7-15.3 48.4-23.5 23-53.7 19.6-84 10.8 3.13-26.4 9.79-61.1 26.5-79.4","m3.19 53.1c-8.19-17-0.2-34.3 19.3-45.1 5.34-2.95 11.5-4.95 17.9-6.35 5.74-1.27 11.8-2.08 17.7-1.36 15.4 1.85 34.4 16.8 38.8 27.9 10.6 26.5-7.45 50-30.7 71.8-23.8-11-53.7-27.5-63-46.9","m0 100c4.57-4.05 6.77-9.47 8.71-14.7 5.19-14.1 9.48-28.4 16.3-42 6.85-13.6 16.5-26.6 30.6-35.8 8.59-5.6 20.3-9.73 30.5-6.23 7.58 2.62 12.4 9.11 13.6 15.8 1.15 6.64-0.866 13.4-3.84 19.6-7.45 15.6-20.9 29.1-37.1 39.5-16.2 10.4-35.1 17.7-54.6 23","m3.91 51.1c3.56-5.47 9.6-10.5 16-15.4 16.1-12.4 34.6-24 53.1-35.7 1.52 8.55 3.05 17.1 7.16 25.5 5.33 10.8 14.9 21.1 18.6 32.1 3.66 11 0.223 23.3-16.8 31-12.8 5.82-60.8 15-66.9 9.84-13.8-11.7-19.3-34.7-11-47.4","m94 10.3s-10.9-17.6-49.1-6.77c-38.2 10.9-44.8 57.2-44.8 57.2s-3.19 40.3 25.9 39.3c29.1-1.06 51.1 1.34 62-9.8 9.64-9.85 12.1-53 12-61.2-0.261-11.8-5.98-18.7-5.98-18.7z","m81.1 15.9c-8.87-9.29-9.11-15.9-34.4-15.9-17.6-0.034-31.7 4.09-40.8 22.7-3.29 6.69-8.52 26.1-4.19 36.8 3.17 7.83 15.3 6.46 17.9 14.4 3.78 11.4-4.65 26.3 6.27 25.9 29-1.06 56.6 3.72 67.5-7.4 9.62-9.83 5.88-47.2 6.37-55.5 0.684-11.8-9.7-11.7-18.6-21z","m40 0.0297c15.9-0.0929 60-0.797 60 15.4 0 17.3-22.3 21.8-21.9 34.5 0.344 12.7 21.8 8.37 21.7 30.3-0.134 22.1-40.2 19.6-59.7 19.7-19.5 0.0859-40.1-9.01-40-50 0.113-41 24.1-49.9 40-50z","m0 25c57.3 15.3 79.9 1.05 100-25v100h-99.9z","m0 25c29.5 13.7 38.7 2.17 48.5-5.79 16.2-13.2 20.5-17.7 51.5-19.2v100h-99.9z","m0 33c24.3 1.75 24.6-9.81 40.1-9.4 13 0.345 20.7-13.5 31.6-13.4 18.6 0.219 16.5-9.65 28.2-10.2v100h-99.9z","m0 21.4c24.3 1.75 25.5 20.3 33.9 20.3 6.34-1.17e-4 6.07-16.9 17-16.8 9.18 0.0074 13.4 12 25 5.09 8.44-5 19.1-29.7 24.1-29.9v100h-99.9z","m90 40v-10l-3.6-3.6v-12.8h-12.8l-3.6-3.6h-10l-10-10-10 10h-10l-3.6 3.6h-12.8v12.8l-3.6 3.6v10l-10 10 10 10v10l3.6 3.6v12.8h12.8l3.6 3.6h10l10 10 10-10h10l3.6-3.6h12.8v-12.8l3.6-3.6v-10l10-10z","M 80.8,12 100,32.6 79.9,85.1 H 74.2 L 50,100 25.8,85.1 H 20.1 L 0,32.6 19.2,12 V 5.2 L 50,0 80.8,5.2 Z","m0.425 69.8c-0.3-0.501-0.499-1-0.399-1.6l7.59-56.4c0.2-1.2 1.3-2.1 2.6-1.9 3.2 0.3 6.19 0.501 9.09 0.501 20 0 27.3-7.51 28.6-9.01 0.2-0.4 0.499-0.701 0.899-1 0.499-0.4 1.2-0.501 1.9-0.3s1.2 0.701 1.5 1.2c1.3 1.6 8.59 9.01 28.6 9.01 2.9 0 5.99-0.2 9.09-0.501 1.3-0.1 2.4 0.701 2.6 1.9l7.59 56.4c0.0998 0.601-0.0998 1.1-0.399 1.6-0.2 0.2-4.49 5.21-12.6 11.8-7.49 6.11-19.8 14.2-36 18.4-0.2 0.1-0.499 0.1-0.799 0.1h-0.0998c-0.3 0-0.599-0.1-0.899-0.2-16.2-4.2-28.6-12.3-35.9-18.4-8.29-6.51-12.6-11.4-12.8-11.6z","m100 50c0 7.08-2.1 13.6-5.6 18.7 0.2 0.674 0.4 1.46 0.6 2.13 0 0-15 15.7-45 29.2-30.1-13.5-45-29.2-45-29.2 0.2-0.674 0.4-1.46 0.6-2.13-3.5-5.06-5.6-11.6-5.6-18.7 0-9.21 3.5-17.3 9.1-22.8-1.1-6.07-2.9-10.4-4.3-13.3-1.1-2.25-0.2-4.94 2.1-5.96 16-7.08 35-7.98 43.1-7.98s27.1 0.899 43.2 8.09c2.3 1.01 3.2 3.71 2.1 5.96-1.4 2.81-3.2 7.19-4.3 13.3 5.5 5.39 9 13.5 9 22.7z","m100 50c-2.3 4.3-5.3 8.2-8.8 11.7 1.7 2.3 2.9 4.6 3.8 6.9-2.2 1-4.8 1.7-7.6 2.2 0.1 5-0.6 9.9-2 14.6-4.6 1.4-9.6 2.1-14.6 2-0.5 2.8-1.2 5.4-2.2 7.6-2.3-0.9-4.6-2.2-6.9-3.8-3.5 3.6-7.4 6.6-11.7 8.8-4.3-2.3-8.2-5.3-11.7-8.8-2.3 1.7-4.6 2.9-6.9 3.8-1-2.2-1.7-4.8-2.2-7.6-5 0.1-9.9-0.6-14.6-2-1.4-4.6-2.1-9.6-2-14.6-2.8-0.5-5.4-1.2-7.6-2.2 0.9-2.3 2.2-4.6 3.8-6.9-3.5-3.5-6.5-7.4-8.8-11.7 2.3-4.3 5.3-8.2 8.8-11.7-1.7-2.3-2.9-4.6-3.8-6.9 2.2-1 4.8-1.7 7.6-2.2-0.1-5 0.6-9.9 2-14.6 4.6-1.4 9.6-2.1 14.6-2 0.5-2.8 1.2-5.4 2.2-7.6 2.3 0.9 4.6 2.2 6.9 3.8 3.5-3.5 7.4-6.5 11.7-8.8 4.3 2.3 8.2 5.3 11.7 8.8 2.3-1.7 4.6-2.9 6.9-3.8 1 2.2 1.7 4.8 2.2 7.6 5-0.1 9.9 0.6 14.6 2 1.4 4.6 2.1 9.6 2 14.6 2.8 0.5 5.4 1.2 7.6 2.2-0.9 2.3-2.2 4.6-3.8 6.9 3.5 3.5 6.5 7.4 8.8 11.7z","m100 50c-0.1 6.4-3.8 11.4-8.2 13.8l0.1 18.9c0 6.5-5.1 6.9-5.1 6.9-24.5 0.1-36.8 10.4-36.8 10.4s-12.3-10.3-36.8-10.4c0 0-5.1-0.4-5.1-6.9l0.1-18.9c-4.4-2.4-8.1-7.4-8.2-13.8 0.1-6.4 3.8-11.4 8.2-13.8l-0.1-18.9c0-6.5 5.1-6.9 5.1-6.9 24.5-0.1 36.8-10.4 36.8-10.4s12.3 10.3 36.8 10.4c0 0 5.1 0.4 5.1 6.9l-0.1 18.9c4.4 2.4 8.1 7.4 8.2 13.8z","m100 50c-2.6 2.8-6.3 5.3-10.7 7.5l9.2 3.8c-2 0.2-3.9 0.7-5.7 1.5 1.5 2.2 2.6 4.3 3.5 6.4-2.1 0.9-4.4 1.6-7 2.1 0.7 1.8 1.7 3.5 3 5.1l-9.2-3.8c1.6 4.6 2.4 9 2.3 12.8-3.8 0.1-8.2-0.7-12.8-2.3l3.8 9.2c-1.6-1.3-3.3-2.3-5.1-3-0.5 2.6-1.2 4.9-2.1 7-2.1-0.8-4.3-2-6.4-3.5-0.8 1.8-1.3 3.7-1.5 5.7l-3.8-9.2c-2.2 4.4-4.7 8.1-7.5 10.7-2.8-2.6-5.3-6.3-7.5-10.7l-3.8 9.2c-0.2-2-0.7-3.9-1.5-5.7-2.2 1.5-4.3 2.6-6.4 3.5-0.9-2.1-1.6-4.4-2.1-7-1.8 0.7-3.5 1.7-5.1 3l3.8-9.2c-4.6 1.6-9 2.4-12.8 2.3-0.1-3.8 0.7-8.2 2.3-12.8l-9.2 3.8c1.3-1.6 2.3-3.3 3-5.1-2.6-0.5-4.9-1.2-7-2.1 0.8-2.1 2-4.3 3.5-6.4-1.8-0.8-3.7-1.3-5.7-1.5l9.2-3.8c-4.4-2.2-8.1-4.7-10.7-7.5 2.6-2.8 6.3-5.3 10.7-7.5l-9.2-3.8c2-0.2 3.9-0.7 5.7-1.5-1.5-2.2-2.6-4.3-3.5-6.4 2.1-0.9 4.4-1.6 7-2.1-0.7-1.8-1.7-3.5-3-5.1l9.2 3.8c-1.6-4.6-2.4-9-2.3-12.8 3.8-0.1 8.2 0.7 12.8 2.3l-3.8-9.2c1.6 1.3 3.3 2.3 5.1 3 0.5-2.6 1.2-4.9 2.1-7 2.1 0.8 4.3 2 6.4 3.5 0.8-1.8 1.3-3.7 1.5-5.7l3.8 9.2c2.2-4.4 4.7-8.1 7.5-10.7 2.8 2.6 5.3 6.3 7.5 10.7l3.8-9.2c0.2 2 0.7 3.9 1.5 5.7 2.2-1.5 4.3-2.6 6.4-3.5 0.9 2.1 1.6 4.4 2.1 7 1.8-0.7 3.5-1.7 5.1-3l-3.8 9.2c4.6-1.6 9-2.4 12.8-2.3 0.1 3.8-0.7 8.2-2.3 12.8l9.2-3.8c-1.3 1.6-2.3 3.3-3 5.1 2.6 0.5 4.9 1.2 7 2.1-0.8 2.1-2 4.3-3.5 6.4 1.8 0.8 3.7 1.3 5.7 1.5l-9.2 3.8c4.4 2.2 8.1 4.7 10.7 7.5z","m91.2 25.1c5.4 6.4 8.8 15.2 8.8 24.9s-3.4 18.5-8.8 24.9v5.1c0 4-3.6 7.2-8 7.2h0.8v2.2c0 4-4.1 4.2-4.1 4.2-20 0.1-30 6.4-30 6.4s-10-6.3-30-6.4c0 0-4.1-0.3-4.1-4.2v-2.2h0.8c-4.4 0-8-3.2-8-7.2v-5.1c-5.2-6.4-8.6-15.2-8.6-24.9s3.4-18.5 8.8-24.9v-5.1c0-4 3.6-7.2 8-7.2h-0.8v-2.2c0-4 4.1-4.2 4.1-4.2 19.9-0.1 29.9-6.4 29.9-6.4s10 6.3 30 6.4c0 0 4.1 0.3 4.1 4.2v2.2h-0.8c4.4 0 8 3.2 8 7.2v5.1z","m94.6 18.3c1.8 0.1 3.6 0.2 5.4 0.2v57.4c-3.5 0.8-15.3 4.2-15.9 15.3h-7.6c-2.3 1.3-5.4 2.4-9.1 3.3-0.9 0.2-1.9 0.4-2.9 0.6 0 0-2.2 0.5-3.3 0.8-3.6 0.9-8.9 2.5-11.2 4.1-2.2-1.6-7.6-3.2-11.2-4.1-1.1-0.3-3.3-0.8-3.3-0.8-1-0.2-1.9-0.4-2.9-0.6-3.7-0.9-6.8-2-9.1-3.3h-7.6c-0.6-11.1-12.4-14.5-15.9-15.3v-57.4c1.8 0 3.6-0.1 5.4-0.2 2.9-5.3 11.8-9.2 22.4-9.2h0.4c0.1-0.3 0.2-0.6 0.2-1 0.1-1.9 1.1-2.9 2.2-2.9h8.1c2-5.2 11.3-5.2 11.3-5.2s9.3 0 11.2 5.2h8.1c1.1 0 2.2 1 2.2 2.9 0 0.3 0.1 0.6 0.2 1h0.4c10.7 0 19.6 3.9 22.5 9.2z","m100 25.5v53.9s-0.3 3.7-4 4.8l-42.4 15s-2.6 0.8-3.6 0.8-3.6-0.8-3.6-0.8l-42.4-15c-3.6-1.1-4-4.8-4-4.8v-53.9c0-1.4 1.2-2.6 2.9-2.6h4.1v-5.2c10.3-0.4 12.2-8.8 12.2-8.8h4.5c0-2.2 1.3-3.3 2.7-3.3h9.9c2.4-5.6 13.7-5.6 13.7-5.6s11.3 0 13.7 5.5h9.9c1.4 0 2.7 1.1 2.7 3.3h4.5s1.9 8.5 12.2 8.8v5.2h4.1c1.7 0.1 2.9 1.3 2.9 2.7z","m93.3 30.5c2.3 0 4.61 0.3 6.71 1v41.8c-2.1 0.6-4.41 1-6.71 1v0.1c0 3-2.61 5.4-5.71 5.4h-3.31v0.2c0 3.7-3.91 6.6-8.72 6.6-1 0-2-0.2-2.91-0.4-2.2 2.9-5.51 5.4-9.72 7.2-0.802 0.4-1.7 0.7-2.61 1 0 0-2.1 0.9-3.11 1.4-2.1 1-5.01 2.6-7.21 4.2-2.3-1.7-5.11-3.2-7.21-4.2-1-0.5-3.11-1.4-3.11-1.4-0.902-0.3-1.8-0.6-2.61-1-4.21-1.8-7.62-4.3-9.72-7.2-0.902 0.2-1.9 0.4-2.91 0.4-4.81 0-8.72-3-8.72-6.6v-0.2h-3.31c-3.11 0-5.71-2.4-5.71-5.4v-0.1c-2.3 0-4.61-0.3-6.71-1v-41.8c2.1-0.6 4.41-1 6.71-1v-0.1c0-3 2.61-5.4 5.71-5.4 0.902-13.9 17.3-25 37.5-25 20.1 0 36.6 11.1 37.7 25 3.11 0 5.71 2.4 5.71 5.4z","m95.7 52c1.1 4.6 3.2 8.8 4.3 13.4-4.9 6-14.3 5.1-21.3 8.6-3.1 1.6-5.9 4.1-9.3 4.6-1.3 0.2-2.6 0-3.8 0.3-2.2 0.5-3.9 2.3-5.5 3.9-8.1 7.9-18.1 13.8-28.9 17.2v-7.7c-1.4 1.2-2.9 2.1-4.5 2.8-0.3-3 0.1-6.1 1-8.9 0.5-1.5 1.1-2.9 1.3-4.4 0.2-2.9-1.6-5.6-3.7-7.5s-4.7-3.4-6.8-5.3c-5.5-5-8-13.4-14.8-16.5 1.2-1.8 2.2-3.8 2.8-5.9-1.6 0.3-3.2 0.8-4.7 1.6 0.9-6.2 0.3-12.5-1.8-18.3 2.4-0.4 4.8-1.4 6.8-2.8l1.6-0.3c4.9-4.9 10.2-9.4 15.8-13.5 2.4-1.7 4.9-3.4 7.6-4.5 1.9-0.8 4-1.3 6-1.9 4.8-1.5 9.3-3.9 13.4-6.9 0.4 1.3 0.7 2.5 1.1 3.8 3.7-0.6 7.4 1.4 11.1 0.9 4.1-0.5 7.9-4 11.8-2.8 0.1 1.1 0.2 2.2 0.2 3.3 2-0.3 3 2.2 3.6 4.1 2.5 7.1 9.4 11.5 14.7 16.7 1.6 1.5 3.1 3.3 3.4 5.4 0.5 2.7-1.3 5.7-4 6.5 1.4 0.2 2.8 0.4 4.2 0.6-2.7 3.7-2.7 8.9-1.6 13.5z","m96.8 69.2c0.5 4.5 0.6 9.3 3.2 12.8-2.2 1.6-4.1 3.6-5.6 5.9-0.2-0.8-0.5-1.5-0.7-2.3-0.1 1.8-1.6 3.1-3.1 3.6-1.6 0.5-3.2 0.4-4.8 0.5-2.5 0.2-5 1-7.2 2.3-2 1.2-3.8 2.9-5.8 4-2 1.2-4.4 1.9-6.6 1.1 0.1-1.3 0.1-2.5 0.2-3.8-0.9 2-3.6 2.8-5.3 1.6-0.3 0.6-0.7 1.3-1 1.9-11.4 1.9-23.1 2.2-34.5 0.8 0.2-0.7 0.5-1.3 0.7-2-4.3 3.8-10.2 4.2-15.8 4.4 1.7-1.8 2.7-4.4 2.7-7 0-3.1-1.3-6-2.4-8.9-1.9-4.4-3.2-9.1-4.2-13.8-0.8-0.7-1.8-1-2.9-1 0.6-0.6 1.2-1.2 1.8-1.7-0.7-0.5-1.2-1.2-1.5-2 1.6-5 1.6-10.4 0-15.2-0.7-2.1-1.7-4.1-2.2-6.2-1.1-4.8 0.2-9.8 1.4-14.6 0.5 0 1 0.1 1.4 0.1-0.8-1.3-1.1-3-1.5-4.5-1-5.5-2-10.9-3.1-16.3 3.5 0.2 6.9-0.1 10.3-0.7 0.5 0.6 0.9 1.2 1.4 1.7l0.2-3.2c2.7-0.9 5.3-1.8 8-2.7 2.9-1 5.9-2 9-2.3 2.5-0.2 5.2 0 7.1-1.7 0 0.4-0.1 0.7-0.1 1.1 5-1.1 10.3-0.5 15.1 1.6 0 0.6 0.1 1.1 0.1 1.7 0.9-1.3 2.6-1.5 4-1.2 1.4 0.4 2.7 1.2 4 1.9 6.3 2.8 13.5 0.2 19.9-2.2 0.5-0.2 1.1-0.4 1.6-0.2s0.9 0.9 0.6 1.4c0.9-0.2 1.8-0.4 2.8-0.7-0.1 0.4-0.2 0.9-0.3 1.3 2.3 3.3 4.5 6.7 6.7 10.2 1.3 2 2.5 4.1 3.2 6.4 0.6 2 0.9 4.2 1.1 6.3l1.2 11.1c0.3 3 0.1 6.9-2.5 7.8 0.5 0.2 1.1 0.4 1.6 0.7-1.4 0.2-2.3 1.7-2.3 3.2-0.1 1.5 0.4 2.9 0.9 4.3 1.6 4.6 2.7 9.5 3.2 14.5z","m96.3 27.7c1.2 0.1 2.4 0.1 3.7 0.2-1.2 0.9-1.6 2.6-1.9 4.2-0.599 3.1-1.1 6.2-1.7 9.3-0.599 3.3-1.2 6.6-0.999 9.9 0.2 3 0.899 5.9 1.2 8.8 0.3 3 0 6.1-1.6 8.5 0.799 0.1 1.5 0.3 2.3 0.4-0.699 1.4-1.7 2.6-2.8 3.5 2.5 1.3 2.6 4.9 2.7 7.9 0.0999 5.2 1.1 10.5 2.8 15.4-1.7-0.1-3.1 1-4.7 1.6-1.3 0.5-3.2 0.5-4-0.6-2.1 0.7-4.1 2-6.29 1.8-1.4-0.1-2.7-0.8-4.1-1.2-1.9-0.7-4-0.9-5.99-0.6-1.4 0.2-2.9 0.6-4.3 0.2-1.4-0.4-2.5-2.1-1.9-3.5-0.599 0.7-0.899 1.7-0.699 2.6-3.4-0.4-6.89 0.2-9.99 1.9-0.2-0.8-0.3-1.6-0.5-2.4-0.4 0.7-0.799 1.3-1.2 2-0.699-1.2-1.4-2.4-2.1-3.6-0.2 1.1-0.4 2.1-0.599 3.2-4.3-1.8-8.89 1.7-13.6 2-2.7 0.2-5.39-0.7-8.09-0.7-2.5 0-4.9 0.9-7.39 1.3-2.5 0.4-5.19 0.2-7.19-1.5-0.3-0.9-0.599-1.7-0.899-2.6-0.999 0.7-1.8 1.7-2.3 2.8-3.7-0.3-7.39 0-11 0.8 0.4-6 0.4-12 0-18-0.2-2.5-0.5-5.2-2.2-6.9 1.1-0.2 2.2-1 2.7-2.1-1.2-0.1-2.4-0.1-3.7-0.2 1.2-0.9 1.6-2.6 1.9-4.2 0.599-3.1 1.1-6.2 1.7-9.3 0.599-3.3 1.2-6.6 0.999-9.9-0.2-3-0.899-5.9-1.2-8.8-0.3-3 0-6.1 1.6-8.5-0.799-0.1-1.5-0.3-2.3-0.4 0.699-1.4 1.7-2.6 2.8-3.5-2.5-1.3-2.6-4.9-2.7-7.9 0.0999-5.4-0.899-10.6-2.6-15.5 1.7 0.1 3.1-1 4.7-1.6 1.3-0.5 3.1-0.5 4 0.6 2.1-0.7 4.1-2 6.29-1.8 1.4 0.1 2.7 0.8 4.1 1.2 1.9 0.7 4 0.9 5.99 0.6 1.3-0.1 2.8-0.5 4.2-0.1 1.4 0.4 2.5 2.1 1.9 3.5 0.599-0.7 0.899-1.7 0.699-2.6 3.4 0.4 6.89-0.2 9.99-1.9 0.2 0.8 0.3 1.6 0.5 2.4 0.4-0.7 0.799-1.3 1.2-2 0.599 1.2 1.3 2.4 2 3.6 0.2-1.1 0.4-2.1 0.599-3.2 4.3 1.8 8.89-1.7 13.6-2 2.7-0.2 5.39 0.7 8.09 0.7 2.5 0 4.9-0.9 7.39-1.3 2.5-0.4 5.19-0.2 7.19 1.5 0.3 0.9 0.599 1.7 0.899 2.6 0.999-0.7 1.8-1.7 2.3-2.8 3.7 0.3 7.39 0 11-0.8-0.4 6-0.4 12 0 18.1 0.2 2.5 0.5 5.2 2.2 6.9-1.1 0.1-2.1 0.9-2.7 2z","m0.0122 12.5c-0.2-2.4 2.1-4.3 4.5-4.8 0.5 0 0.901-0.0999 1.4-0.0999v-1.1c2.7-0.999 5.4-2.1 8.11-3.3 0.6 0.699 1.1 1.5 1.7 2.2-0.1-0.899-0.2-1.8-0.3-2.7 3.7-0.899 7.51-1.8 11.2-2.7 0.5 0.799 1 1.7 1.5 2.5 0-1.6 2.4-1.8 4.1-1.6 8.51 1.1 17.1 0.999 25.5-0.3 0.701 0.799 1.2 1.7 1.5 2.7 1.7-2.8 6-2.8 9.51-2.5 9.71 0.899 19.3 1.8 28.9 2.7-0.6 5.49-0.5 11.2 0.4 16.8-1 0.4-1.9 0.899-2.9 1.3 0.801 0.3 1.6 0.699 2.4 0.999-0.6 7.09-1.1 14.1-1.7 21.2-0.1 0.999-0.1 2 0.2 2.9 0.2 0.599 0.6 1.1 0.801 1.7 0.2 0.599 0.2 1.3 0.1 1.9-0.1 2.3-0.2 4.5-0.4 6.79-0.701 0.799-1.3 1.7-2 2.5 0.901 0 1.6 0.999 1.7 1.9 0 0.899-0.3 1.7-0.5 2.5-0.2 0.999-0.1 2 0 2.9 0.3 4.3 0.701 8.49 1 12.8 0.2 2.9 0.701 6.19 3.2 7.99 0.2 2.3-2.1 4.2-4.5 4.7-0.5 0.0999-0.901 0.0999-1.4 0.0999v1.1c-2.7 0.999-5.4 2.1-8.11 3.3-0.6-0.699-1.1-1.5-1.7-2.2 0.1 0.899 0.2 1.8 0.3 2.7-3.7 0.899-7.51 1.8-11.2 2.7-0.5-0.799-1-1.7-1.5-2.5 0 1.6-2.4 1.8-4.1 1.6-8.51-1.1-17.1-0.999-25.5 0.3-0.701-0.799-1.2-1.7-1.5-2.7-1.7 2.8-6 2.8-9.51 2.5-9.61-0.899-19.2-1.7-28.8-2.6 0.6-5.49 0.5-11.2-0.4-16.8 1-0.4 1.9-0.899 2.9-1.3-0.801-0.3-1.6-0.699-2.4-0.999 0.5-7.09 1.1-14.2 1.7-21.2 0.1-0.999 0.1-2-0.2-2.9-0.2-0.599-0.6-1.1-0.801-1.7-0.2-0.599-0.2-1.3-0.1-1.9 0.1-2.3 0.2-4.5 0.4-6.79 0.701-0.799 1.3-1.7 2-2.5-0.901 0-1.6-0.999-1.7-1.9 0-0.899 0.3-1.7 0.5-2.5 0.2-0.999 0.1-2 0-2.9-0.3-4.3-0.701-8.49-1-12.8-0.3-3-0.801-6.29-3.3-7.99z","m0.0295 73.1c-0.3-5.51 1.7-11 5.5-15 0.8-0.801 1.6-1.6 2.1-2.5 0.5-0.901 0.6-2 0.7-3 0.4-4 0.7-8.11 1.1-12.1 0.1-0.601 0.1-1.2 0.5-1.6 0.4-0.4 1.2-0.4 1.4 0.1-0.6-0.801-0.2-2 0.2-3 3.5-7.61 7.7-14.8 12.4-21.7 0.3 0 0.7 0 1 0.1 3.3-3.9 5-9.21 4.5-14.3 4.2 2.6 9.2 4 14.2 3.9 1.5 0 3.4 0.2 3.7 1.6 3.1 0.4 6.3 0.4 9.3 1 10.2 1.9 18.6 8.71 26.6 15.2 1.1 0.901 2.3 2.2 1.7 3.5 0.4-0.4 1-0.5 1.5-0.2v3.3c4.7-0.1 9.4 1 13.6 3.2-8.1 9.61-12.3 22.4-11.6 34.9-2.1-0.4-4.3-0.801-6.4-1.2 1.3 1.4 2.6 2.8 3.9 4.2-3 1.8-3.5 5.91-4.2 9.31-0.7 3.4-2.9 7.51-6.4 7.21-0.1 0.701 0.3 1.5 0.9 1.8-0.6 0.2-1.2 0.5-1.8 0.701 0.5 1.1 1.1 2.2 1.6 3.3-3.1 1.9-5.4 4.8-6.6 8.21-4.2-4.4-10.2-7.01-16.3-7.11 0.2-0.801 0.4-1.6 0.6-2.4l-1.7 0.801c-4.9-1.5-10-2.5-15.1-3-0.1-0.601-0.2-1.2-0.4-1.8-1.2-0.3-2.1-1-3.2-1.6-4.3-2.4-9.8-1.9-14.1-4.4-0.1-0.4-0.1-0.801-0.2-1.2-0.4 0.3-0.8 0.701-1.2 1-0.7-1.7-2.9-1.9-4.7-2.4-2.3-0.701-4.2-2.3-6.3-3.5-2-1.3-4.5-2.2-6.8-1.3z","m1.43 45.4c-0.3-0.5-0.7-0.9-1.2-1 1.6-0.9 0.9-3.5 0.999-5.4 0-1.6 0.7-3.1 1.4-4.5 2.1-4.6 4.3-9.2 6.4-13.7 0-0.6-0.0999-1.1-0.0999-1.7 0.999 0.9 2.4-0.4 3.2-1.5 4.6-6.4 12.5-9.4 17.4-15.5 0.7 0.1 1.3 0.5 1.7 1.1 0.4-1.1 1.6-1.7 2.7-1.8 1.1 0 2.3 0.4 3.4 0.6 5.7 1.2 11.9-1.9 17.2 0.7 2.9-1.8 6.4-3.4 9.6-2.4 0.7 0.2 1.4 0.5 2 0.9 5 2.5 10.1 5 14 9.1 0.9 0.9 1.7 2.2 1.4 3.4 0 0.1-0.1 0.2-0.1 0.3 1.2 0.9 2.7 1.3 4.2 1.1 0.1 0.5 0.2 1 0.2 1.6l1.1-0.5s0.6 1.1 1.2 2.1c2.3 1.4 4.3 3.2 5.9 5.3-0.2 0.4-0.4 0.9-0.7 1.3 1.1-0.4 1.9 1 2.2 2.1 1.1 4.4 1.7 9 1.7 13.5 0 2-0.1 4.1 0.6 6 0.5 1.4 1.5 2.6 2 4.1 0.5 1.5 0.2 3.4-1.2 4 0.3 0.5 0.7 0.9 1.2 1-1.6 0.9-0.9 3.5-0.999 5.4 0 1.6-0.7 3.1-1.4 4.5-2.1 4.6-4.3 9.2-6.4 13.7 0 0.6 0.1 1.1 0.1 1.7-0.999-0.9-2.4 0.4-3.2 1.5-4.6 6.4-12.5 9.4-17.4 15.5-0.7-0.1-1.3-0.5-1.7-1.1-0.4 1.1-1.6 1.7-2.7 1.8-1.1 0-2.3-0.4-3.4-0.6-5.7-1.2-11.9 1.9-17.2-0.7-2.9 1.8-6.4 3.4-9.6 2.4-0.7-0.2-1.4-0.5-2-0.9-5-2.5-10.1-5-14-9.1-0.9-0.9-1.7-2.2-1.4-3.4 0-0.1 0.1-0.2 0.1-0.3-1.2-0.9-2.7-1.3-4.2-1.1-0.1-0.5-0.2-1-0.2-1.6l-1.1 0.5s-0.6-1.1-1.2-2.1c-2.3-1.4-4.3-3.2-5.9-5.3 0.2-0.4 0.4-0.9 0.7-1.3-1.1 0.4-1.9-1-2.2-2.1-1.1-4.4-1.7-9-1.7-13.5 0-2 0.0999-4.1-0.6-6-0.5-1.4-1.5-2.6-2-4.1-0.5-1.4-0.2-3.4 1.2-4z","m95.4 51c2.1 2.9 3.7 6.4 4.6 10-1 1.1-2 2.1-3 3.2 0.3 0.6 0.5 1.2 0.8 1.8-1.4 3-4.2 3.9-6.8 4.9-5.8 2.3-11 6.3-15.2 11.8l0.3-2.4c-7.5 4.1-15.3 7.4-23.4 9.8-0.1-0.7 0.1-1.3 0.4-1.7-4.1 1.5-8.2 3-12.2 4.5-3.7 1.4-7.6 2.9-10.3 6.2 0.4-0.8 0.6-2 0.4-3.2-2.1-0.2-4-3-5.5-5.7-3.3-6-5.9-12.6-8.4-19.1-1.1-2.8-2.1-5.6-3.2-8.4-1.8-4.8-3.7-9.6-4.7-14.5-0.7-4.2-1.5-9.5-4.5-11.6l0.9-4.2-1.7 2 0.3-2.2s-0.4-1-1.7-2.3c-1.3-1.4-2.5-3.3-2.5-3.3s5.2-2.7 7.9-3.8 4.5-3.5 4.5-3.5c4.7-3.5 9.4-6.9 14.1-10.4 0.4 0.9 0.8 1.8 1.2 2.8 1.6-1.9 4-2 6.3-2.3 6.3-0.9 12.1-3.7 16.9-8.3 1.6 2.5 3.9 1.1 5.3-0.5 0.2 0.6 0.5 1.2 0.7 1.8 4.9-0.8 9.7-1.6 14.6-2.4-1.4 0.3-2.5 1.7-2.8 3.6 2.1-1.6 4.7-2.5 7.4-2.6 1.3 2.7 2.4 5.7 3 8.7 0.8 0 1.5 0.1 2.3 0.1 0 2.4 0.8 5 1.6 7.4l1.5 4.5c1.6 4.7 3.1 9.4 5.3 13.7 1.6 3.2 3.7 6.6 3.8 10 0 0.9-0.1 1.8 0.1 2.8 0.4 1.1 1.1 2 1.7 2.8z","m99.9 48.4c0.1 1.6 0.2 3.1-0.1 4.7-0.3 1.4-1.1 2.8-1.5 4.2-0.4 1.4-0.5 3.1 0.5 4.2-1.1 0.699-2.2 1.4-3.3 2.1-0.3 0.2-0.7 0.4-0.9 0.799-0.3 0.5-0.2 0.999-0.2 1.5 0.1 1.4-0.2 2.8-0.8 4.1-1.1 2.6-2.3 5.19-3.4 7.79-0.2 0.5-0.6 1.1-1.2 1.1-0.3 0.999-0.7 2-1 3h-1.3c0.1 0.999-0.8 1.9-1.8 2.4-1 0.4-2.1 0.599-3.1 0.999-3.1 1.1-5 4.2-7.4 6.49-0.4 0.4-0.9 0.799-1.4 0.699-0.4 0-0.8-0.3-1.2-0.4-1-0.3-2 0.5-2.5 1.3-0.5 0.899-0.7 1.9-1.2 2.7-2.3 3.4-8.2 1.5-11.6 3.9-0.4-0.4-0.9-0.899-1.3-1.3-2.1 0.799-4.4 1.3-6.7 1.4-0.9 0-2.3-0.4-2.1-1.3-5.1 0-10.2 0.0999-15.2 0.599-0.8 0.0999-1.6 0.0999-2.2-0.3-0.5-0.3-0.8-0.799-1.3-1.2-1.1-0.799-2.8-0.3-3.9-1.1-1-0.699-1.2-2.2-2.3-2.6-1.4-0.4-3.1 1.3-4.1 0.3-0.1-0.5-0.2-0.999-0.3-1.5-2.2-2.8-4.4-5.49-6.5-8.29-1.2-1.5-2.3-3-3.3-4.6-1.2-2.1-2-4.4-3.3-6.39-0.6-0.999-1.4-2-1.8-3.1s-0.2-2.5 0.7-3.3c-0.6-0.0999-1.2-0.3-1.5-0.799-0.2-0.3-0.2-0.599-0.2-0.899-0.2-2-0.3-4-0.5-5.99-0.1-0.899-0.1-1.7-0.2-2.6-0.1-1.8-0.3-3.7-0.4-5.49-0.1-1.4-0.2-3 0.1-4.5 0.3-1.4 1.1-2.8 1.5-4.2 0.4-1.4 0.5-3.1-0.5-4.2 1.1-0.699 2.2-1.4 3.3-2.1 0.3-0.2 0.7-0.4 0.9-0.799 0.3-0.5 0.2-0.999 0.2-1.5-0.1-1.4 0.2-2.8 0.8-4.1 1.1-2.6 2.3-5.19 3.4-7.79 0.2-0.5 0.6-1.1 1.2-1.1 0.3-0.999 0.7-2 1-3h1.3c-0.1-0.999 0.8-1.9 1.8-2.4 1-0.4 2.1-0.599 3.1-0.999 3.1-1.1 5-4.2 7.4-6.49 0.4-0.4 0.9-0.799 1.4-0.699 0.4 0 0.8 0.3 1.2 0.4 1 0.3 2-0.5 2.5-1.3 0.5-0.899 0.7-1.9 1.2-2.7 2.3-3.4 8.2-1.5 11.6-3.9l1.3 1.3c2.2-0.799 4.4-1.3 6.7-1.4 0.9 0 2.3 0.4 2.1 1.3 5.1 0 10.2-0.0999 15.2-0.599 0.8-0.0999 1.6-0.0999 2.2 0.3 0.5 0.3 0.8 0.799 1.3 1.2 1.1 0.799 2.8 0.3 3.9 1.1 1 0.699 1.2 2.2 2.3 2.6 1.4 0.4 3.1-1.3 4.1-0.3l0.3 1.5c2.2 2.8 4.4 5.49 6.5 8.29 1.2 1.5 2.3 3 3.3 4.6 1.2 2.1 2 4.4 3.3 6.39 0.6 0.999 1.4 2 1.8 3.1 0.4 1.1 0.2 2.5-0.7 3.3 0.6 0.0999 1.2 0.3 1.5 0.799 0.2 0.3 0.2 0.599 0.2 0.899 0.2 2 0.3 4 0.5 5.99 0.1 0.899 0.1 1.7 0.2 2.6 0.1 1.6 0.2 3.4 0.4 5.29z","m0.00116 75.7c0.794 0.0537 1.95-0.858 2.66 0.148 0.617 0.87 0.424 1.62 1.12 1.62 0.181 4.22 2.61-1.6 2.98 1.98 0.0294 0.286-0.998 2.08-1.07 2.24 0.239-0.53 1.7-0.122 2.03-0.13 0.695-0.0188 1.27 0.938 1.46 2.15 0.0106 0.0685 0.727 0.909 0.851 1.12 0.555 0.948-0.436 0.907 0.914 1.4 0.245-0.0013 0.491-0.0027 0.736-0.0027 0.0642-0.0362 0.0963-0.23 0.0966-0.58 1.86-0.46 3.67-0.393 5.4 0.58 2.51 1.41 4.86 2.46 7.33 4.1 6.07 4.04 12.2 4.33 18.7 5.85 3.57 0.834 8.17-0.4 12-1.11 4.13-0.76 8.34-3.88 12.5-2.25 3.08 1.2 6.23 3.67 9.46 4.56 3.03 0.84 6 4.31 9.1 1.7 0.714-0.6 1.55-1.83 2.24-2.3 0.449-0.303 1.13 0.205 1.56-0.608 0.456-0.852 0.654-2.3 1.07-3.53 0.34-1.01 1.14-0.795 1.36-1.74 0.372-1.62 0.0865-3.46 0.194-4.99-0.0355 0.503 0.221-3.28 0.191-2.69 0.061-1.2 0.481-1.82 0.412-3.21-0.112-2.27-2.02-3.95-1.85-6.65-0.22 0 0.752 0.248 0.602-0.98-0.24-1.96-1.63-2.75-2.1-3.11 0.088-2.07 0.393-0.599 0.756-1.4-0.782-3.91 2.58-2.79 2.91-2.69 0.167 0.0497 2.63-0.0752 2.55-0.957-0.0659-0.732-0.698-0.514-0.605-1.97 0.502 0 2.29 0.677 2.62-0.856-0.157-1.3-1.83-1.7-1.58-3.4 0.405-2.75 2.6 1.68 3.04-1.59 0.261-1.96-0.338-3.61-0.693-4.99-0.148-0.579-0.412-1.43-0.568-2.02-0.188-0.715-0.688-0.506-0.802-1.4 0.329-3.24 2.08 0.768 2.34-2.43-0.22-1.15-1.79-1.06-2.19-1.43-0.831-0.756-1.34-1.51-2.11-2.43-0.853-1-1.71-2.74-2.61-4.01-2.94-4.15-5.83-6.53-8.97-8.18-1.19-0.623-3.29-0.0564-4.26-4.09-0.52-2.17-0.603-5.55-1.23-7.51-0.556-1.76-1.19-2.3-1.78-3.06-2.06-2.66-4.28-2.91-6.46-3.37-2.25-0.474-4.36-1.86-6.45-2.39-5.64-1.42-10.6-4.15-16.3-4.15 0-2.92 0.419-2.48-0.315-4.09-0.344-0.756-0.747-0.444-1.18-0.584-0.465-0.15-0.624-0.474-1.12 0-0.332 0.314-0.611 0.468-0.952 0.584-0.438 0.149-0.843 0.768-1.46 0.591-0.691-0.197-1.14-0.0537-2.03-0.00537-2.05 0.11-3.94-0.699-6.17-0.585-1.36 0.0711-2.58 1.75-3.87 3.24-0.536 0.626-0.966 1.54-1.51 2.02-0.656 0.577-1.01 1.28-1.51 2.19-2.16 3.91-5.25 0.153-7.65 0.153-2.13 0-4.15 0.0738-6.17 1.17-1.44 0.777-2.75 1.93-4.13 3.21-0.51 0.471-1.11 0.98-1.58 2.05-0.12 0.274-0.503 0.129-0.591 0.881-0.324 2.74 0.255 1.98 0.562 2.93-2.86e-4 1.58-2 4.52-2.18 4.96-0.445 1.06-1.32 3.54-1.81 5.47 0.0436 1.82 1.06 0.149 1.37 0.76 0.614 1.2-0.197 2.12-0.113 2.81 0.113 0.929 0.445-0.132 0.606 0.66-0.434 2.04-1.49 1.28-1.72 3.36-0.0386 0.357 0.957 0.949 0.961 0.969 0.46 2.4-0.261 2.01-0.266 2.93-0.0151 2.49-0.298 1.17 0.405 1.17 0.353 0 3.5-1.66 3.68-0.0564 0.379 3.24-1.06 4.04-1.52 4.45-0.824 0.74-1.27 1.01-1.97 1.97-0.541 0.74-0.69 1.63-1.07 2.79-0.399 1.21-1.3 1.84-1.6 3.29-0.191 0.94 1.23-0.168 1.35-0.168 0 2.7-1.61 3.82-1.6 3.9 0.152 1.15 0.18 2.76-0.0223 4.6-0.384 3.48-0.785 1.83-1.47 3.78-0.915 2.6 0.0226 2.84-0.0274 5.46-0.0194 1.01-0.813 3.89-0.915 3.88 0.33 0.0215-0.0241-0.0013 0 0","m100 7.43c-0.651-5.63-2.08-5.19-3.24-5.89-2.07-1.25-4.59-1.75-6.56-1.01-2.2 0.822-5.24 1.38-7.41 0.999-3.69-0.639-7.04 1.32-10.9 1.38-3.25 0.0474-6.06-1.07-9.76-2.14-8.09-2.34-16.4 1.23-24.6 3.52-9.76 2.72-19.7 7.64-29.6 9.64-1.23 0.25-5.05-2.64-5.32 5.82-0.184 5.87 0.561 0.52 1.16 4.5 0.662 4.42-0.517 4.54-0.962 5.53-1.76 3.9 0.133 11.4-1.42 14.8-0.612 1.32-1.42 0.566-1.39 5.69 0.021 3.28 0.782 2.97 0.782 5.67-0.291-0.757-0.502-0.624-0.635 0.402 0.251 1.36 0.511 1.32 0.787 1.95 0.243 0.55 0.655 0.493 0.892 1.09 0.373 0.945 0.466 2.51 0.844 3.41 1.07 2.54 2.22 1.6 3.19 4.85 0.154 0.517 0.402 0.446 0.53 1.05 0.298 1.4 0.195 3.11 0.602 4.42 0.621 2 1.68-0.432 2.26 1.43 0.316 1.01 0.331 3.82 0.528 5.24 0.262 1.89 0.629 3.64 1.02 5.09 1.41 5.25 3.3 7.68 5.04 7.59 0.756-0.0395 1.9-0.139 2.68 1.36 0.384 0.74 0.793 1.99 1.23 2.74 1.85 3.17 3.87 3.46 6.01 3.46 1.94-0.0032 3.84-0.588 5.62-3.17 1.17-1.71 2.49-3.92 3.8-4.4 3.83-1.39 7.85-2.01 11.7-0.694 1.23 0.422 2.51-0.463 3.67 0.678 0.641 0.629 1.18 1.73 1.85 2.15 1.84 1.18 3.59 0.267 5.27-1.45 2.87-2.95 6.19-3.79 9.05-5.47 1.51-0.885 3.27 1.87 4.96 1.27 1.62-0.575 3.61-1.58 5.33-2.68 1.39-0.888 2.64-2.79 3.99-4.13 0.787-0.783 2.88-2.24 3.24-6.43-0.024 0.283-0.611-0.939-0.618-2.33-0.044 0.098 0.846-1.58 0.844-1.58 0.888-0.727 1.28-0.636 1.84-2.74 0.628-2.37 0.484-3.14 1.35-4.13 0.286-0.326 2.23-0.977 2.33-1.86 0.301-2.7-1.03-2.65-1.16-3.29 0.258-2.1 2.48-1.7 0.91-3.81-0.39-0.52-1.03-0.648-1.5-0.675-0.13-0.0079-1.17 1.37-1.3 0.667-0.629-3.22 0.665-3.06 0.774-4.13 0.323-3.15-0.292-4.5-0.0602-6.19 0.192-1.4 1.39-0.498 1.74-0.689 0.723-0.383 3.74 1.08 4.23-2.98 0.0784-0.65-2.48-1.74-2.78-1.84-1.32-0.446-2.83-0.953-4.11-2.06 0.0563-0.759 0.477-2.36 0.583-2.76 0.921-3.48 0.296-0.0237 1.16-0.715 0.218-0.174 0.645-1.27 0.865-1.48 0.0739-0.0711 0.637 0.0016 0.58 0.0427 0.664-0.47 1.25-0.688 1.45-3.33 0.192-2.56-0.386-4.71 0.318-6.92 0.197-0.62 0.795-0.413 0.875-0.683 0.226-0.771 0.311-2.67 0.445-3.19 0.434-1.68 0.948-4.87 1.61-5.76 1.06-1.42 5.42 1.08 5.42-5.81-0.0482-0.419 0 0.161 0 0","m99.8 53.3c-0.222-0.982-0.895-2-1.24-2.87-0.525-1.31-1.29-0.933-1.64-2.44 0.694-2.46 0.261-4.17-0.359-5.33-0.468-0.879-1.03-0.394-1.51-1.15-0.357-0.564-0.291-1.79-0.667-2.33-0.409-0.58-2.02-0.415-2.14-2.28-0.153-2.47 1.58-0.537 1.8-1.87 0.458-2.77-2.47-4.29-2.74-4.49-0.839-0.633-1.81-0.889-2.65-1.69-0.266-0.254-0.474-3.08-0.84-1.47 0.0506 0.58 0.521 1.49 0.0823 2.03-0.119 0.148-1.45-0.529-1.55-1.14-0.658-3.83 1.4-2.91 1.59-3.72-0.515-1.76-0.969-0.0568-1.32-0.542-0.525-0.727-1.07-2.89-1.6-3.8-1.33-2.31-2.82-2.93-4.34-4.73-1.07-1.26-2.92-3.32-4.08-3.61-0.178-0.0449-0.744 0.978-0.846 0.923-0.155-0.0872-0.399-1.6-0.502-1.69-0.91-0.842-1.98-0.533-2.74-0.57-3.36-0.165-7.59-3.2-10.8-4.7-1.4-0.645-2.38-2.73-3.94-2.74-0.945-0.00793-1.42-1.72-2.51-1.29 0.137-0.0529-0.391 0.595-0.261 0.576-0.581 0.0846-1.03-0.905-1.64-1.18-0.539-0.247-1.66-1.45-2.22-1.08-0.463 0.299-0.293 2.06-0.969 2.27-0.198 0.0608-0.0637-1.16-0.231-1.29-0.277-0.213-0.676-0.345-1.03-0.337-0.202 0.00529-1.18 0.0806-1.37 0.234-6e-3 0.00529-0.523 1.1-0.463 1.09-0.504 0.131-1.43-0.387-2.21 0.221-0.276 0.217-0.447 1.2-0.76 1.22-0.267 0.0172-0.371-1.42-1.11-1.14-0.446 0.173-1.61 0.597-2.02 1.15-0.53 0.708-0.251 1.85-0.845 2.3 0.163-0.124-1.07-1.08-1.11-1.08-1.11-0.156-2.29 1.98-3.45 1.94-3.43-0.13-7.31-1.43-11-1.43-3.81-0.00529-7.57-0.776-11.1 4.62-1.58 2.42-2.7 7.8-3.59 14.1-0.674 4.77-1.51 6.14-2.69 8.35-1.21 2.29-2.44 4.54-3.43 8.04-0.237 0.833-0.178 2.94-0.391 3.45-0.342 0.831-0.921-0.0753-1.25 1.19-0.9 3.49 0.334 4.96 0.334 8.6-1.23 0-2.06 4.43-2.35 8.95-0.348 5.51 0.0015 7.11 0.391 11.8 0.48 5.75 0.197 10.7 1.99 9.21 0.259-0.211 0.577-1.04 0.75-1.15 1.03-0.645 1.28 1.5 2.19 1.39 1.67-0.21 3.55 1.13 5.29 0.866 0.465-0.07 1.01-0.152 1.59-0.529 0.935-0.604 1.04-0.0476 1.95-0.0013 1.01 0.0502 2.05-0.703 3.12-1.15 0.525-0.219 0.377-1.12 1.07 1.85 0.312 1.35 0.795 4.22 1.13 4.95 1.28 2.83 3.7 0.615 4.95 0.601 2.27-0.0251 4.41-0.519 6.6-1.07 4.14-1.05 7.82 2.27 11.7 5.16 7.2 5.42 15.2 6.73 22.2 4.62 2.2-0.662 4.52-0.765 6.68-1.73 0.374-0.168 0.922 0.176 1.17-0.555 0.285-0.83 0.0248-2.91 0.483-3.36 0.237-0.234 0.38 2.55 0.34 2.49 0.289 0.386 0.559 0.531 0.906 0.843 0.439 0.395 1.52 0.533 1.82-0.575 0.295-1.07 0.0634-4.08 0.274-4.94 0.723-2.96 0.749 1.29 0.899 2.06 0.231 1.19-0.717 6.43 1.24 3.45-0.0542 0.0833 0.936-1 0.586-1-0.102 0.0013 0.0368-1.3 0.194-1.24 0.0703 0.0238 0.626 1.96 0.804 2.19 0.32 0.414 1.43 0.514 1.74-0.225 0.641-1.55 0.382-3.17-0.261-3.17 0-7 0.472 1.02 0.652-3.17 0.122-2.85-0.465-1.27-0.261-4.18 0.275-3.93 1.14-3.1 1.3 0.447 0.0431 0.956-0.688 8.19-0.315 9.78 0.245 1.05 2.91 0.379 3.2-0.806 0.519-2.11-0.047-4.61 0.434-6.15-0.191 0.608 0.924 1.41 0.952 1.4 0.323-0.141 0.514-1.34 0.855-1.83 0.163-0.233 0.644-0.233 0.863-0.406 0.0838-0.0661 0.111-1.22 0.201-1.39 0.328 1.31 1.56-0.0952 1.95-1.17 0.394-1.09 0.311-3.01 0.782-4.6 0.317-1.07 0.976-0.829 1.37-1.17 0.387-0.33 1.48-1.45 1.69-2.57 0.902-4.65-1.65-1.13-0.458-6.64 0.539-2.49 1.11-1.13 1.55-1.46 0.102-0.074 0.737-1.9 0.987-1.99 0.349-0.115 1.65 1.93 1.3-2.06-0.447-5.15-5.27-0.843-4.06-11.4 0.0844-0.732-0.581-1.11-0.626-1.24 0.0087-0.0793 0.53-2.4 0.518-2.37 1.12-2.61 0.42-0.43 0.782 1.77 0.223 1.36-0.268 2.09 0.391 2.31 0.0583 0.0198 0.622 0.141 0.759-1.05 0.0464-0.403-0.513-1.73-0.0634-3.17 0.0906-0.289 0.308 0.572 0.477 0.48 0.239-0.13 0.742 0.634 0.977 1.44 0.351 1.2 0.488 2.54 0.912 3.17 0.327 0.48 1.43 0.552 0.849-2.03","m100 70.7c-2.05 0-4.47 0.583-6.74 0.583 0-1.06 0.507-2.47 0.691-3.05 0.278-0.868 0.751-0.65 1.1-3.23 0.106-0.793-0.298-1.88 6.31e-4 -3.3 0.178-0.848 0.477-1.02 0.616-1.51 0.178-0.619 1.88-4.67 0.484-4.67 0.0935-2.19 1.85-1 1.79-3.05-0.0199-0.669-4.63-1.03-5.09-1.03 0-2.4 1.23 0.0067 1.38-1.17 0.198-1.55-1.84-1.14-2.06-1.95 0.197-2.48 0.21 0.257-0.149-2.51 1.22-4.87 2.85-2.24 4.26-5.72-0.437-1.63-1.96 0.699-2.52 0.844-1.01 0.263-3.25 1.45-3.93-1.45 0.341-1.51 2.38-0.835 2.45-1.67 0.173-1.94-2.49 0.438-2.59-2.13 0.214 0.276 0.347-1.78 0.195-2.33 0.187 0.677-1.11 0.0415-1.02-1.17 0.222 0.415 0.361 0.224 0.417-0.575 0.0032-1.22-1.49-1.76-1.65-1.76 0-3.02 3.1-4.72 3.56-4.96 0.847-0.457 1.96-1.24 2.76-1.46 0.385-0.103 0.961-0.513 1.24-0.583 0.507-0.129 0.96 0.197 1.39-0.462 0.238-0.363-0.0464-1.29-0.154-1.29 0-0.69 1.19-3.27 1.38-3.5 0.583-0.717 1.61 0.536 2.05-1.42-0.231-1.12-2.6-0.844-2.98-0.915-1.03-0.198-1.96-0.0737-2.9-0.584-1.78-0.958-3.47-1.18-5.24-2.33-2.94-1.91-5.92-4.57-9.01-5.84-3.49-1.43-7.1-2.5-10.6-3.36-3.93-0.955-8.13-2.83-12.2-3.06-5.69-0.319-11.1 0.304-16.6 0.581-3.54 0.18-7.63-0.19-11.1 1.75-6.74 3.72-13.8 3.03-20.6 8.16-1.03 0.785-6.54 6.35-4.41 12.3 0.323 0.894 0.957 0.67 1.18 1.46 0.164 0.592 0.653 4.39 0.622 5.54-0.0515 1.88 0.235 0.908-0.162 2.92-0.104 0.527-0.92-0.596-1.01 0-0.355 2.33 1.09 1.17 1.38 1.17 0 2.75-1.41 0.604-1.63 2.54-0.0281 0.253 3.11-1.18 2.81 2.48-0.174 2.15-1.44-1.28-1.71 1.01-0.042 0.351 1.37 1.12 1.49 0.974-0.0164 0.435-2.6 1.17-2.89 1.17-0.0591 0.839 0.425 1.5 0.553 1.95-0.0733 3.26-1.97-1.13-1.35 3.89 0.429 3.44 1.44 1.54 2.03 3.22-0.466 2.72-0.449 0.758-0.358 4.36 0.0426 1.68 0.826 0.379 0.131 2.93-0.331 1.21-1.79 1.21-2.32 1.16-0.837-0.0831-1.74-1.01-2.41 0.86-0.0983 0.275-0.437 1.73-0.478 2.06-0.0822 0.683-0.0551 4.04 0.136 4.66 0.265 0.87 0.81-0.186 1.03 0.583 0.541 1.88-0.039 3.51 0.213 5.25 0.131 0.906 0.861 3.81 1.02 4.67 0.125 0.651 0.453 1.91 0.626 2.97 0.238 1.46 0.149 2.49 0.453 3.64 0.538 2.03 1.36 2.26 1.95 4.22 0.445 1.48 0.55 2.45 1.08 4.05 0.662 2-0.197 2.02 1.07 2.53-6e-3 -0.0027 0.195-1.08 0.231-1.06 0.559 0.212 3.32 2.34 3.26 2.61 0.155 0.892 0.545 0.0603 0.545-0.868 0.676 0 1.29 1.43 1.99 1.75 0.307 0.142 0.547-0.367 0.973 0.591 0.194-0.938 1.37 0.549 1.71 0.573 0.666 0.0469 2.56 1.51 3.07-0.482-0.758 2.95 1.86 1.32 1.74 1.35 0.549-0.161 2.53-1.01 2.67 0.311 0.365-1.47 2.73-1.46 3.31-1.76 0.889-0.457 1.8-0.135 2.48-0.587 1.19-0.792 2.3 0.0335 3.3 0.583 0.626 0.346 2.18 0.36 2.63-0.683 0.648-1.48 0.0287-0.238 0.737 0.1 0.689 0.328 0.977 0.0188 1.55-0.106 1.88-0.407 4.11-0.421 5.81-0.478 2.13-0.071 4.71 0.647 6.88 0.584 1.07-0.0322 1.83-0.41 2.81 0 1.04 0.433 2.14-0.644 3.13-0.584 5.39 0.33 10.9 0.381 16.8-0.587 2.62-0.427 6.2-0.0094 8.72-0.0107 0.85 0 8.17 1.09 8.17 0.0147 0-0.486-1.84-1.2-1.95-1.17-0.326 0.0804-0.779 0.439-1.41 0.0871-0.554-0.312-1.19-0.411-1.74-0.382-0.263 0.0147-0.815 0.494-1.16 0.296-0.233-0.135-0.509-0.922-0.673-1.07-0.243-0.221-0.278 1.36-0.504 1.07 0.0322-0.528-0.0136-0.916-0.138-1.17 0.103-2.21 5.93-0.615 6.33-0.583 0.311 0.0241 0.637-0.506 1.01-0.513 0.649-0.0121 0.9-0.0027 1.6 0.21 1.37 0.417 2.85 0.0322 4.46-0.281 0.237-0.0456 4.69-4.83 3.85-7.59h-1.03c0-1.62 1.2-14.6 1.1-14.6","m99.8 27.2c-0.424-0.0797-0.901-1.76-1.28-1.76-0.0254-0.33 0.808-0.982 0.404-2.11-0.397-1.11-1.84-0.423-2.35-0.769-0.287-0.195-2.4-1.19-2.38-2.05 0.119-4.51 4.61 0.485 5.05-1.76-0.514-2.13-1.48-1.4-2.22-1.4 0-2.22-0.403-0.361-0.741-1.46 0.108-0.187 0.156-0.47 0.143-0.849-2.96 0-5.81-0.985-8.67-2.31-1.33-0.613-1.89-5.22-3.39-6.39-3.09-2.42-6.15-4.62-8.99-5.32-1.56-0.383-3.24-1.37-4.67-0.994-1.83 0.485-4.04 1.03-6.09 0.575-1.37-0.306-2.96 0.595-4.48 0.692-1.35 0.0849-3.17 0.0782-4.62 1.57-0.657-2.53-1.6-0.296-2.15-0.236-1.02 0.111-1.63-0.305-2.63 0.245-1.36 0.752-3.14-0.602-4.48 0.0265-2.85 1.33-5.73-0.886-8.82 0.172-0.96 0.327-2.28 1.17-3.65 1.57-0.969 0.286-1.54 0.786-2.34 1.18-0.906 0.448-1.86 0.774-2.76 1.42-6.35 4.57-12.9 0.22-19.3 2.04-1.44 0.407-2.84 0.504-4.23 1.13-0.909 0.408-2.44 0.445-3.27 2.03-1.68 3.19 0.00137 6.81 0.649 10.4-0.0999 0.356-0.431 1.02-0.45 1.5-0.127 3.19 0.348 0.693-0.247 2.84-0.813 2.94-1.29 0.578-0.799 6.14 0.057 0.644 0.623 4.2 0.568 5-0.0522 0.753-0.505 1.81-0.488 1.57-0.0302 0.448-0.346 0.577-0.379 0.847-0.221 1.82 0.364 2.24 0.443 3.53 0.163 2.64 0.143 2.63 0.304 4.58 0.0288 0.353 0.521 5.02 0.47 4.67 0.123 0.836 0.735 3.34 0.73 4.02-0.0203 2.57 0.0831 0.391-0.542 0.79-0.572 0.365-1.49-2.76-1.98-0.338-0.417 2.06 0.251 3.04 0.422 4.38 0.247 1.94 0.716 4.08 0.749 6.3 0.0079 0.501-0.509 3.08-0.445 4.13 0.113 1.86 0.653 2.33 0.957 3.38 1.27 4.37 2.27 6.22 3.94 7.01 0.985 0.467 2.03 0.865 2.98 1.8 0.335 0.33 0.0755 1.96 0.419 2.24 0.185 0.155 1.84 0.0529 1.96 0 0.973-0.473 1.68-0.429 3.02 0 0.721 0.23 1.76 1.53 2.52 1.74 1.07 0.286 2.79-0.28 4.1-0.0066 0.216 0.0451 0.91-0.214 1.09 0-0.0436-0.0528 0.766 1.35 0.56 1.45-0.232 0.112 1.25 0.115 0.593-0.831 0.443 0.642 0.0642-0.735 0.666 2.29 0.268-0.352 0.396-0.936 0.384-1.75 0.223-0.0663 0.658 2.37 1.01 2.31 0.663-0.111 1.17-6.31 2.14-2.55-0.36 1.22-0.833 1.77-0.453 3.71 0.117 0.601 1.43-0.676 1.64-0.576 1.24 0.585 1.59 5.08 1.72-0.383 0.0199-0.836-0.982-0.239-0.272-2.02 0.525-1.32 0.395-0.719 0.799 1.12 0.569 2.59 0.118 2.87 0.848 3.49 0.0663 0.057 0.949-0.649 1.25-0.472-0.0052-0.0025 0.26 2.24 0.413 2.31 0.188 0.0918 0.629-1.18 0.783-1.73 0.286-1.02-0.0464-4.08 0.449-2.6 0.0965 0.289-0.0481 2.58-0.125 2.22 0.0797 0.38 0.0563 2.5 0.125 2.69h0.965c0.232-1.6 0.458-1.5 0.678 0.298 0.405 0.108 0.552 1.13 1.05-0.559-0.147-1.06-0.854-3.78 0.148-3.78 0.136 2.1-0.369 1.94 0.338 4.04 0.393 1.17 0.889 2.45 1.37 0.66 0.498 1.41 0.217 1.33 0.801 0.727 0.142-0.147 0.75-2.14 0.931-1.97 0 4.1 2.17 2.04 2.54 2.01 0.249-0.0162 1.56 0.803 2.32 0.874 2.12 0.195 4.63-1.38 6.58-1.76 4.35-0.857 8.64-4.07 12.7-8.08 2.22-2.2 4.46-2.95 6.75-4.69 0.975-0.738 2.14-1.78 3.19-2.22 1.01-0.425 2.19-0.238 3.16-1.46 0.674-0.85 1.01-2.23 1.63-2.59 0.341-0.196 0.247-0.028 0.559-0.578 0.325-0.573 0.145 1.83 0.712 0.569 0.217-0.484-0.0793-2.04 0.186-2.38 1.11-1.43 2.27-2.56 3.33-3.39 1.89-1.47 3.37-1.6 4.87-3.95 0.511-0.795 1.15 0.0663 1.88-0.682 0.08-0.0807 0.778-1.77 0.794-1.83 0.236-0.955-0.325-1.44-0.19-2.05 0.323-1.46 0.823-1.7 1.16 0.121-0.147 0.336-0.196 0.819-0.146 1.45 1.8 0 0.349-0.581 0.475-1.54 0.399-3.04 1.5 2.23 0.921-3.07-0.0776-0.707-0.819 0.336-0.798-1.16 0.023-1.57 0.87-1.57 0.875-1.52-3.43e-4 -0.0016-0.379-0.86-0.426-0.789-0.0367 0.0554 0.6-0.859 0.748-1.15-0.0295 0.0597 0.538 0.578 0.509 0.578 0.531-1.15-0.379-1.15-0.359-1.15 0-5.03 0.0604-0.135 0.443-2.61-1.07-4.54 2.74-1.35 2.55-3.74 0.0384-0.735-1.46-1.12-1.58-1.17-0.464-0.222-1.29 0.0766-1.71-0.561-0.331-0.501-0.167-2.18-0.434-2.89-0.167-0.444-0.764-0.573-0.912-0.573-0.0494-0.639 3.26-3.61 3.74-6.35 0.528-3.01-0.161-1.63-0.0978-2.89 0.133-2.63 0.383-0.765 0.981-3.13-0.197-0.795-0.733 0.349-0.733-1.49 0.699 0 0.584-2.56 1.02-3.23 0.346-0.529 1.93 0.978 2.11 0.028-0.07-0.271-0.14-0.542-0.21-0.814-0.0488-0.0082 0.07 0.272 0 0","m56.2 0.033c-6.56 0.319-13 1.11-19.5 2.25-5.03 0.299-9.75 2.39-14.7 3.09-4.09 0.76-8.61 0.178-13 1.04-1.22-2.13-2.78-8.81-5.88-3.41-0.677 4.57-2.49 8.64-2.05 13.3-0.451 9.45-1.52 18.9-1.1 28.4 0.228 7.65 0.318 15.3 0.623 22.9 0.363 4.12 0.337 8.49 1.06 12.4-0.0369 4.8 0.938 9.31 1.75 13.9 0.288 2.65 2.83 8.99 4.56 3.44 2.76-1.65 1.7-5.79 4.37-7.23 0.56-4.09 3.84-0.429 6.06-2.14 2.53 2.05 2.02-5.08 3.28-0.435 2.17-1.26 5.36-3.26 7.12-3.59 1.78-0.77 1.23 0.454 1.6-0.802 0.711 1.66 3.54 1.4 3.93 3.88-0.111-6.19 3.06 3.77 6.73 0.248 3.28 3.78 3.05-3.14 3.7-2.48 3.85-1.51 1.84-6.81 4.16-8.85 0.721 2.38 3.3 3 4.14 0.157 0.731 6.1 3.22-5.43 4.25 0.361 1.78-0.333 2.99 3.12 4.79 0.705 1.9 2.58 5.1 0.637 6.91 2.42 0.591-2.83 0.996 2.83 1.58 0.163-0.0621 3.73 3.64 3.93 3.73-0.178 0.303 1.65 0.703 4.36 1.63 1.21 1.47 3.36 3.43-1.4 3.28 3 1.25 1.4 1.13 2.21 2.44 1.29 1.48 0.725 0.975 1.98 1.91 0.0674 0.336 0.999 0.806-1.03 1.94 0.968 1.41-1.29 1.98 0.987 3.4-1.59 1.13 1.5 2.08 3.72 2.1 2.14 2.22 2.55 2.52-4.81 3.06-6.76 2.32-2.21 0.624-5.66 0.466-8.57 0.17-1.77 1.25-3.32 1.08-5.19 0.619-0.635 1.08 1.06 1.04-1.83 0.513-1.47-0.667-3.65 1.21-5.57-0.537-2.93-0.601-7.87 0.796-7.23-0.682-1.42-1.9-2.1-0.372-3.44 0.642-1.35-0.373-3.97 1.42-3.17-0.289-4.17 0.257-7.83 0.167-12-0.456-4.06-0.163-7.74-0.734-12.1-0.691-3.19 2.33-8.31-1.81-10.1-2.59-1.64-7.45-4.76-8.93-4.68-4.01-0.18-9.63-4.07-12.9-2.21-2-3.23-7.51-1.74-10.9-3.1-2.82-0.278-5.66-0.531-8.49-0.64","m99.9 59.9c-0.429-4.47-0.0208-8.78-1.82-12.8-3.51-4.83 4.14-9.21 0.0086-14.4-2-3.02 3.77-5.44 0.34-7.9 0.494-0.405 0.665-4.2-1.1-3.48-0.446-2.97-4.58-1.1-3.65-5.85-0.691-3.24-2.44-6.98-4.15-7.98-2.1-1.3-2.98-0.0809-5.09 0.394-1.55 1.89-3.26 2.22-5.16 1.69-1.63-0.518-3.75 0.667-4.78 0.566-2.67-0.49-4.87-0.175-7.08 2.25-3.03-0.327-2.67-8.46-6.19-9.93-1.97-3.78-5.31-2.72-7.74-0.973-2.85 0.63-4.4 4.33-6.57 5.6 0.531 2.94-2.6 2.41-1.63 5.27-0.697 1.57-1.07 3.8-2.57 4.01-0.43 0.445-2.1 2.7-2.5 3.19-1.28 0.245-3.51 1.67-3.47 0.213 1.15-1.07-2.13-0.0342-1.28 0.685-1.64-2.25-2.77-3.92-3.85-4.75-0.204 1.99-3.21-1.12-2.73-3.03-0.394-2.08-1.98-0.629-2.93-2.09-1.85 0.617-2.35-2.39-4.13-2.2-2.29-2.49-0.997 2.36-2.6 0.848-3.69-1.58 3.2-0.901-0.826-1.9-1.39-0.0212-2.12-2.89-2.41-1.48 1.28 1.14 0.165 2 1.64 2.31 0.995 3.29-2.34-0.449-3.55-1.63-0.874-0.598 2.09-0.28-0.0556-1.22-2.17 0.249-5.21-2.49-6.77-1.79-0.53-0.149-1.73 2.25-2.9 2.83-1.8 0.753-2.27 4.57-2.74 6.74 1.07 0.208-2.14 2.69-0.139 3.32-1.68 0.0341-1.04 6.3-1.46 8.25 0.00219 2.17-0.114 4.42 0.225 6.19 0.677 2.54 1.3 3.07 2.59 5.42 1.55 3.05 5.97 1.74 8.6 2.5 0.0223-1.58-3.25-0.0475-4.74-2.5-0.0458-0.298 0.105-1.68-0.224-2.45 1.45 0.536 4.37 0.187 0.951-0.121-1.61-0.444 0.726-1.06 0.343-2.19 2.84 0.364-1.46-3.11 1.41-1.01 0.239-0.745 2.54 0.93 2.45-0.0821-1.93-3.05 2.42 2.4 1.49 0.0405 0.337-1.54 2.62-0.292 3.67-0.272 1.85 0.0829 2.43 0.202 3.98 0.76-0.0615 0.618 4.33 1.47 0.663 3.43-3.07 1.17-5.25 3.19-8.23 5.11-2.81 2.09-5.65 5.13-6.71 9.26-1.05 4.27-3.19 8.41-2.01 12.5-0.482 2.44 1.32 4.39-0.938 5.97-2.67 3.49 3.93 6.97 1.12 8.63-0.752-0.662-2.34 4.31-3.1 6.72-0.875 0.844-0.966 4.32-1.08 6.66-0.522 3.04 1.13 6.87 1.43 6.14-0.344 2.44 1.89 3.56 2.78 4.37 2.95 0.334 5.14-0.012 7.96-0.3 1.02-0.116 7.99-0.679 4.58-1.12-1.9 0.568-2.99 0.0635-5.06 0.801-1.98-0.0719-4.46 0.428-6.1-0.464-0.796 0.74-1.37-4.01-0.198-2.79 2.25 1.83-1.25-2.48 1.87-1.7 2.83-1.14 4.91 0.361 7.29-1.18 1.92-0.779 1.23 2.38 3.34 1.57 1.86-1.03 4.08-0.352 5.76-1.37 1.4 1.48-2.71 1.81-1.91 2.31-0.927 1.28 1.61-0.304 1.95-0.506 1.23-0.0631 3.46 0.0403 1.56 1.08-1.62-0.0129-2.25 0.632-3 1.03 2.68 0.946 7.52-1.75 10.8-3.01 2.65-1.18 5.1-3.02 7.15-5.06 2.36-5.25 5.56-0.448 8.86-0.121 1.37-1.21 2.66-1.1 4.4-1.55 0.0892-2.14 2.74-0.396 2.11-0.787-0.0946-1.83 0.691-1.11 1.92-1.52 2.09-0.0898 4.48 1.08 6.41 2.77 0.362-1.34 0.846 2.11 1.13-0.268 0.968 1.25 3.49 3.2 3.65 5.21 1.01-1.45 3.64 1.9 4.08-0.694-0.271-2.53 0.909-6.22 1.15-8.6-0.134-3.46-0.858-9.05-2.99-11.5 0.199-4.15-5.82-5.99-4.68-8.3 1.36 0.976 6.53 3.06 6.34 2.09-2.25-1.37 2.82 0.187 3.62-0.395 2.17 0.514 2.34-0.687 4.81 0.371 2.47-0.21 3.34 0.831 5.7-0.0719 1.08 0.698 2.23-0.448 3.18 1.26 3.06 0.249 2.31 4.17 5.36 0.16 1.82 0.597 1-1.72 2.12-2.56 0.35-0.647 1.28-2.82 1.43-2.46 0.562-0.194 0.836-1.5 0.614-2.24","m99.8 79.3c-1.23 1.28-2.8 1.6-2.71-2.33-0.874 2.34-1.77-2.61-0.384-1.35-0.913-2.54-2.97-0.585-1.54 1.35-0.496-1.88-4.34-1.08-1.8-3.3-0.392-2.5 2.06-5.51 0.458-7.36 2.23 0.0233-1.16-3.53 1.66-3.13 0.976-4.27 1.61-7.65 2.54-10.9-0.918-1.03 0.492-4.21-0.889-3.83 1.26-2.54-1.66-1.5-0.197-4.16-0.239-4.15-0.939-7.77-1.87-11.8-1.58-7.17-5.22-10.5-8.2-15.2-1.74-2.23-5.4-4.65-6.26-5.48-0.845-1.88-2.96-1.74-4.16-3.92-0.963-1.67 1.65 3.7-0.523 0.815-1.12-2.24-2.85 1.85-2.98-2.14-1.31-1.61-4.23-3.32-5.55-1.8-1.35-3.46-3.65-0.563-5.08-2.75-1.37 0.15-1.43 0.812-3.27 0.0912-0.8-0.479-3.38-4.46-3.03 0.259-1.56 0.0992-2.49-3.03-3.33 0.506-1.32-0.386-2.76-2.34-3.8-2.61 1.48-0.779-3.9 0.356-0.338 0.951-1.41 0.994-2.97-2.17-1.86 1.46-1.74 0.622-5.09-1.66-2.91-1.2-1.4-2.06-1.98 1.32-3.26-1.26-0.679-0.164 0.482 2.12-1.26-0.0521-0.111 2.63 3.46 2.95 1.05 3.72-0.366 2.68-2.17-7.37-2.62-1.92 3.35 5.38-5.4 2.82-0.71 2.85 1.03-0.871-0.364-0.422 0.205-1.98-1.71 1.42-3.3 1.78-3.02-0.928-0.314 0.993-2.58-0.631-3.25 1.06-1.36-1.31-3.83-0.359-4.09 1.87 0.109 2.08-4.2 1.16-1.38 1.87-0.768 3.09-2.3 0.448-2.59 1.81-0.0473-3.64-2.18-2.31-0.257-0.0301-0.4 2.61 0.264 4.08-1.29 1.17-1.11 1.41-3.49-1.06-3.28 2.56-1.32 0.226-2.8-2.86-3.12 2.33-0.132-5.07-1.49 0.898-3.15-1.67-1.97 1.34-0.959 5.64-2.79 3.3-1.45 1.59-2.56 2.9-0.0603 1.39 0.498 3.59 3.38-2.18 1.75 1.61-1.73 0.89-3.63-0.669-4.79-0.0128-0.534 1.76 0.746 0.52-1.52 2.29-1.55 2.33-0.801 3.98-2.57 5.16 1.49 2.66 0.664 1.18 1.96 0.066 0.434 2.2-0.976 5.15-0.955 2.48-3.51-4.16 1.35 4.45-2.06 2.94-0.618 1.66 1.58-0.0786 0.436 2.27-1.8 4.07-1.17 9.35-0.621 14 0.402 2.92-0.0393 3.11 0.497 3.64-0.331 2.66 0.431 3.91 0.22 6.05 0.719 0.111-1.02 2.41 0.871 4.3-0.0436 3.58 0.613 6.96 2.21 9.59 2.35 1.7 3.41 4.1 5.51 4.43 1.39 5.72 5.4 7.3 8.07 10.4 2.82 3.17 6.86 4.01 9.36 6.34 1.84 0.142 3.4 1.4 4.74 1.79 1.58 0.552 2.87-0.366 2.07 1.17 2.6-0.306 3.43 1.66 6.02 1.37 2.78 1.87 6.31 1.85 9.12 1.73 2.8 2.46 4.38-1.47 6.07 0.698 3.54-0.298 7.35-0.155 11-1.52 2.47-0.667 5.1-1.55 7.58-1.95 1.75-0.981 3.32-0.539 5.03-0.831 2.11-0.536 3.45-1.66 4.62-1.14 1.99-2.58 4.23-0.53 6.26-3.67 0.324 2.76 3.77-2.67 4.44-1.66 0.644-1.53 1.18-3.73 1.15-1.54 1.53 8.08e-4 -0.0866-2.07 2.03-2.28 0.463 1.49 3.36-3.95 2.43-5.98","m64.2 0.539c-3.04 1.13-4.28 1.48-7.29 2.16-2.93 0.926-5.25-0.384-6.34 3.44-0.19 2.45-1.8 3.55-3.03 6.32 0.108 3.53-5.56 3.56-2.35 1.79-2.19-2.65-6.04-3.21-9.46-3.61-3.18 0.962-5.72 1.02-7.97 2.44-2.01 1.05 1.32 1.78-1.55 2.46 0.234 4.66-4.92 2.17-7.55 4.76-2.35-0.93-5.47 1.08-4.9 1.17-1.32-0.158 1.23 3.18-1.62 2.75-1.76 1.03-4.26 2.49-2.67 3.79-2.22 1.65-3.12 5.44-4.02 9.36-1.42 3.27 0.484 7.57-1.55 9.1-0.778 3.13 0.0511 6.82-0.816 8.38 0.33 1.07-0.709 2.21-0.265 3.18-2.15 0.906 0.318 3.89-0.247 4.91-1.03 3.9-0.923 5.95-1.73 8.36 0.35 1.94 0.102 5.22-0.347 6.91-1.12 2.26 1.43 6.21-0.447 6.94 0.0358 3.06 2.24 1.14 1.15 3.73 1.52 2.36 2.73 3.76 5.62 6.23 0.927 0.525 4.32 4.39 7 4.89 1.62-1.38 3.94-3.44 5.19-6.32 2.59-0.889 5.01 2.84 6.32 1.6-0.752 1.86 3.63 0.13 4.68 2.69 0.384 0.0568 1.7-1.95 1.51-0.607-2.51 2.91 3.17 1.17 2.3 0.963-0.257 2.72 3-0.793 3.03 0.11 1.77-0.129 0.96-2.42 2.31-0.695-0.726-0.685 1.65-3.56 1.86-1.19-0.799-3.27 2.71-5.48 3.01-8.76-1.44-0.786-8.22 1.44-2.83-0.345 2.9-0.209 4.13-0.42 5-2.82 2.54 1.85 4.65 3.55 6.86 4.37 1.83-1.33 1.82 0.143 1.01 1.35 3.12-2.09-1.13 1.54 2.65 0.572 2.27 2.39 4.95 1.27 7.51 0.842 1.54-1.6 3.05-0.883 3.72-3.58-0.856-0.757 2.88 0.329 2.85-2.42 0.71-2.56 4.67-2.24 3.75-3.73 1.09-0.163 2.86-4 4.19-1.51-0.912 1.37-3.02-1.52-2.18 1.38 2.59 0.157 2.94-3.7 5.31-3.46 0.195-0.817 1.5 2.01 0.332-0.81-3.65 0.277-0.695-3.85 0.926-1.84 1.51-1.34-0.182-2.91-1.26-1.47-3.11-0.966 2.58-1.69 3.22-2.65 0.724-0.837-3.99-0.537-1.15-1.43 0.207-0.0239 2.33-2.25 0.396-2.21 1.75-1.03 0.404-2.77 3.06-1.65-2.13-1.35 4.25-1.89 0.951-3.16 2.05 0.115 0.407-1.17 1.51-2.55-1.23-1.97-0.913-2.48 0.164-3.68-3.58-1.14 3.32-3.83 0.162-0.809 1.43 1.04 2.96-3.68-0.242-2.09-0.637-0.992 4.45-0.246 0.689-1.5 2.7-2.59-2.1-0.753 0.177-3.6 1.07-1.15 2.59-1.79 2.61-3.95-0.219-1.26 0.806-4.08 0.025-4.69 1.09-0.882 1.92-1.99 2.06-3.32 0.889-0.326-0.453-2.78 1.45-1.56-1.42-2.04 0.433-2.61-0.0815-4.94 2.65-1.48-2.48-2.36 1.4-2.28 1.12-1.01 2.32-4.78 1.59-5.76 1.2-1.01-3.05-1.28-0.352-2.6-0.95-0.331-2.6-0.781-0.343-1.39-1.22-3.04-2.16 1.36-2.79-1.89 0.717-0.51-2.24 0.659-1.16-0.68-1.36 1.93-4.2-1.53-2.41 1.45-1.39-1.07-3.78 0.856-1.96-2.22-1 0.261-2.11 1.78-4.01 1.33-2.63 1.47-3.27 0.8-6.2 1.05-1.86-0.919-0.729 1.95-3.33 0.295-4.17 1.08-1.6-5.9-2.7-8.54 0.219-2.95-1.7-5.27-4.39-5.74 0.0318-1.12-0.108-0.55 0.847-2.61-0.53-2.2-3.05 2.19-4.21-0.651-0.985 1.5-1.5-1.46-2.61 0.229z","m97.3 57.2c-3.41 0-4.74-6.08-8.05-6.1-1.29-0.795-3.87-0.991-2.73-2.24-0.461 0.105 4.07-1.76 2.58-2.95-0.276 0.0469-1.66-4.4-1.88-1.47-1.36-0.391-1.07-2.36-1.27-1.62-1.62 0.0399 8.03-1.15 6.51-0.797-1.78 0.597-1.31-1.57-2.35-2.4-0.458 0.327-4.94-0.923-1.01-0.854-0.831-1.1-0.472-1.75 0.0586-4.04 0.533-1.89-2.5 0.207-0.825-1.39-0.89-1.75-1.09-0.904-1.57-3.06-1.16-0.951-1.78-1.03-2.84-1.14 2.11 0.151-0.32-2.08 1.08-1.45 0.421-0.661 8.25-3.23 7.96-4.94-1.57-1.95-1.71-0.0456-3.1-3.81 0.665 3.54-0.192 0.654-0.944-0.899-0.654-1.49-1.36-3.11-2.92-4.35-1.19-2.92-0.257 2.7-1.65-0.177-0.363-2.09-3.08 0.626-1.6-1.95 0.915-1.38 5.96-7.76 6.92-5.41-1.84-0.314 0.0411-0.555-1.4-2.01-2.65-0.62-0.587-2.27-2.83-1.94-0.891-1.13-0.313-0.513-0.368-1.36-1.07-1.02-1.2-1.36-1.13 0.396-1.83-0.483-2.44-0.812-3.45-0.308-2.32-0.0102-9.13-0.462-12-0.359-0.581 0.361-2.24 4.17-3.12 3.74-0.345 0.803-29-4.16-30.3-2.87 0.426-0.902-5.43-0.656-2.95-0.38-2.09 0.429-2.98 0.345-3.78 0.739-1.76 0.0938-2.27 3.72-3.7 3.74-0.875 1.71-1.59-0.443-2.57 0.925-1.59-0.0625-4.02-0.262-3.68-0.529-1.73 0.25-2.36-0.259-2.95-0.822-1.27 0.255-1.65-3.16-3.36-3.25-1.77-0.478-3.08 0.112-4.51-0.279-0.795-1.08-2.01-0.597-2.79-0.309-1.29 0.673-2.41-1.64-3.25-0.36 0.269 3.8-0.413 9.13-1.18 9.65-0.958 3.77 6.29 8.17 4.95 11.7 0.33 2.17-5.9 4.99-5.18 7.06-0.151 3 2.7 2.24 4.34 1.83 1.55 1.14 3.65-0.928 4.48 1.08 0.844 4.55-4.57 7.76-2.15 12.5 0.93 4.55 5.67 2.93 8.52 4.87 2.87 0.757 9.05 1.51 3.39 4.16-3.63 3.38-20 9.73-18.1 14.2 2.82 2.46 6.51 1.82 9.54 2.71 2.8 0.982 5.74 0.786 8.6 2.07 3.35 1.2-2.94 2.88-3.3 5.45-2.42 3.72-3.78 8.59-3.09 13.1-0.57 4.75 4.49 3.18 7.13 4.2 8.46 2.12 33.1 4.16 41.8 4.31 5.06 0.0968 10.1 0.248 15.2 0.179 2.56-1.15 5.94 0.664 9.04-0.886 3.42-0.389 7.19-1.46 10.3-3.45 2.26-1.65 5.26-6.01 3.7-9.75-1.99-2.48-3.9-6.12-4.74-8.06-1.1-2.55-3.59-3.99-5.43-5.01-1.16-0.584-3.28-0.481-4.21-0.804 1.7-2.1 14.6-5.56 14-9.31 0.303-2.06-0.0416-5.48-1.94-5.48z","m86.9 0.416c-2.65 0.408-5.71-0.589-8.11 0.475-3.02-1.44-6.37 0.199-9.03-0.782-1.92 1.65-4.94 0.317-7.17 0.0679-3.2 0.55-7-0.879-10.1 0.314-2.97-0.426-6.34-0.492-9.57 0.108-2.95 0.128-6.34-0.391-8.93 0.331-2.24 0.0952-4.71-0.758-6.98 0.496-3.21-0.616-6.48-0.693-9.53 0.357-2.98 0.795-5.03 3.75-7.08 7.64-2.73 2.45-6.1 3.3-7.82 8.86-0.445 0.677-3.29-2.09-2.51 1.37 3.26-1.21-0.803 8.33 2.38 10.4 0.42 6.11 3.88 6.35 6.25 6.63 2.29 1.75 5.76-1.33 7.03 3.1-1.79 2.08-4.22 2.77-6.05 4.95-3.39 4.3-4.2 11.5-2.08 17.9 1.85 5.04 0.776 12.6 2.91 17.4 1.53 2.54 3.71 2.13 5.02 3.42 3.52-1.88 2.62 7.15 5.18 8.6 2.6 2.27 5.67 1.43 8.43 2.78 2.92 0.673 5.36-0.13 8.13 0.67 2.73-0.475 5.51 1.53 8.19 0.136 2.71 1.99 5.7 0.76 8.48 1.13 1.47 0.551 3.01-0.468 4.52 0.174 2.15 1.32 4.49 0.423 6.78 0.366 2.48 1.8 5.74 1.69 8.46 1.47 2.86-1.03 5.56 1.22 8.36 0.503 2.47 1.6 5.08 0.104 7.27-0.656 0.0273-4.47 3.15-5.73 2.5-11.4 2.59-4.28 1.77-10.5 0.635-15.5-2.25-5.73-7.91-4.13-7.78-12.2-0.15-5.61 5.39-0.0295 7.76-2.7 2.57 1.77 5.55 0.341 6.09-4.8 3.49-3.55-0.732-9.66 0.471-13.6-1.53-2.77-3.79-5.59-6.39-4.86-1.83-0.569-3.35-0.944-2.87-5.04-3.26-3.66 2.44-4.1 2.02-8.61 3.91-6 0.769-13.5-2.16-17.9-0.935-0.187-1.76-1.25-2.72-1.66z","m0 97.2v-97.2h100s-1.64 4.67-2.14 7.16c-0.493 2.49 1.85e-4 0.623-1.07 2.18-1.07 1.56-1.97 2.18-2.47 4.05s-0.658 3.11-1.4 3.11c-0.74 0-1.32-0.622-2.14 2.18-0.822 2.8-0.904 3.43-1.81 4.36-0.905 0.934-1.07 3.43-1.64 5.3-0.576 1.87-1.07 2.18-1.97 4.05-0.904 1.87-2.38 3.12-3.04 4.98-0.658 1.87-1.48 4.67-1.73 6.54s-1.81 6.23-3.45 7.79c-1.64 1.56-3.37 2.49-4.03 4.05-0.658 1.56-1.07 3.43-2.06 3.74-0.987 0.312-6.09 9.35-7.98 9.03-1.89-0.311-4.19-0.312-4.44 2.18-0.247 2.49-1.89 2.18-3.95 0.623-2.06-1.56-3.37-0.623-5.51 2.8-2.14 3.43-2.88 0.311-3.62-0.623-0.74-0.934-4.11 1.25-5.35 2.49-1.23 1.25-2.06 1.56-3.37 1.56-1.32 0-3.21 5.3-4.19 5.61-0.37 0.117-0.821 0.102-1.27 0.0869-0.757-0.0243-1.52-0.0486-1.93 0.535-0.658 0.934-1.56 3.74-2.22 4.67-0.658 0.934-2.47 0.934-2.96 0.934-0.494 0-2.14-2.49-3.54 0-1.4 2.49-3.04 4.98-4.36 4.05-1.32-0.934-2.63-4.05-3.7-1.56-1.07 2.49-3.45 8.41-4.19 8.1-0.74-0.312-4.19-1.87-5.02-2.18-0.822-0.311-3.45-0.622-3.45-0.622","m0 100v-100s2.5 1.73 2.92 3.47c0.417 1.73 1.04 3.18 2.08 3.47 1.04 0.29 1.87 0.00176 2.81-0.288 0.937-0.29 1.98 2.02 3.02 2.6 1.04 0.577 3.44 1.15 4.17-0.29 0.729-1.44 1.46-1.16 2.29 0 0.833 1.16 2.19-0.867 4.48-1.73 2.29-0.867 3.54-4.34 4.69-2.6 1.15 1.73 2.71 4.62 3.33 5.2 0.625 0.577 0.729 1.73 2.08 4.05 1.35 2.31 3.75 1.16 4.9 0.867 1.15-0.288 3.65-0.867 4.06 0.867 0.417 1.73 3.54 11 5.83 11.3 1.15 0.146 1.98 0.0728 2.63 8.46e-4 0.65-0.072 1.12-0.145 1.54-8.46e-4 0.833 0.29 1.15 2.31 2.08 3.18 0.937 0.867 1.04 2.02 2.6 2.89 1.56 0.867 2.6-0.29 4.06-1.44 1.46-1.16 3.65-3.47 5.1-2.6 1.46 0.867 1.35-0.577 3.85 2.02 2.5 2.6 3.54 3.18 5.52 3.76 0.729 0.213 0.978 0.152 1.21 0.0902 0.397-0.106 0.743-0.211 3.37 1.07 4.17 2.02 4.9 0.867 6.77 0.867 1.88 0 6.04-0.867 7.4 0.29 1.35 1.15 3.96 1.16 4.9 0 0.937-1.16 2.29-1.73 2.29-1.73v43.9s-2.5-2.89-3.85-1.45c-1.35 1.45-2.81 2.89-3.75 3.76-0.937 0.867-2.71 2.02-4.17 2.02-1.46 0-2.08 2.02-4.06 2.02-1.98 0-4.58 0.869-5.83-0.577-1.25-1.44-2.19-1.44-3.85-2.6-1.67-1.16-2.92-1.15-3.85 0-0.938 1.16-5.21 2.89-6.25 4.34-1.04 1.44-3.02 2.02-3.85 2.02-0.834 0-3.85-2.6-4.48-2.02-0.625 0.577-4.58 2.89-6.04 5.49-1.46 2.6-3.33 2.89-4.9 2.89-1.56 0-3.13-0.29-5.1-1.16-1.98-0.867-7.71-3.18-8.33-2.89-0.625 0.29-1.77 2.89-3.85 4.62-2.08 1.73-4.17 2.6-5 2.6h-6.25c-0.312 0-2.92-0.577-4.06-1.16-1.15-0.577-1.77-2.31-2.71-2.89-0.937-0.579-0.938-2.31-2.6-1.16-1.67 1.16-1.56 0.867-3.33 2.31-1.77 1.45-3.85 4.62-3.85 4.62","m0 70.8v-70.8h100v97.9s-3.74-2.93-6.23 0c-2.49 2.93-2.74 2.56-5.24 0-2.49-2.57-4.24-1.83-7.23-2.57-2.99-0.732-6.98-1.46-7.48-3.66-0.498-2.2-2.24-2.93-3.74-2.2-1.5 0.733-6.73 0.366-8.23-0.733-1.5-1.1-1.5-3.66-5.24-5.49-2.08-1.02-2.69-0.34-3.49 0.339-0.64 0.543-1.4 1.09-3.11 0.76-3.87-0.733-5.36-3.3-7.11-3.3-1.75 0-4.24 2.56-7.48 0.733-3.24-1.83-2.49-3.16-7.23-3.41-1.67-0.0891-3.06 0.414-4.32 0.919-2.33 0.929-4.23 1.86-6.65-0.919-3.74-4.28-4.24-5.75-8.23-5.02-3.99 0.733-4.99 3.3-6.98 0.367l-2-2.93","m100 19.6v80.4h-100v-97.8s2.29-4.97 4.38 0c2.08 4.97 5.42 5.62 6.46 4.97 1.04-0.654 4.79-0.654 5.62-0.654 0.833 0 4.38 3.79 5 3.86 0.625 0.0667 1.88 0.585 3.54 0 1.67-0.586 3.96-1.38 4.58 0 0.625 1.37 2.08 3.99 3.13 4.64 1.04 0.654 1.67 0.654 3.54 0.654 1.88 0 4.58 1.99 6.04 3.94 1.46 1.95 1.25 0.64 3.75 5.87 2.5 5.23 1.46 11.1 3.96 8.82 2.5-2.29 2.71-0.327 5.21-4.25 2.5-3.92 2.29-3.92 4.79-5.88 2.5-1.96 5.83-6.51 6.56-4.56 0.729 1.95 3.65 2.6 5.31 3.25 1.67 0.654 1.67 3.27 3.96 1.31 2.29-1.96 1.04-4.55 4.79-4.56 1.26-0.0049 2.21 0.216 3.16 0.437 1.88 0.437 3.73 0.875 7.88-0.436 6.25-1.97 8.33 0 8.33 0","m0 0v100h100v-45.4s-4.66-9.87-7.4-4.61c-2.74 5.26-5.48 1.97-8.22 0-2.74-1.97-9.04-8.55-11.2-7.89-1.04 0.312-2.57-0.705-4.12-1.72-1.73-1.13-3.49-2.26-4.64-1.57-2.19 1.32-3.56 2.63-7.12 0-3.56-2.63-2.47-6.58-7.26-5.26-4.8 1.32-8.08 0-11.9-3.29-3.84-3.29-4.11-7.89-9.32-7.24-5.21 0.658-7.75 2.16-9.04-1.32-2.19-5.92-1.1-7.89-4.66-9.87-3.56-1.97-2.74-5.26-5.75-6.58-3.01-1.32-9.32-5.26-9.32-5.26","m100 0.435v98.2s-2.49 0.722-4.98 0c-1.01-0.293-2.02 0.175-2.98 0.643-1.41 0.684-2.71 1.37-3.77-0.323-1.78-2.85-1.78-3.57-5.69-3.57-3.91 0-6.4-0.361-7.46-1.08-1.07-0.722-3.55-3.25-5.33-3.25s-3.55-0.722-7.82 0c-4.26 0.721-11.4 2.89-14.9 1.44-3.55-1.44-6.4-3.25-8.17-3.25s-6.75 1.08-8.53-1.08c-1.78-2.17-0.711-4.33-4.62-4.33-3.91 0-3.2-0.361-7.11-0.722-3.91-0.361-7.46-2.53-8.88-3.61-1.42-1.08-3.91-2.17-6.4-3.61-2.49-1.44-4.26-3.61-2.84-5.41 1.42-1.81 2.13-5.05 2.84-6.86 0.711-1.8-1.07-7.51 0-8.08 1.07-0.58 2.13-4.62 2.13-5.3 0-0.69 0.711-6.1 0.711-6.1s1.42-4.69 1.42-6.32c0-1.62 1.07-3.79 1.78-6.32 0.711-2.53 0.355-2.89 1.07-6.14 0.71-3.25 1.07-6.14 2.13-9.02 1.07-2.89 0.711-4.33 2.13-6.86 1.42-2.53 3.2-2.37 6.4-2.63 1.24-0.101 2.64 0.078 3.97 0.257 2.11 0.283 4.04 0.566 4.91-0.257 1.42-1.34 9.59-2.79 11.4-3.51 1.78-0.722 5.54-0.722 8.63-0.361 3.1 0.361 7.36 0.722 9.49-0.361 2.13-1.08 4.97-3.61 7.46-2.17 2.49 1.44 7.11 1.81 9.95 1.81 2.84 0 8.17-0.361 9.59-0.361 1.42 0 13.5-1.44 13.5-1.44","m0 100h100v-98.1s-2.26 2.58-3.06 6.45c-0.799 3.87-1.86-3.87-2.53-6.45-0.666-2.58-2-2.58-2.66 0-0.666 2.58-2.93 5.16-3.59 10.3-0.666 5.16-2 1.29-3.33 5.16-1.33 3.87-2.8 3.87-3.6 5.16-0.799 1.29-1.86-1.29-2.53-3.87-0.666-2.58-0.932-9.03-1.86-7.74-0.359 0.498-0.835 0.0392-1.33-0.418-0.794-0.735-1.64-1.47-2.13 1.71-0.799 5.16-2.13 1.29-2.93 5.16-0.349 1.69-0.546 1.66-0.802 1.62-0.329-0.0434-0.754-0.0898-1.73 3.54-1.73 6.45-1.73 7.74-3.59 14.2-1.86 6.45-3.99 6.45-4.66 6.45-0.666 0-2.13-3.87-3.2-5.16-1.06-1.29-3.86-9.03-4.26-7.74-0.16 0.516-0.383 0.207-0.658-0.103-0.412-0.465-0.94-0.93-1.54 1.39-0.999 3.87-0.999 5.16-2.73 9.03-1.73 3.87-3.73 1.29-4.39 1.29-0.666 0-1.86-9.03-3.06-6.45-1.2 2.58-2 2.58-3.06 6.45-1.07 3.87-0.133-0.645-3.06 8.06-2.93 8.71-4.53 11.3-5.86 8.71-1.33-2.58-0.266-8.39-2.53-8.71-2.26-0.323-0.133-4.19-2.26-0.323-0.926 1.68-1.48 0.318-1.93-1.05-0.592-1.77-1.03-3.55-1.93 1.37-1.6 8.71-1.86 3.55-3.46 10-0.888 3.58-1.73 3.19-2.59 2.79-0.681-0.318-1.36-0.635-2.07 1.08-1.6 3.87-2.93 9.03-3.73 12.9-0.799 3.87-1.73 5.16-2.8 6.45-1.07 1.29-3.06 7.74-3.06 7.74l-1.46 9.03","m0.642 91.6c2.18-0.834 1.23 0.646 2.08 5.01 1.15 5.89 2.04-0.393 3.53-1.92 0.997-1.02 1.1-0.0486 1.34 0.919 0.167 0.677 0.401 1.35 1.05 1.35 0.673-0.0028 1.21-2.06 1.94-2.16 0.618-0.0861 1.53 1.26 2.16 1.6 0.978 0.537 2.32 1.11 3.25-0.214 1.12-1.6 1.06-5.87 1.91-7.36 0.49-0.854 1.61-0.912 2.23-1.08-0.0448 3.49 1.27 7.03 2.23 2.97-0.228 3.71 0.481 3.62 1.48 5.18 0.689 1.07 2.22 1.88 3.09 2.98 2.56 3.23 3.88-1.12 6.34-2.31 1.83-0.88 2.74-0.315 4.27 1.94 1.62 2.39 1.83 1.85 3.39-0.883 2.19-3.85 4.81-0.0486 6.84-5.73 1.17-3.28 0.699-3.87 2.54-4.2 0.763-0.135 2.62-0.893 3.33-0.516 1.6 0.843 1.1 5.2 2.63 6.59 0.307 0.282 0.625 0.0555 0.928-0.171 0.274-0.205 0.537-0.41 0.77-0.239 0.545 0.403 0.557 1.66 1.03 2.34 1.35 1.98 2.47 2.41 4.01 2.77 0.848 0.193 1.74-0.0541 2.63-0.301 1.06-0.296 2.12-0.591 3.09-0.132 0.718 0.339 1.3 2.06 2.05 1.66 0.934-0.498 1.31-4.57 1.87-6.2 0.859-2.48 1.25-4.16 3.04-3.21-0.524 6.14 3.33 4.11 4.71 3.39 0.848-0.446 1.36-0.7 2.04-2.01 0.888-1.71 1.56-7.51 2.84-7.75 1.02-0.192 4.02 7.53 5.11 9.04 1.52 2.12 2.79 3.41 4.23 0.0153 0.722-1.7 2.48-6.64 1.64-8.7 0.507-2.05 1.15-2.65 2.49-2.7 0.44-0.0167 0.848 0.0333 1.24 0.107v-81.6c-0.445 0.429-0.885 0.876-1.32 1.37-0.33 0.378-1.05 0.343-1.33 0.957-0.295 0.639-0.319 2.69-0.593 3.12-1.62 2.53-1.55 0.0208-3.15-1.53-0.362-0.351-0.409-1.3-0.906-1.61-0.242-0.149-0.558 0.107-0.892 0.362-0.337 0.257-0.691 0.515-1.01 0.358 0.0703-6.64-4.2 2.67-5.42 3.23-1.38 0.637-2.65-0.368-3.9-1.37-1.68-1.36-3.33-2.72-5.16-0.0236-2.46 3.62-3.81 10.4-7.44 10.5-0.598 0.0125-1.15-0.317-1.7-0.646-0.552-0.329-1.1-0.658-1.68-0.646-1.25 0.0264-2.54 2.7-3.82 1.58-1.11-0.979-1.29-4.91-2.23-5.75-0.609-0.541-1.21 0.146-1.81 0.832-0.576 0.659-1.16 1.32-1.76 0.894-1.14-0.802-1.5-4.69-2.45-6.31-1.24-2.12-2.71-1.89-4.11-1.23-1.89 0.883-3.13 3.74-4.83 5.04-0.567 0.432-1.31 0.0986-2.06-0.235-1.04-0.465-2.1-0.93-2.71 0.677-0.65 1.7 0.652 7.88-0.753 9.93-1.3 1.9-0.737-0.33-1.75-1.81-0.856-1.25-0.647 0.13-1.34-1.47 0.523-2.12 1.3-4.75 0.92-7.43-0.264-0.0514-0.611-0.018-0.991 0.0153-1.09 0.0944-2.45 0.189-2.96-1.65-0.319-1.14 0.104-5.07-0.0232-6.59-0.958 0.0236-10.5 11.6-9.23 1.89-0.96 4.56-3.26 9.14-5.33 7.57-0.658-0.497-1.2-2.3-1.84-2.73-0.614-0.419-1.21-0.204-1.82 0.0111-0.399 0.14-0.803 0.282-1.22 0.244-0.86-0.0764-1.94-1.51-2.72-1.16-1.38 0.628-2.42 4.97-3.89 5.08-2.16 0.172-2.31-5.77-4.01-7.49-0.809-0.822-1.8-0.18-2.79 0.99v86.8c0.206-0.0403 0.418-0.0958 0.642-0.18","m89.3 0h-89.3v94.5c0.542 1.3 1.03 2.47 1.34 2.65 1.24 0.722 1.8-3.48 2.81-4.09 1.45-0.875 0.831 1.28 2 2.99 1.64 2.4 2.1-1.09 3.84-1.12 0.421-0.0071 0.747 0.258 1.04 0.524 0.65 0.593 1.12 1.19 2.09-1.25-0.447-1.41-1.17-2.01-1.74-3.04 0.802-1.44 1.52-2.38 2.16-4.14 0.692-1.9 0.15-4.06 1.52-4.07 0.985 4.63-0.761 7.72 1.38 9.28 0.3 0.219 0.6 0.0435 0.906-0.131 0.334-0.191 0.674-0.382 1.03-0.059 0.792 0.725 1.15 4.18 1.89 4.91 1.78 1.76 6.06-6.96 4.09-12.7 1.24-2.15 2.73-3.02 3.98-5.06 0.969-1.58 1.69-4.6 2.79-5.47 0.38 5 1.7 8.26 3.69 10-0.615 1.29-1.16 2.77-1.36 4.72 0.938 2.73 2.26 0.706 3.42 0.376 2.77-0.789 1.47 2.79 3.45 4.97 0.963 1.06 1.94-0.59 2.96-2.24 1.11-1.79 2.26-3.58 3.49-1.91 0.604 0.819 0.825 3.53 1.52 4.56 0.557 0.829 0.962 0.787 1.41 0.746 0.269-0.0239 0.554-0.0492 0.897 0.118 0.897 0.437 1.79 1.55 2.72 1.91 0.591 0.223 1.14 0.0056 1.65-0.211 0.63-0.264 1.22-0.528 1.8 0.0014 0.474 0.434 0.482 2.86 1.25 3.21 0.891 0.416 1.58-2.12 2.33-2.78 1.33-1.17 2.89-0.27 3.82-3.51-0.602 0.574-1.3 0.93-1.9 0.949 0.283-3.84 1.86-5.23 3.06-6.95-0.181-1.04-0.013-2-0.12-2.98 0.539 1.01 1.17 1.33 1.77 0.697-0.922-4.21 0.292-5.18 1.53-7.87-0.427 2.09 0.193 5.48 0.213 7.66 0.0284 3.21-0.28 2.65 0.266 5.81 0.337 1.95 1.17 0.185 0.604 3.3 1.39 2.93 7.69 4.26 5.58-4.16 0.871-0.0885 1.21 1.17 1.56 2.43 0.444 1.63 0.89 3.26 2.49 1.96 0.744-0.6 1.44-3.09 2.16-3.37 1.76-0.671 1.24 3.23 2.81 3.75 1.31 0.438 2.66-4.45 3.85-5.48 0.512-0.442 0.951-0.358 1.44-0.274 0.267 0.0464 0.548 0.0927 0.864 0.052 2.22-0.284 3.09-4.96 1.35-9.59 1.11-1.21 1.7-2.88 2.47-4.96 1.5-4.03 0.88-3.53 2.82-0.896 1.06 1.44 2.01 3.27 3.03 0.126v-73.9h-10.7","m0 51.2c3.3-2.88 6.4-5.95 9.3-9.33-0.9-1.59-2.1-3.08-3.9-3.57-0.8-1.49 0.2-3.47 1.7-4.46 0.3-0.198 0.6-0.298 0.9-0.496-0.1-0.198-0.2-0.496-0.3-0.694 1.6-1.49 3.1-2.98 4.6-4.46 0.6 0.298 1.2 0.694 1.8 0.992-0.3-0.595-0.6-1.19-0.9-1.69 0.7-0.496 1.4-1.09 2.2-1.59-0.3-1.39-0.8-2.78-2.1-3.67-0.1-1.69 1.5-3.08 3.3-3.47 0.3-0.0992 0.7-0.0992 1-0.0992v-0.794l6-2.38c0.4 0.496 0.8 1.09 1.3 1.59-0.1-0.694-0.1-1.29-0.2-1.98 0.8-0.198 1.6-0.397 2.5-0.595 1.1-3.17 1.7-6.45 1.9-9.82 1.1 0.595 2.4 0.198 3.6 0.198 1.1 0 2.3 0.496 2.6 1.49 1.6 0.0992 3.4-0.198 4.8 0.496 0.8 0.397 1.5 1.09 2.2 1.79 2.3-2.58 4.3-5.46 5.8-8.63 0.8 0.893 2.1 1.09 3.3 1.59 0.7 0.694 1.7 1.69 1.6 2.68 1.4 0.694 3.2 1.09 4.2 2.28 0.5 0.496 0.8 1.19 1.1 1.88 3.6-1.09 7.3-2.28 10.9-3.37 1 3.37 2.4 6.55 4.1 9.62 3.9 0.397 7.8 0.694 11.8 1.09-0.4 3.17-0.4 6.35-0.1 9.52 0.3 0.298 0.6 0.694 0.8 1.09 0 0.694-0.1 1.39-0.1 2.08 0.9-0.198 1.7-0.694 2.4-1.19 2.4 1.29 5 2.08 7.7 2.58-1.6 3.27-3 6.55-4.3 10 0.4 0.595 0.6 1.29 0.6 1.98-0.3 0.595-0.6 1.19-0.9 1.88 0.9 0.0992 1.8 0 2.7-0.198 1.7 2.08 3.8 3.87 6.1 5.26-3.3 2.88-6.4 5.95-9.3 9.33 0.9 1.59 2.1 3.08 3.9 3.57 0.8 1.49-0.2 3.47-1.7 4.46-0.3 0.198-0.6 0.298-0.9 0.496 0.1 0.198 0.2 0.496 0.3 0.694-1.6 1.49-3.1 2.98-4.6 4.46-0.6-0.298-1.2-0.694-1.8-0.992 0.3 0.595 0.6 1.19 0.9 1.69-0.7 0.496-1.4 1.09-2.2 1.59 0.3 1.39 0.8 2.78 2.1 3.67 0.1 1.69-1.5 3.08-3.3 3.47-0.3 0.0992-0.7 0.0992-1 0.0992v0.794c-2 0.794-4 1.59-6 2.38-0.4-0.496-0.8-1.09-1.3-1.59 0.1 0.694 0.1 1.29 0.2 1.98-0.8 0.198-1.6 0.397-2.5 0.595-1.1 3.17-1.7 6.45-1.9 9.82-1.1-0.595-2.4-0.198-3.6-0.198-1.1 0-2.3-0.496-2.6-1.49-1.6-0.0992-3.4 0.198-4.8-0.496-0.8-0.397-1.5-1.09-2.2-1.79-2.3 2.58-4.3 5.46-5.8 8.63-0.8-0.893-2.1-1.09-3.3-1.59-0.7-0.893-1.7-1.88-1.6-2.88-1.4-0.694-3.2-1.09-4.2-2.28-0.5-0.496-0.8-1.19-1.1-1.88-3.6 1.09-7.3 2.28-10.9 3.37-1-3.37-2.4-6.55-4.1-9.62-3.9-0.397-7.8-0.694-11.8-1.09 0.4-3.17 0.4-6.35 0.1-9.52-0.3-0.298-0.6-0.694-0.8-1.09 0-0.694 0.1-1.39 0.1-2.08-0.9 0.198-1.7 0.694-2.4 1.19-2.4-1.29-5-2.08-7.7-2.58 1.6-3.27 3-6.55 4.3-10-0.4-0.595-0.6-1.29-0.6-1.98 0.3-0.595 0.6-1.19 0.9-1.88-0.9-0.0992-1.8 0-2.7 0.198-1.7-1.79-3.8-3.57-6.1-5.06z","m100 48.7c-3.3 2.89-6.49 6.08-9.39 9.36-1.2 1.39-2.4 2.99-2.4 4.78-0.699-0.498-1.6-0.598-2.5-0.299 0.599 0.697 1.2 1.29 1.8 1.99-1.1-0.199-2.2 0.498-3.2 1.2-0.0999 0.0996-0.3 0.199-0.4 0.299 0.2 1.99 0.3 3.98 0.5 5.88 0.2 2.09 0.5 4.48 2.3 5.88 0.0999 1.69-1.5 3.09-3.3 3.49-0.3 0.0996-0.699 0.0996-0.999 0.0996v0.797c-2 0.797-4 1.59-5.99 2.39-0.4-0.498-0.799-1.1-1.3-1.59 0.0999 0.697 0.0999 1.29 0.2 1.99-2.7 0.697-5.49 1.29-8.19 1.99-0.4-0.598-0.699-1.2-1.1-1.79 0 1.2-1.8 1.39-3 1.2-0.5-0.0996-1.1-0.0996-1.6-0.199-0.2 1.59-1.6 3.09-2.8 4.38-2.7 2.79-4.9 5.98-6.49 9.46-0.799-0.896-2.1-1.1-3.3-1.59-0.899-0.598-1.9-1.59-1.8-2.59-1.4-0.697-3.2-1.1-4.2-2.29-0.699-0.797-0.999-1.79-1.5-2.79-0.699-1.29-1.6-2.49-2.8-3.49-0.4-0.299-0.899-0.697-1.3-0.996-0.4 0-0.699 0-1.1-0.0996-6.99-0.598-14.1-1.2-21.1-1.89 0.5-4.08 0.4-8.27-0.3-12.4 0.699-0.299 1.4-0.598 2.1-0.996-0.599-0.199-1.2-0.498-1.8-0.697 0.0999-1.39 0.2-2.89 0.3-4.28-1.3-1.29-3-2.09-4.5-3.19-1.5-1.1-2.8-2.59-3-4.48 0.3-0.598 0.599-1.2 0.899-1.89-0.899-0.0996-1.8 0-2.7 0.199-1.7-2.09-3.8-3.88-6.09-5.28 3.3-2.89 6.49-6.08 9.39-9.36 1.2-1.39 2.4-2.99 2.4-4.78 0.699 0.498 1.6 0.598 2.5 0.299-0.599-0.697-1.2-1.29-1.8-1.99 1.1 0.199 2.2-0.498 3.2-1.2 0.0999-0.0996 0.3-0.199 0.4-0.299-0.2-1.99-0.3-3.98-0.5-5.88-0.2-2.09-0.5-4.48-2.3-5.88-0.0999-1.69 1.5-3.09 3.3-3.49 0.3-0.0996 0.699-0.0996 0.999-0.0996v-0.797c2-0.797 4-1.59 5.99-2.39 0.4 0.498 0.799 1.1 1.3 1.59-0.0999-0.697-0.0999-1.29-0.2-1.99 2.7-0.697 5.49-1.29 8.19-1.99 0.4 0.598 0.699 1.2 1.1 1.79 0-1.2 1.8-1.39 3-1.2 0.5 0.0996 1.1 0.0996 1.6 0.199 0.2-1.59 1.6-3.09 2.8-4.38 2.7-2.79 4.9-5.98 6.49-9.46 0.799 0.896 2.1 1.1 3.3 1.59 0.999 0.598 2 1.59 1.9 2.59 1.4 0.697 3.2 1.1 4.2 2.29 0.699 0.797 0.999 1.79 1.5 2.79 0.699 1.29 1.6 2.49 2.8 3.49 0.4 0.299 0.899 0.697 1.3 0.996 0.4 0 0.699 0 1.1 0.0996 7.09 0.598 14.1 1.29 21.2 1.89-0.5 4.08-0.4 8.27 0.3 12.4-0.699 0.299-1.4 0.598-2.1 0.996 0.599 0.199 1.2 0.498 1.8 0.697-0.0999 1.39-0.2 2.89-0.3 4.28 1.3 1.29 3 2.09 4.5 3.19 1.5 1.1 2.8 2.59 3 4.48-0.3 0.598-0.599 1.2-0.899 1.89 0.899 0.0996 1.8 0 2.7-0.199 1.5 1.99 3.6 3.78 5.89 5.28z","m100 61.9c0 10.9-8 19.9-18.4 21.1-1.9 9.7-10.3 17-20.3 17-4.2 0-8-1.3-11.3-3.4-3.2 2.1-7.1 3.4-11.3 3.4-10.1 0-18.5-7.3-20.4-17.1-10.3-1.2-18.3-10.2-18.3-21 0-10.4 7.3-19 16.9-20.8 0-0.8 0.1-1.6 0.2-2.4 0.6-4.2 3-7 3-7s0 3.5 1.7 2.7c2.1-1 1.5-5.1 3.4-8.8 4.3-8.1 11.6-11.1 11.6-11.1s-2.9 7.2 1.6 6.3c2.9-0.6 2.6-7.5 7.5-13 7.5-8.6 16.1-7.8 16.1-7.8s-6.6 5.7-7.2 12.5c-0.4 4 1.5 8.5 5 9.2 5.1 1 4.1-2.4 4.1-2.4s3.4-0.1 6.8 3.9c2.3 2.6 1.9 6.4 4.6 6.9 1.4 0.3 1.3-2.5 1.3-2.5s2.9 1.4 4.6 5.9c1 2.6 1.3 5.1 1.4 7.4 9.9 1.7 17.4 10.4 17.4 21z","m94.3 56.2c0.4 6 2 13 5.7 21.2 0 0-16.6 12.2-50 22.6-33.4-10.4-50-22.6-50-22.6 3.7-8.1 5.3-15.1 5.7-21.1-0.5-0.9-3.9-7.7-2.5-14.8 0.9-4.5 4.3-7.5 4.3-7.5s0 3.8 2.5 2.9c3-1.1 2.1-5.5 4.9-9.4 6.1-8.7 16.7-12 16.7-12s-4.1 7.8 2.3 6.7c4.2-0.7 3.8-8.1 10.8-14 10.7-9 23.1-8.2 23.1-8.2s-9.5 6.2-10.4 13.4c-0.6 4.3 2.2 9.2 7.3 9.9 7.4 1 5.9-2.6 5.9-2.6s4.9-0.1 9.8 4.2c3.3 2.8 2.8 6.9 6.7 7.5 2 0.3 1.9-2.7 1.9-2.7s4.2 1.6 6.6 6.4c4.7 9.7-0.3 18.6-1.3 20.1z","m100 56.2v0.1c0 24.1-22.4 43.7-50 43.7-27.6 0-50-19.6-50-43.7v-0.1c0-1.6 0.1-3.3 0.4-5.1 1-5.6 4.5-9.3 4.5-9.3s0 4.7 2.6 3.6c3.1-1.3 2.2-6.8 5.1-11.6 6.5-10.7 17.6-14.8 17.6-14.8s-4.4 9.6 2.4 8.3c4.4-0.8 4-9.9 11.4-17.2 11.5-11.1 24.6-10.1 24.6-10.1s-10 7.6-11 16.5c-0.6 5.4 2.3 11.3 7.7 12.2 7.8 1.3 6.3-3.2 6.3-3.2s5.1-0.1 10.3 5.1c3.5 3.5 2.9 8.4 7.1 9.2 2.1 0.4 2-3.3 2-3.3s4.4 1.9 7 7.9c1.6 4.2 2.1 8.3 2 11.8z","m100 41.1v34.5c-2 0-3.7 0.3-5.2 0.8v0.7c0 5-4.1 9.1-9.1 9.1h-0.1c-0.6 2-0.6 3.6-0.6 3.6-12.4 7-30 10.2-35 10.2s-22.6-3.2-35-10.2c0 0-0.1-1.6-0.7-3.7h-0.1c-5 0-9.1-4.1-9.1-9.1v-0.7c-1.4-0.4-3.1-0.7-5.1-0.7v-34.5c0-0.9 0.1-1.8 0.3-2.8 1-4.2 4.5-7 4.5-7s0 3.5 2.6 2.7c3.1-1 2.2-5.1 5.1-8.7 6.5-8 17.6-11.1 17.6-11.1s-4.4 7.2 2.4 6.2c4.5-0.6 4.1-7.4 11.5-12.8 11.5-8.4 24.6-7.6 24.6-7.6s-10 5.7-11 12.4c-0.6 4 2.3 8.5 7.7 9.2 7.8 1 6.3-2.4 6.3-2.4s5.1-0.1 10.3 3.8c3.5 2.6 2.9 6.3 7.1 6.9 2.1 0.3 2-2.5 2-2.5s4.4 1.4 7 5.9c1.4 2.8 2 5.4 2 7.8z","m91.7 37.2c2.6-0.4 5.4-1 8.3-1.7 0 0-5.2 44-50 64.5-44.8-20.5-50-64.5-50-64.5 2.9 0.7 5.6 1.3 8.3 1.7-0.1-1.3-0.1-2.7 0.2-4.1 0.8-3.6 3.8-6 3.8-6s0 3 2.2 2.3c2.6-0.9 1.9-4.4 4.3-7.5 5.4-6.9 14.7-9.6 14.7-9.6s-3.7 6.2 2 5.4c3.7-0.5 3.3-6.4 9.6-11.1 9.5-7.3 20.5-6.6 20.5-6.6s-8.4 4.9-9.2 10.7c-0.5 3.5 1.9 7.3 6.4 7.9 6.5 0.8 5.2-2 5.2-2s4.3-0.1 8.6 3.3c2.9 2.3 2.5 5.5 5.9 6 1.8 0.3 1.6-2.1 1.6-2.1s3.7 1.2 5.8 5.1c1.7 2.9 2.1 5.8 1.8 8.3z","m97.2 50.9v34.9s-0.3 2.6-3.8 3.3l-40.2 10.3s-2.5 0.6-3.4 0.6-3.4-0.6-3.4-0.6l-40.3-10.3c-3.4-0.8-3.8-3.3-3.8-3.3v-34.9c-1.2-2.3-3.2-7.3-2-12.5 0.999-4.2 4.49-7 4.49-7s0 3.5 2.6 2.7c3.1-1 2.2-5.1 5.09-8.7 6.49-8 17.6-11.1 17.6-11.1s-4.39 7.2 2.4 6.2c4.49-0.6 4.1-7.5 11.5-12.9 11.5-8.4 24.6-7.6 24.6-7.6s-9.99 5.7-11 12.4c-0.599 4 2.3 8.5 7.69 9.2 7.79 1 6.29-2.4 6.29-2.4s5.09-0.1 10.3 3.8c3.5 2.6 2.9 6.3 7.09 6.9 2.1 0.3 2-2.5 2-2.5s4.39 1.4 6.99 5.9c4.2 7.7 0.899 14.8-0.799 17.6z","m100 35.6v51.8h-10.4c-3.4 1.9-8 3.5-13.6 4.7-1.4 0.3-2.8 0.6-4.3 0.8 0 0-3.4 0.8-5 1.2-5.3 1.3-13.4 3.6-16.7 5.9-3.3-2.3-11.4-4.5-16.7-5.9-1.6-0.4-5-1.2-5-1.2-1.5-0.3-2.9-0.5-4.3-0.8-5.6-1.2-10.2-2.8-13.6-4.7h-10.4v-51.8c0-0.9 0.1-1.8 0.4-2.7 1-3.6 4.5-6 4.5-6s0 3 2.6 2.3c3.1-0.9 2.2-4.4 5.1-7.5 6.5-6.9 17.6-9.5 17.6-9.5s-4.4 6.2 2.4 5.3c4.4-0.5 4-6.3 11.4-11 11.5-7.2 24.6-6.5 24.6-6.5s-10 4.9-11 10.6c-0.6 3.4 2.3 7.3 7.7 7.9 7.8 0.8 6.3-2 6.3-2s5.1-0.1 10.3 3.3c3.5 2.2 2.9 5.4 7.1 5.9 2.1 0.2 2-2.1 2-2.1s4.4 1.2 7 5.1c1.5 2.4 2 4.8 2 6.9z","m100 35.9-4.1 42.7v0.2c0 4.1-5.2 7.5-11.7 7.5-1.4 0-2.6-0.2-3.9-0.5-2.9 3.3-7.4 6.1-13 8.1-1.1 0.4-2.3 0.8-3.5 1.1 0 0-3.3 0.7-4.6 1.3-2.9 1.2-5.8 2.6-9.2 3.7-3.4-1.1-6.3-2.5-9.2-3.7-1.3-0.6-4.6-1.3-4.6-1.3-1.2-0.3-2.4-0.7-3.5-1.1-5.7-2-10.1-4.8-13-8.1-1.2 0.3-2.5 0.5-3.9 0.5-6.5 0-11.7-3.4-11.7-7.5v-0.2l-4.1-42.7c0-0.9 0.1-1.8 0.4-2.8 1-3.6 4.5-6 4.5-6s0 3 2.6 2.3c3.1-0.9 2.2-4.4 5.1-7.5 6.5-6.9 17.6-9.6 17.6-9.6s-4.4 6.2 2.4 5.4c4.4-0.5 4-6.4 11.4-11.1 11.5-7.3 24.6-6.6 24.6-6.6s-10 4.9-11 10.7c-0.6 3.5 2.3 7.3 7.7 7.9 7.8 0.8 6.3-2 6.3-2s5.1-0.1 10.3 3.3c3.5 2.3 2.9 5.5 7.1 6 2.1 0.3 2-2.1 2-2.1s4.4 1.2 7 5.1c1.5 2.4 2 4.8 2 7z","m96.4 38.7c0.4 9.69 3.6 14.6 3.6 14.6s-3.6 5.39-3.7 16.2c0 0-0.1 2.2-2.4 2.2h-5.8v9.69c0 4.2-3.3 7.69-7.4 7.69h-6.6c0 3-0.9 5.39-2.6 6.79-1.2 0.999-2.7 1.4-4.5 1.3-1-0.0999-2.4-0.3-3.8-0.499-3.2-0.499-7.1-0.999-8.9-0.599-2.6 0.499-3.8 2.9-3.8 3l-0.5 0.999-0.5-0.999s-1.2-2.4-3.8-3c-1.8-0.4-5.8 0.2-8.9 0.599-1.4 0.2-2.8 0.4-3.8 0.499-1.8 0.0999-3.3-0.3-4.5-1.3-1.7-1.4-2.6-3.8-2.6-6.79h-6.6c-4.1 0-7.4-3.4-7.4-7.69v-9.69h-5.8c-2.3 0-2.4-2.2-2.4-2.2-0.1-10.7-3.7-16.1-3.7-16.1s3.3-4.89 3.6-14.6c0-0.999 0.1-2 0.3-3 0.9-3.9 4.2-6.49 4.2-6.49s0 3.3 2.4 2.5c2.9-0.899 2.1-4.79 4.8-8.09 6-7.49 16.3-10.3 16.3-10.3s-4.1 6.69 2.2 5.79c4.1-0.599 3.7-6.89 10.6-12 10.7-7.89 22.9-7.19 22.9-7.19s-9.3 5.29-10.2 11.6c-0.5 3.7 2.1 7.89 7.1 8.49 7.2 0.899 5.8-2.2 5.8-2.2s4.8-0.0999 9.6 3.6c3.2 2.4 2.7 5.89 6.5 6.39 2 0.3 1.8-2.3 1.8-2.3s4.1 1.3 6.5 5.49c1.5 2.7 2 5.29 2 7.59z","m100 65s-2.7 1.4-5.6 2.2c-1.2 2.5-2.1 5.1-2.8 7.9-0.4 1.8-2.6 3-5.4 3.1v2.5c0 2.9-1.4 5.6-3.9 7.6-5.4 4.4-16.8 11.7-32.3 11.7s-26.9-7.3-32.3-11.7c-2.4-2-3.9-4.7-3.9-7.6v-2.5c-2.8-0.1-5-1.3-5.4-3.1-0.7-2.8-1.6-5.4-2.8-7.9-2.9-0.9-5.6-2.2-5.6-2.2l4.3-5-3.2-9.2s2.6 1 5.5 1.8c1.7 0.5 4.9 1.1 7.3 1.5v-15.4c0-1 0.1-2 0.3-3 0.7-3.9 3.3-6.5 3.3-6.5s0 3.3 1.9 2.5c2.3-0.9 1.6-4.8 3.7-8.1 4.7-7.5 12.7-10.3 12.7-10.3s-3.2 6.7 1.8 5.8c3.2-0.6 2.9-6.9 8.3-12 8.1-7.8 17.6-7.1 17.6-7.1s-7.2 5.3-8 11.6c-0.4 3.7 1.6 7.9 5.6 8.5 5.6 0.9 4.5-2.2 4.5-2.2s3.7-0.1 7.5 3.6c2.5 2.4 2.1 5.9 5.1 6.4 1.5 0.3 1.4-2.3 1.4-2.3s3.2 1.3 5.1 5.5c1.2 2.7 1.6 5.3 1.5 7.6v15.4c2.4-0.4 5.6-1 7.3-1.5 2.8-0.9 5.5-1.8 5.5-1.8l-3.3 9.2z","m67.5-0.0611c-2.04-0.0186-4 0.25-5.85 0.688-7.3 1.73-18 6.14-22.2 8.41-8.72 4.7-22.6 1.06-32.2 0.194l2.92 23.1c-0.447 0.377-0.915 0.682-1.35 1.1-4.44 4.28-7.79 10.5-8.4 18.1-0.372 4.67 0.385 9.17 1.97 13.2 1.58 3.99 3.91 7.31 6.65 9.9 2.54 2.39 5.32 4.01 8.19 5.11-0.976 0.748-2.05 1.3-2.99 2.11l10.7 17.4c8.64-7.49 20-11.1 30.6-9.7 5.12 0.661 11.7 3.06 20 2.57 4.16-0.25 8.67-1.34 12.9-4.21 4.37-2.93 8.22-7.55 10.1-14 1.34-4.53 1.46-9.24 0.594-13.7-0.859-4.41-1.65-8.96-4.02-12.2-4.14-5.63-6.67-8.38-12.2-9.55 1.09-1.79 3.6-3.7 4.32-5.88 1.11-3.4 1.64-7.11 1.37-11-0.268-3.87-1.32-7.67-3.26-11.1-2.93-5.11-7.17-8.16-11.6-9.6-2.15-0.706-4.26-1.01-6.3-1.03z","m51.7 3.39s-7.76 0.243-9.75 0.416c-1.86 0.162-4.01 0.213-6.44 0.266-7.55 0.164-15.1 0.372-22.6 0.623-6.68 0.222-11.9 5.82-11.7 12.5 0.325 3.66 2.3 6.98 5.36 9.01-1 0.664-2 1.45-2.91 2.55-1.2 1.44-2.19 3.2-2.73 5.38-0.542 2.21-0.561 4.6 0.238 7.11 0.814 2.56 2.34 4.86 4.81 6.62 1.65 1.18 3.17 1.73 4.57 2.05-1.09 1.09-2.92 2.93-4.24 6.62-0.764 2.13-1.22 4.7-0.748 7.67 0.488 3.08 1.88 6.16 4.76 8.69 0.904 0.794 1.76 1.38 2.55 1.84-5.83 3.14-8.06 10.4-4.99 16.3 3.11 5.91 8.02 7.85 15.7 6.6 4.5-0.588 8.83-1.4 13.3-2.01 7.35 0.434 14-0.585 18.2-0.808 5.45-0.243 8.88-1.26 10.5-1.35 1.49-0.0776 4.49 0.386 9.04 0.439 2.28 0.027 5.83-1.53 8.46-2.8 2.77-1.35 6.19-2.06 9.15-4.48 1.96-1.6 3.81-3.67 5.18-6.37 1.02-2 2.24-5.05 1.69-9.26-0.205-1.55-0.793-3.16-1.62-4.75 0.928-2.51 1.45-5.39 0.799-8.69-0.553-2.81-2-5.19-3.88-7.28 0.927-1.06 1.81-2.26 2.51-3.82 0.998-2.25 1.55-4.87 1.18-7.85-0.348-2.77-1.46-5.95-4.54-8.68-0.251-0.222-0.499-0.356-0.75-0.551 0.483-0.438 0.981-0.809 1.44-1.34 1.69-1.96 2.98-4.4 3.47-7.37 0.502-3.03 0.128-6.19-1.51-9.26-1.96-3.66-4.77-5.52-7.19-6.6-2.29-1.02-4-1.25-4.9-1.39-8.02-1.28-14 0.0821-17.6-0.483zm-28.5 49.5c-0.38-0.0969-0.159-0.137 0.438 0.102-0.2-0.0513-0.231-0.0488-0.438-0.102z","m84.8 0.869c-5.02 0.251-10.1-0.442-15 0.896-5.22 0.146-10.4 1.2-15.6 1.48-4.05 0.815-8.31 0.0499-12.3 1.33 1.43-0.679-4.41 0.385-6.32 0.408-6.76 0.17-13.5 0.457-20.3 0.322-3.41 0.185-6.94-0.433-10.3 0.444-5.37 1.74-3.41 9.51 0.453 10.4-5.31 1.74-4.09 10.6 1.42 11-4.21 2.27-3.18 9.11 1.41 10.2-2.18 2.33-3.93 5.84-1.44 8.69 4.6 2.01-2.5 3.66-0.256 7.42 1.9 5.4 8.45 2.04 12.6 2.94 3.14 0.0137 3.8 1.32 0.371 1.76-4.1 1.73-8.77 3.41-11.6 6.95-3.14 4.08 3.82 6.8 0.532 9.93-0.47 2.53 1.56 4.79-2.37 4.05-5.74-0.1-7.69 8.76-2.68 11.3 4 1.75 7.9 2.31 10.3 6.04 3.21 1.25 6.69 0.132 10-0.203 6.22-1.23 12.5 0.58 18.8 0.443 11.7 0.511 23.5-0.0068 35-2.2 4.33-1.02 8.72-1.8 12.9-3.21 3.99-1.56 7.68-5.21 6.84-9.71-0.012-4.4-5.85-6.18-7.77-5.45-2.68 0.632-4.09-1.24-5.94-2.5 4.27-2.03 9.39-3.35 12.3-7.29 2.62-4.3-2.09-9.97-6.78-8.22-1.1 0.327-2.97 1.72-0.838 0.416-4.37 3.51-4.82-4.46-9.72-3.11 1.87-1.46 8.91-4.78 2.99-2.35-4.86 1.67 4.88-1.29 6.79-2.34 1.62-0.784-3.68-5.75 1.25-4.09 2.81 2.24 2.16-1.46 2.43-2.63 3.38-2.45 0.6-6.82-0.0624-8.94 2.44-1.51 1.21-4.08 1.14-6.33-0.477-4.67-5.18 4.82-4.53 1.09-0.0838-2.09 5.2-3.33 3.62-7.9-3.1-3.56 3.49-7.52-0.873-11.2-2.29-1.88 1.11-7.41-3.46-9.04-0.97-0.535-2.1-0.82-3.21-0.768zm5.24 9.12c0.0118-0.00178 0.0507 0.0433 0 0zm-1.22 40.2c-0.331 0.34-1.93 0.69 0 0zm-74.3 46.1c2.4 0.856 1.33 0.876 0 0z","m72.8 1.64c-5.3 0.108-12.7 0.345-15.7 0.501-14.9 0.773-29.5-0.736-41.1 0.0102-11.6 0.747-14.5 7.19-15.7 16.7-1.21 9.55 3.18 15.6 10.6 17.4 4.59 1.1 9.22 1.9 13.9 2.42l-5.24 1.78 0.604-0.188c-5.22 1.45-9.7 5.05-13 10.4-3.27 5.36-4.9 11.8-4.7 18.5 0.226 7.85 2.83 14.9 7.43 20.2 4.6 5.26 10.4 7.81 16.6 7.28l-2.05-0.0203c10.1 1.07 20.3 1.8 30.5 2.19 9.78 0.375 19.6 0.436 29.3 0.181 7.56-0.196 13.6-8.12 13.4-17.7-0.156-9.58-6.41-17.2-14-17-1.78 0.0465-3.57-0.0584-5.35-0.0339 4.95-3.39 9.51-7.67 13.4-12.9 1.75-2.31 3.9-5.39 5.68-9.8 1.83-4.54 2.47-7.45 1.81-14.2-0.785-7.99-4.04-14.1-8.21-18.4-4.04-4.15-8.5-6.1-12.6-6.88-2.02-0.384-3.91-0.515-5.68-0.479z","m16.4 0.00257a6.4 6.35 0 0 0-6.58 6.17 6.4 6.35 0 0 0 6.22 6.52c5.1 0.143 10.4 0.305 19.4 0.795-7.6 1.3-13.5 2.56-16.8 3.57-1.11 0.343-1.97 0.534-3.44 1.35-0.732 0.409-2.08 0.675-3.22 3.57-0.572 1.45-0.529 3.74 0.203 5.25 0.732 1.5 1.67 2.21 2.34 2.66 2.65 1.78 3.38 1.38 4.93 1.62 1.55 0.239 3.45 0.44 5.97 0.653 5.03 0.425 13.4 0.791 21.2 1.22-1.71 0.318-3.67 0.688-5.16 0.972-6.36 1.22-10.4 2.08-13 2.75-1.32 0.339-2.29 0.613-3.24 0.98-0.478 0.184-0.951 0.371-1.62 0.779-0.67 0.408-1.85 0.867-2.82 3.27-0.483 1.2-0.629 3.1-0.0735 4.61 0.555 1.51 1.5 2.43 2.19 2.95 1.38 1.05 2.09 1.1 2.64 1.24 1.12 0.276 1.72 0.286 2.43 0.327 1.42 0.0823 2.96 0.0728 4.6 0.0728h6.99c-0.382 0.111-1.17 0.293-1.52 0.398-2.22 0.668-3.57 1.05-5.24 1.91-0.416 0.216-0.872 0.454-1.53 0.996s-1.85 1.42-2.33 3.86c-0.481 2.44 1.16 5.38 2.35 6.33 1.19 0.95 1.93 1.11 2.49 1.27 1.8 0.528 2.79 0.52 3.96 0.52-9.64 2.52-18.7 4.99-24.4 6.58-4.53 1.27-6.68 1.76-8.81 2.63-0.533 0.217-1.05 0.279-2.32 1.38-0.633 0.55-1.72 1.54-2.14 3.66-0.421 2.12 0.675 4.63 1.64 5.66 1.94 2.05 2.69 1.77 3.26 1.93 0.571 0.166 0.958 0.239 1.35 0.315 2.75 0.527 8.63 1.11 18.6 1.55 0.0405 0.681 0.0582 1.39 0.286 1.93 0.643 1.54 1.51 2.25 2.09 2.68 1.15 0.866 1.66 0.932 2.09 1.07 0.866 0.281 1.35 0.344 1.98 0.443 1.26 0.198 2.85 0.364 5.17 0.559 9.29 0.78 29.8 1.87 50.5 2.98a6.4 6.35 0 0 0 6.74-6 6.4 6.35 0 0 0-0.584-2.82c0.36-0.184 0.751-0.398 1.46-1.05 0.861-0.794 2.37-3 1.98-5.6-0.391-2.6-1.95-3.79-2.71-4.31-1.53-1.04-1.88-0.893-2.23-0.974-1.39-0.324-1.36-0.204-1.75-0.234-1.58-0.123-4.34-0.277-15.8-0.425-7.69-0.0991-19.2-0.304-30-0.49 4.65-1.2 9.29-2.44 13.8-3.48 14.9-3.42 27.2-5.34 32.7-6.73 0.686-0.174 1.27-0.33 1.99-0.604 0.359-0.137 0.748-0.289 1.34-0.644 0.594-0.355 1.63-0.725 2.65-2.88 0.51-1.08 0.801-2.79 0.429-4.28s-1.21-2.55-1.86-3.16c-1.31-1.22-2.06-1.34-2.6-1.52-1.09-0.355-1.61-0.376-2.24-0.445-2.51-0.274-5.82-0.28-10.7-0.317-0.0931-7.01e-4 -0.236 6.87e-4 -0.33 0 0.21-0.0548 0.585-0.154 0.786-0.207 2.45-0.643 4.24-1.13 5.58-1.53 1.34-0.399 1.87-0.413 3.5-1.32 0.406-0.228 0.94-0.439 1.86-1.51 0.461-0.534 1.08-1.36 1.4-2.74 0.322-1.38 0.0653-3.29-0.639-4.55-1.41-2.52-2.88-2.73-3.58-2.98-0.702-0.245-1.08-0.29-1.39-0.337-0.341-0.0498-0.404-0.0151-0.649-0.0354 0.542-0.114 1.67-0.301 2.16-0.407 2.52-0.551 4.28-0.988 5.73-1.46 0.723-0.234 1.35-0.442 2.2-0.901 0.428-0.23 0.93-0.504 1.62-1.15 0.688-0.641 1.8-1.83 2.07-4.01 0.272-2.17-0.911-4.44-1.88-5.41-0.967-0.962-1.68-1.25-2.21-1.47-1.06-0.452-1.62-0.519-2.18-0.618-1.13-0.199-2.12-0.274-3.15-0.356-4.16-0.33-9.38-0.547-22-1.15-0.0481-0.0023-0.113-0.0076-0.161-0.0099 5.35-0.609 12-1.36 15.3-1.84 2.08-0.301 3.56-0.556 4.86-0.886 0.649-0.165 1.24-0.319 2.08-0.709 0.845-0.39 2.78-0.677 3.81-4.31 0.517-1.82-0.0388-4.13-0.822-5.32-0.783-1.19-1.52-1.67-2.05-2-1.06-0.672-1.6-0.794-2.11-0.955-1.03-0.32-1.82-0.464-2.64-0.626-3.3-0.65-7.81-1.36-17.1-2.16-9.24-0.804-23.3-1.72-33-2.26-9.71-0.537-15.1-0.687-20.3-0.834zm-7.83 76.3c0.0849 0.0247 0.264-0.0317 0.59 0.0807-0.0708-0.0128-0.349-0.0373-0.411-0.0492-0.23-0.0442-0.359-0.0841-0.179-0.0315z","m15 0.00104a6.81 8.11 0 0 0-6.91 7.98 6.81 8.11 0 0 0 6.7 8.23c3.08 0.0583 5.73 0.128 8.76 0.187-0.375 0.129-0.886 0.258-1.24 0.388-1.88 0.696-3.23 0.987-5.39 2.9-1.08 0.959-3.37 3.18-3.15 7.71 0.219 4.53 2.88 6.58 4.13 7.37 1.6 1.01 2.86 1.36 4.15 1.61-0.141 1.66-0.0734 3.37 0.453 4.62 0.889 2.1 1.89 2.8 2.5 3.26 2.45 1.82 2.42 1.15 2.89 1.24 0.473 0.0921 0.87 0.142 1.34 0.195 0.936 0.107 2.11 0.203 3.72 0.313 2.47 0.169 7.02 0.368 10.8 0.57-2.7 0.642-5.02 1.15-7.5 1.75-15.4 3.77-24.7 6.36-29.6 8.36-1.21 0.499-2.02 0.651-3.7 2.14-0.841 0.746-2.73 2.15-2.96 6.33-0.115 2.09 0.607 4.33 1.43 5.61 0.819 1.28 1.59 1.86 2.18 2.26 2.34 1.59 2.96 1.25 3.93 1.39 0.968 0.146 1.94 0.225 3 0.299 2.53 0.177 7.62 0.237 11.8 0.331-0.0236 0.0284-0.0312 0.0225-0.0552 0.0518-0.776 0.949-1.88 2.87-1.96 5.46-0.0726 2.58 1.01 4.78 1.82 5.83 1.63 2.11 2.4 2.06 2.96 2.29 1.71 0.718 2.52 0.777 3.49 0.855a6.81 8.11 0 0 0-0.821 2.9 6.81 8.11 0 0 0 7.25 7.55c18.1-1.45 36.3-2.91 45.2-3.65 4.47-0.373 6.19-0.461 7.94-0.787 0.219-0.0407 0.446-0.0803 0.851-0.203 0.405-0.123 0.782 0.275 2.74-1.63 0.977-0.954 2.88-3.94 2.43-7.51-0.29-2.28-1.06-3.49-1.81-4.35 0.426-0.121 0.962 0.242 2.9-2.09 0.996-1.2 2.44-4.65 1.76-7.77-0.68-3.12-2.16-4.22-2.9-4.79-0.201-0.156-0.252-0.147-0.415-0.259 2.91e-4 -0.0022 0.0086-0.0677 0.0086-0.0677-5.1e-5 -5.82e-4 -0.401-2.04-0.401-2.04-1.8e-4 -5.79e-4 -0.432-1.15-0.677-1.59-0.49-0.891-0.986-1.45-1.39-1.84-1.63-1.59-2.14-1.43-2.55-1.56-0.405-0.131-0.617-0.167-0.792-0.199-0.351-0.0646-0.527-0.078-0.699-0.0936-0.344-0.0313-0.615-0.0415-0.94-0.0538-0.65-0.0245-1.46-0.0395-2.47-0.0538-4.06-0.0573-11.4-0.0936-21.4-0.149-0.704-4e-3 -1.52-0.0138-2.25-0.0179 9.3-2.15 19.7-4.61 25.4-5.92 5.17-1.21 7.46-1.75 9.07-2.27 0.402-0.13 0.656-0.146 1.61-0.683 0.478-0.268 1.29 0.0431 2.94-3.09 0.824-1.56 1.39-5.17 0.431-7.69-0.962-2.52-2.28-3.35-3.01-3.82-2.93-1.86-2.63-0.956-2.99-0.986-0.361-0.0296-0.579-0.0305-0.776-0.0359-1.18-0.032-4.54-0.0306-8.24-0.0319 0.504-2.45 0.311-5.91-0.685-7.55-1.3-2.14-2.24-2.4-2.8-2.7-2.26-1.2-2.15-0.724-2.71-0.795-2.2-0.283-5.44-0.377-11.3-0.592-0.898-0.0328-2.36-0.103-3.36-0.139 0.966-0.213 2.26-0.514 3.15-0.707 9.85-2.16 14.1-3.04 16.6-3.52 0.638-0.119 1.2-0.218 1.71-0.317 0.511-0.0982 0.134 0.367 2.33-0.701 0.549-0.267 1.92 0.456 3.69-4.23 0.882-2.34 0.325-6.49-0.794-8.25-1.12-1.75-1.98-2.13-2.53-2.44-2.18-1.23-2.06-0.742-2.43-0.791-0.73-0.0972-1.25-0.114-2.08-0.153-3.34-0.158-10.7-0.339-17.8-0.562-7.12-0.223-14-0.485-22.4-0.709-8.4-0.224-18.3-0.411-28.1-0.598zm68.4 18.1c0.147 0.0109 0.537 0.038 0.477 0.0299-0.0416-0.0055-0.126 0.0615-0.477-0.0299zm-8.05 6.25c-0.0726 0.0123-0.115 0.0254-0.187 0.0359 0.092-0.0441 0.11-0.0186 0.187-0.0359zm16.6 26.6c0.0692 0.0015 0.482 2.94e-4 0.545 2e-3 0.155 0.0042 0.258 0.0128 0.15 4e-3 -0.0653-0.0053-0.187 0.129-0.696-6e-3z","m8.55 0c-3.58 0-6.49 3.34-6.49 7.47 0 4.12 2.9 7.47 6.49 7.47 6.65 0 11.1 0.0284 17.4 0.0331-3.94 1.03-8.41 2.2-10.6 2.79-0.819 0.227-1.51 0.402-2.44 0.766-0.465 0.182-0.882 0.156-2.23 1.3-0.672 0.573-2.07 1.59-2.59 4.7-0.519 3.1 1.3 6.39 2.4 7.38 0.545 0.494 0.751 0.517 1.11 0.755-0.851 0.793-1.7 2.04-1.92 4.9-0.182 2.34 0.842 4.76 1.76 5.9 0.918 1.14 1.65 1.54 2.21 1.84 0.944 0.509 1.56 0.69 2.17 0.838-1.84 0.486-3.3 0.907-4.29 1.22-0.573 0.181-1.06 0.264-2.19 0.815-0.564 0.276-1.61-0.521-3.49 3.62-0.943 2.07-0.548 6.47 0.701 8.25 1.25 1.79 2.16 2.06 2.75 2.33 2.35 1.09 2.65 0.734 3.96 0.84 1.3 0.106 2.99 0.184 5.33 0.249 0.967 0.0271 3.08 0.0164 4.25 0.0389-0.03 0.453 0.0463 0.927 0.098 1.4-2.79 0.294-7.31 0.716-8.76 0.912-0.7 0.0953-1.23 0.142-2.14 0.362-0.228 0.0549-0.477 0.109-0.958 0.298-0.481 0.188-1.27-0.522-3.31 2.84-1.02 1.68-1.39 5.87-0.314 8.03 0.158 0.316 0.293 0.383 0.448 0.63-0.508 0.0914-1.46 0.14-1.89 0.241-0.532 0.124-0.976 0.17-2.04 0.712-0.53 0.271-1.32 0.478-2.56 2.24-0.618 0.881-1.34 2.39-1.45 4.26s0.508 3.71 1.15 4.78c1.29 2.14 2.23 2.37 2.81 2.67 0.579 0.299 0.942 0.411 1.27 0.51 0.65 0.198 1.13 0.285 1.67 0.375 1.54 0.258 4.31 0.452 6.99 0.661 0.0178 0.111 0.098 0.609 0.098 0.609 1.18e-4 1.99e-4 1.89 2.09 1.89 2.09 2.8e-4 2.02e-4 0.772 0.486 1.02 0.601 0.245 0.114 0.421 0.179 0.566 0.229 0.29 0.101 0.458 0.142 0.591 0.173 1.07 0.25 0.834 0.133 0.97 0.144 1.08 0.0833 2.67 0.123 7.18 0.268 9.02 0.291 28.2 0.873 47.3 1.45 3.58 0.109 6.56-3.15 6.66-7.27-2e-3 -1.13-0.225-2.24-0.652-3.25 0.701-0.0264 2.38-0.0732 2.76-0.0953 0.271-0.0158 0.336 0.0035 0.939-0.0894 0.151-0.0232 0.305-0.0279 0.838-0.191 0.266-0.0814 0.597-0.129 1.45-0.665 0.214-0.134 0.77-0.57 0.77-0.57 3.18e-4 -2.72e-4 1.07-1.16 1.07-1.16 1.82e-4 -2.48e-4 0.923-1.85 1.08-2.17 1.29-0.0298 2.68-0.0594 3.47-0.0894 0.577-0.0219 1.03-0.0442 1.44-0.0739 0.41-0.0297 0.296 0.157 1.8-0.299 0.375-0.114 0.824 0.0351 2.36-1.34 0.384-0.343 0.855-0.825 1.34-1.62 0.242-0.398 0.484-0.879 0.686-1.44 0.202-0.566 0.437-1.91 0.438-1.91 8e-5 -7.61e-4 -0.0253-2.08-0.0253-2.08-1.04e-4 -7.63e-4 -0.259-1.29-0.459-1.82-0.4-1.06-0.901-1.77-1.32-2.26-1.67-1.96-2.22-1.73-2.63-1.88-0.408-0.156-0.616-0.203-0.792-0.245-0.704-0.168-0.9-0.164-1.25-0.204-0.693-0.0796-1.51-0.147-2.49-0.233-0.837-0.0735-2.51-0.187-3.65-0.28 0.199-0.404 0.481-1.07 0.481-1.07 2.07e-4 -5.98e-4 0.387-1.59 0.387-1.59 1.21e-4 -8.51e-4 -0.0995-1.5-0.167-2.52 0.137-0.0616 0.22-0.0839 0.427-0.202 0.205-0.117 0.453-0.269 0.782-0.527 0.329-0.258 1.25-1.29 1.26-1.29 4.23e-4 -5.67e-4 1.44-3.33 1.44-3.34 5.2e-5 -2.7e-4 0.0828-2.54 0.0828-2.54-2.6e-5 -2.64e-4 -0.616-2.32-0.617-2.32-2.17e-4 -5.13e-4 -1.79-2.54-1.79-2.54s-0.924-0.716-1.24-0.889c-1.26-0.692-1.52-0.587-1.79-0.636-1.09-0.198-0.941-0.0984-1.11-0.101-0.166-0.0027-0.293-2e-3 -0.414-2e-3 -0.963 0-2.41 0.0013-5.46-0.0525-0.439-0.0078-2.35-0.0252-2.88-0.035 0.639-0.112 3.1-0.579 3.52-0.648 0.421-0.0691 0.0365 0.255 1.99-0.453 0.244-0.0885 0.55-0.178 1.2-0.583 0.646-0.406 2.4-0.87 3.22-4.84 0.412-1.99-0.123-4.51-0.9-5.86-0.778-1.35-1.52-1.9-2.03-2.26-1.02-0.72-1.44-0.769-1.77-0.869-1.33-0.402-1.33-0.264-1.71-0.292-0.0603-0.0045-0.318-0.0055-0.382-0.0098 0.192-0.174 0.26-0.164 0.502-0.416 0.797-0.833 2.35-3 2.11-6.18-0.231-3.18-2-4.93-2.86-5.6-1.73-1.34-2.11-1.09-2.51-1.17-0.788-0.175-1.06-0.161-1.41-0.183-0.717-0.044-1.42-0.051-2.23-0.0603-1.68-0.0194-6.55-0.0346-9.66-0.0467 1.96-0.633 4.16-1.3 5.6-1.87 1.19-0.466 2.18-0.884 3.22-1.49 0.522-0.302 1.06-0.62 1.79-1.3 0.736-0.679 2.14-1.72 2.6-5.03 0.229-1.66-0.138-3.76-0.855-5.15-0.716-1.39-1.55-2.14-2.19-2.61-1.27-0.948-2-1.08-2.66-1.25-1.31-0.35-2.34-0.43-3.71-0.527-2.75-0.195-6.6-0.254-12.2-0.299-11.1-0.0915-29-0.0914-46.9-0.0914z","M 0,100 V 0 H 100 V 100 H 99 A 49,-98 0 0 0 50,2 49,-98 0 0 0 1,100 Z","M 0,0 V 100 H 100 V 0 H 99 A 49,98 0 0 1 50,98 49,98 0 0 1 1,0 Z","M 0,100 V 0 H 100 V 100 H 95 A 45,-90 0 0 0 50,10 45,-90 0 0 0 5,100 Z","m0 0v100h100v-100h-5a45 90 0 0 1-45 90 45 90 0 0 1-45-90z","M 0,100 V 0 H 100 V 100 H 90 A 40,-80 0 0 0 50,20 40,-80 0 0 0 10,100 Z","M 0,0 V 100 H 100 V 0 H 90 A 40,80 0 0 1 50,80 40,80 0 0 1 10,0 Z","m 0,0 v 100 h 10.035156 c 1.705045,-6.54927 3.941587,-12.742544 6.720703,-18.300782 l 20.09375,-40.1875 C 50.561077,14.088757 71.945169,12.702882 84.796875,38.40625 92.993332,54.799136 95.671807,78.132046 92.986328,100 H 100 V 0 Z","M 0,0 V 100 H 100 V 0 H 92.986328 C 91.461087,12.420096 88.21082,24.367414 83.244141,34.300782 L 63.150391,74.48828 C 49.438924,101.91124 28.054831,103.29712 15.203125,77.59375 4.9562739,57.10008 3.3279352,25.763198 10.035156,0 Z","M 100,0 C 98.542915,3.142831 97.022904,6.152491 95.425781,8.973086 L 62.601562,66.942421 C 40.203879,106.49781 13.008645,96.967171 1.625,45.571361 1.0225932,42.851581 0.48998452,40.055281 0,37.221491 V 100 h 100 z","M 0,0 V 10 C -1.5552177e-6,6.609576 0.10489712,3.277196 0.28515625,0 Z m 0,10 v 90 H 100 V 10 c 1e-5,44.31998 -15.860419,79.99998 -35.5625,80 H 35.5625 C 15.860418,90.00002 0,54.31999 0,10 Z m 100,0 V 0 H 99.714844 C 99.895106,3.277194 99.999998,6.609576 100,10 Z","M 0,0 V 99.999998 H 100 V 26.237487 A 61.723576,126.74566 7.430995 0 1 82.216797,52.190278 61.723576,126.74566 7.430995 0 1 1.3339844,8.692257 61.723576,126.74566 7.430995 0 1 0,0 Z"].forEach((t=>{const i=(0,s.T)("div",{className:"shape-setting-pod"});i.setAttribute("data",t),i.addEventListener("click",this.selectPreset,!0),i.appendChild(this.createPreview(t)),t===this.path&&(this.selected=i,this.selected.classList.add("active")),e.append(i)}));let t=e.querySelector(".active");t&&t.scrollIntoView({behavior:"auto",block:"center",inline:"nearest"})},this.createPreview=e=>{const t=m.vL(50,50),i=t.getContext("2d"),s=new Path2D;return s.addPath(new Path2D(e),(new DOMMatrix).scale(.48,.48)),i.translate(1,1),i.lineWidth=2,i.strokeStyle="rgba(255, 255, 255, .5)",i.fillStyle="rgba(0, 0, 0, 0.6)",i.fill(s),i.stroke(s),t},this.selectPreset=e=>{var t;null===(t=this.selected)||void 0===t||t.classList.remove("active"),this.selected=e.currentTarget,this.selected.classList.add("active"),this.path=this.selected.getAttribute("data"),this.preview&&this.preview(this.path),"x"===x.ZP.product&&this.cleanUp()},this.cleanUp=()=>{this.callback&&this.callback(this.path),this.container.remove(),this.modal.remove()},this.path=t,this.preview=n,this.callback=i,this.modal=(0,s.ZP)("workspace").appendChild((0,s.T)("div",{id:"shape-selector-modal",className:"modal"}));let a=(0,s.T)("div",{id:"shape-selector-presets"});this.container=(0,s.T)("div",{id:"shape-selector",className:"shape-float"},a),(0,s.ZP)("workspace").appendChild(this.container),this.modal.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),e.target===e.currentTarget&&this.cleanUp()}),!1);let r=e.getBoundingClientRect();if("x"===x.ZP.product)this.container.style.width="320px",this.container.style.top=r.bottom-15+"px",this.container.style.left="50px",this.container.offsetTop+this.container.offsetHeight>(0,s.ZP)("workspace").offsetHeight&&(this.container.style.top=(0,s.ZP)("workspace").offsetHeight-this.container.offsetHeight+"px");else{this.container.style.top=r.bottom-5+"px",this.container.style.left=r.left-~~(this.container.offsetWidth/2)+40+"px";const e=(0,s.T)("img",{src:"/img/icon/three-dot.svg",className:"resize ic"});(0,s.Rg)(e,this.resizeStart,this.resizeMove),this.container.append(e)}new k.Z((0,s.ZP)("shape-selector-presets")),this.populatePresets()}}class O{constructor(e,t,i){this.path="M 0,0 H 100 V 100 H 0 Z",this.previewPath=e=>{this.setPath(e),this.preview&&this.preview(this.path)},this.callbackPath=e=>{this.setPath(e),this.callback&&this.callback(this.path)},this.setPath=e=>{this.path=e;let t=this.thumbnail.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height);const i=new Path2D;i.addPath(new Path2D(this.path),(new DOMMatrix).scale((t.canvas.width-2)/100,(t.canvas.height-2)/100)),t.save(),t.lineWidth=1,t.translate(1,1),t.strokeStyle="rgba(255, 255, 255, 0.4)",t.fillStyle="rgba(0, 0, 0, 0.3)",t.fill(i),t.stroke(i),t.restore()},this.getPath=()=>this.path,this.toggle=()=>{new N(this.container,this.path,this.callbackPath,this.previewPath)},this.cleanUp=()=>{this.container.setAttribute("data",this.path),this.container.removeEventListener("click",this.toggle,!1)},this.preview=i,this.callback=t,this.container=(0,s.ZP)(e),this.container.hasChildNodes()?(this.thumbnail=(0,s.ZP)(e+"-canvas"),this.container.hasAttribute("data")&&(this.path=this.container.getAttribute("data"))):(this.container.classList.add("shape-pod"),this.thumbnail=(0,s.T)("canvas",{id:e+"-canvas",width:30,height:30}),this.container.append(this.thumbnail)),this.container.addEventListener("click",this.toggle,!1),this.setPath(this.path)}}class B extends p{constructor(e){let t;super(e),this.stage=e,this.setType=()=>{let e=document.querySelector('input[name="shape-design-type"]:checked').value;(0,s.ZP)("shape-design-path").style.display="path"===e?"block":"none",(0,s.ZP)("shape-design-outline-radii").style.display="rounded"===e?"block":"none"},this.selectType=()=>{let e=document.querySelector('input[name="shape-design-type"]:checked').value;const t=this.selected.shapeSettings.clone();"path"===e?this.selected.setPath(this.shape.getPath()):this.selected.setVariant(e),this.stage.history.add({type:"shapeSettings",kind:"type",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render")),this.setType()},this.previewShape=e=>{this.selected.setPath(e,!0),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectShape=e=>{const t=this.selected.shapeSettings.clone();this.selected.setPath(e),this.stage.history.add({type:"shapeSettings",kind:"shape",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.previewFill=e=>{this.selected.setFill(e,!0),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectFill=e=>{const t=this.selected.shapeSettings.clone();this.selected.setFill(e),this.stage.history.add({type:"shapeSettings",kind:"fill",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutlineState=()=>{const e=this.selected.shapeSettings.clone();this.changeOutline(),this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutline=()=>{let e=(0,s.ZP)("shape-design-outline").checked,t=this.outlineColor.getColor().toHEX(),i=this.outlineSize.getValue();this.selected.setOutline(e?i:0,t),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectLine=()=>{const e=this.selected.shapeSettings.clone();this.selected.setOutline(this.lineSize.getValue(),this.lineColor.getColor().toHEX()),this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.previewOutlineColor=e=>{this.selected.setOutline(this.outlineSize.getValue(),this.outlineColor.getColor().toHEX()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectOutlineRadii=()=>{const e=this.selected.shapeSettings.clone();this.selected.setRadii(this.outlineRadii.getValue()),this.stage.history.add({type:"shapeSettings",kind:"radii",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowState=()=>{const e=this.selected.shapeSettings.clone();this.changeShadow(),this.stage.history.add({type:"shapeSettings",kind:"shadow",layer:this.selected,settings:e})},this.changeShadow=()=>{this.selected.setShadow((0,s.ZP)("shape-shadow").checked,this.shadowBlur.getValue(),this.shadowOpacity.getValue(),this.shadowColor.getColor().toHEX(),this.shadowDistance.getValue(),this.shadowDirection.getValue()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowColor=e=>{const t=this.selected.shapeSettings.clone();this.changeShadow(),this.stage.history.add({type:"shapeSettings",kind:"shadow",layer:this.selected,settings:t})},this.setLayer=e=>{if(this.selected=e,"svg"===this.selected.shapeSettings.variant)return void(this.selected=void 0);let t=this.selected.shapeSettings;"line"!==t.variant?((0,s.ZP)("shape-design-settings").style.display="block",(0,s.ZP)("shape-design-line-settings").style.display="none",(0,s.ZP)("shape-design-type-"+t.variant).checked=!0,this.setType(),(0,s.ZP)("shape-design-outline").checked=t.outlineSize>0,this.outlineRadii.setValue(t.radii),this.outlineSize.setValue(t.outlineSize),this.outlineColor.setHex(t.outlineColor),this.fill.setFill(this.selected.fill),"path"===t.variant&&this.shape.setPath(t.content)):(t.outlineSize=this.selected.rect.height,(0,s.ZP)("shape-design-settings").style.display="none",(0,s.ZP)("shape-design-line-settings").style.display="block",this.lineSize.setValue(t.outlineSize),this.lineColor.setHex(t.outlineColor)),(0,s.ZP)("shape-shadow").checked=this.selected.shapeSettings.shadow,this.shadowColor.setHex(this.selected.shapeSettings.shadowColor),this.shadowBlur.setValue(this.selected.shapeSettings.shadowBlur),this.shadowOpacity.setValue(this.selected.shapeSettings.shadowOpacity),this.shadowDistance.setValue(this.selected.shapeSettings.shadowDistance),this.shadowDirection.setValue(this.selected.shapeSettings.shadowDirection)},this.cleanUp=()=>{this.fill.cleanUp(),this.shape.cleanUp(),this.outlineSize.cleanUp(),this.outlineRadii.cleanUp(),this.lineSize.cleanUp(),this.outlineSize.cleanUp(),this.shadowBlur.cleanUp(),this.shadowOpacity.cleanUp(),this.shadowDistance.cleanUp(),this.shadowDirection.cleanUp(),(0,s.ZP)("shape-shadow").removeEventListener("change",this.changeShadowState,!1),(0,s.ZP)("shape-design-outline").removeEventListener("change",this.changeOutlineState,!1),document.querySelectorAll('input[name="shape-design-type"]').forEach((e=>e.removeEventListener("change",this.selectType)))},document.querySelectorAll('input[name="shape-design-type"]').forEach((e=>e.addEventListener("change",this.selectType))),this.shape=new O("shape-design-shape",this.selectShape,this.previewShape),this.fill=new M("shape-design-fill",new g.Z(v.Z.fromHEX(x.ZP.mainColor)),this.selectFill,this.previewFill),this.outlineColor=new P.Z((0,s.ZP)("shape-design-outline-color"),void 0,this.changeOutlineState,!0,280,120),this.shadowColor=new P.Z((0,s.ZP)("shape-shadow-color"),void 0,this.changeShadowColor,!0,280,120),this.outlineSize=new o.Z("shape-design-outline-size",{onStart:()=>{t=this.selected.shapeSettings.clone()},label:(0,n.Z)("size"),defaultValue:4,range:[1,100],step:1,onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:t})}}),this.outlineRadii=new o.Z("shape-design-outline-radii",{label:(0,n.Z)("radii"),defaultValue:5,range:[0,100],step:1,onEnd:this.selectOutlineRadii}),this.lineColor=new P.Z((0,s.ZP)("shape-design-line-color"),void 0,this.selectLine),this.lineSize=new o.Z("shape-design-line-size",{label:(0,n.Z)("size"),defaultValue:1,range:[1,100],step:1,onEnd:this.selectLine});const i={labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,100)/100,range:[0,1],onChange:()=>this.changeShadow(),onStart:()=>{t=this.selected.shapeSettings.clone()},onEnd:()=>{this.stage.history.add({type:"shapeSettings",kind:"shadow",layer:this.selected,settings:t})}};this.shadowBlur=new o.Z("shape-shadow-blur",Object.assign(Object.assign({},i),{label:(0,n.Z)("blur")})),this.shadowOpacity=new o.Z("shape-shadow-opacity",Object.assign(Object.assign({},i),{label:(0,n.Z)("opacity"),defaultValue:1})),this.shadowDistance=new o.Z("shape-shadow-distance",Object.assign(Object.assign({},i),{label:(0,n.Z)("distance"),range:[0,1]})),this.shadowDirection=new o.Z("shape-shadow-direction",Object.assign(Object.assign({},i),{label:(0,n.Z)("direction"),range:[0,360],defaultValue:180,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10)})),(0,s.ZP)("shape-shadow").addEventListener("change",this.changeShadowState,!1),(0,s.ZP)("shape-design-outline").addEventListener("change",this.changeOutlineState,!1)}}class U extends p{constructor(e){let t;super(e),this.stage=e,this.toggleMode=()=>{this.selected.editMode||this.selected.canvas?(this.selected.editMode=!this.selected.editMode,(0,s.ZP)("frame-position-title").innerText=this.selected.editMode?(0,n.Z)("titlePositionFrame"):(0,n.Z)("titlePositionContent"),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))):this.stage.notify("frameNoContent")},this.selectShape=e=>{const t=this.selected.frameSettings.clone();this.selected.setPath(e),this.stage.history.add({type:"frameSettings",kind:"shape",layer:this.selected,settings:t}),window.requestAnimationFrame((()=>this.stage.render()))},this.changeOutlineState=()=>{const e=this.selected.frameSettings.clone();this.changeOutline(),this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:e})},this.changeOutline=()=>{let e=(0,s.ZP)("frame-outline").checked,t=this.outlineColor.getColor().toHEX(),i=this.outlineSize.getValue();this.selected.setOutline(e,i,t),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutlineColor=e=>{const t=this.selected.frameSettings.clone();this.changeOutline(),this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:t})},this.changeShadowState=()=>{const e=this.selected.frameSettings.clone();this.changeShadow(),this.stage.history.add({type:"frameSettings",kind:"shadow",layer:this.selected,settings:e})},this.changeShadow=()=>{this.selected.setShadow((0,s.ZP)("frame-shadow").checked,this.shadowBlur.getValue(),this.shadowOpacity.getValue(),this.shadowColor.getColor().toHEX(),this.shadowDistance.getValue(),this.shadowDirection.getValue()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowColor=e=>{const t=this.selected.frameSettings.clone();this.changeShadow(),this.stage.history.add({type:"frameSettings",kind:"shadow",layer:this.selected,settings:t})},this.setLayer=e=>{this.selected=e,(0,s.ZP)("frame-position").style.display=this.selected.canvas?"block":"none",(0,s.ZP)("frame-position-title").innerText=this.selected.editMode?(0,n.Z)("titlePositionFrame"):(0,n.Z)("titlePositionContent"),this.shapePod.setPath(this.selected.frameSettings.clip),(0,s.ZP)("frame-outline").checked=this.selected.frameSettings.outline,this.outlineColor.setHex(this.selected.frameSettings.outlineColor),this.outlineSize.setValue(this.selected.frameSettings.outlineSize),(0,s.ZP)("frame-shadow").checked=this.selected.frameSettings.shadow,this.shadowColor.setHex(this.selected.frameSettings.shadowColor),this.shadowBlur.setValue(this.selected.frameSettings.shadowBlur),this.shadowOpacity.setValue(this.selected.frameSettings.shadowOpacity),this.shadowDistance.setValue(this.selected.frameSettings.shadowDistance),this.shadowDirection.setValue(this.selected.frameSettings.shadowDirection)},this.cleanUp=()=>{this.shapePod.cleanUp(),this.outlineSize.cleanUp(),this.shadowBlur.cleanUp(),this.shadowOpacity.cleanUp(),this.shadowDistance.cleanUp(),this.shadowDirection.cleanUp(),(0,s.ZP)("frame-outline").removeEventListener("change",this.changeOutlineState,!1),(0,s.ZP)("frame-shadow").removeEventListener("change",this.changeShadowState,!1),(0,s.ZP)("frame-position").removeEventListener("click",this.toggleMode,!1),(0,s.ZP)("frame-image").removeEventListener("click",this.stage.browseFrameImage,!1)},(0,s.ZP)("frame-position").addEventListener("click",this.toggleMode,!1),(0,s.ZP)("frame-image").addEventListener("click",this.stage.browseFrameImage,!1),this.shapePod=new O("frame-shape",this.selectShape),this.outlineColor=new P.Z((0,s.ZP)("frame-outline-color"),void 0,this.changeOutlineState,!0,280,120),this.shadowColor=new P.Z((0,s.ZP)("frame-shadow-color"),void 0,this.changeShadowColor,!0,280,120);const i={onStart:()=>{t=this.selected.frameSettings.clone()},labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,100)/100};this.outlineSize=new o.Z("frame-outline-size",Object.assign(Object.assign({},i),{label:(0,n.Z)("size"),range:[.01,1],defaultValue:.3,step:.01,onChange:()=>this.changeOutline(),labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,100)/100,onEnd:()=>{this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:t})}}));const a=Object.assign(Object.assign({},i),{range:[0,1],onChange:()=>this.changeShadow(),onEnd:()=>{this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:t})}});this.shadowBlur=new o.Z("frame-shadow-blur",Object.assign(Object.assign({},a),{label:(0,n.Z)("blur")})),this.shadowOpacity=new o.Z("frame-shadow-opacity",Object.assign(Object.assign({},a),{label:(0,n.Z)("opacity"),defaultValue:1})),this.shadowDistance=new o.Z("frame-shadow-distance",Object.assign(Object.assign({},a),{label:(0,n.Z)("distance"),range:[0,1]})),this.shadowDirection=new o.Z("frame-shadow-direction",Object.assign(Object.assign({},a),{label:(0,n.Z)("direction"),range:[0,360],defaultValue:180,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10)})),(0,s.ZP)("frame-outline").addEventListener("change",this.changeOutlineState,!1),(0,s.ZP)("frame-shadow").addEventListener("change",this.changeShadowState,!1)}}class H extends r.Z{constructor(e){super("arrange",e),this.isShiftDown=!1,this.cancelClick=e=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.selectTool=e=>{let t=e.currentTarget.getAttribute("data");document.dispatchEvent(new CustomEvent("select-tool",{detail:t}))},this.addShape=()=>{this.stage.addShape()},this.addFrame=()=>{this.stage.addFrame()},this.addText=()=>{this.stage.addText()},this.inputBegin=()=>{this.stage.reform.beginHistory()},this.inputEnd=e=>{let t=e.target.id,i="arrange-width"===t||"arrange-height"===t?"resize":"move";this.stage.fresco.isSelectedType(h.Z.TYPE_TEXT)&&(i="arrange-height"===t?"w-resize":"t-resize"),this.stage.reform.commitHistory(i)},this.changeName=()=>{let e=this.stage.fresco.getLayerById(this.currentId),t=Object.assign({},e.settings);const i=(0,s.ZP)("arrange-name").value;e.settings.name!==i&&""!==i?(e.settings.name=i,this.stage.history.add({type:"layerSettings",kind:"name",layer:e,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))):(0,s.ZP)("arrange-name").value=e.settings.name},this.toggleConstraint=e=>{1===this.stage.fresco.getSelectedStack().length&&this.setConstraint(!this.stage.reform.constrain)},this.setConstraint=e=>{this.stage.reform.constrain=e,(0,s.ZP)("arrange-size-lock").style.display=this.stage.reform.constrain?"block":"none",(0,s.ZP)("arrange-size-vs").style.display=this.stage.reform.constrain?"none":"block"},this.shiftDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleConstraint())},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleConstraint())},this.layerSelect=()=>{if(!this.stage||!this.stage.fresco)return;let e=this.stage.fresco.getSelectedLinkedStack(),t=this.stage.fresco.getStackHashId(e),i=this.stage.fresco.getSelectedStack();t!==this.currentId&&this.stage.history.commitTransaction(),this.currentId=t,(0,s.ZP)("arrange-type-title").innerText=(0,n.Z)("viewArrangeTitle"),(0,s.ZP)("arrange-no-layer").style.display="none",(0,s.ZP)("arrange-has-layer").style.display="flex",(0,s.ZP)("arrange-text").style.display="none",(0,s.ZP)("arrange-shape").style.display="none",(0,s.ZP)("arrange-image").style.display="none",(0,s.ZP)("arrange-frame").style.display="none",(0,s.ZP)("arrange-transform").style.display="none",(0,s.ZP)("arrange-transform-locked").style.display="none",(0,s.ZP)("arrange-rotate").style.display="block",(0,s.ZP)("arrange-flip-horizontal").style.display="block",(0,s.ZP)("arrange-flip-vertical").style.display="block",(0,s.ZP)("arrange-duplicate").style.display="block";let a=i.length>1||1===i.length&&i[0].hasLink();if((0,s.ZP)("arrange-link").style.display=a?"block":"none",1===i.length&&i[0].rect&&i[0].rect.isSet()){let e=i[0];!e.settings.locked||e.editMode?(0,s.ZP)("arrange-transform").style.display="block":((0,s.ZP)("arrange-transform-locked").style.display="block",(0,s.ZP)("arrange-flip-horizontal").style.display="none",(0,s.ZP)("arrange-flip-vertical").style.display="none"),e instanceof c.Z?((0,s.ZP)("arrange-flip-horizontal").style.display="none",(0,s.ZP)("arrange-flip-vertical").style.display="none",(0,s.ZP)("arrange-text").style.display="block",this.textPanel||(this.textPanel=new z(this.stage)),this.textPanel.setLayer(e)):e instanceof l.Z?((0,s.ZP)("arrange-rotate").style.display=e.editMode?"none":"block",(0,s.ZP)("arrange-flip-horizontal").style.display=e.editMode?"block":"none",(0,s.ZP)("arrange-flip-vertical").style.display=e.editMode?"block":"none",(0,s.ZP)("arrange-duplicate").style.display=e.editMode?"none":"block",(0,s.ZP)("arrange-frame").style.display="block",this.framePanel||(this.framePanel=new U(this.stage)),this.framePanel.setLayer(e)):e instanceof d.Z?((0,s.ZP)("arrange-flip-horizontal").style.display="none",(0,s.ZP)("arrange-flip-vertical").style.display="none","svg"!==e.shapeSettings.variant&&(this.shapePanel||(this.shapePanel=new B(this.stage)),this.shapePanel.setLayer(e),(0,s.ZP)("arrange-shape").style.display="block")):e instanceof u.Z||((0,s.ZP)("arrange-image").style.display="block"),this.updateInputs()}else i.length>1?((0,s.ZP)("arrange-rotate").style.display="none",(0,s.ZP)("arrange-flip-vertical").style.display="none",(0,s.ZP)("arrange-flip-horizontal").style.display="none",(0,s.ZP)("arrange-transform").style.display="block",this.setConstraint(!0),this.updateInputs()):((0,s.ZP)("arrange-has-layer").style.display="none",(0,s.ZP)("arrange-no-layer").style.display="block");this.updateSelectedInfo()},this.updateSelectedInfo=()=>{let e=this.stage.fresco.getSelectedStack();if(0===e.length)return;const t=a.Z.bestFit(this.stage.fresco.width,this.stage.fresco.height,50,50),i=t.width/this.stage.fresco.width;if(1===e.length){const r=e[0];(0,s.ZP)("arrange-name").value=r.settings.name,(0,s.ZP)("arrange-name").disabled=!1,r instanceof d.Z&&"svg"===r.shapeSettings.variant?((0,s.ZP)("arrange-type-title").innerText="SVG "+(0,n.Z)(r.type),(0,s.ZP)("arrange-type").innerText="SVG "+(0,n.Z)(r.type)):r instanceof l.Z&&r.editMode?((0,s.ZP)("arrange-type-title").innerText=(0,n.Z)(r.type)+" "+(0,n.Z)("content"),(0,s.ZP)("arrange-type").innerText=(0,n.Z)(r.type)+" "+(0,n.Z)("content")):((0,s.ZP)("arrange-type-title").innerText=(0,n.Z)(r.type),(0,s.ZP)("arrange-type").innerText=(0,n.Z)(r.type));const o=this.stage.fresco.width,h=this.stage.fresco.height;let c=(0,s.ZP)("arrange-thumb");c.width=t.width,c.height=t.height;let u=c.getContext("2d");if(u.clearRect(0,0,c.width,c.height),r.canvas)if(r.rect.width/o>.5||r.rect.height/h>.5)u.scale(i,i),this.stage.renderLayer(u,r,!0);else{u.translate(t.width/2,t.height/2),u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.rotate(r.rect.rotation*Math.PI/180);const e=a.Z.bestFit(r.rect.width,r.rect.height,t.width,t.height);u.drawImage(r.bect?r.baked:r.canvas,-e.width/2,-e.height/2,e.width,e.height)}u.setTransform(1,0,0,1,0,0)}else{(0,s.ZP)("arrange-name").value=(0,n.Z)("layerGroupOf",e.length.toString()),(0,s.ZP)("arrange-name").disabled=!0,(0,s.ZP)("arrange-type-title").innerText=(0,n.Z)("layerGroup"),(0,s.ZP)("arrange-type").innerText=(0,n.Z)("layerGroup");let a=(0,s.ZP)("arrange-thumb");a.width=t.width,a.height=t.height;let r=a.getContext("2d");r.clearRect(0,0,a.width,a.height),r.scale(i,i);for(let t of e)t.canvas&&this.stage.renderLayer(r,t,!0);r.setTransform(1,0,0,1,0,0)}},this.unlock=()=>{let e=this.stage.fresco.getSelected();if(!e)return;const t=Object.assign(Object.assign({},e.settings),{rect:e.rect.clone()});e.settings.locked=!1,document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.stage.history.add({type:"layerSettings",kind:"locked",layer:e,settings:t})},this.inputPosition=e=>{let t=Math.round(Number((0,s.ZP)("arrange-top").value)),i=Math.round(Number((0,s.ZP)("arrange-left").value));this.stage.reform.inputPosition(i,t)},this.inputSize=e=>{if("arrange-width"==e.currentTarget.id){let e=(0,s.ZP)("arrange-width").value,t=Number.isNaN(Number(e))?50:Math.round(Number(e)),i=this.stage.reform.inputSize(t,void 0);(0,s.ZP)("arrange-height").value=Math.round(i.height).toString()}else{let e=(0,s.ZP)("arrange-height").value,t=Number.isNaN(Number(e))?50:Math.round(Number(e)),i=this.stage.reform.inputSize(void 0,t);(0,s.ZP)("arrange-width").value=Math.round(i.width).toString()}},this.updateInputs=()=>{let e=this.stage.fresco.getSelectedLinkedStack(),t=this.stage.fresco.getStackBounds(e);if(!t)return;(0,s.ZP)("arrange-width").value=Math.round(t.width).toString(),(0,s.ZP)("arrange-height").value=Math.round(t.height).toString(),(0,s.ZP)("arrange-top").value=Math.round(t.y).toString(),(0,s.ZP)("arrange-left").value=Math.round(t.x).toString();let i=this.stage.fresco.getSelected();i&&(i instanceof c.Z&&this.textPanel&&this.textPanel.textSize.setValue(i.textSettings.size),this.rotate.setValue(i.rect.rotation>180?i.rect.rotation-360:i.rect.rotation))},this.flip=e=>{if(!this.stage.fresco.getSelected())return;const t=e.currentTarget.getAttribute("id");this.stage.flipSelected("arrange-flip-vertical"===t)},this.linkLayer=()=>this.stage.linkLayer(),this.deleteLayer=()=>this.stage.deleteLayer(),this.duplicateLayer=()=>this.stage.duplicateLayer(),this.cleanUp=()=>{var e,t,i;null===(e=this.shapePanel)||void 0===e||e.cleanUp(),null===(t=this.framePanel)||void 0===t||t.cleanUp(),null===(i=this.textPanel)||void 0===i||i.cleanUp(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("layer-arrange",this.updateInputs,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),(0,s.ZP)("arrange-constraint").removeEventListener("click",this.toggleConstraint,!1),(0,s.ZP)("arrange-link").removeEventListener("click",this.linkLayer,!1),(0,s.ZP)("arrange-delete").removeEventListener("click",this.deleteLayer,!1),(0,s.ZP)("arrange-duplicate").removeEventListener("click",this.duplicateLayer,!1),(0,s.ZP)("arrange-close").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("arrange-cancel").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("arrange-unlock").removeEventListener("click",this.unlock,!1),(0,s.ZP)("arrange-width").removeEventListener("input",this.inputSize,!1),(0,s.ZP)("arrange-height").removeEventListener("input",this.inputSize,!1),(0,s.ZP)("arrange-top").removeEventListener("input",this.inputPosition,!1),(0,s.ZP)("arrange-left").removeEventListener("input",this.inputPosition,!1),(0,s.ZP)("arrange-width").removeEventListener("focus",this.inputBegin,!1),(0,s.ZP)("arrange-height").removeEventListener("focus",this.inputBegin,!1),(0,s.ZP)("arrange-top").removeEventListener("focus",this.inputBegin,!1),(0,s.ZP)("arrange-left").removeEventListener("focus",this.inputBegin,!1),(0,s.ZP)("arrange-width").removeEventListener("blur",this.inputEnd,!1),(0,s.ZP)("arrange-height").removeEventListener("blur",this.inputEnd,!1),(0,s.ZP)("arrange-top").removeEventListener("blur",this.inputEnd,!1),(0,s.ZP)("arrange-left").removeEventListener("blur",this.inputEnd,!1),(0,s.ZP)("arrange-flip-vertical").removeEventListener("click",this.flip,!1),(0,s.ZP)("arrange-flip-horizontal").removeEventListener("click",this.flip,!1),(0,s.ZP)("arrange-add-shape").removeEventListener("click",this.addShape,!0),(0,s.ZP)("arrange-add-frame").removeEventListener("click",this.addFrame,!0),(0,s.ZP)("arrange-add-text").removeEventListener("click",this.addText,!0),(0,s.ZP)("image-effect").removeEventListener("click",this.selectTool,!0),(0,s.ZP)("image-adjust").removeEventListener("click",this.selectTool,!0),(0,s.ZP)("image-cutout").removeEventListener("click",this.selectTool,!0),(0,s.ZP)("image-retouch").removeEventListener("click",this.selectTool,!0),(0,s.ZP)("image-liquify").removeEventListener("click",this.selectTool,!0),(0,s.ZP)("image-paint").removeEventListener("click",this.selectTool,!0),this.rotate.cleanUp()},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("layer-arrange",this.updateInputs,!1),document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),(0,s.ZP)("arrange-close").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("arrange-cancel").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("arrange-unlock").addEventListener("click",this.unlock,!1),(0,s.ZP)("arrange-width").addEventListener("input",this.inputSize,!1),(0,s.ZP)("arrange-height").addEventListener("input",this.inputSize,!1),(0,s.ZP)("arrange-top").addEventListener("input",this.inputPosition,!1),(0,s.ZP)("arrange-left").addEventListener("input",this.inputPosition,!1),(0,s.ZP)("arrange-width").addEventListener("focus",this.inputBegin,!1),(0,s.ZP)("arrange-height").addEventListener("focus",this.inputBegin,!1),(0,s.ZP)("arrange-top").addEventListener("focus",this.inputBegin,!1),(0,s.ZP)("arrange-left").addEventListener("focus",this.inputBegin,!1),(0,s.ZP)("arrange-width").addEventListener("blur",this.inputEnd,!1),(0,s.ZP)("arrange-height").addEventListener("blur",this.inputEnd,!1),(0,s.ZP)("arrange-top").addEventListener("blur",this.inputEnd,!1),(0,s.ZP)("arrange-left").addEventListener("blur",this.inputEnd,!1),(0,s.ZP)("arrange-link").addEventListener("click",this.linkLayer,!1),(0,s.ZP)("arrange-delete").addEventListener("click",this.deleteLayer,!1),(0,s.ZP)("arrange-duplicate").addEventListener("click",this.duplicateLayer,!1),(0,s.ZP)("arrange-constraint").addEventListener("click",this.toggleConstraint,!1),(0,s.ZP)("arrange-name").addEventListener("blur",this.changeName,!1),(0,s.ZP)("arrange-flip-vertical").addEventListener("click",this.flip,!1),(0,s.ZP)("arrange-flip-horizontal").addEventListener("click",this.flip,!1),(0,s.ZP)("arrange-size-lock").style.display=this.stage.reform.constrain?"block":"none",(0,s.ZP)("arrange-size-vs").style.display=this.stage.reform.constrain?"none":"block",this.rotate=new o.Z("arrange-rotate",{label:(0,n.Z)("rotate"),step:1,range:[-180,180],defaultValue:0,labelFormat:e=>e.toFixed(1)+"°",labelParse:e=>parseFloat(e),onStart:()=>{this.stage.reform.beginHistory()},onChange:e=>{this.stage.reform.inputRotation(e<0?360+e:e)},onEnd:e=>{this.stage.reform.commitHistory("rotate")}}),(0,s.ZP)("arrange-add-shape").addEventListener("click",this.addShape,!0),(0,s.ZP)("arrange-add-frame").addEventListener("click",this.addFrame,!0),(0,s.ZP)("arrange-add-text").addEventListener("click",this.addText,!0),(0,s.ZP)("image-effect").addEventListener("click",this.selectTool,!0),(0,s.ZP)("image-adjust").addEventListener("click",this.selectTool,!0),(0,s.ZP)("image-cutout").addEventListener("click",this.selectTool,!0),(0,s.ZP)("image-retouch").addEventListener("click",this.selectTool,!0),(0,s.ZP)("image-liquify").addEventListener("click",this.selectTool,!0),(0,s.ZP)("image-paint").addEventListener("click",this.selectTool,!0),this.layerSelect()}}},4543:(e,t,i)=>{i.d(t,{Z:()=>g});var s=i(96548),n=i(93947),a=i(33655),r=i(36817),o=i(18203),h=i(4188),c=i(98776),l=i(74211),d=i(94084),u=i(9389),p=i(4256);class g extends o.Z{constructor(e){super("colorize",e),this.applyClick=()=>{document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=async()=>{const e=this.selected===this.stage.fresco.getSelected();if(this.selected&&!e&&this.apply(),!this.stage.fresco.isSelectedShaderbleWithCanvas())return(0,n.ZP)("colorize-layer-locked").style.display="block",(0,n.ZP)("colorize-settings").style.display="none",void(this.selected=null);if((0,n.ZP)("colorize-layer-locked").style.display="none",(0,n.ZP)("colorize-settings").style.display="block",e)setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render()))}),0);else{this.selected=this.stage.fresco.getSelected(),this.cached=this.selected.baked?this.selected.baked:this.selected.canvas,this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"replace",this.cached);let e=r.Z.fillFit(this.selected.canvas.width,this.selected.canvas.height,120,120);this.thumbnail=a.Ai(this.selected.canvas,e.width,e.height),this.populatePresets()}this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.setValues()},this.populatePresets=()=>{const e=new p.Z([]),t=(0,n.ZP)("colorize-presets");t.innerHTML="";const i=-(this.thumbnail.width-120)/2,s=-(this.thumbnail.height-80)/2;[{amount:1,contrast:.75,one:"#BFE4F4",two:"#AB080A",three:"#2F1A30"},{amount:1,contrast:.75,one:"#BEE3F5",two:"#EA1E86",three:"#B02673"},{amount:1,contrast:.75,one:"#71DF6E",two:"#201E67"},{amount:1,contrast:.5,one:"#FFFFC1",two:"#400040"},{amount:1,contrast:.75,one:"#E6D60F",two:"#B00A4A"},{amount:1,contrast:.75,one:"#EE0463",two:"#40026D"},{amount:1,contrast:.75,one:"#1AD1E3",two:"#950660"},{amount:1,contrast:.75,one:"#C2000B",two:"#020957"},{amount:1,contrast:.75,one:"#FDFBFC",two:"#5481A0",three:"#772D68"},{amount:1,contrast:.75,one:"#1AD1E3",two:"#A52977",three:"#041136"},{amount:1,contrast:.75,one:"#8BEA72",two:"#0A1B35"},{amount:1,contrast:.75,one:"#A1E9D5",two:"#440C7B"},{amount:1,contrast:.75,one:"#DDD709",two:"#142664"},{amount:1,contrast:.75,one:"#BD2325",two:"#1B1B1B"},{amount:1,contrast:.75,one:"#FDDC01",two:"#422900"},{amount:1,contrast:.75,one:"#DCAA4B",two:"#3F776C"},{amount:1,contrast:.75,one:"#ED7900",two:"#740D08"},{amount:1,contrast:.75,one:"#EDA65F",two:"#1D216B"},{amount:1,contrast:.75,one:"#94D0C6",two:"#A31514"},{amount:1,contrast:.75,one:"#D1897D",two:"#AB3A56"},{amount:1,contrast:.75,one:"#FECB38",two:"#30093F"},{amount:1,contrast:.75,one:"#FDD7A9",two:"#1B2B38"},{amount:1,contrast:.75,one:"#FEE00C",two:"#FE0C92"},{amount:1,contrast:0,one:"#ffffff",two:"#000000"},{amount:1,contrast:0,one:"#EB7D46"},{amount:1,contrast:0,one:"#B4EB46"},{amount:1,contrast:0,one:"#7D46EB"},{amount:1,contrast:0,one:"#EB46B4"},{amount:.3,contrast:.5,one:"#BFE4F4",two:"#AB080A",three:"#2F1A30"},{amount:.3,contrast:.5,one:"#BEE3F5",two:"#EA1E86",three:"#B02673"},{amount:.3,contrast:.5,one:"#71DF6E",two:"#201E67"},{amount:.4,contrast:.5,one:"#FEE00C",two:"#FE0C92"},{amount:.3,contrast:.25,one:"#FFFFC1",two:"#400040"},{amount:.5,contrast:.5,one:"#FDD7A9",two:"#1B2B38"}].forEach((a=>{const r=(0,n.T)("div",{className:"effect-pod"});r.addEventListener("click",(()=>this.selectPreset(a)),!0);const o=(0,n.T)("canvas",{width:120,height:80,className:"thumb"}),h=o.getContext("2d");h.drawImage(this.thumbnail,i,s,this.thumbnail.width,this.thumbnail.height);const l=(0,n.T)("div",{className:"color"});a.one&&l.append((0,n.T)("span",{style:"background-color:"+a.one})),a.two&&l.append((0,n.T)("span",{style:"background-color:"+a.two})),a.three&&l.append((0,n.T)("span",{style:"background-color:"+a.three})),r.append(o,l),t.append(r);setTimeout((()=>{e.reset();const t=100*a.contrast;e.addShader("bwpoint",{black:t,white:255-t}),a.one&&a.two?e.addShader("toning",new u.Z(c.Z.fromHEX(a.one),a.three?c.Z.fromHEX(a.two):void 0,a.three?c.Z.fromHEX(a.three):c.Z.fromHEX(a.two),a.amount)):e.addShader("fill",new d.Z(c.Z.fromHEX(a.one),"color",a.amount)),h.drawImage(e.apply(this.thumbnail),i,s,this.thumbnail.width,this.thumbnail.height)}),10)}))},this.previewColor=e=>{this.change()},this.setColor=e=>{this.changeWithHistory()},this.changeWithHistory=()=>{this.change(),this.stage.history.add({type:"adjust",layer:this.selected,kind:"toning",shaders:this.shaders,chain:this.cacheChain}),this.cacheChain=void 0},this.change=()=>{var e;this.cacheChain||(this.cacheChain=this.shaders.cloneChain()),this.shaders.chain=[];let t=this.colorOne.getColor(),i=this.colorTwo.getColor(),s=this.colorThree.getColor();if(t||i||s){const n=100*this.contrast.getValue();if(this.shaders.addShader("bwpoint",{black:n,white:255-n}),t&&i||t&&s||i&&s){let e;t&&i&&s?e=new u.Z(t,i,s,this.amount.getValue()):t&&i||t&&s?e=new u.Z(t,void 0,null!=i?i:s,this.amount.getValue()):i&&s&&(e=new u.Z(i,void 0,s,this.amount.getValue())),this.shaders.addShader("toning",e)}else if(t||i||s){let n=null!==(e=null!=t?t:i)&&void 0!==e?e:s;this.shaders.addShader("fill",new d.Z(n,"color",this.amount.getValue()))}}setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render()))}),0)},this.selectPreset=e=>{this.amount.setValue(e.amount),this.contrast.setValue(e.contrast),this.colorOne.setColor(e.one),this.colorTwo.setColor(e.two),this.colorThree.setColor(e.three),this.changeWithHistory()},this.setValues=()=>{if(0===this.shaders.chain.length)return this.amount.setValue(1),this.contrast.setValue(.75),this.colorOne.setColor(void 0),this.colorTwo.setColor(void 0),void this.colorThree.setColor(void 0);this.shaders.chain.forEach((e=>{switch(e.type){case"toning":const t=e.value;this.colorOne.setColor(t.highlight),this.colorTwo.setColor(t.midtone),this.colorThree.setColor(t.shadow),this.amount.setValue(t.amount);break;case"fill":const i=e.value;this.colorOne.setColor(i.color),this.amount.setValue(i.amount);break;case"bwpoint":const s=e.value;this.contrast.setValue(s.black/100)}}))},this.cancel=()=>{this.shaders.chain=[],this.stage.history.abortTransaction()},this.apply=()=>{if(!this.selected||!this.stage.fresco.hasLayer(this.selected)||!this.shaders||0===this.shaders.chain.length)return;const e=new r.Z(0,0,this.selected.rect.width,this.selected.rect.height),t=a.$E(this.selected.canvas);this.selected.replaceCanvas(this.shaders.apply(this.selected.canvas)),this.selected.render(),this.shaders.reset(),this.stage.history.add({type:"bitmapChange",kind:"colorize",layer:this.selected,patchRect:e,patch:t,rect:this.selected.rect.clone()})},this.cleanUp=()=>{var e;this.stage.fresco.removeScratch(),null===(e=this.shaders)||void 0===e||e.cleanUp(),this.amount.cleanUp(),this.contrast.cleanUp(),this.colorOne.cleanUp(),this.colorTwo.cleanUp(),this.colorThree.cleanUp(),(0,n.ZP)("colorize-apply").removeEventListener("click",this.applyClick,!1),(0,n.ZP)("colorize-close").removeEventListener("click",this.cancelClick,!1),(0,n.ZP)("colorize-cancel").removeEventListener("click",this.cancelClick,!1),document.removeEventListener("layer-select",this.layerSelect,!1),this.stage.render()},this.shaders=new p.Z,this.amount=new h.Z("colorize-amount",{range:[0,1],step:.01,defaultValue:1,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,label:(0,s.Z)("amount"),onChange:()=>this.change(),onEnd:()=>this.changeWithHistory()}),this.contrast=new h.Z("colorize-contrast",{range:[0,1],step:.01,defaultValue:.75,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,label:(0,s.Z)("contrast"),onChange:()=>this.change(),onEnd:()=>this.changeWithHistory()}),this.colorOne=new l.Z("colorize-color-one",void 0,this.setColor,this.previewColor),this.colorTwo=new l.Z("colorize-color-two",void 0,this.setColor,this.previewColor),this.colorThree=new l.Z("colorize-color-three",void 0,this.setColor,this.previewColor),(0,n.ZP)("colorize-apply").addEventListener("click",this.applyClick,!1),(0,n.ZP)("colorize-close").addEventListener("click",this.cancelClick,!1),(0,n.ZP)("colorize-cancel").addEventListener("click",this.cancelClick,!1),document.addEventListener("layer-select",this.layerSelect,!1),this.layerSelect()}}},63515:(e,t,i)=>{i.d(t,{Z:()=>u});var s=i(93947),n=i(96548),a=i(33655),r=i(36817),o=i(99872),h=i(43673),c=i(18203),l=i(4188),d=i(9579);class u extends c.Z{constructor(e){super("crop",e),this.aspectX=0,this.aspectY=0,this.applyClick=()=>{document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.resize=e=>{new d.Z(this.stage)},this.rotateOrFlip=e=>{switch(e.currentTarget.getAttribute("id")){case"flip-vertical":this.stage.flip(!0);break;case"flip-horizontal":this.stage.flip(!1);break;case"rotate-left":this.stage.rotate(!0);break;case"rotate-right":this.stage.rotate(!1)}},this.inputBlur=e=>{(0,s.ZP)("crop-width").value=Math.round(this.crop.width).toString(),(0,s.ZP)("crop-height").value=Math.round(this.crop.height).toString()},this.updateCrop=e=>{var t;this.applying||(this.crop=new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),this.viewport=new r.Z(this.stage.offset.x,this.stage.offset.y,this.stage.canvas.width,this.stage.canvas.height),this.stage.fresco.lockedBackground()&&this.crop.equalTo(this.stage.fresco.layers[0].rect)?(this.stage.fresco.layers[0].rect.rotation=0,(0,s.ZP)("crop-straighten").style.display="block"):(0,s.ZP)("crop-straighten").style.display="none",(0,s.ZP)("crop-aspect").checked=!1,null===(t=this.straighten)||void 0===t||t.reset(),this.updateSizeInput(),this.render())},this.viewportChange=()=>{this.viewport=new r.Z(this.stage.offset.x,this.stage.offset.y,this.stage.canvas.width,this.stage.canvas.height),this.render()},this.markAspect=(e,t)=>{if((0,s.ZP)("crop-aspect").checked=0!=e||0!=t,0!==e){let e=(t,i)=>0==i?t:e(i,t%i),t=e(this.crop.width,this.crop.height);(0,s.ZP)("crop-aspect-width").value=(this.crop.width/t).toString(),(0,s.ZP)("crop-aspect-height").value=(this.crop.height/t).toString()}(0,s.ZP)("crop-aspect-size").checked=!1,(0,s.ZP)("crop-aspect-ratio").checked=!0,(0,s.ZP)("crop-aspect-preset").value="0:0"},this.aspectActivate=e=>{let t=["0","0"];(0,s.ZP)("crop-aspect").checked&&(t[0]=t[1]="1",(0,s.ZP)("crop-aspect-size-tip").style.display="none",(0,s.ZP)("crop-aspect-preset").value="1:1",(0,s.ZP)("crop-aspect-size").checked=!1,(0,s.ZP)("crop-aspect-ratio").checked=!0,(0,s.ZP)("crop-aspect-width").value="1",(0,s.ZP)("crop-aspect-height").value="1"),this.setAspect(Number(t[0]),Number(t[1]))},this.aspectModeChange=e=>{let t=e.currentTarget===(0,s.ZP)("crop-aspect-ratio")?"ratio":"size",i=Number((0,s.ZP)("crop-aspect-width").value),n=Number((0,s.ZP)("crop-aspect-height").value);if("ratio"===t){let e=(t,i)=>0==i?t:e(i,t%i),t=e(i,n);(0,s.ZP)("crop-aspect-width").value=(i/t).toString(),(0,s.ZP)("crop-aspect-height").value=(n/t).toString()}else(0,s.ZP)("crop-aspect-width").value=(0,s.ZP)("crop-width").value,(0,s.ZP)("crop-aspect-height").value=(0,s.ZP)("crop-height").value;i=Number((0,s.ZP)("crop-aspect-width").value),n=Number((0,s.ZP)("crop-aspect-height").value),this.setAspect(i,n),(0,s.ZP)("crop-aspect-size-tip").style.display="ratio"===t?"none":"block",(0,s.ZP)("crop-aspect-preset").value="0:0"},this.aspectPresetChange=e=>{let t=(0,s.ZP)("crop-aspect-preset").value.split(":");if("0"===t[0])return;if("x"===t[0]&&"y"===t[1]){let e=(t,i)=>0==i?t:e(i,t%i),i=e(this.stage.fresco.width,this.stage.fresco.height);t[0]=(this.stage.fresco.width/i).toString(),t[1]=(this.stage.fresco.height/i).toString()}let i=Number(t[0]),n=Number(t[1]);this.setAspect(i,n);let a="x"!==t[0]&&i>50;(0,s.ZP)("crop-aspect-size").checked=a,(0,s.ZP)("crop-aspect-ratio").checked=!a,(0,s.ZP)("crop-aspect-width").value=t[0],(0,s.ZP)("crop-aspect-height").value=t[1]},this.aspectWidthHeightInputChange=e=>{let t=(0,s.ZP)("crop-aspect-width").value,i=(0,s.ZP)("crop-aspect-height").value,n=Number.isNaN(Number(t))?1:Number(t),a=Number.isNaN(Number(i))?1:Number(i);this.setAspect(n,a)},this.setAspect=(e,t)=>{this.aspectX=e,this.aspectY=t,this.calculate(new h.Z(0,0),new h.Z(this.stage.fresco.width,this.stage.fresco.height)),this.crop.width<30&&(this.crop.width=30),this.crop.height<30&&(this.crop.height=30),this.crop.x+=Math.round((this.stage.fresco.width-this.crop.width)/2),this.crop.y+=Math.round((this.stage.fresco.height-this.crop.height)/2),this.updateSizeInput(),window.requestAnimationFrame(this.render)},this.widthHeightInputChange=e=>{let t=(0,s.ZP)("crop-width").value,i=(0,s.ZP)("crop-height").value,n=Number.isNaN(Number(t))?this.stage.fresco.width:Number(t),a=Number.isNaN(Number(i))?this.stage.fresco.height:Number(i),r=Math.round(30/this.stage.zoom);if(n<r?n=r:n>this.stage.fresco.width&&(n=this.stage.fresco.width),a<r?a=r:a>this.stage.fresco.height&&(a=this.stage.fresco.height),this.crop.width=n,this.crop.height=a,0!=this.aspectX){let t=e.currentTarget.getAttribute("id");"crop-width"==t?this.crop.height=this.stage.fresco.height:this.crop.width=this.stage.fresco.width,this.calculate(this.crop.topLeft(),this.crop.bottomRight()),this.updateSizeInput("crop-width"==t,"crop-height"==t)}this.crop.right()>this.stage.fresco.width&&(this.crop.x=this.stage.fresco.width-this.crop.width),this.crop.bottom()>this.stage.fresco.height&&(this.crop.y=this.stage.fresco.height-this.crop.height),window.requestAnimationFrame(this.render)},this.updateSizeInput=(e,t)=>{e||((0,s.ZP)("crop-width").value=this.crop.width.toString()),t||((0,s.ZP)("crop-height").value=this.crop.height.toString())},this.down=e=>{this.p=this.stage.translateRasterToFresco(e),this.setCursor(this.p),this.updateSizeInput(),this.downTopLeft=this.crop.topLeft(),this.downBottomRight=this.crop.bottomRight(),this.raster.addEventListener("pointerup",this.pointerUp,!1),window.requestAnimationFrame(this.render)},this.move=e=>{e=this.stage.translateRasterToFresco(e),this.isDown?this.reform(this.p.x-e.x,this.p.y-e.y):this.setCursor(e)},this.up=e=>{this.raster.removeEventListener("pointerup",this.pointerUp,!1),window.requestAnimationFrame(this.render)},this.setCursor=e=>{let t=this.crop.width/6,i=this.crop.height/6;e.x<=this.crop.x+t?e.y<this.crop.y+i?this.method="nw-resize":e.y<this.crop.y+this.crop.height-i?this.method="w-resize":this.method="sw-resize":e.x>this.crop.x+t&&e.x<this.crop.x+this.crop.width-t?e.y<this.crop.y+i?this.method="n-resize":e.y<this.crop.y+this.crop.height-i?this.method="move":this.method="s-resize":e.y<this.crop.y+i?this.method="ne-resize":e.y<this.crop.y+this.crop.height-i?this.method="e-resize":this.method="se-resize",this.raster.style.cursor=this.method},this.refit=()=>{this.viewport=new r.Z(this.stage.offset.x,this.stage.offset.y,this.stage.canvas.width,this.stage.canvas.height);let e=Math.round(30/this.stage.zoom),t=new h.Z(this.crop.x,this.crop.y),i=new h.Z(this.crop.right(),this.crop.bottom());t.x<0&&(t.x=0),t.y<0&&(t.y=0),i.x>this.stage.fresco.width&&(i.x=this.stage.fresco.width),i.y>this.stage.fresco.height&&(i.y=this.stage.fresco.height),i.x<t.x+e&&(i.x=t.x+e),i.y<t.y+e&&(i.y=t.y+e),t.x>i.x-e&&(t.x=i.x-e),t.y>i.y-e&&(t.y=i.y-e),this.calculate(t,i),this.updateSizeInput(),this.render()},this.reform=(e,t)=>{if("move"==this.method)this.crop.x=this.downTopLeft.x-e,this.crop.y=this.downTopLeft.y-t,this.crop.x<0?this.crop.x=0:this.crop.right()>this.stage.fresco.width&&(this.crop.x=this.stage.fresco.width-this.crop.width),this.crop.y<0?this.crop.y=0:this.crop.bottom()>this.stage.fresco.height&&(this.crop.y=this.stage.fresco.height-this.crop.height);else{let i=this.downTopLeft.clone(),s=this.downBottomRight.clone();switch(this.method){case"w-resize":0!=this.aspectX&&(s.y=this.stage.fresco.height),i.x=this.downTopLeft.x-e;break;case"e-resize":0!=this.aspectX&&(s.y=this.stage.fresco.height),s.x=this.downBottomRight.x-e;break;case"n-resize":0!=this.aspectX&&(s.x=this.stage.fresco.width),i.y=this.downTopLeft.y-t;break;case"s-resize":0!=this.aspectX&&(s.x=this.stage.fresco.width),s.y=this.downBottomRight.y-t;break;case"nw-resize":i.x=this.downTopLeft.x-e,i.y=this.downTopLeft.y-t;break;case"ne-resize":i.y=this.downTopLeft.y-t,s.x=this.downBottomRight.x-e;break;case"sw-resize":i.x=this.downTopLeft.x-e,s.y=this.downBottomRight.y-t;break;case"se-resize":s.x=this.downBottomRight.x-e,s.y=this.downBottomRight.y-t}let n=Math.round(30/this.stage.zoom);i.x!=this.downTopLeft.x&&(i.x<0?i.x=0:i.x>s.x-n&&(i.x=s.x-n)),i.y!=this.downTopLeft.y&&(i.y<0?i.y=0:i.y>s.y-n&&(i.y=s.y-n)),s.x!=this.downBottomRight.x&&(s.x>this.stage.fresco.width?s.x=this.stage.fresco.width:s.x<i.x+n&&(s.x=i.x+n)),s.y!=this.downBottomRight.y&&(s.y>this.stage.fresco.height?s.y=this.stage.fresco.height:s.y<i.y+n&&(s.y=i.y+n)),this.calculate(i,s,this.downTopLeft),this.updateSizeInput()}window.requestAnimationFrame(this.render)},this.render=()=>{let e=this.crop.scale(this.stage.zoom);e.x+=this.viewport.x,e.y+=this.viewport.y;let t=e.width<200||e.height<200?15:30;if(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.straightenIsDown){this.ctx.lineWidth=1,this.ctx.fillStyle=a.wf,this.ctx.translate(.5,.5),this.ctx.beginPath();let e=new h.Z(Math.round(this.raster.width/2),Math.round(this.raster.height/2));this.ctx.moveTo(this.viewport.x,e.y),this.ctx.lineTo(this.viewport.right()-1,e.y),this.ctx.moveTo(e.x,this.viewport.y),this.ctx.lineTo(e.x,this.viewport.bottom()-1),this.ctx.strokeStyle="rgba(255,255,255,.5)";let t=0,i=e.x;for(;i>this.viewport.x;)t%5==0?(this.ctx.moveTo(i,this.viewport.y),this.ctx.lineTo(i,this.viewport.bottom()-1),this.ctx.moveTo(e.x+e.x-i,this.viewport.y),this.ctx.lineTo(e.x+e.x-i,this.viewport.bottom()-1)):(this.ctx.moveTo(i,e.y-3),this.ctx.lineTo(i,e.y+3),this.ctx.moveTo(e.x+e.x-i,e.y-3),this.ctx.lineTo(e.x+e.x-i,e.y+3)),i-=30,t++;t=0;let s=e.y;for(;s>this.viewport.y;)t%5==0?(this.ctx.moveTo(this.viewport.x,s),this.ctx.lineTo(this.viewport.right()-1,s),this.ctx.moveTo(this.viewport.x,e.y+e.y-s),this.ctx.lineTo(this.viewport.right()-1,e.y+e.y-s)):(this.ctx.moveTo(e.x-3,s),this.ctx.lineTo(e.x+3,s),this.ctx.moveTo(e.x-3,e.y+e.y-s),this.ctx.lineTo(e.x+3,e.y+e.y-s)),s-=30,t++;this.ctx.stroke(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.beginPath(),this.ctx.arc(e.x,e.y,50,0,2*Math.PI),this.ctx.arc(e.x,e.y,300,0,2*Math.PI),this.ctx.stroke()}else{if(this.ctx.fillStyle="rgba(0,0,0,0.5)",this.ctx.fillRect(this.viewport.x<0?0:this.viewport.x,this.viewport.y<0?0:this.viewport.y,this.viewport.width,this.viewport.height),this.ctx.clearRect(e.x,e.y,e.width,e.height),this.ctx.lineWidth=1,this.ctx.fillStyle=a.wf,this.ctx.translate(.5,.5),this.ctx.strokeStyle="rgb(0,0,0)",this.ctx.strokeRect(e.x,e.y,e.width-1,e.height-1),this.ctx.strokeStyle=a.wf,this.ctx.strokeRect(e.x-1,e.y-1,e.width+1,e.height+1),this.isDown){let t=Math.round(e.width/3),i=Math.round(e.height/3);this.ctx.strokeStyle="rgba(255,255,255,.5)",this.ctx.beginPath(),this.ctx.moveTo(e.x+t,e.y),this.ctx.lineTo(e.x+t,e.bottom()),this.ctx.moveTo(e.x+2*t,e.y),this.ctx.lineTo(e.x+2*t,e.bottom()),this.ctx.moveTo(e.x,e.y+i),this.ctx.lineTo(e.right(),e.y+i),this.ctx.moveTo(e.x,e.y+2*i),this.ctx.lineTo(e.right(),e.y+2*i),this.ctx.stroke()}this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillRect(e.x-3,e.y-3,t,3),this.ctx.fillRect(e.x-3,e.y,3,t-3),this.ctx.fillRect(e.x-3,e.y+e.height,t,3),this.ctx.fillRect(e.x-3,e.y+e.height-t+3,3,t-3),this.ctx.fillRect(e.x+e.width-t+3,e.y-3,t,3),this.ctx.fillRect(e.x+e.width,e.y,3,t-3),this.ctx.fillRect(e.x+e.width-t+3,e.y+e.height,t,3),this.ctx.fillRect(e.x+e.width,e.y+e.height-t+3,3,t-3),this.ctx.fillRect(Math.floor(e.x+e.width/2-t),e.y-3,2*t,3),this.ctx.fillRect(Math.floor(e.x+e.width/2-t),e.y+e.height,2*t,3),this.ctx.fillRect(e.x-3,e.y+e.height/2-t,3,2*t),this.ctx.fillRect(e.x+e.width,e.y+e.height/2-t,3,2*t)}},this.dblClick=()=>{this.setAspect(this.aspectY,this.aspectX)},this.apply=()=>{this.applying=!0;const e=this.stage.fresco.lockedBackground()&&0!==this.stage.fresco.layers[0].rect.rotation;if(!this.crop.equalTo(new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height))||e){let t,i=new o.Z(this.stage.fresco.width,this.stage.fresco.height),s=new h.Z(-this.crop.x,-this.crop.y);if(e){const e=this.stage.fresco.layers[0];t=a.dN(e.canvas),i=new o.Z(e.canvas.width,e.canvas.height),s.x+=-e.rect.x,s.y+=-e.rect.y,e.applyStraighten(new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height))}this.stage.fresco.crop(this.crop),this.stage.history.add({type:"crop",offset:s,size:i,straighten:t})}if((0,s.ZP)("crop-aspect").checked&&(0,s.ZP)("crop-aspect-size").checked){const e=Number((0,s.ZP)("crop-aspect-width").value),t=Number((0,s.ZP)("crop-aspect-height").value),i=new o.Z(this.stage.fresco.width,this.stage.fresco.height);if(i.width!==e||i.height!==t){const s=this.stage.fresco.layers.map((e=>e.clone()));this.stage.fresco.resize(e,t,!0),this.stage.history.add({type:"pageResize",size:i,layers:s})}}},this.cancel=()=>{this.stage.fresco.lockedBackground()&&0!==this.stage.fresco.layers[0].rect.rotation&&this.stage.straighten(0)},this.cleanUp=()=>{var e;this.removeDownListeners(),(0,s.ZP)("crop-resize").removeEventListener("click",this.resize,!1),document.removeEventListener("history-update",this.updateCrop,!1),document.removeEventListener("viewport-render",this.viewportChange,!1),this.raster.removeEventListener("pointermove",this.pointerMove,!1),this.raster.removeEventListener("dblclick",this.dblClick,!1);const t=(0,s.ZP)("crop-width");t.removeEventListener("input",this.widthHeightInputChange,!1),t.removeEventListener("blur",this.inputBlur,!1);const i=(0,s.ZP)("crop-height");i.removeEventListener("input",this.widthHeightInputChange,!1),i.removeEventListener("blur",this.inputBlur,!1);const n=(0,s.ZP)("crop-aspect-width");n.removeEventListener("input",this.aspectWidthHeightInputChange,!1),n.removeEventListener("blur",this.inputBlur,!1);const a=(0,s.ZP)("crop-aspect-height");a.removeEventListener("input",this.aspectWidthHeightInputChange,!1),a.removeEventListener("blur",this.inputBlur,!1),null===(e=this.straighten)||void 0===e||e.cleanUp(),(0,s.ZP)("crop-aspect").removeEventListener("change",this.aspectActivate,!1),(0,s.ZP)("crop-aspect-preset").removeEventListener("change",this.aspectPresetChange,!1),(0,s.ZP)("crop-aspect-size").removeEventListener("click",this.aspectModeChange,!1),(0,s.ZP)("crop-aspect-ratio").removeEventListener("click",this.aspectModeChange,!1),(0,s.ZP)("crop-apply").removeEventListener("click",this.applyClick,!1),(0,s.ZP)("crop-close").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("crop-cancel").removeEventListener("click",this.cancelClick,!1);let r=(0,s.ZP)("crop-rotate-flip").getElementsByTagName("li");for(var o=0;o<r.length;o++)r[o].removeEventListener("click",this.rotateOrFlip,!1);this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.viewport=null,this.ctx=null,this.stage.updateViewport()},this.raster=e.raster,this.ctx=this.raster.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,(0,s.ZP)("crop-resize").addEventListener("click",this.resize,!1),document.addEventListener("history-update",this.updateCrop,!1),document.addEventListener("viewport-render",this.viewportChange,!1),this.raster.addEventListener("pointermove",this.pointerMove,!1),this.raster.addEventListener("dblclick",this.dblClick,!1);const t=(0,s.ZP)("crop-width");t.addEventListener("input",this.widthHeightInputChange,!1),t.addEventListener("blur",this.inputBlur,!1);const i=(0,s.ZP)("crop-height");i.addEventListener("input",this.widthHeightInputChange,!1),i.addEventListener("blur",this.inputBlur,!1);const c=(0,s.ZP)("crop-aspect-width");c.addEventListener("input",this.aspectWidthHeightInputChange,!1),c.addEventListener("blur",this.inputBlur,!1);const u=(0,s.ZP)("crop-aspect-height");u.addEventListener("input",this.aspectWidthHeightInputChange,!1),u.addEventListener("blur",this.inputBlur,!1),this.straighten=new l.Z("crop-straighten",{range:[-25,25],step:.25,force:!0,label:(0,n.Z)("straighten"),labelFormat:e=>e.toFixed(1)+"°",labelParse:e=>parseFloat(e),onChange:e=>{this.stage.straighten(e),this.calculate(new h.Z(0,0),new h.Z(this.stage.fresco.width,this.stage.fresco.height)),this.refit()},onStart:()=>{this.straightenIsDown=!0,this.render()},onEnd:(e,t)=>{this.straightenIsDown=!1,this.refit(),this.render()}}),(0,s.ZP)("crop-aspect").addEventListener("change",this.aspectActivate,!1),(0,s.ZP)("crop-aspect-preset").addEventListener("change",this.aspectPresetChange,!1),(0,s.ZP)("crop-aspect-size").addEventListener("click",this.aspectModeChange,!1),(0,s.ZP)("crop-aspect-ratio").addEventListener("click",this.aspectModeChange,!1),(0,s.ZP)("crop-apply").addEventListener("click",this.applyClick,!1),(0,s.ZP)("crop-close").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("crop-cancel").addEventListener("click",this.cancelClick,!1);let p=(0,s.ZP)("crop-rotate-flip").getElementsByTagName("li");for(var g=0;g<p.length;g++)p[g].addEventListener("click",this.rotateOrFlip,!1);this.addDownListeners(),this.updateCrop()}calculate(e,t,i){if(this.crop.x=Math.round(e.x<t.x?e.x:t.x),this.crop.y=Math.round(e.y<t.y?e.y:t.y),this.crop.width=Math.round(e.x<t.x?t.x-this.crop.x:e.x-this.crop.x),this.crop.height=Math.round(e.y<t.y?t.y-this.crop.y:e.y-this.crop.y),0!=this.aspectX&&0!=this.aspectY){let t=this.crop.height,s=this.crop.width;this.aspectY/this.aspectX*(this.crop.width/this.crop.height)<this.aspectX/this.aspectY*(this.crop.height/this.crop.width)?this.crop.height=Math.round(this.crop.width*(this.aspectY/this.aspectX)):this.crop.width=Math.round(this.crop.height*(this.aspectX/this.aspectY)),i&&(i.x!=e.x&&(this.crop.x+=Math.round(s-this.crop.width)),i.y!=e.y&&(this.crop.y+=Math.round(t-this.crop.height)))}}}},74469:(e,t,i)=>{i.d(t,{Z:()=>w});var s=i(93947),n=i(96548),a=i(33655);class r{constructor(e,t,i){this.start=e,this.stop=t,this.row=i}}var o=i(18203),h=i(4188),c=i(98776),l=i(12257),d=i(4256),u=i(67175),p=i(23868),g=i(36817),m=i(71030),v=i(92365);class f extends p.Z{constructor(e){super((0,n.Z)("dialogAiCutoutTitle")),this.run=async()=>{try{let e=this.stage.fresco.getSelected();const t=a.$E(e.mask);await(0,v.Z)(e),this.stage.render(),this.stage.history.add({type:"mask",layer:e,rect:new g.Z(0,0,e.mask.width,e.mask.height),patch:t}),this.cleanUp()}catch(e){console.error(e),(0,s.ZP)("ai-icon").src="/img/icon/ai-err.svg",(0,s.ZP)("dialog-cancel"+this.mid).innerText=(0,n.Z)("close"),(0,s.ZP)("ai-load").style.display="none",(0,s.ZP)("ai-message").innerText=window.navigator.onLine?(0,n.Z)("genericError"):(0,n.Z)("genericOffline")}},this.stage=e,this.dialog.style.width="300px",this.dialog.style.maxWidth="300px",this.setContent('\n            <img src="/img/icon/ai.svg" id="ai-icon" class="ic">\n            <div id="ai-load" class="ai-load"><div class="dot-floating"></div></div> \n            <div id="ai-message" class="pad-20">Machines are doing their thing, please wait ..</div>\n        '),(0,s.ZP)("dialog-apply"+this.mid).style.display="none",(0,m.Z)("run-ai-cutout"),this.run()}}var y=i(50972);class w extends o.Z{constructor(e){super("cutout",e),this.type="",this.mode="remove",this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,s.ZP)("cutout-no-layer").style.display="block",(0,s.ZP)("cutout-sub-tools").style.display="none",void(this.selected=null);(0,s.ZP)("cutout-sub-tools").style.display="block",(0,s.ZP)("cutout-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),"brush"===this.type&&this.updateBrush(),this.renderMask()},this.selectType=e=>{this.setType(e.currentTarget.value)},this.setType=e=>{e!==this.type&&(""!==this.type&&((0,s.ZP)("cutout-"+this.type+"-settings").style.display="none"),(0,s.ZP)("cutout-"+e+"-settings").style.display="block",this.type=e,this.selected&&!this.selected.hasMask()&&("shape"===this.type?this.setMode("keep"):this.setMode("remove")),this.selected?"brush"===this.type?this.updateBrush():(this.stage.coating.removeCursorImage(),this.stage.raster.style.cursor="crosshair"):this.stage.raster.style.cursor="auto")},this.toggleMode=()=>{this.setMode("keep"===this.mode?"remove":"keep")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,s.ZP)("cutout-mode-remove")?"remove":"keep")},this.setMode=e=>{if(this.mode=e,(0,s.ZP)("cutout-mode-remove").checked="remove"===this.mode,(0,s.ZP)("cutout-mode-keep").checked="keep"===this.mode,"brush"===this.type)this.updateBrush()},this.zoomChange=()=>{if("brush"===this.type)this.updateBrush()},this.isKeyDown=!1,this.shiftDown=e=>{"Shift"!==e.key||this.isKeyDown||(this.isKeyDown=!0,this.toggleMode())},this.shiftUp=e=>{"Shift"===e.key&&(this.isKeyDown=!1,this.toggleMode())},this.down=e=>{if(this.selected)if(this.downPoint=e,"magic"!==this.type){switch(this.type){case"brush":this.downBrush(e);break;case"lasso":this.downLasso(e);break;case"shape":this.downShape(e)}this.addMoveListeners()}else this.applyMagic(e)},this.move=e=>{switch(this.type){case"shape":this.moveShape(e);break;case"brush":this.moveBrush(e);break;case"lasso":this.moveLasso(e)}},this.up=e=>{switch(this.removeMoveListeners(),this.type){case"shape":this.applyShape(this.stage.translateRasterToFresco(this.downPoint,this.selected.rect),this.stage.translateRasterToFresco(e,this.selected.rect));break;case"brush":this.applyBrush();break;case"lasso":this.applyLasso()}},this.applyMagic=e=>{if((e=this.stage.translateRasterToFresco(e,this.selected.rect)).x<0||e.y<0||e.x>this.selected.canvas.width||e.y>this.selected.canvas.height)return;const t=this.prepareMask();let i=document.querySelector('input[name="cutout-magic-smooth"]:checked').value,n=this.selected.canvas.getContext("2d").getImageData(e.x,e.y,1,1).data,a=new c.Z(n[0],n[1],n[2],n[3]);if(0===a.a&&"remove"===this.mode&&"none"===i)return;let r=100*this.tolerance.getValue(),o=(this.selected.baked&&"remove"===this.mode?this.selected.baked:this.selected.canvas).getContext("2d").getImageData(0,0,this.selected.canvas.width,this.selected.canvas.height);this.cpx=new Uint32Array(o.data.buffer);let h=this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height);this.mpx=new Uint32Array(h.data.buffer),(0,s.ZP)("cutout-magic-contiguous").checked?this.floodFill(e,a,r,"none"!==i):this.allFill(a,r),this.scratch.ctx.putImageData(h,0,0),this.cpx=null,this.mpx=null,this.drawToMask(t,i)},this.updateBrush=()=>{this.brush||(this.brush=new l.Z(new y.Z)),this.brush.settings.size=this.size.getValue(),this.brush.settings.softness=this.softness.getValue(),this.brush.generate("keep"===this.mode?new c.Z(0,255,0,255):new c.Z(255,0,0,255)),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),(0,s.ZP)("cutout-brush-preview").innerHTML="",(0,s.ZP)("cutout-brush-preview").appendChild(this.brush.canvas)},this.downBrush=e=>{this.x=this.y=-1,this.scratch.settings.opacity=.4,this.moveBrush(e)},this.x=-1,this.y=-1,this.moveBrush=e=>{let t=this.brush.getStep(),i=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0),e.x!==this.x||e.y!==this.y){let s=e.x-this.x,n=e.y-this.y,a=s>0?1:-1,r=n>0?1:-1;if(s=s<0?-s:s,n=n<0?-n:n,s>n){let e=.5*s;for(let o=1;o<=s;o++)this.x+=a,e+=n,e>=s&&(e-=s,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=s,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}}i&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{this.scratch.ctx.drawImage(this.brush.canvas,e,t)},this.applyBrush=()=>{const e=this.prepareMask();this.drawToMask(e,"none")},this.downLasso=e=>{this.points=[]},this.moveLasso=e=>{this.rasterctx.save(),this.points.push(e),this.stage.raster.style.opacity="0.6",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.rasterctx.strokeStyle="keep"===this.mode?"#00ff00":"#ff0000",this.rasterctx.lineWidth=2,this.rasterctx.lineCap="round",this.rasterctx.setLineDash([6]),this.rasterctx.beginPath(),this.rasterctx.moveTo(this.points[0].x,this.points[0].y),this.points.forEach((e=>{this.rasterctx.lineTo(e.x,e.y)})),this.rasterctx.stroke(),this.rasterctx.restore()},this.applyLasso=()=>{if(this.stage.raster.style.opacity="1",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.points.length<2)return;const e=this.points.map((e=>this.stage.translateRasterToFresco(e,this.selected.rect))),t=this.prepareMask();let i=document.querySelector('input[name="cutout-lasso-smooth"]:checked').value;this.scratch.ctx.beginPath(),this.scratch.ctx.moveTo(e[0].x,e[0].y),e.forEach((e=>this.scratch.ctx.lineTo(e.x,e.y))),this.scratch.ctx.fill(),this.drawToMask(t,i)},this.downShape=e=>{this.shapeType=document.querySelector('input[name="cutout-shape-type"]:checked').value},this.moveShape=e=>{switch(this.rasterctx.save(),this.stage.raster.style.opacity="0.6",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.rasterctx.strokeStyle="keep"===this.mode?"#00ff00":"#ff0000",this.rasterctx.lineWidth=2,this.shapeType){case"square":this.rasterctx.setLineDash([6]),this.rasterctx.strokeRect(this.downPoint.x,this.downPoint.y,e.x-this.downPoint.x,e.y-this.downPoint.y);break;case"circle":this.rasterctx.setLineDash([6]),u.Z.ellipse(this.rasterctx,this.downPoint,e),this.rasterctx.stroke();break;case"triangle":this.rasterctx.setLineDash([6]),u.Z.triangle(this.rasterctx,this.downPoint,e),this.rasterctx.stroke();break;case"star":this.rasterctx.setLineDash([6]),u.Z.star(this.rasterctx,this.downPoint,e),this.rasterctx.stroke();break;case"heart":this.rasterctx.setLineDash([6]),u.Z.heart(this.rasterctx,this.downPoint,e),this.rasterctx.stroke();break;case"line":this.rasterctx.lineWidth=4,u.Z.line(this.rasterctx,this.downPoint,e),this.rasterctx.stroke()}this.rasterctx.restore()},this.applyShape=(e,t)=>{if(e.x===t.x&&e.y===t.y)return;this.stage.raster.style.opacity="1",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height);const i=this.prepareMask(),s=document.querySelector('input[name="cutout-shape-smooth"]:checked').value;switch(this.shapeType){case"square":this.scratch.ctx.fillRect(e.x,e.y,t.x-e.x,t.y-e.y);break;case"circle":u.Z.ellipse(this.scratch.ctx,e,t),this.scratch.ctx.fill();break;case"triangle":u.Z.triangle(this.scratch.ctx,e,t),this.scratch.ctx.fill();break;case"star":u.Z.star(this.scratch.ctx,e,t),this.scratch.ctx.fill();break;case"heart":u.Z.heart(this.scratch.ctx,e,t),this.scratch.ctx.fill();break;case"line":this.scratch.ctx.lineWidth=4/this.stage.zoom,u.Z.line(this.scratch.ctx,e,t),this.scratch.ctx.stroke()}this.drawToMask(i,s)},this.prepareMask=()=>{let e=!1;return this.selected.hasMask()||(this.selected.addMask("remove"===this.mode?"fill":"clear"),e=!0),e},this.renderMask=()=>{this.selected.hasMask()&&(this.selected.render(),(0,s.ZP)("cutout-show-ghost").checked&&this.renderGhost(),this.stage.render())},this.renderGhost=()=>{if(this.selected.hasMask()){var e=this.selected.baked.getContext("2d");e.save(),e.globalAlpha=.33,e.drawImage(this.selected.canvas,0,0),e.restore(),e=null}},this.auto=e=>{this.selected&&new f(this.stage)},this.delete=()=>{this.stage.maskDelete()},this.bake=()=>{this.stage.maskApply()},this.invert=()=>{this.stage.maskInvert()},this.allFill=(e,t)=>{for(var i=0;i<this.mpx.length;++i)this.tolerate(i,e,t)&&(this.mpx[i]=4294967295)},this.floodFill=(e,t,i,s)=>{let n=this.selected.canvas.width,a=this.selected.canvas.height,r=new Array,o=new Array(n*a);for(this.linearFill(e.x,e.y,t,i,s,r,o);r.length>0;)for(var h=r.shift(),c=h.start;c<=h.stop;++c)h.row>0&&!o[(h.row-1)*n+c]&&this.linearFill(c,h.row-1,t,i,s,r,o),h.row<a-1&&!o[(h.row+1)*n+c]&&this.linearFill(c,h.row+1,t,i,s,r,o)},this.linearFill=(e,t,i,s,n,a,o)=>{var h=this.selected.canvas.width;if(o[h*t+e]=!0,this.tolerate(h*t+e,i,s)){this.mpx[h*t+e]=4294967295;for(var c=e-1,l=e+1;c>=0&&!o[h*t+c];){if(o[h*t+c]=!0,!this.tolerate(h*t+c,i,s)){n&&(this.mpx[h*t+c]=4294967295);break}this.mpx[h*t+c]=4294967295,--c}for(;l<h&&!o[h*t+l];){if(o[h*t+l]=!0,!this.tolerate(h*t+l,i,s)){n&&(this.mpx[h*t+l]=4294967295);break}this.mpx[h*t+l]=4294967295,++l}a.push(new r(c+1,l-1,t))}else n&&(this.mpx[h*t+c]=4294967295)},this.tolerate=(e,t,i)=>{let s,n,a,r,o,h,c;return n=0,a=this.cpx[e],r=a>>24&255,r=t.a-r,s=r<0?-r:r,s>n&&(n=s),t.a>0&&(c=a>>16&255,h=a>>8&255,o=255&a,o=t.r-o,s=o<0?-o:o,s>n&&(n=s),h=t.g-h,s=h<0?-h:h,s>n&&(n=s),c=t.b-c,s=c<0?-c:c,s>n&&(n=s)),n<i},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.removeDownListeners(),(0,s.ZP)("cutout-show-ghost").checked&&(this.selected.render(),this.stage.render()),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),document.removeEventListener("zoom-change",this.zoomChange,!1),document.removeEventListener("layer-select",this.layerSelect,!1),(0,s.ZP)("cutout-close").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("cutout-cancel").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("cutout-reset").removeEventListener("click",this.delete,!1),(0,s.ZP)("cutout-invert").removeEventListener("click",this.invert,!1),(0,s.ZP)("cutout-apply").removeEventListener("click",this.bake,!1),(0,s.ZP)("cutout-auto").removeEventListener("click",this.auto,!1),(0,s.ZP)("cutout-show-ghost").removeEventListener("change",this.renderMask,!1),(0,s.ZP)("cutout-type-magic").removeEventListener("change",this.selectType,!1),(0,s.ZP)("cutout-type-brush").removeEventListener("change",this.selectType,!1),(0,s.ZP)("cutout-type-lasso").removeEventListener("change",this.selectType,!1),(0,s.ZP)("cutout-type-shape").removeEventListener("change",this.selectType,!1),(0,s.ZP)("cutout-mode-keep").removeEventListener("click",this.selectMode,!1),(0,s.ZP)("cutout-mode-remove").removeEventListener("click",this.selectMode,!1),this.size.cleanUp(),this.softness.cleanUp(),this.tolerance.cleanUp(),this.rasterctx=null,this.selected=null,this.brush=null},(0,s.ZP)("cutout-close").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("cutout-cancel").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("cutout-reset").addEventListener("click",this.delete,!1),(0,s.ZP)("cutout-invert").addEventListener("click",this.invert,!1),(0,s.ZP)("cutout-apply").addEventListener("click",this.bake,!1),(0,s.ZP)("cutout-auto").addEventListener("click",this.auto,!1),(0,s.ZP)("cutout-type-magic").addEventListener("change",this.selectType,!1),(0,s.ZP)("cutout-type-brush").addEventListener("change",this.selectType,!1),(0,s.ZP)("cutout-type-lasso").addEventListener("change",this.selectType,!1),(0,s.ZP)("cutout-type-shape").addEventListener("change",this.selectType,!1),(0,s.ZP)("cutout-mode-keep").addEventListener("click",this.selectMode,!1),(0,s.ZP)("cutout-mode-remove").addEventListener("click",this.selectMode,!1),(0,s.ZP)("cutout-show-ghost").addEventListener("change",this.renderMask,!1),document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.zoomChange,!1),this.size=new h.Z("cutout-brush-size",{label:(0,n.Z)("size"),range:[1,500],step:1,defaultValue:50,labelFormat:e=>e+"px",onEnd:e=>{this.updateBrush()}}),this.softness=new h.Z("cutout-brush-hardness",{label:(0,n.Z)("softness"),defaultValue:.5,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.updateBrush()}}),this.tolerance=new h.Z("cutout-magic-tolerance",{defaultValue:.32,label:(0,n.Z)("tolerance"),labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100}),(0,s.ZP)("cutout-magic-settings").style.display="none",(0,s.ZP)("cutout-brush-settings").style.display="none",(0,s.ZP)("cutout-shape-settings").style.display="none",(0,s.ZP)("cutout-lasso-settings").style.display="none",this.rasterctx=this.stage.raster.getContext("2d"),this.addDownListeners(),this.layerSelect();const t=document.querySelector('input[name="cutout-type"]:checked').value;this.setType(t);const i=document.querySelector('input[name="cutout-mode"]:checked').value;this.setMode(i)}drawToMask(e,t){if("none"!==t){let e=new d.Z;e.addShader("blur","light"===t?.1:.3),this.scratch.replaceCanvas(e.apply(this.scratch.canvas))}const i=a.l(this.scratch.canvas);if(!i)return;let s;e||(s=a.$E(this.selected.mask,i));const n=this.selected.mask.getContext("2d");n.save(),"remove"===this.mode&&(n.globalCompositeOperation="destination-out"),n.drawImage(this.scratch.canvas,0,0),n.restore(),this.scratch.clear(),this.renderMask(),this.stage.history.add({type:"mask",layer:this.selected,rect:i,patch:s})}}},72155:(e,t,i)=>{i.d(t,{Z:()=>g});var s=i(93947),n=i(96548),a=i(33655),r=i(36817),o=i(98776),h=i(18203),c=i(4188),l=i(43673),d=i(12257),u=i(50972);class p{constructor(e,t,i,s,n,a,r,o,h){this.sx=e,this.sy=t,this.tx=i,this.ty=s,this.background=n,this.color=a,this.radius=r,this.rotation=o,this.factor=h}}class g extends h.Z{constructor(e){super("dispersion",e),this.mode="mask",this.applyClick=()=>{document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,s.ZP)("dispersion-no-layer").style.display="block",(0,s.ZP)("dispersion-settings").style.display="none",this.selected=null,void this.updateBrush();(0,s.ZP)("dispersion-settings").style.display="block",(0,s.ZP)("dispersion-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.setMode("mask")},this.updateBrush=()=>{this.brush.generate(),this.selected&&"mask"===this.mode?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),this.scratch&&(this.scratch.settings.opacity="mask"===this.mode?.4:1)},this.selectMode=e=>{this.setMode(e.currentTarget===(0,s.ZP)("dispersion-mode-mask")?"mask":"effect")},this.setMode=e=>{"effect"!==e||this.maskRect||(e="mask",this.stage.notify("dispersionCreateMask")),this.mode=e,(0,s.ZP)("dispersion-mode-mask").checked="mask"===this.mode,(0,s.ZP)("dispersion-mode-effect").checked="effect"===this.mode,(0,s.ZP)("dispersion-mask-settings").style.display="mask"===this.mode?"block":"none",(0,s.ZP)("dispersion-effect-settings").style.display="effect"===this.mode?"block":"none",this.updateBrush(),this.disperse()},this.rand=(e,t)=>Math.random()*(t-e)+e,this.disperse=()=>{var e;if(this.scratch.clear(),"effect"!==this.mode||!this.maskRect)return;const t=this.maskRect,i=t.center(),n=this.scratch.ctx,a=this.selected.canvas.getContext("2d"),r=new Array,h=10*this.amount.getValue(),c=Math.round(100*this.scale.getValue()),d=Math.round(.5*c),u=Math.round(t.width/c)*Math.round(t.height/c)*h,g=this.direction.getValue()*Math.PI/180,m=this.spread.getValue(),v=Math.sqrt(t.width*t.width+t.height*t.height),f=Math.round(this.stretch.getValue()*v),y=(0,s.ZP)("dispersion-shrink").checked,w=(0,s.ZP)("dispersion-hollow").checked;let x,b=0,Z=0;for(;b<u&&Z<5e4;){let s=new l.Z(Math.round(this.rand(t.x,t.x+t.width)),Math.round(this.rand(t.y,t.y+t.height)));if(Z++,this.maskData.data[4*(s.y*n.canvas.width+s.x)]>0){b++;let t=v*Math.cos(g),n=v*Math.sin(g),h=this.getBound(s.x,s.y,s.x-t,s.y-n),l=this.getBound(s.x,s.y,s.x+t,s.y+n),u=null!==(e=s.distanceTo(h)/l.distanceTo(h))&&void 0!==e?e:0,w=1-u,x=d+this.rand(.2*-d,.2*d);y&&(x=.5*x+Math.round(.5*x*w));let Z=a.getImageData(l.x,l.y,1,1).data;const k=new o.Z(Z[0],Z[1],Z[2]);let E=a.getImageData(s.x,s.y,1,1).data;const P=new o.Z(E[0],E[1],E[2]);let S=u*u*f,C=Math.cos(g)*S,L=Math.sin(g)*S;if(0!==m){let e=i.rotateAround(s,g),t=(s.y-e.y)*m*u;C+=Math.sin(g)*t,L+=Math.cos(g)*t}if(r.push(new p(s.x,s.y,s.x+C,s.y+L,k,P,x,6.283185308*Math.random(),w)),y&&Math.random()>w){let e=2*c*u,t=this.rand(-e,e),i=this.rand(-e,e);r.push(new p(s.x+t,s.y+i,s.x+C+t,s.y+L+i,k,P,x,6.283185308*Math.random(),w))}}}switch(document.querySelector('input[name="dispersion-type"]:checked').value){case"circle":x=this.circle;break;case"square":x=this.square;break;case"hexagon":x=this.hexagon;break;case"cross":x=this.cross;break;case"triangle":x=this.triangle;break;case"heart":x=this.heart;break;case"star":x=this.star;break;case"glimmer":x=this.glimmer}n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",r.forEach((e=>{n.save(),n.translate(e.sx,e.sy),n.rotate(e.rotation),n.beginPath(),n.shadowBlur=2,n.fillStyle=n.shadowColor=e.background.toRGBA(245),x(n,d),n.closePath(),n.fill(),n.restore()})),r.forEach((e=>{Math.random()<.5&&(n.save(),n.translate(e.tx,e.ty),n.rotate(e.rotation),n.beginPath(),x(n,e.radius),n.closePath(),n.fillStyle=w?e.background.toRGBA():e.color.toRGBA(),n.fill(),w&&(n.lineWidth=.25*e.radius,n.strokeStyle=e.color.toRGBA(),n.stroke()),n.restore())})),window.requestAnimationFrame((()=>this.stage.render()))},this.getBound=(e,t,i,s)=>{let n=e,a=t,r=i-e,o=s-t,h=r>0?1:-1,c=o>0?1:-1;if(r=r<0?-r:r,o=o<0?-o:o,r>o){let e=.5*r;for(let t=1;t<=r&&(n+=h,e+=o,e>=r&&(e-=r,a+=c),0!==this.maskData.data[4*(a*this.scratch.canvas.width+n)]);t++);}else{let e=.5*o;for(let t=1;t<=o&&(a+=c,e+=r,e>=o&&(e-=o,n+=h),0!==this.maskData.data[4*(a*this.scratch.canvas.width+n)]);t++);}return new l.Z(n,a)},this.circle=(e,t)=>{e.arc(0,0,t,0,2*Math.PI)},this.square=(e,t)=>{e.moveTo(0,t);for(let i=0;i<4;i++)e.rotate(2*Math.PI/4),e.lineTo(0,t)},this.triangle=(e,t)=>{e.moveTo(0,0-t);for(let i=0;i<3;i++)e.rotate(Math.PI/3),e.lineTo(0,0-.5*t),e.rotate(Math.PI/3),e.lineTo(0,0-t)},this.hexagon=(e,t)=>{e.moveTo(0,t);for(let i=0;i<6;i++)e.rotate(2*Math.PI/6),e.lineTo(0,t)},this.heart=(e,t)=>{let i=.8*t;e.translate(0,-t/2),e.rotate(45*Math.PI/180),e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(-i,0,-i,t,0,t),e.lineTo(t,t),e.lineTo(t,0),e.bezierCurveTo(t,-i,0,-i,0,0)},this.cross=(e,t)=>{let i=.35*t;e.moveTo(-i,-i);for(let s=0;s<4;s++)e.lineTo(-i,-t),e.lineTo(i,-t),e.lineTo(i,-i),e.rotate(Math.PI/2)},this.star=(e,t)=>{e.moveTo(0,0-t);for(let i=0;i<5;i++)e.rotate(Math.PI/5),e.lineTo(0,0-.5*t),e.rotate(Math.PI/5),e.lineTo(0,0-t)},this.glimmer=(e,t)=>{e.moveTo(0,0-t);for(let i=0;i<4;i++)e.rotate(Math.PI/4),e.lineTo(0,0-.2*t),e.rotate(Math.PI/4),e.lineTo(0,0-t)},this.down=e=>{this.selected&&"mask"===this.mode&&(this.x=this.y=-1,this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),i=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1==this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0),e.x!==this.x||e.y!==this.y){let s=e.x-this.x,n=e.y-this.y,a=s>0?1:-1,r=n>0?1:-1;if(s=s<0?-s:s,n=n<0?-n:n,s>n){let e=.5*s;for(let o=1;o<=s;o++)this.x+=a,e+=n,e>=s&&(e-=s,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=s,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}}i&&window.requestAnimationFrame((()=>this.stage.render()))},this.up=e=>{this.removeMoveListeners(),this.maskRect=a.l(this.scratch.canvas),this.maskData=this.maskRect?this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height):void 0,this.maskData&&this.setMode("effect")},this.cancel=()=>{var e;null===(e=this.scratch)||void 0===e||e.clear()},this.apply=()=>{if(!this.selected||!this.stage.fresco.hasLayer(this.selected))return;if(!this.maskRect)return;const e=new r.Z(0,0,this.selected.rect.width,this.selected.rect.height),t=a.$E(this.selected.canvas);this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"dispersion",layer:this.selected,patchRect:e,patch:t,rect:this.selected.rect.clone()})},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.removeDownListeners(),(0,s.ZP)("dispersion-apply").removeEventListener("click",this.applyClick,!1),(0,s.ZP)("dispersion-close").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("dispersion-cancel").removeEventListener("click",this.cancelClick,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),(0,s.ZP)("dispersion-mode-mask").removeEventListener("change",this.selectMode,!0),(0,s.ZP)("dispersion-mode-effect").removeEventListener("change",this.selectMode,!0),document.querySelectorAll('input[name="dispersion-type"]').forEach((e=>e.removeEventListener("change",this.disperse))),(0,s.ZP)("dispersion-shrink").removeEventListener("click",this.disperse,!1),(0,s.ZP)("dispersion-hollow").removeEventListener("click",this.disperse,!1),this.brushSize.cleanUp(),this.direction.cleanUp(),this.stretch.cleanUp(),this.amount.cleanUp(),this.spread.cleanUp(),this.scale.cleanUp(),this.selected=null,this.scratch=null},(0,s.ZP)("dispersion-apply").addEventListener("click",this.applyClick,!1),(0,s.ZP)("dispersion-close").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("dispersion-cancel").addEventListener("click",this.cancelClick,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),(0,s.ZP)("dispersion-mode-mask").addEventListener("change",this.selectMode,!0),(0,s.ZP)("dispersion-mode-effect").addEventListener("change",this.selectMode,!0),this.brush=new d.Z(new u.Z("circle",50,0)),this.brushSize=new c.Z("dispersion-brush-size",{label:(0,n.Z)("size"),step:2,range:[5,200],defaultValue:this.brush.settings.size,labelFormat:e=>e.toFixed(0)+"px",onEnd:e=>{this.brush.settings.size=e,this.updateBrush()}}),this.scale=new c.Z("dispersion-scale",{label:(0,n.Z)("scale"),range:[.02,1],step:.02,defaultValue:.2,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.disperse()}),this.amount=new c.Z("dispersion-amount",{label:(0,n.Z)("amount"),range:[.01,1],step:.01,defaultValue:.5,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.disperse()}),this.stretch=new c.Z("dispersion-stretch",{label:(0,n.Z)("stretch"),range:[0,1],step:.01,defaultValue:.5,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.disperse()}),this.direction=new c.Z("dispersion-direction",{label:(0,n.Z)("direction"),range:[-180,180],defaultValue:0,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onEnd:e=>this.disperse()}),this.spread=new c.Z("dispersion-spread",{label:(0,n.Z)("spread"),range:[-1,1],step:.02,defaultValue:0,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.disperse()}),document.querySelectorAll('input[name="dispersion-type"]').forEach((e=>e.addEventListener("change",this.disperse))),(0,s.ZP)("dispersion-shrink").addEventListener("click",this.disperse,!1),(0,s.ZP)("dispersion-hollow").addEventListener("click",this.disperse,!1),this.addDownListeners(),this.layerSelect()}}},99954:(e,t,i)=>{i.d(t,{Z:()=>a});var s=i(93947),n=i(18203);class a extends n.Z{constructor(e){super("effect",e),this.selectTool=e=>{let t=e.currentTarget.getAttribute("data");document.dispatchEvent(new CustomEvent("select-tool",{detail:t}))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.cleanUp=()=>{(0,s.ZP)("effect-close").removeEventListener("click",this.cancelClick,!1)};let t=(0,s.ZP)("effect-list").getElementsByTagName("li");for(var i=0;i<t.length;i++)t[i].addEventListener("click",this.selectTool,!1);(0,s.ZP)("effect-close").addEventListener("click",this.cancelClick,!1)}}},3948:(e,t,i)=>{i.d(t,{Z:()=>u});var s=i(93947),n=i(96548),a=i(33655),r=i(36817),o=i(18203),h=i(43673),c=i(4188),l=i(11726),d=i(4256);class u extends o.Z{constructor(e){super("focus",e),this.mode="symmetric",this.PI2=2*Math.PI,this.selectMode=e=>{this.mode=e.currentTarget.value,this.rotation=0,window.requestAnimationFrame((()=>{this.renderControls(),this.renderFocus()}))},this.applyClick=()=>{document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=()=>{if(this.selected===this.stage.fresco.getSelected()||this.apply(),!this.stage.fresco.isSelectedImageWithCanvas())return(0,s.ZP)("focus-layer-locked").style.display="block",(0,s.ZP)("focus-settings").style.display="none",this.selected=void 0,this.cached=void 0,this.shape=void 0,this.blur=void 0,void window.requestAnimationFrame((()=>{this.renderControls()}));(0,s.ZP)("focus-layer-locked").style.display="none",(0,s.ZP)("focus-settings").style.display="block",this.selected=this.stage.fresco.getSelected(),this.cached=this.selected.baked?this.selected.baked:this.selected.canvas,this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over",this.cached),this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.center=new h.Z(Math.round(this.stage.fresco.width/2),Math.round(this.stage.fresco.height/2)),this.distance=Math.round(this.stage.fresco.height/2*.75),this.falloff=Math.round(.5*this.distance),this.rotation=0,window.requestAnimationFrame((()=>{this.renderControls(),this.renderBlur(),this.renderShape()}))},this.down=e=>{if(!this.selected)return;this.downPoint=this.stage.translateRasterToFresco(e);let t=this.downPoint.clone();if(0!==this.rotation&&(this.matrix.reset(),this.matrix.translate(this.center),this.matrix.rotate(this.rotation),this.matrix.invert(),t=this.matrix.transformPoint(t).add(this.center)),this.checkControl(t),this.control){switch(this.control){case"center":this.downPosition=this.center.clone();break;case"falloff":this.downPosition=new h.Z(this.center.y,this.falloff),this.downPoint=t;break;case"distance":this.downPosition=new h.Z(this.center.y,this.distance),this.downPoint=t;break;case"rotation":this.downRotation=Math.atan2(this.downPoint.y-this.center.y,this.downPoint.x-this.center.x)-this.rotation}this.raster.addEventListener("pointerup",this.pointerUp,!1)}else a.aG(0,0,this.stage.fresco.width,this.stage.fresco.height,this.downPoint.x,this.downPoint.y)?this.renderControls():this.rctx.clearRect(0,0,this.raster.width,this.raster.height)},this.move=e=>{if(!this.selected)return;let t=this.stage.translateRasterToFresco(e),i=t.clone();if(0!==this.rotation&&(this.matrix.reset(),this.matrix.translate(this.center),this.matrix.rotate(this.rotation),this.matrix.invert(),i=this.matrix.transformPoint(i).add(this.center)),this.isDown){if(this.control){switch(this.control){case"center":this.center.x=this.downPosition.x+(t.x-this.downPoint.x),this.center.y=this.downPosition.y+(t.y-this.downPoint.y);break;case"falloff":this.falloff=a.uZ(this.downPosition.y+(i.y-this.downPoint.y),20,this.distance-20);break;case"distance":this.distance=a.uZ(this.downPosition.y+(i.y-this.downPoint.y),this.falloff+20,Math.round(this.cached.height));break;case"rotation":this.rotation=Math.atan2(t.y-this.center.y,t.x-this.center.x)-this.downRotation,this.rotation<0?this.rotation+=this.PI2:this.rotation>=this.PI2&&(this.rotation-=this.PI2)}window.requestAnimationFrame((()=>{this.renderControls(),this.renderFocus()}))}}else this.checkControl(i)},this.checkControl=e=>{let t=28/this.stage.zoom,i=t/2,s=50/this.stage.zoom,n=!1,r=!1;a.aG(this.center.x-i,this.center.y+this.falloff-i,t,t,e.x,e.y)&&(r="falloff"===this.control,this.control="falloff",n=!0),a.aG(this.center.x-i,this.center.y+this.distance-i,t,t,e.x,e.y)&&(r="distance"===this.control,this.control="distance",n=!0),a.aG(this.center.x-i,this.center.y-i,t,t,e.x,e.y)&&(r="center"===this.control,this.control="center",n=!0),"radial"!==this.mode&&a.aG(this.center.x+s-i,this.center.y-s-i,t,t,e.x,e.y)&&(r="rotation"===this.control,this.control="rotation",n=!0),n&&!r?(window.requestAnimationFrame(this.renderControls),this.raster.style.cursor="pointer"):!n&&this.control&&(this.control=void 0,window.requestAnimationFrame(this.renderControls),this.raster.style.cursor="unset")},this.up=e=>{this.isDown=!1},this.renderBlurEvent=()=>{window.requestAnimationFrame(this.renderBlur)},this.renderBlur=()=>{if((0,s.ZP)("bokeh-blur").checked){const e=document.querySelector('input[name="bokeh-blur-type"]:checked').value;this.shaders.addShader("bokeh",{size:this.bokehBlurSize.getValue(),amount:this.bokehBlurIntensity.getValue(),type:e})}else this.shaders.addShader("bokeh",void 0);const e=(0,s.ZP)("soft-blur").checked;this.shaders.addShader("blur",e?this.softBlurAmount.getValue():void 0),this.blur=this.shaders.apply(this.cached),this.renderFocus()},this.rand=(e,t)=>Math.random()*(t-e)+e,this.hsla=(e,t,i,s)=>"hsla("+e+","+t+"%,"+i+"%,"+s+")",this.renderShape=()=>{if(!(0,s.ZP)("bokeh-shape").checked)return this.shape=void 0,void this.renderFocus();this.shape||(this.shape=a.vL(this.cached.width,this.cached.height));const e=this.shape.getContext("2d");e.clearRect(0,0,this.shape.width,this.shape.height),e.save(),e.globalCompositeOperation="lighter";const t=document.querySelector('input[name="bokeh-shape-type"]:checked').value,i=this.shape.width,n=this.shape.height,r=i+n,o=this.bokehShapeHue.getValue()+180,h=.1*r*this.bokehShapeSize.getValue(),c=.03*r;let l,d=Math.floor(.1*r*this.bokehShapeQuantity.getValue());switch(t){case"circle":l=this.circle;break;case"square":l=this.square;break;case"hexagon":l=this.hexagon;break;case"cross":l=this.cross;break;case"triangle":l=this.triangle;break;case"heart":l=this.heart;break;case"star":l=this.star;break;case"glimmer":l=this.glimmer}const u=(0,s.ZP)("bokeh-shape-dual").checked;for(;d--;){const t=this.rand(0,i),s=this.rand(0,n),a=this.rand(1,h);let r=this.rand(o-30,o+30);u&&d%2==0&&(r+=120),e.shadowColor=this.hsla(r,this.rand(10,80),this.rand(30,60),this.rand(.2,.8)),e.shadowBlur=this.rand(10,c),e.beginPath(),e.save(),e.translate(t,s),e.rotate(Math.random()*this.PI2),l(e,a),e.restore(),e.closePath(),e.fill()}for(d=Math.floor(.03*r*this.bokehShapeQuantity.getValue()),e.shadowBlur=15,e.shadowColor="#fff";d--;){const t=this.rand(0,i),s=this.rand(0,n),a=this.rand(.5,.75*h);e.fillStyle=this.hsla(0,0,100,this.rand(.03,.1)),e.beginPath(),e.save(),e.translate(t,s),e.rotate(Math.random()*this.PI2),l(e,a),e.restore(),e.closePath(),e.fill()}e.restore(),this.renderFocus()},this.circle=(e,t)=>{e.arc(0,0,t,0,2*Math.PI)},this.square=(e,t)=>{e.moveTo(0,t);for(let i=0;i<4;i++)e.rotate(2*Math.PI/4),e.lineTo(0,t)},this.triangle=(e,t)=>{e.moveTo(0,0-t);for(let i=0;i<3;i++)e.rotate(Math.PI/3),e.lineTo(0,0-.5*t),e.rotate(Math.PI/3),e.lineTo(0,0-t)},this.hexagon=(e,t)=>{e.moveTo(0,t);for(let i=0;i<6;i++)e.rotate(2*Math.PI/6),e.lineTo(0,t)},this.heart=(e,t)=>{let i=.8*t;e.translate(0,-t/2),e.rotate(45*Math.PI/180),e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(-i,0,-i,t,0,t),e.lineTo(t,t),e.lineTo(t,0),e.bezierCurveTo(t,-i,0,-i,0,0)},this.cross=(e,t)=>{let i=.35*t;e.moveTo(-i,-i);for(let s=0;s<4;s++)e.lineTo(-i,-t),e.lineTo(i,-t),e.lineTo(i,-i),e.rotate(Math.PI/2)},this.star=(e,t)=>{e.moveTo(0,0-t);for(let i=0;i<5;i++)e.rotate(Math.PI/5),e.lineTo(0,0-.5*t),e.rotate(Math.PI/5),e.lineTo(0,0-t)},this.glimmer=(e,t)=>{e.moveTo(0,0-t);for(let i=0;i<4;i++)e.rotate(Math.PI/4),e.lineTo(0,0-.2*t),e.rotate(Math.PI/4),e.lineTo(0,0-t)},this.renderFocus=()=>{if(this.scratch.replaceCanvas(this.blur),this.scratch.drawCanvas(this.shape,"screen",this.bokehShapeIntensity.getValue()),"none"===this.mode)return void window.requestAnimationFrame(this.stage.render);let e;const t=(0,s.ZP)("focus-invert").checked,i=t?"#00000000":"#000000FF",n=t?"#000000FF":"#00000000";let a=this.center.neg(this.selected.rect.topLeft());if("radial"===this.mode){const t=this.falloff/this.distance;e=this.scratch.ctx.createRadialGradient(a.x,a.y,0,a.x,a.y,this.distance),e.addColorStop(0,i),e.addColorStop(t,i),e.addColorStop(1,n)}else if("symmetric"===this.mode){const t=this.falloff/this.distance*.5,s=new h.Z(a.x,a.y-this.distance).rotateAround(a,this.rotation),r=new h.Z(a.x,a.y+this.distance).rotateAround(a,this.rotation);e=this.scratch.ctx.createLinearGradient(s.x,s.y,r.x,r.y),e.addColorStop(0,n),e.addColorStop(.5-t,i),e.addColorStop(.5,i),e.addColorStop(.5+t,i),e.addColorStop(1,n)}else{const t=this.falloff/this.distance,s=new h.Z(a.x,a.y+this.distance).rotateAround(a,this.rotation);e=this.scratch.ctx.createLinearGradient(a.x,a.y,s.x,s.y),e.addColorStop(0,i),e.addColorStop(t,i),e.addColorStop(1,n)}this.scratch.ctx.save(),this.scratch.ctx.fillStyle=e,this.scratch.ctx.globalCompositeOperation="destination-out",this.scratch.ctx.fillRect(0,0,this.scratch.canvas.width,this.scratch.canvas.height),this.scratch.ctx.restore(),window.requestAnimationFrame(this.stage.render)},this.renderControls=()=>{if(this.rctx.clearRect(0,0,this.raster.width,this.raster.height),!this.selected||"none"===this.mode)return;const e=this.stage.translateFrescoToRaster(this.center),t=Math.round(this.falloff*this.stage.zoom),i=Math.round(this.distance*this.stage.zoom),s="radial"!==this.mode;this.rctx.save(),this.rctx.lineWidth=2,this.rctx.shadowBlur=6,this.rctx.shadowColor="rgba(0,0,0,0.5)",this.rctx.strokeStyle=a.XE,this.rctx.translate(e.x,e.y),this.rctx.rotate(this.rotation),"symmetric"===this.mode?(this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,-i),this.rctx.lineTo(this.raster.width,-i),this.rctx.closePath(),this.rctx.stroke(),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,i),this.rctx.lineTo(this.raster.width,i),this.rctx.closePath(),this.rctx.stroke(),this.rctx.setLineDash([5,8]),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,-t),this.rctx.lineTo(this.raster.width,-t),this.rctx.closePath(),this.rctx.stroke(),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,t),this.rctx.lineTo(this.raster.width,+t),this.rctx.closePath(),this.rctx.stroke()):"linear"===this.mode?(this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,i),this.rctx.lineTo(this.raster.width,i),this.rctx.closePath(),this.rctx.stroke(),this.rctx.setLineDash([5,8]),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,t),this.rctx.lineTo(this.raster.width,t),this.rctx.closePath(),this.rctx.stroke()):(this.rctx.beginPath(),this.rctx.arc(0,0,i,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.stroke(),this.rctx.setLineDash([5,5]),this.rctx.beginPath(),this.rctx.arc(0,0,t,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.stroke()),this.rctx.setLineDash([]),this.rctx.fillStyle=a.wf,this.rctx.beginPath(),this.rctx.arc(0,t,"falloff"===this.control?12:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="falloff"===this.control?a.xZ:a.Bs,this.rctx.beginPath(),this.rctx.arc(0,t,"falloff"===this.control?10:6,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle=a.wf,this.rctx.beginPath(),this.rctx.arc(0,i,"distance"===this.control?12:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="distance"===this.control?a.xZ:a.Bs,this.rctx.beginPath(),this.rctx.arc(0,i,"distance"===this.control?10:6,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),s&&(this.rctx.fillStyle=a.wf,this.rctx.beginPath(),this.rctx.arc(50,-50,"rotation"===this.control?12:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="rotation"===this.control?a.xZ:a.Bs,this.rctx.beginPath(),this.rctx.arc(50,-50,"rotation"===this.control?10:6,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill()),this.rctx.fillStyle=a.wf,this.rctx.beginPath(),this.rctx.arc(0,0,"center"===this.control?12:10,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="center"===this.control?a.xZ:a.XI,this.rctx.beginPath(),this.rctx.arc(0,0,"center"===this.control?10:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.restore()},this.cancel=()=>{var e;null===(e=this.scratch)||void 0===e||e.clear(),this.blur=void 0,this.shape=void 0,this.cached=void 0},this.apply=()=>{if(!this.selected||!this.stage.fresco.hasLayer(this.selected))return;const e=(0,s.ZP)("soft-blur").checked,t=(0,s.ZP)("bokeh-blur").checked,i=(0,s.ZP)("bokeh-shape").checked;if(!e&&!t&&!i)return;const n=new r.Z(0,0,this.selected.rect.width,this.selected.rect.height),o=a.$E(this.selected.canvas);this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.shaders.reset(),this.stage.history.add({type:"bitmapChange",kind:"focus",layer:this.selected,patchRect:n,patch:o,rect:this.selected.rect.clone()})},this.cleanUp=()=>{var e;this.removeMoveListeners(),this.removeDownListeners(),this.stage.fresco.removeScratch(),null===(e=this.shaders)||void 0===e||e.cleanUp(),this.shaders=void 0,this.softBlurAmount.cleanUp(),this.bokehBlurSize.cleanUp(),this.bokehBlurIntensity.cleanUp(),this.bokehShapeHue.cleanUp(),this.bokehShapeSize.cleanUp(),this.bokehShapeQuantity.cleanUp(),this.bokehShapeIntensity.cleanUp(),(0,s.ZP)("focus-invert").removeEventListener("click",this.renderFocus),(0,s.ZP)("focus-mode-symmetric").removeEventListener("change",this.selectMode,!1),(0,s.ZP)("focus-mode-linear").removeEventListener("change",this.selectMode,!1),(0,s.ZP)("focus-mode-radial").removeEventListener("change",this.selectMode,!1),(0,s.ZP)("focus-mode-none").removeEventListener("change",this.selectMode,!1),(0,s.ZP)("soft-blur").removeEventListener("change",this.renderBlurEvent,!1),(0,s.ZP)("bokeh-blur").removeEventListener("change",this.renderBlurEvent,!1),(0,s.ZP)("bokeh-blur-type-circle").removeEventListener("change",this.renderBlurEvent,!1),(0,s.ZP)("bokeh-blur-type-square").removeEventListener("change",this.renderBlurEvent,!1),(0,s.ZP)("bokeh-blur-type-hexagon").removeEventListener("change",this.renderBlurEvent,!1),(0,s.ZP)("bokeh-blur-type-cross").removeEventListener("change",this.renderBlurEvent,!1),(0,s.ZP)("bokeh-shape").removeEventListener("change",this.renderShape,!1),(0,s.ZP)("bokeh-shape-dual").removeEventListener("change",this.renderShape,!1),document.querySelectorAll('input[name="bokeh-shape-type"]').forEach((e=>e.removeEventListener("change",this.renderShape))),this.removeDownListeners(),this.raster.removeEventListener("pointermove",this.pointerMove,!1),(0,s.ZP)("focus-apply").removeEventListener("click",this.applyClick,!1),(0,s.ZP)("focus-close").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("focus-cancel").removeEventListener("click",this.cancelClick,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("viewport-render",this.renderControls,!1),this.cached=void 0,this.shape=void 0,this.blur=void 0,this.raster=void 0,this.rctx=void 0},this.matrix=new l.Z,this.shaders=new d.Z,this.raster=e.raster,this.rctx=this.raster.getContext("2d"),(0,s.ZP)("focus-mode-symmetric").addEventListener("change",this.selectMode,!1),(0,s.ZP)("focus-mode-linear").addEventListener("change",this.selectMode,!1),(0,s.ZP)("focus-mode-radial").addEventListener("change",this.selectMode,!1),(0,s.ZP)("focus-mode-none").addEventListener("change",this.selectMode,!1),(0,s.ZP)("focus-invert").addEventListener("click",this.renderFocus),(0,s.ZP)("soft-blur").addEventListener("change",this.renderBlurEvent,!1),this.softBlurAmount=new c.Z("soft-blur-amount",{label:(0,n.Z)("amount"),range:[0,1],step:.01,defaultValue:.3,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderBlurEvent()}),(0,s.ZP)("bokeh-blur").addEventListener("change",this.renderBlurEvent,!1),(0,s.ZP)("bokeh-blur-type-circle").addEventListener("change",this.renderBlurEvent,!1),(0,s.ZP)("bokeh-blur-type-square").addEventListener("change",this.renderBlurEvent,!1),(0,s.ZP)("bokeh-blur-type-hexagon").addEventListener("change",this.renderBlurEvent,!1),(0,s.ZP)("bokeh-blur-type-cross").addEventListener("change",this.renderBlurEvent,!1),this.bokehBlurSize=new c.Z("bokeh-blur-size",{label:(0,n.Z)("size"),range:[0,1],step:.01,defaultValue:.3,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderBlurEvent()}),this.bokehBlurIntensity=new c.Z("bokeh-blur-intensity",{label:(0,n.Z)("intensity"),range:[0,1],step:.01,defaultValue:.5,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderBlurEvent()}),(0,s.ZP)("bokeh-shape").addEventListener("change",this.renderShape,!1),(0,s.ZP)("bokeh-shape-dual").addEventListener("change",this.renderShape,!1),document.querySelectorAll('input[name="bokeh-shape-type"]').forEach((e=>e.addEventListener("change",this.renderShape))),this.bokehShapeHue=new c.Z("bokeh-shape-hue",{label:(0,n.Z)("color"),range:[-180,180],step:1,labelFormat:e=>String(e),labelParse:e=>parseInt(e,10),onEnd:e=>this.renderShape()}),this.bokehShapeSize=new c.Z("bokeh-shape-size",{label:(0,n.Z)("size"),range:[0,1],step:.01,defaultValue:.4,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderShape()}),this.bokehShapeQuantity=new c.Z("bokeh-shape-quantity",{label:(0,n.Z)("quantity"),range:[0,1],step:.01,defaultValue:.4,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderShape()}),this.bokehShapeIntensity=new c.Z("bokeh-shape-intensity",{label:(0,n.Z)("intensity"),range:[0,1],step:.01,defaultValue:.6,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderFocus()}),(0,s.ZP)("focus-apply").addEventListener("click",this.applyClick,!1),(0,s.ZP)("focus-close").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("focus-cancel").addEventListener("click",this.cancelClick,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("viewport-render",this.renderControls,!1),this.mode=document.querySelector('input[name="focus-mode"]:checked').value,this.addDownListeners(),this.addMoveListeners(),this.layerSelect()}}},89:(e,t,i)=>{i.d(t,{Z:()=>l});var s=i(93947),n=i(96548),a=i(33655),r=i(36817),o=i(18203),h=i(4188),c=i(4256);class l extends o.Z{constructor(e){super("glitch",e),this.splitType="red-blue",this.splitTypes=["red-blue","green-red","blue-green","red","blue","green"],this.checkStateChanges=()=>{(0,s.ZP)("glitch-split").classList.toggle("changed",this.splitDistance.isChanged()),(0,s.ZP)("glitch-scan").classList.toggle("changed",this.scanSize.isChanged()),(0,s.ZP)("glitch-interfer").classList.toggle("changed",this.interferSeed.isChanged()),(0,s.ZP)("glitch-slice").classList.toggle("changed",this.sliceSeed.isChanged()),(0,s.ZP)("glitch-bleed").classList.toggle("changed",this.bleedSeed.isChanged())},this.reset=e=>{this.cacheChain=this.shaders.cloneChain(),this.shaders.reset(),this.splitDistance.reset(),this.scanSize.reset(),this.interferSeed.reset(),this.sliceSeed.reset(),this.bleedSeed.reset(),this.scratch.canvas=this.cached,window.requestAnimationFrame((()=>this.stage.render())),this.checkStateChanges(),e&&(this.addHistory("reset"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("reset")})))},this.glPreset=e=>{switch(this.cacheChain=this.shaders.cloneChain(),this.reset(),e.currentTarget.id){case"glitch-gl1":this.splitDistance.setValue(.14),this.splitDirection.setValue(180),this.splitAmount.setValue(1),(0,s.ZP)("split-"+this.splitType).classList.remove("active"),this.splitType="red-blue",(0,s.ZP)("split-"+this.splitType).classList.add("active"),this.split(),this.scanSize.setValue(3),this.scanAmount.setValue(.25),this.scan(),this.sliceSeed.setValue(172),this.sliceAmount.setValue(3),this.sliceDistance.setValue(.1),this.slice();break;case"glitch-gl2":this.splitDistance.setValue(.22),this.splitDirection.setValue(0),this.splitAmount.setValue(1),(0,s.ZP)("split-"+this.splitType).classList.remove("active"),this.splitType="blue",(0,s.ZP)("split-"+this.splitType).classList.add("active"),this.split(),this.sliceSeed.setValue(95),this.sliceAmount.setValue(4),this.sliceDistance.setValue(.2),(0,s.ZP)("slice-line").checked=!0,this.slice(),this.bleedSeed.setValue(83),this.bleedAmplitude.setValue(.3),this.bleed();break;case"glitch-gl3":this.splitDistance.setValue(.2),this.splitDirection.setValue(215),this.splitAmount.setValue(.6),(0,s.ZP)("split-"+this.splitType).classList.remove("active"),this.splitType="red",(0,s.ZP)("split-"+this.splitType).classList.add("active"),this.split(),this.scanSize.setValue(3),this.scanAmount.setValue(.14),this.scan(),this.interferSeed.setValue(7),this.interferAmount.setValue(.04),this.interfer(),this.bleedSeed.setValue(178),this.bleedAmplitude.setValue(.67),this.bleed();break;case"glitch-gl4":this.splitDistance.setValue(.51),this.splitDirection.setValue(57),this.splitAmount.setValue(.4),(0,s.ZP)("split-"+this.splitType).classList.remove("active"),this.splitType="blue",(0,s.ZP)("split-"+this.splitType).classList.add("active"),this.split(),this.sliceSeed.setValue(193),this.sliceAmount.setValue(4),this.sliceDistance.setValue(.2),this.slice()}this.addHistory("preset"),document.dispatchEvent(new CustomEvent("notification",{detail:"GL"}))},this.random=()=>{this.cacheChain=this.shaders.cloneChain(),this.reset(),Math.random()>.5&&(this.splitDistance.setValue(.7*Math.random()),(0,s.ZP)("split-"+this.splitType).classList.remove("active"),this.splitType=this.splitTypes[Math.floor(5.999*Math.random())],(0,s.ZP)("split-"+this.splitType).classList.add("active"),this.splitDirection.setValue(Math.round(360*Math.random())),this.splitAmount.setValue(.5+.5*Math.random()),this.split()),Math.random()>.5&&(this.scanSize.setValue(Math.round(4*Math.random())),this.scanAmount.setValue(Math.round(.8*Math.random()*100)/100),this.scan()),Math.random()>.7&&(this.interferSeed.setValue(Math.round(100*Math.random())),this.interferAmount.setValue(Math.round(100*(.2*Math.random()-.1))/100),this.interfer()),Math.random()>.5&&(this.sliceSeed.setValue(Math.round(200*Math.random())),(0,s.ZP)("slice-line").checked=Math.random()>.5,this.slice()),Math.random()>.5&&(this.bleedSeed.setValue(Math.round(200*Math.random())),this.bleedAmplitude.setValue(Math.round(100*Math.random())/100),this.bleed()),this.addHistory("random"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,n.Z)("random")}))},this.applyClick=()=>{document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=()=>{if(this.selected===this.stage.fresco.getSelected()||this.apply(),!this.stage.fresco.isSelectedShaderbleWithCanvas())return(0,s.ZP)("glitch-layer-locked").style.display="block",(0,s.ZP)("glitch-settings").style.display="none",void(this.selected=void 0);(0,s.ZP)("glitch-layer-locked").style.display="none",(0,s.ZP)("glitch-settings").style.display="block",this.selected=this.stage.fresco.getSelected(),this.cached=this.selected.baked?this.selected.baked:this.selected.canvas,this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"replace",this.cached),this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.setValues(this.shaders.chain),this.checkStateChanges()},this.setValues=e=>{this.reset(),e&&e.forEach((e=>{switch(e.type){case"rgb-split":{let t=e.value;this.splitDistance.setValue(20*t.distance),this.splitDirection.setValue(t.direction),this.splitAmount.setValue(t.amount),this.splitType=t.type,this.split()}case"scanlines":{let t=e.value;this.scanSize.setValue(4*t.size),this.scanAmount.setValue(4*t.amount),(0,s.ZP)("scan-colorize").checked=t.colorize,(0,s.ZP)("scan-direction").checked=t.direction,this.scan()}case"interfer":{let t=e.value;this.interferSeed.setValue(t.seed),this.interferAmount.setValue(t.amount),(0,s.ZP)("interfer-direction").checked=t.direction,this.interfer()}case"slice":{let t=e.value;this.sliceSeed.setValue(t.seed),this.sliceAmount.setValue(t.amount),this.sliceDistance.setValue(t.distance),(0,s.ZP)("slice-line").checked=t.line,this.slice()}case"bleed":let t=e.value;this.bleedSeed.setValue(t.seed),this.bleedAmplitude.setValue(7*t.amplitude),this.bleedBlock.setValue(t.block),this.bleed()}}))},this.splitSwatch=e=>{this.cacheChain=this.shaders.cloneChain(),(0,s.ZP)("split-"+this.splitType).classList.remove("active");let t=e.currentTarget;this.splitType=t.getAttribute("data"),t.classList.add("active"),this.split(),this.addHistory("split")},this.split=()=>{0===this.splitDistance.getValue()?this.shaders.addShader("rgb-split",void 0):this.shaders.addShader("rgb-split",{distance:this.splitDistance.getValue()/20,amount:this.splitAmount.getValue(),direction:this.splitDirection.getValue(),type:this.splitType}),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render())),this.checkStateChanges()},this.scanCheck=()=>{this.cacheChain=this.shaders.cloneChain(),this.scan(),this.addHistory("scan")},this.scan=()=>{0===this.scanSize.getValue()?this.shaders.addShader("scanlines",void 0):this.shaders.addShader("scanlines",{size:this.scanSize.getValue()/4,amount:this.scanAmount.getValue()/4,colorize:(0,s.ZP)("scan-colorize").checked,direction:(0,s.ZP)("scan-direction").checked}),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render())),this.checkStateChanges()},this.interferCheck=()=>{this.cacheChain=this.shaders.cloneChain(),this.interfer(),this.addHistory("interfer")},this.interfer=()=>{0===this.interferSeed.getValue()?this.shaders.addShader("interference",void 0):this.shaders.addShader("interference",{seed:this.interferSeed.getValue(),amount:this.interferAmount.getValue(),direction:(0,s.ZP)("interfer-direction").checked}),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render())),this.checkStateChanges()},this.sliceCheck=()=>{this.cacheChain=this.shaders.cloneChain(),this.slice(),this.addHistory("slice")},this.slice=()=>{0===this.sliceSeed.getValue()?this.shaders.addShader("slice",void 0):this.shaders.addShader("slice",{seed:this.sliceSeed.getValue(),amount:this.sliceAmount.getValue(),distance:this.sliceDistance.getValue(),line:(0,s.ZP)("slice-line").checked}),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render())),this.checkStateChanges()},this.bleed=()=>{this.selected&&(0===this.bleedSeed.getValue()?this.shaders.addShader("bleed",void 0):this.shaders.addShader("bleed",{seed:this.bleedSeed.getValue(),amplitude:this.bleedAmplitude.getValue()/7,block:4*this.bleedBlock.getValue()}),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render())),this.checkStateChanges())},this.addHistory=e=>{this.stage.history.add({type:"glitch",layer:this.selected,kind:e,shaders:this.shaders,chain:this.cacheChain})},this.cancel=()=>{this.shaders.chain=[],this.stage.history.abortTransaction()},this.apply=()=>{if(!this.selected||!this.stage.fresco.hasLayer(this.selected)||!this.shaders||0===this.shaders.chain.length)return;const e=new r.Z(0,0,this.selected.rect.width,this.selected.rect.height),t=a.$E(this.selected.canvas);this.selected.replaceCanvas(this.shaders.apply(this.selected.canvas)),this.selected.render(),this.shaders.reset(),this.stage.history.add({type:"bitmapChange",kind:"glitch",layer:this.selected,patchRect:e,patch:t,rect:this.selected.rect.clone()})},this.cleanUp=()=>{var e;this.stage.fresco.removeScratch(),this.stage.history.abortTransaction(),null===(e=this.shaders)||void 0===e||e.cleanUp(),this.bleedSeed.cleanUp(),this.bleedBlock.cleanUp(),this.bleedAmplitude.cleanUp(),this.splitAmount.cleanUp(),this.splitDistance.cleanUp(),this.splitDirection.cleanUp(),this.scanSize.cleanUp(),this.scanAmount.cleanUp(),this.interferSeed.cleanUp(),this.interferAmount.cleanUp(),this.sliceSeed.cleanUp(),this.sliceAmount.cleanUp(),this.sliceDistance.cleanUp(),document.querySelector("#split-swatches").querySelectorAll("div").forEach((e=>e.removeEventListener("click",this.splitSwatch))),(0,s.ZP)("scan-colorize").removeEventListener("click",this.scanCheck),(0,s.ZP)("scan-direction").removeEventListener("click",this.scanCheck),(0,s.ZP)("interfer-direction").removeEventListener("click",this.interferCheck),(0,s.ZP)("slice-line").removeEventListener("click",this.sliceCheck),(0,s.ZP)("glitch-apply").removeEventListener("click",this.applyClick,!1),(0,s.ZP)("glitch-close").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("glitch-cancel").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("glitch-random").removeEventListener("click",this.random,!0),(0,s.ZP)("glitch-reset").removeEventListener("click",this.reset,!0),(0,s.ZP)("glitch-gl1").removeEventListener("click",this.glPreset,!0),(0,s.ZP)("glitch-gl2").removeEventListener("click",this.glPreset,!0),(0,s.ZP)("glitch-gl3").removeEventListener("click",this.glPreset,!0),(0,s.ZP)("glitch-gl4").removeEventListener("click",this.glPreset,!0),document.removeEventListener("layer-select",this.layerSelect,!1)},this.shaders=new c.Z,(0,s.ZP)("glitch-random").addEventListener("click",this.random,!0),(0,s.ZP)("glitch-reset").addEventListener("click",this.reset,!0),(0,s.ZP)("glitch-gl1").addEventListener("click",this.glPreset,!0),(0,s.ZP)("glitch-gl2").addEventListener("click",this.glPreset,!0),(0,s.ZP)("glitch-gl3").addEventListener("click",this.glPreset,!0),(0,s.ZP)("glitch-gl4").addEventListener("click",this.glPreset,!0),this.splitDistance=new h.Z("split-distance",{label:(0,n.Z)("distance"),step:.01,range:[0,1],defaultValue:0,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.split(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("split")}}),this.splitDirection=new h.Z("split-direction",{label:(0,n.Z)("direction"),step:1,range:[0,360],defaultValue:180,labelFormat:e=>`${Math.round(e)}`,labelParse:e=>parseInt(e,10),onChange:e=>this.split(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("split")}}),this.splitAmount=new h.Z("split-amount",{label:(0,n.Z)("amount"),step:.01,range:[0,1],defaultValue:1,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.split(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("split")}}),document.querySelector("#split-swatches").querySelectorAll("div").forEach((e=>e.addEventListener("click",this.splitSwatch))),this.scanSize=new h.Z("scan-size",{label:(0,n.Z)("size"),range:[0,10],step:1,defaultValue:0,labelFormat:e=>String(e),onChange:e=>this.scan(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("scan")}}),this.scanAmount=new h.Z("scan-amount",{label:(0,n.Z)("amount"),step:.01,range:[0,1],defaultValue:.5,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.scan(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("scan")}}),(0,s.ZP)("scan-colorize").addEventListener("click",this.scanCheck),(0,s.ZP)("scan-direction").addEventListener("click",this.scanCheck),this.interferSeed=new h.Z("interfer-seed",{label:(0,n.Z)("seed"),range:[0,100],step:1,defaultValue:0,labelFormat:e=>String(e),onChange:e=>this.interfer(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("interfer")}}),this.interferAmount=new h.Z("interfer-amount",{label:(0,n.Z)("amount"),step:.01,range:[-1,1],defaultValue:.2,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.interfer(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("interfer")}}),(0,s.ZP)("interfer-direction").addEventListener("click",this.interferCheck),this.sliceSeed=new h.Z("slice-seed",{label:(0,n.Z)("seed"),range:[0,200],step:1,defaultValue:0,labelFormat:e=>String(e),onChange:e=>this.slice(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("slice")}}),this.sliceAmount=new h.Z("slice-amount",{label:(0,n.Z)("amount"),step:1,range:[0,25],defaultValue:4,labelFormat:e=>`${Math.round(e)}`,labelParse:e=>parseInt(e,10),onChange:e=>this.slice(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("slice")}}),this.sliceDistance=new h.Z("slice-distance",{label:(0,n.Z)("distance"),step:.01,range:[-1,1],defaultValue:.2,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.slice(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("slice")}}),(0,s.ZP)("slice-line").addEventListener("click",this.sliceCheck),this.bleedSeed=new h.Z("bleed-seed",{label:(0,n.Z)("seed"),range:[0,200],step:1,defaultValue:0,labelFormat:e=>String(e),onChange:e=>this.bleed(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("bleed")}}),this.bleedAmplitude=new h.Z("bleed-amplitude",{label:(0,n.Z)("amount"),step:.01,range:[0,1],defaultValue:.5,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.bleed(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("bleed")}}),this.bleedBlock=new h.Z("bleed-block",{label:(0,n.Z)("block"),step:.01,range:[0,1],defaultValue:.7,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.bleed(),onStart:()=>{this.cacheChain=this.shaders.cloneChain()},onEnd:(e,t,i)=>{this.addHistory("bleed")}}),(0,s.ZP)("glitch-apply").addEventListener("click",this.applyClick,!1),(0,s.ZP)("glitch-close").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("glitch-cancel").addEventListener("click",this.cancelClick,!1),document.addEventListener("layer-select",this.layerSelect,!1),this.layerSelect()}}},69453:(e,t,i)=>{i.d(t,{Z:()=>l});var s=i(96548),n=i(93947),a=i(18203),r=i(9579),o=i(31971),h=i(75934),c=i(32804);class l extends a.Z{constructor(e){super("layout",e),this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.resize=e=>{new r.Z(this.stage)},this.background=e=>{new o.Z(this.stage)},this.loadTemplates=async(e=1)=>{if(!this.stage.fresco.templateMeta||!this.stage.fresco.templateMeta.category)return;(0,n.ZP)("layout-loading").style.display="block";let t={limit:50};t.category=this.stage.fresco.templateMeta.category,t.page=e;const i=await c.Qz(t);if(await this.renderTemplateResult(i.templates),i.page!==i.pages){const t=(0,n.T)("div",{className:"button big positive w-100",style:"margin:20px auto"},(0,s.Z)("loadMore"));t.addEventListener("click",(()=>{this.loadTemplates(e+1),t.remove()})),(0,n.ZP)("layout-list").append(t)}(0,n.ZP)("layout-loading").style.display="none"},this.renderTemplateResult=async e=>{if(!e||0===e.length)return;let t=(0,n.ZP)("layout-list");t.hasChildNodes()||((0,n.ZP)("layout-list-title").innerText=(0,s.Z)("similarTemplates")),e.forEach((e=>{const i=(0,n.T)("div",{id:e.id,className:"template-box"});if(e.ratio.width/e.ratio.height>1.75&&i.classList.add("wide"),e.premium?i.appendChild((0,n.T)("div",{className:"premium"})):i.appendChild((0,n.T)("div",{className:"free"},(0,s.Z)("free"))),i.title=e.name,i.addEventListener("click",(()=>h.$k(this.stage,e)),!0),Date.parse(e.createdAt)>Date.now()-26298e5&&i.append((0,n.T)("div",{className:"new"},(0,s.Z)("new"))),e.animated){let t=(0,n.T)("video",{autoplay:!0,muted:!0,loop:!0},(0,n.T)("source",{src:e.previewVideo,type:"video/mp4"}));t.height=250,t.width=Math.round(Number(e.ratio.width)/Number(e.ratio.height)*250),t.title=e.name,i.appendChild(t)}else{let t=(0,n.T)("img",{src:e.thumbnailMedium});t.height=250,t.width=Math.round(Number(e.ratio.width)/Number(e.ratio.height)*250),t.loading="lazy",t.alt=e.name,i.appendChild(t)}t.append(i)})),(0,n.ZP)("template-loading").style.display="none"},this.cleanUp=()=>{(0,n.ZP)("layout-list").innerHTML="",(0,n.ZP)("layout-resize").removeEventListener("click",this.resize,!1),(0,n.ZP)("layout-background").removeEventListener("click",this.background,!1),(0,n.ZP)("layout-close").removeEventListener("click",this.cancelClick,!1),(0,n.ZP)("layout-cancel").removeEventListener("click",this.cancelClick,!1)},(0,n.ZP)("layout-close").addEventListener("click",this.cancelClick,!1),(0,n.ZP)("layout-cancel").addEventListener("click",this.cancelClick,!1),(0,n.ZP)("layout-resize").addEventListener("click",this.resize,!1),(0,n.ZP)("layout-background").addEventListener("click",this.background,!1),this.loadTemplates()}}},51158:(e,t,i)=>{i.d(t,{Z:()=>d});var s=i(93947),n=i(96548),a=i(33655),r=i(18203),o=i(4188),h=i(98776),c=i(12257),l=i(50972);class d extends r.Z{constructor(e){super("liquify",e),this.timedStroke=!1,this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=async()=>{const{Displacement:e}=await Promise.resolve().then(i.bind(i,28132));if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,s.ZP)("liquify-no-layer").style.display="block",(0,s.ZP)("liquify-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,s.ZP)("liquify-sub-tools").style.display="block",(0,s.ZP)("liquify-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"replace"),this.scratch.ctx.drawImage(this.selected.canvas,0,0);const t=this.selected.canvas.getContext("2d").getImageData(0,0,this.selected.canvas.width,this.selected.canvas.height);if(this.displacement)this.displacement.retarget(t.data,t.width,t.height);else{this.displacement=new e(t.data,t.width,t.height,this.sizeSlider.getValue(),this.strengthSlider.getValue(),this.densitySlider.getValue());const i=document.querySelector('input[name="liquify-mode"]:checked').value;this.setMode(i),this.brush.settings.size=this.sizeSlider.getValue()}this.updateBrush()},this.selectMode=e=>{this.setMode(e.currentTarget.value)},this.setMode=e=>{var t;this.timedStroke="MOVE"!==e,null===(t=this.displacement)||void 0===t||t.setMode(e)},this.updateBrush=()=>{this.brush.generate(),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom,new h.Z(255,255,255,255))):this.stage.coating.removeCursorImage()},this.down=e=>{this.selected&&this.displacement&&(this.scratch.rect=this.selected.rect,this.stroke=this.displacement.beginStroke(),this.highQualityStroke=(0,s.ZP)("liquify-hq-preview").checked,this.move(e),this.addMoveListeners())},this.move=e=>{const t=this.stage.translateRasterToFresco(e,this.selected.rect),i=this.stroke.push(t.x,t.y,this.timedStroke);if(i){this.strokeDamage=i.union(this.strokeDamage),window.requestAnimationFrame((()=>this.stage.render()));const e=this.highQualityStroke?this.displacement.applyQuality(i):this.displacement.applyFast(i);this.scratch.ctx.putImageData(new ImageData(e,i.width,i.height),i.x,i.y)}this.timedStroke&&(window.clearTimeout(this.strokeTimeout),this.strokeTimeout=window.setTimeout((()=>this.move(e)),16))},this.up=e=>{var t;if(null===(t=this.stroke)||void 0===t||t.free(),this.stroke=void 0,window.clearTimeout(this.strokeTimeout),this.removeMoveListeners(),!this.displacement||!this.strokeDamage)return;const i=this.strokeDamage;if(this.strokeDamage=void 0,!this.highQualityStroke){let e=this.displacement.applyQuality(i);this.scratch.ctx.putImageData(new ImageData(e,i.width,i.height),i.x,i.y),window.requestAnimationFrame((()=>this.stage.render()))}const s=a.$E(this.selected.canvas,i),n=this.selected.rect.clone(),r=this.selected.canvas.getContext("2d");r.clearRect(i.x,i.y,i.width,i.height),r.drawImage(this.scratch.canvas,i.x,i.y,i.width,i.height,i.x,i.y,i.width,i.height),this.scratch.clear(),this.scratch.ctx.drawImage(this.selected.canvas,0,0),this.selected.render(),this.stage.render(),this.stage.history.add({type:"bitmapChange",kind:"liquify",layer:this.selected,patchRect:i,patch:s,rect:n})},this.cleanUp=()=>{var e,t;null===(e=this.displacement)||void 0===e||e.free(),null===(t=this.stroke)||void 0===t||t.free(),this.stage.fresco.removeScratch(),this.removeDownListeners(),this.sizeSlider.cleanUp(),this.strengthSlider.cleanUp(),this.densitySlider.cleanUp(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),(0,s.ZP)("liquify-close").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("liquify-cancel").removeEventListener("click",this.cancelClick,!1),document.getElementsByName("liquify-mode").forEach((e=>{e.removeEventListener("click",this.selectMode,!1)})),this.selected=null},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.getElementsByName("liquify-mode").forEach((e=>{e.addEventListener("click",this.selectMode,!1)})),(0,s.ZP)("liquify-close").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("liquify-cancel").addEventListener("click",this.cancelClick,!1),this.brush=new c.Z(Object.assign(Object.assign({},new l.Z),{size:50,softness:0})),this.sizeSlider=new o.Z("liquify-brush-size",{label:(0,n.Z)("size"),step:2,range:[5,500],defaultValue:50,labelFormat:e=>e.toFixed(0)+"px",onEnd:e=>{var t;this.brush.settings.size=e,this.updateBrush(),null===(t=this.displacement)||void 0===t||t.setStampSize(e)}}),this.strengthSlider=new o.Z("liquify-brush-strength",{label:(0,n.Z)("strength"),range:[.01,1],defaultValue:.5,step:.01,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{var t;return null===(t=this.displacement)||void 0===t?void 0:t.setStrength(e)}}),this.densitySlider=new o.Z("liquify-brush-density",{label:(0,n.Z)("density"),range:[0,.95],defaultValue:.5,step:.01,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{var t;return null===(t=this.displacement)||void 0===t?void 0:t.setDensity(e)}}),this.addDownListeners(),this.layerSelect()}}},65725:(e,t,i)=>{i.d(t,{Z:()=>Z});var s=i(93947),n=i(18203),a=i(96548),r=i(33655),o=i(36817),h=i(4188),c=i(44170);function l(e,t){return Math.floor(Math.random()*(t-e+1))+e}var d=i(49198),u=i(92397);class p extends n.Z{constructor(e){super("pen",e),this.stage=e,this.isShiftDown=!1,this.pathPoints=[],this.shiftDown=e=>{"Shift"===e.key&&(this.isShiftDown=!0)},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1)},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(c.Z.TYPE_IMAGE))return(0,s.ZP)("paint-no-layer").style.display="block",(0,s.ZP)("paint-sub-tools").style.display="none",this.stage.raster.style.cursor="auto",void(this.selected=null);(0,s.ZP)("paint-no-layer").style.display="none",(0,s.ZP)("paint-sub-tools").style.display="block",this.stage.raster.style.cursor="crosshair",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over")},this.down=e=>{this.selected&&(this.mode=(0,s.ZP)("pen-mode").value,this.scratch.settings.opacity=this.opacity.getValue(),this.scratch.ctx.lineWidth=this.size.getValue()/2,this.scratch.ctx.lineJoin=this.scratch.ctx.lineCap="round",this.scratch.ctx.strokeStyle=this.color.getHex(),this.scratch.ctx.fillStyle=this.color.getHex(),this.pathPoints=[],this.pp=this.stage.translateRasterToFresco(e,null),this.pathPoints.push(this.pp),this.addMoveListeners())},this.move=e=>{e=this.stage.translateRasterToFresco(e,null),this.pathPoints.push(e);(function(e,t,i,s,n){let a,r,o,h,c;const d=n.length;if(d<2)return!1;let u=n[d-2],p=n[d-1];const g=Math.sqrt(Math.pow(u.x-p.x,2)+Math.pow(u.y-p.y,2));switch(t){case"plain":case"neon":e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.stroke();break;case"parallel":if(a=p.x-u.x,r=p.y-u.y,a*a+r*r<500)return!1;i=Math.round(i*s*5),e.beginPath(),e.moveTo(u.x-l(0,i),u.y-l(0,i)),e.lineTo(p.x-l(0,i),p.y-l(0,i)),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.moveTo(u.x+l(0,i),u.y+l(0,i)),e.lineTo(p.x+l(0,i),p.y+l(0,i)),e.stroke();break;case"sketchy":if(g<.8*i)return!1;for(e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.stroke(),e.beginPath(),e.globalAlpha=.33,h=0;h<n.length;++h)a=n[h].x-p.x,r=n[h].y-p.y,o=a*a+r*r,o<i/2*4e3&&Math.random()<s&&(e.moveTo(p.x+.3*a,p.y+.3*r),e.lineTo(n[h].x-.3*a,n[h].y-.3*r));e.stroke(),e.globalAlpha=1;break;case"shaded":for(e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.stroke(),e.beginPath(),e.globalAlpha=.1,h=0,c=n.length-2;h<c&&!(h>50);++h)a=n[c-h].x-p.x,r=n[c-h].y-p.y,o=a*a+r*r,o<i/2*5e3*s&&(e.beginPath(),e.moveTo(p.x,p.y),e.lineTo(n[c-h].x,n[c-h].y),e.stroke());e.globalAlpha=1;break;case"furry":if(g<.8*i)return!1;for(e.beginPath(),e.moveTo(n[n.length-2].x,n[n.length-2].y),e.lineTo(n[n.length-1].x,n[n.length-1].y),e.stroke(),e.globalAlpha=.3,e.beginPath(),h=0,c=n.length;h<c;h++)a=n[h].x-n[n.length-1].x,r=n[h].y-n[n.length-1].y,o=a*a+r*r,o<i/2*2e3&&Math.random()>o/2e3&&(e.moveTo(p.x+a*s*2,p.y+r*s*2),e.lineTo(p.x-a*s*2,p.y-r*s*2));e.stroke(),e.globalAlpha=1;break;case"trail":if(g<.8*i)return!1;for(e.globalAlpha=.3,e.beginPath(),h=n.length-1,c=n.length-Math.round(25*s);h>c;--h)h>0&&(e.moveTo(p.x,p.y),e.lineTo(n[h].x,n[h].y));e.stroke(),e.globalAlpha=1;break;case"crayon":var m=Math.round(Math.sqrt(Math.pow(p.x-u.x,2)+Math.pow(p.y-u.y,2))/(5/(100*s))),v=(p.x-u.x)/m,f=(p.y-u.y)/m;for(h=0;h<m;h++)e.save(),e.globalAlpha=.4+.2*Math.random(),a=u.x+h*v,r=u.y+h*f,e.fillRect(a+(Math.random()-.5)*(i+5),r+(Math.random()-.5)*(i+5),2*Math.random()+2,Math.random()+1),e.restore();break;case"ink":e.save(),e.lineWidth=l(i,2*i),e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.stroke(),e.restore()}return!0})(this.scratch.ctx,this.mode,this.size.getValue(),this.amount.getValue()/100,this.pathPoints)?window.requestAnimationFrame((()=>this.stage.render())):this.pathPoints.length>1&&this.pathPoints.pop()},this.up=e=>{this.removeMoveListeners();let t=r.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=this.selected.rect?r.$E(this.selected.canvas,t.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const i=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(t),this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"pen",layer:this.selected,patchRect:this.selected.rect?t.rebase(this.selected.rect.x,this.selected.rect.y):t,patch:e,rect:i})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.removeDownListeners(),this.size.cleanUp(),this.amount.cleanUp(),this.opacity.cleanUp(),document.removeEventListener("layer-select",this.layerSelect,!1)},this.scratch=new d.Z,document.addEventListener("layer-select",this.layerSelect,!1),this.size=new h.Z("pen-size",{label:(0,a.Z)("size"),defaultValue:1,range:[1,10],step:1}),this.amount=new h.Z("pen-amount",{label:(0,a.Z)("amount"),defaultValue:30,range:[1,100],step:1}),this.opacity=new h.Z("pen-opacity",{label:(0,a.Z)("opacity"),defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100}),this.color=new u.Z((0,s.ZP)("pen-color-picker")),this.addDownListeners(),this.layerSelect()}}var g=i(12257);class m{constructor(e,t,i,n){this.container=e,this.updatePreview=()=>{if(!this.options.enablePreview)return;this.options.enableSize&&(this.brush.settings.size=this.sizeSlider.getValue()),this.options.enableSoftness&&(this.brush.settings.softness=this.softnessSlider.getValue()),this.options.enableTransparency&&(this.brush.settings.opacity=this.transparencySlider.getValue()),this.brush.generate(),this.previewImage.width=this.brush.canvas.width,this.previewImage.height=this.brush.canvas.height;this.previewImage.getContext("2d").drawImage(this.brush.canvas,0,0),this.previewImage.style.opacity=this.brush.settings.opacity.toFixed(2)},this.buildDOM=()=>{if(this.options.enablePreview){this.container.append((0,s.T)("label",{className:"pad-0"},(0,a.Z)("brush")));const e=(0,s.T)("canvas",{id:`${this.id}:brush-preview`,className:"ic"});this.container.append((0,s.T)("div",{className:"brush-preview-holder"},(0,s.T)("div",{className:"brush-preview"},e)))}this.options.enablePreview&&(this.options.enableSize||this.options.enableSoftness||this.options.enableTransparency)&&this.container.append((0,s.T)("div",{className:"splitter small"})),this.options.enableSize&&this.container.append((0,s.T)("div",{id:`${this.id}:brush-size`,className:"range-box"})),this.options.enableSoftness&&this.container.append((0,s.T)("div",{id:`${this.id}:brush-softness`,className:"range-box"})),this.options.enableTransparency&&this.container.append((0,s.T)("div",{id:`${this.id}:brush-transparency`,className:"range-box"}))},this.cleanUp=()=>{var e,t,i;null===(e=this.sizeSlider)||void 0===e||e.cleanUp(),null===(t=this.softnessSlider)||void 0===t||t.cleanUp(),null===(i=this.transparencySlider)||void 0===i||i.cleanUp()};const o=!!e.dataset.brushEditorId;this.brush=t,this.onUpdate=i,this.options=Object.assign({enablePreview:!0,enableSize:!0,enableSoftness:!0,enableTransparency:!0},n),o?this.id=e.dataset.brushEditorId:(this.id=e.dataset.brushEditorId=r.M8(),this.buildDOM()),this.options.enableSize&&(this.sizeSlider=new h.Z(`${this.id}:brush-size`,{label:(0,a.Z)("size"),range:[1,100,1e3],step:[1,10],stops:[0,.4,1],defaultValue:this.brush.settings.size,labelFormat:e=>e.toFixed(0)+"px",labelParse:e=>parseInt(e,10),onEnd:()=>{this.updatePreview(),this.onUpdate&&this.onUpdate()}})),this.options.enableSoftness&&(this.softnessSlider=new h.Z(`${this.id}:brush-softness`,{label:(0,a.Z)("softness"),defaultValue:this.brush.settings.softness,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onChange:()=>{this.updatePreview(),this.onUpdate&&this.onUpdate()}})),this.options.enableTransparency&&(this.transparencySlider=new h.Z(`${this.id}:brush-transparency`,{range:[.01,1],label:(0,a.Z)("transparency"),defaultValue:this.brush.settings.opacity,labelParse:e=>parseInt(e,10)/100,labelFormat:e=>(100*e).toFixed(0)+"%",onChange:()=>{this.updatePreview(),this.onUpdate&&this.onUpdate()}})),this.options.enablePreview&&(this.previewImage=(0,s.ZP)(`${this.id}:brush-preview`),this.updatePreview())}}var v=i(50972);class f extends n.Z{constructor(e){super("draw",e),this.stage=e,this.isShiftDown=!1,this.shiftDown=e=>{"Shift"===e.key&&(this.isShiftDown=!0)},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1)},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(c.Z.TYPE_IMAGE))return(0,s.ZP)("paint-no-layer").style.display="block",(0,s.ZP)("paint-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,s.ZP)("paint-no-layer").style.display="none",(0,s.ZP)("paint-sub-tools").style.display="block",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over"),this.updateBrush()},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),this.lastColor=void 0,this.lastSettings=void 0},this.down=(e,t)=>{if(!this.selected)return;this.isShiftDown||(this.x=this.y=-1);let i=this.colorSelector.getColor();v.Z.isEqual(this.brush.settings,this.lastSettings)&&i.isEqual(this.lastColor)||(this.brush.generate(i),this.lastSettings=this.brush.settings,this.lastColor=i),this.scratch.settings.opacity=this.brush.settings.opacity,"touch"!==t&&this.move(e),this.addMoveListeners()},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),i=!1;if(e=this.stage.translateRasterToFresco(e),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0),e.x!==this.x||e.y!==this.y){let s=e.x-this.x,n=e.y-this.y,a=s>0?1:-1,r=n>0?1:-1;if(s=s<0?-s:s,n=n<0?-n:n,s>n){let e=.5*s;for(let o=1;o<=s;o++)this.x+=a,e+=n,e>=s&&(e-=s,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=s,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}}i&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{this.scratch.ctx.drawImage(this.brush.canvas,e,t)},this.up=e=>{this.removeMoveListeners();const t=r.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=this.selected.rect?r.$E(this.selected.canvas,t.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const i=r.dN(this.selected.mask),s=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(t),this.scratch.drawToLayer(this.selected,"source-over",this.brush.settings.opacity),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"draw",layer:this.selected,patchRect:this.selected.rect?t.rebase(this.selected.rect.x,this.selected.rect.y):t,patch:e,rect:s,mask:i})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.brushEditor.cleanUp(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),this.brush=new g.Z(new v.Z),this.brushEditor=new m((0,s.ZP)("draw-brush"),this.brush,this.updateBrush),this.colorSelector=new u.Z((0,s.ZP)("draw-color-picker")),this.addDownListeners(),this.layerSelect()}}var y=i(67175);class w extends n.Z{constructor(e){super("shape",e),this.stage=e,this.isShiftDown=!1,this.shiftDown=e=>{"Shift"===e.key&&(this.isShiftDown=!0)},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1)},this.toggleLineShape=()=>{this.mode=document.querySelector('input[name="shape-type"]:checked').value,(0,s.ZP)("shape-line-settings").style.display="line"===this.mode?"block":"none",(0,s.ZP)("shape-fill-settings").style.display="line"===this.mode?"none":"block",(0,s.ZP)("shape-outline-settings").style.display="line"===this.mode?"none":"block"},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(c.Z.TYPE_IMAGE))return(0,s.ZP)("paint-no-layer").style.display="block",(0,s.ZP)("paint-sub-tools").style.display="none",this.stage.raster.style.cursor="auto",void(this.selected=null);(0,s.ZP)("paint-no-layer").style.display="none",(0,s.ZP)("paint-sub-tools").style.display="block",this.stage.raster.style.cursor="crosshair",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over")},this.down=e=>{if(!this.selected)return;const t=(0,s.ZP)("shape-outline").checked,i=(0,s.ZP)("shape-fill").checked;(t||i||"line"===this.mode)&&(this.downPoint=this.stage.translateRasterToFresco(e),this.addMoveListeners())},this.move=e=>{this.scratch.clear(),e=this.stage.translateRasterToFresco(e),this.scratch.ctx.save();const t=(0,s.ZP)("shape-fill").checked,i=(0,s.ZP)("shape-outline").checked;(t||"line"===this.mode)&&(this.scratch.ctx.lineWidth=this.shapeLineSize.getValue(),this.scratch.ctx.fillStyle=this.shapeColorSelector.getHex(),this.scratch.ctx.strokeStyle=this.shapeLineColorSelector.getHex(),y.Z.fill(this.scratch.ctx,this.mode,this.downPoint,e)),i&&"line"!==this.mode&&(this.scratch.ctx.lineWidth=this.shapeOutlineSize.getValue(),this.scratch.ctx.strokeStyle=this.shapeOutlineColorSelector.getHex(),y.Z.stroke(this.scratch.ctx,this.mode,this.downPoint,e)),this.scratch.ctx.restore(),window.requestAnimationFrame((()=>this.stage.render()))},this.up=e=>{if(this.removeMoveListeners(),e=this.stage.translateRasterToFresco(e),this.downPoint.x===e.x&&this.downPoint.y===e.y)return;this.scratch.clear(),this.scratch.ctx.save();const t=(0,s.ZP)("shape-fill").checked,i=(0,s.ZP)("shape-outline").checked;(t||"line"===this.mode)&&(this.scratch.ctx.lineWidth=this.shapeLineSize.getValue(),this.scratch.ctx.fillStyle=this.shapeColorSelector.getHex(),this.scratch.ctx.strokeStyle=this.shapeLineColorSelector.getHex(),y.Z.fill(this.scratch.ctx,this.mode,this.downPoint,e)),i&&"line"!==this.mode&&(this.scratch.ctx.lineWidth=this.shapeOutlineSize.getValue(),this.scratch.ctx.strokeStyle=this.shapeOutlineColorSelector.getHex(),y.Z.stroke(this.scratch.ctx,this.mode,this.downPoint,e)),this.scratch.ctx.restore();let n=r.l(this.scratch.canvas);if(n&&n.width>0&&n.height>0){let e=this.selected.rect?r.$E(this.selected.canvas,n.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const t=r.dN(this.selected.mask),i=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(n),this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"shape",layer:this.selected,patchRect:this.selected.rect?n.rebase(this.selected.rect.x,this.selected.rect.y):n,patch:e,rect:i,mask:t})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.querySelectorAll('input[name="shape-type"]').forEach((e=>e.removeEventListener("change",this.toggleLineShape))),this.shapeOutlineSize.cleanUp(),this.shapeLineSize.cleanUp()},document.addEventListener("layer-select",this.layerSelect,!1),this.shapeColorSelector=new u.Z((0,s.ZP)("shape-color-picker")),this.shapeOutlineColorSelector=new u.Z((0,s.ZP)("shape-outline-color-picker")),this.shapeLineColorSelector=new u.Z((0,s.ZP)("shape-line-color-picker")),this.shapeOutlineSize=new h.Z("shape-outline-size",{label:(0,a.Z)("size"),defaultValue:5,range:[1,50],step:1}),this.shapeLineSize=new h.Z("shape-line-size",{label:(0,a.Z)("lineSize"),defaultValue:1,range:[1,50],step:1}),document.querySelectorAll('input[name="shape-type"]').forEach((e=>e.addEventListener("change",this.toggleLineShape))),this.addDownListeners(),this.layerSelect(),this.toggleLineShape()}}var x=i(98776);class b extends n.Z{constructor(e){super("eraser",e),this.stage=e,this.isShiftDown=!1,this.shiftDown=e=>{"Shift"===e.key&&(this.isShiftDown=!0)},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1)},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(c.Z.TYPE_IMAGE))return(0,s.ZP)("paint-no-layer").style.display="block",(0,s.ZP)("paint-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,s.ZP)("paint-no-layer").style.display="none",(0,s.ZP)("paint-sub-tools").style.display="block",this.selected=this.stage.fresco.getSelected(),this.cached=r.dN(this.selected.canvas),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"none"),this.updateBrush()},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom,new x.Z(255,255,255,255))):this.stage.coating.removeCursorImage()},this.down=(e,t)=>{this.selected&&this.selected.rect&&this.selected.canvas&&(this.x=this.y=-1,"touch"!==t&&this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),i=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0),e.x!==this.x||e.y!==this.y){let s=e.x-this.x,n=e.y-this.y,a=s>0?1:-1,r=n>0?1:-1;if(s=s<0?-s:s,n=n<0?-n:n,s>n){let e=.5*s;for(let o=1;o<=s;o++)this.x+=a,e+=n,e>=s&&(e-=s,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=s,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}}i&&(this.selected.replaceCanvas(this.cached),this.scratch.drawToLayer(this.selected,"destination-out",this.brush.settings.opacity),this.selected.render(),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(e,t)=>{this.scratch.ctx.drawImage(this.brush.canvas,e,t)},this.up=e=>{this.removeMoveListeners();let t=r.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){const e=this.selected.rect.clone();let i=r.$E(this.cached,t);this.cached=r.dN(this.selected.canvas);const s=this.selected.shrinkWrap();this.scratch.clear(),this.stage.history.add({type:"bitmapChange",kind:"eraser",layer:this.selected,patchRect:t.rebase(this.selected.rect.x-e.x,this.selected.rect.y-e.y),patch:i,rect:e}),s&&this.layerSelect()}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.brushEditor.cleanUp(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),this.cached=void 0},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),this.brush=new g.Z(new v.Z),this.brushEditor=new m((0,s.ZP)("eraser-brush"),this.brush,this.updateBrush),this.addDownListeners(),this.layerSelect()}}class Z extends n.Z{constructor(e){super("paint",e),this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.selectSubTool=e=>{this.setSubTool(e.currentTarget.value)},this.addLayer=()=>{this.stage.addEmpty(),this.stage.notify("layerAdded")},this.setSubTool=e=>{var t,i;if(null===(t=this.stage)||void 0===t||t.coating.removeCursorImage(),!this.subTool||this.subTool.name!==e)switch((0,s.ZP)("paint-draw-settings").style.display="none",(0,s.ZP)("paint-eraser-settings").style.display="none",(0,s.ZP)("paint-pen-settings").style.display="none",(0,s.ZP)("paint-shape-settings").style.display="none",null===(i=this.subTool)||void 0===i||i.cleanUp(),this.subTool=null,(0,s.ZP)("paint-"+e+"-settings").style.display="block",e){case"draw":this.subTool=new f(this.stage);break;case"eraser":this.subTool=new b(this.stage);break;case"pen":this.subTool=new p(this.stage);break;case"shape":this.subTool=new w(this.stage)}},this.cleanUp=()=>{var e;(0,s.ZP)("paint-close").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("paint-cancel").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("paint-add-empty").removeEventListener("click",this.addLayer,!1),(0,s.ZP)("paint-type-draw").removeEventListener("change",this.selectSubTool,!1),(0,s.ZP)("paint-type-eraser").removeEventListener("change",this.selectSubTool,!1),(0,s.ZP)("paint-type-pen").removeEventListener("change",this.selectSubTool,!1),(0,s.ZP)("paint-type-shape").removeEventListener("change",this.selectSubTool,!1),null===(e=this.subTool)||void 0===e||e.cleanUp(),this.subTool=null},(0,s.ZP)("paint-close").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("paint-cancel").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("paint-add-empty").addEventListener("click",this.addLayer,!1),(0,s.ZP)("paint-type-draw").addEventListener("change",this.selectSubTool,!1),(0,s.ZP)("paint-type-eraser").addEventListener("change",this.selectSubTool,!1),(0,s.ZP)("paint-type-pen").addEventListener("change",this.selectSubTool,!1),(0,s.ZP)("paint-type-shape").addEventListener("change",this.selectSubTool,!1);const t=document.querySelector('input[name="paint-type"]:checked').value;this.setSubTool(t)}}},46970:(e,t,i)=>{i.d(t,{Z:()=>d});var s=i(96548),n=i(93947),a=i(33655),r=i(36817),o=i(18203),h=i(4256),c=i(89679),l=i(92672);class d extends o.Z{constructor(e){super("preset",e),this.applyClick=()=>{document.dispatchEvent(new CustomEvent("tool-apply"))},this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.layerSelect=()=>{const e=this.selected===this.stage.fresco.getSelected();if(e||this.apply(),(0,n.ZP)("preset-settings").style.display="none",(0,n.ZP)("preset-selected").style.display="none",!this.stage.fresco.isSelectedShaderbleWithCanvas())return(0,n.ZP)("preset-layer-locked").style.display="block",(0,n.ZP)("preset-presets").style.display="none",void(this.selected=null);if((0,n.ZP)("preset-layer-locked").style.display="none",(0,n.ZP)("preset-presets").style.display="block",e)setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render()))}),0);else{this.selected=this.stage.fresco.getSelected(),this.cached=this.selected.baked?this.selected.baked:this.selected.canvas,this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"replace",this.cached);let e=r.Z.fillFit(this.selected.canvas.width,this.selected.canvas.height,280,280);this.thumbnail=a.Ai(this.selected.canvas,e.width,e.height)}this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.group?this.renderPresets(this.group):(0===(0,n.ZP)("preset-list").childElementCount&&this.renderGroups(),this.renderMarked())},this.renderMarked=()=>{if(!this.marked)return;(0,n.ZP)("preset-selected").style.display="block";const e=-(this.thumbnail.width-280)/2,t=-(this.thumbnail.height-160)/2,i=new h.Z([]);i.addPreset(this.marked.name);const s=(0,n.ZP)("preset-selected-preview").getContext("2d");s.drawImage(this.thumbnail,e,t,this.thumbnail.width,this.thumbnail.height),(0,n.ZP)("preset-selected-name").innerText=this.marked.name;setTimeout((()=>{s.drawImage(i.apply(this.thumbnail),e,t,this.thumbnail.width,this.thumbnail.height)}),10),this.positionSettings((0,n.ZP)("preset-selected"))},this.renderGroups=()=>{(0,n.ZP)("preset-back").style.display="none";let e=(0,n.ZP)("preset-list");e.innerHTML="",l.Z.groups().forEach((t=>{const i=(0,n.T)("div",{className:"preset-group",id:"preset-"+t,onclick:()=>{this.renderPresets(t)}});let a=(0,n.T)("div",{className:"info"},(0,n.T)("h2",{},t.replace("-"," & ")),(0,n.T)("span",{},l.Z.groupLength(t)+" "+(0,s.Z)("presets"))),r=(0,n.T)("img",{src:"/img/preset/"+t+".jpg",className:"preview"});i.append(a,r),e.appendChild(i)}))},this.renderPresets=e=>{(0,n.ZP)("preset-back").style.display="block",(0,n.ZP)("preset-selected").style.display="none",(0,n.ZP)("preset-settings").style.display="none",this.group=e;let t=(0,n.ZP)("preset-list");t.innerHTML="";const i=-(this.thumbnail.width-280)/2,s=-(this.thumbnail.height-160)/2,a=new h.Z([]);l.Z.names(e).forEach((e=>{const r=(0,n.T)("div",{className:"preset-preset",id:e,onclick:this.change}),o=(0,n.T)("canvas",{width:280,height:160});r.appendChild(o);const h=o.getContext("2d");h.drawImage(this.thumbnail,i,s,this.thumbnail.width,this.thumbnail.height),r.appendChild((0,n.T)("span",{},e)),t.appendChild(r);setTimeout((()=>{a.reset(),a.addPreset(e),h.drawImage(a.apply(this.thumbnail),i,s,this.thumbnail.width,this.thumbnail.height),this.marked&&this.marked.name==e&&setTimeout((()=>{r.classList.add("selected"),this.positionSettings(r)}),200)}),10)}))},this.amount=a.d4(50,(e=>{this.shaders.reset();const t=parseInt((0,n.ZP)("preset-amount").value,10)/100;this.shaders.addPreset(this.marked.name,t),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render()))})),this.back=()=>{(0,n.ZP)("preset-selected").style.display="none",(0,n.ZP)("preset-settings").style.display="none",this.group="",this.renderGroups(),this.renderMarked()},this.change=e=>{let t=e.currentTarget,i=(0,n.ZP)("preset-list").getElementsByTagName("div");for(var s=0;s<i.length;s++)i[s].classList.remove("selected");t.classList.add("selected"),this.preset(t.id),(0,n.ZP)("preset-settings").style.display="none",setTimeout((()=>{this.positionSettings(t)}),200)},this.positionSettings=e=>{if(!this.marked)return;(0,n.ZP)("preset-amount").value=(0,n.ZP)("preset_amount_out").innerHTML=(100*this.marked.value).toString();let t=(0,n.ZP)("preset-settings");t.style.display="block",t.style.top=e.offsetTop+"px",t.style.left=e.offsetLeft+"px"},this.preset=e=>{if(!this.selected)return;let t,i;this.marked&&(t=this.marked.name,i=this.marked.value),this.stage.history.add({type:"effect",layer:this.selected,kind:e,tool:this,name:t,value:i}),this.shaders.reset(),this.marked=new c.Z(e,1),this.shaders.addPreset(e,1),this.scratch.canvas=this.shaders.apply(this.cached),window.requestAnimationFrame((()=>this.stage.render())),document.dispatchEvent(new CustomEvent("notification",{detail:e}))},this.reset=()=>{if(!this.selected)return;let e,t;this.marked&&(e=this.marked.name,t=this.marked.value),this.stage.history.add({type:"effect",layer:this.selected,kind:"reset",tool:this,name:e,value:t});let i=(0,n.ZP)("preset-list").getElementsByTagName("div");for(var s=0;s<i.length;s++)i[s].classList.remove("selected");this.marked=null,this.shaders.chain=[],(0,n.ZP)("preset-settings").style.display="none",(0,n.ZP)("preset-selected").style.display="none",this.scratch.setTarget(this.selected.id,this.selected.rect,"replace",this.cached),this.stage.render()},this.cancel=()=>{this.shaders.chain=[],this.stage.history.abortTransaction()},this.apply=()=>{if(!this.selected||!this.shaders||0===this.shaders.chain.length)return;const e=new r.Z(0,0,this.selected.rect.width,this.selected.rect.height),t=a.$E(this.selected.canvas);this.selected.replaceCanvas(this.shaders.apply(this.selected.canvas)),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"preset - "+this.marked.name,layer:this.selected,patchRect:e,patch:t,rect:this.selected.rect.clone()}),this.marked=void 0,this.shaders.chain=[]},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.stage.history.abortTransaction(),document.removeEventListener("layer-select",this.layerSelect,!1),(0,n.ZP)("preset-amount").removeEventListener("input",this.amount,!1),(0,n.ZP)("preset-back").removeEventListener("click",this.back,!1),(0,n.ZP)("preset-remove").removeEventListener("click",this.reset,!1),(0,n.ZP)("preset-apply").removeEventListener("click",this.applyClick,!1),(0,n.ZP)("preset-close").removeEventListener("click",this.cancelClick,!1),(0,n.ZP)("preset-cancel").removeEventListener("click",this.cancelClick,!1),(0,n.ZP)("preset-settings").style.display="none",(0,n.ZP)("preset-list").innerHTML="",this.thumbnail=null,this.cached=null},this.shaders=new h.Z,(0,n.ZP)("preset-apply").addEventListener("click",this.applyClick,!1),(0,n.ZP)("preset-close").addEventListener("click",this.cancelClick,!1),(0,n.ZP)("preset-cancel").addEventListener("click",this.cancelClick,!1),(0,n.ZP)("preset-back").addEventListener("click",this.back,!1),(0,n.ZP)("preset-remove").addEventListener("click",this.reset,!1),(0,n.ZP)("preset-amount").addEventListener("input",this.amount,!1),document.addEventListener("layer-select",this.layerSelect,!1),(0,n.ZP)("preset-selected").style.display="none",(0,n.ZP)("preset-settings").style.display="none",(0,n.ZP)("preset-back").style.display="none",this.layerSelect()}}},34604:(e,t,i)=>{i.d(t,{Z:()=>x});var s=i(93947),n=i(96548),a=i(98776),r=i(33655),o=i(36817),h=i(18203),c=i(4188),l=i(43673),d=i(12257),u=i(50972);class p{constructor(e){this.stage=e,this.resize=()=>{const e=document.querySelector(".raster");this.container.style.top=e.style.top,this.container.style.left=e.style.left,this.container.style.width=e.style.width},this.bar=(0,s.T)("div"),this.container=(0,s.T)("div",{id:"workspace-progress"},this.bar),(0,s.ZP)("workspace").append(this.container),this.resize(),document.addEventListener("viewport-update",this.resize),document.addEventListener("resize",this.resize)}update(e){this.bar.style.width=`${(100*e).toFixed(0)}%`}show(){this.bar.style.width="0",this.container.style.display="block",this.resize()}hide(){this.container.style.display="none",this.resize()}cleanUp(){this.bar.remove()}}var g=i(87282);const m={speed:[2,20],balanced:[20,20],quality:[50,50]};class v extends h.Z{constructor(e){super("heal",e),this.workset=null,this.changeMode=()=>{this.mode=document.querySelector('input[name="heal-mode"]:checked').value,this.updateBrush(),this.selected&&this.selected.transient&&(this.selected.transient=void 0,this.cleanUpWorker(),this.worker=new g.$p),this.stage.render(),(0,s.ZP)("heal-presets").style.display="infill"===this.mode?"block":"none"},this.layerSelect=()=>{var e,t;if((null===(e=this.selected)||void 0===e?void 0:e.id)!==(null===(t=this.stage.fresco.getSelected())||void 0===t?void 0:t.id)&&(this.cleanUpWorker(),this.worker=new g.$p,this.selected&&this.selected.transient&&(this.selected.transient=void 0,this.stage.render())),!this.stage.fresco.isSelectedImageWithCanvas())return(0,s.ZP)("retouch-no-layer").style.display="block",(0,s.ZP)("retouch-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,s.ZP)("retouch-sub-tools").style.display="block",(0,s.ZP)("retouch-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.scratch.settings.opacity=.4,this.updateBrush()},this.updateBrush=()=>{this.brush.generate(new a.Z(0,255,0,255)),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.down=(e,t)=>{if(!this.selected)return;"patch"===document.querySelector('input[name="heal-mode"]:checked').value?(this.stage.coating.animateCursorTap(),this.applyHealPatch(e)):(this.brushPoints=[],this.x=this.y=-1,"touch"!==t&&this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),i=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1==this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0),e.x!==this.x||e.y!==this.y){let s=e.x-this.x,n=e.y-this.y,a=s>0?1:-1,r=n>0?1:-1;if(s=s<0?-s:s,n=n<0?-n:n,s>n){let e=.5*s;for(let o=1;o<=s;o++)this.x+=a,e+=n,e>=s&&(e-=s,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=s,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}}i&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{this.brushPoints.push(new l.Z(e,t)),this.scratch.ctx.drawImage(this.brush.canvas,e,t)},this.up=async e=>{try{this.removeMoveListeners();const e=document.querySelector('input[name="heal-preset"]:checked').value,[t,i]=m[e];let s=50,n=o.Z.fromPointRects(this.brushPoints,this.brush.canvas.width,this.brush.canvas.height);if(n.x-=s,n.y-=s,n.width+=2*s,n.height+=2*s,n=n.intersect(new o.Z(0,0,this.scratch.canvas.width,this.scratch.canvas.height)),!n)return;const a=r.$E(this.selected.canvas,n);this.workset=[n,a],await this.fill(n,!0,t,i),this.stage.history.add({type:"bitmapChange",kind:"healObject",layer:this.selected,patchRect:n,patch:a,rect:this.selected.rect.clone()})}finally{this.workset=null}},this.applyHealPatch=async e=>{try{(e=this.stage.translateRasterToFresco(e,this.selected.rect)).x-=~~(this.brush.canvas.width/2),e.y-=~~(this.brush.canvas.height/2),this.scratch.ctx.drawImage(this.brush.canvas,e.x,e.y);let t=this.brush.canvas.width,i=this.brush.canvas.height;const s=50;let n=new o.Z(e.x-s,e.y-s,t+2*s,i+2*s);if(n=n.intersect(new o.Z(0,0,this.scratch.canvas.width,this.scratch.canvas.height)),!n)return;const a=r.$E(this.selected.canvas,n);this.workset=[n,a];const[h,c]=m.balanced;await this.fill(n,!1,h,c),this.stage.history.add({type:"bitmapChange",kind:"healSpot",layer:this.selected,patchRect:n,patch:a,rect:this.selected.rect.clone()})}finally{this.workset=null}},this.fill=async(e,t,i,s)=>{t&&(this.stage.coating.removeCursorImage(),this.progress.show());const n=this.selected.getCanvas().getContext("2d"),a=n.getImageData(e.x,e.y,e.width,e.height),o=r.vL(e.width,e.height),h=o.getContext("2d");h.fillStyle="#fff",h.fillRect(0,0,e.width,e.height),h.drawImage(this.scratch.canvas,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const c=h.getImageData(0,0,e.width,e.height);this.worker.send({image:a,neighbour:i,random:s,mask:c,intermediateImage:t},[a.data.buffer,c.data.buffer]),h.globalCompositeOperation="copy",h.drawImage(this.scratch.canvas,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const l=r.vL(e.width,e.height),d=l.getContext("2d");for(d.globalCompositeOperation="destination-atop",this.scratch.clear(),this.stage.render();;){const{progress:t,image:i}=await this.worker.receive();if("done"===t){this.progress.update(1),n.putImageData(i,e.x,e.y);break}this.progress.update(t),i&&(d.putImageData(i,0,0),d.drawImage(o,0,0),n.drawImage(l,0,0,e.width,e.height,e.x,e.y,e.width,e.height),window.requestAnimationFrame((()=>{this.stage.render()})))}t&&(setTimeout((()=>this.progress.hide()),300),this.updateBrush()),this.selected.render(),this.scratch.clear(),this.stage.render()},this.cleanUpWorker=()=>{var e;if(null===(e=this.worker)||void 0===e||e.terminate(),this.progress.hide(),this.workset){const[e,t]=this.workset;this.selected.getCanvas().getContext("2d").putImageData(t,e.x,e.y),this.stage.render(),this.workset=null}},this.cleanUp=()=>{var e;this.cleanUpWorker(),null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),this.size.cleanUp(),this.progress.cleanUp(),document.getElementsByName("heal-mode").forEach((e=>{e.removeEventListener("click",this.changeMode,!1)})),this.selected=null,this.scratch=null},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new d.Z(new u.Z("circle",50,0)),this.progress=new p(this.stage),this.size=new c.Z("heal-brush-size",{label:(0,n.Z)("size"),step:2,range:[5,200],defaultValue:this.brush.settings.size,labelFormat:e=>e.toFixed(0)+"px",onEnd:e=>{this.brush.settings.size=e,this.updateBrush()}}),document.getElementsByName("heal-mode").forEach((e=>{e.addEventListener("click",this.changeMode,!1)})),this.addDownListeners(),this.changeMode(),this.layerSelect()}}class f extends h.Z{constructor(e){super("clone",e),this.mode="source",this.layerSelect=()=>{const e=this.selected===this.stage.fresco.getSelected();if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,s.ZP)("retouch-no-layer").style.display="block",(0,s.ZP)("retouch-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,s.ZP)("retouch-sub-tools").style.display="block",(0,s.ZP)("retouch-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over"),e||(this.alignChange(),this.updateBrush())},this.alignChange=()=>{this.source=void 0,this.setMode("source")},this.toggleMode=()=>{this.setMode("paint"===this.mode?"source":"paint")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,s.ZP)("clone-mode-paint")?"paint":"source")},this.setMode=e=>{this.mode=e,(0,s.ZP)("clone-mode-paint").checked="paint"===this.mode,(0,s.ZP)("clone-mode-source").checked="source"===this.mode,this.updateBrush()},this.isShiftDown=!1,this.shiftDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleMode())},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleMode())},this.updateBrush=()=>{this.brush.generate(),this.selected?this.stage.coating.setCursorImage("source"===this.mode?null:this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),(0,s.ZP)("clone-brush-preview").innerHTML="",(0,s.ZP)("clone-brush-preview").appendChild(this.brush.canvas)},this.down=(e,t)=>{if(this.selected)return"source"==this.mode?(this.source=this.stage.translateRasterToFresco(e),this.offset=void 0,void(this.isShiftDown||this.toggleMode())):void(this.source?((0,s.ZP)("workspace").appendChild(this.sourceMarker),(0,s.ZP)("clone-aligned").checked&&this.offset||(this.offset=this.stage.translateRasterToFresco(e),this.offset.x=this.offset.x-this.source.x,this.offset.y=this.offset.y-this.source.y),this.x=this.y=-1,this.scratch.settings.opacity=this.opacity.getValue(),"touch"!==t&&this.move(e),this.addMoveListeners()):document.dispatchEvent(new CustomEvent("notification",{detail:"select source"})))},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),i=!1;if(this.sourceMarker.style.top=e.y-Math.round(this.offset.y*this.stage.zoom)+(this.stage.raster.offsetTop-16)+"px",this.sourceMarker.style.left=e.x-Math.round(this.offset.x*this.stage.zoom)+(this.stage.raster.offsetLeft-16)+"px",e=this.stage.translateRasterToFresco(e),-1==this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0),e.x!==this.x||e.y!==this.y){let s=e.x-this.x,n=e.y-this.y,a=s>0?1:-1,r=n>0?1:-1;if(s=s<0?-s:s,n=n<0?-n:n,s>n){let e=.5*s;for(let o=1;o<=s;o++)this.x+=a,e+=n,e>=s&&(e-=s,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=s,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}}i&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{let i=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);i.save(),i.drawImage(this.selected.canvas,-(e-this.offset.x-this.selected.rect.x),-(t-this.offset.y-this.selected.rect.y)),i.globalCompositeOperation="destination-in",i.drawImage(this.brush.canvas,0,0),i.restore(),this.scratch.ctx.drawImage(this.patch,e,t)},this.getPatchContext=(e,t)=>this.patch?(this.patch.width!==e||this.patch.height!==t?(this.patch.width=e,this.patch.height=t):this.ptx.clearRect(0,0,e,t),this.ptx):(this.patch=r.vL(e,t),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=e=>{this.sourceMarker.remove(),this.removeMoveListeners();let t=r.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=r.$E(this.selected.canvas,t.rebase(this.selected.rect.x,this.selected.rect.y));const i=this.selected.rect.clone(),s=r.dN(this.selected.mask);this.selected.extendCanvas(t),this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"clone",layer:this.selected,patchRect:t.rebase(this.selected.rect.x,this.selected.rect.y),patch:e,rect:i,mask:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.size.cleanUp(),this.opacity.cleanUp(),this.softness.cleanUp(),this.removeDownListeners(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),(0,s.ZP)("clone-mode-source").removeEventListener("click",this.selectMode,!1),(0,s.ZP)("clone-mode-paint").removeEventListener("click",this.selectMode,!1),(0,s.ZP)("clone-aligned").removeEventListener("change",this.alignChange,!1),this.selected=null,this.patch=null,this.ptx=null},document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),(0,s.ZP)("clone-mode-source").addEventListener("click",this.selectMode,!1),(0,s.ZP)("clone-mode-paint").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new d.Z(Object.assign(Object.assign({},new u.Z),{size:50,softness:.5})),this.size=new c.Z("clone-brush-size",{label:(0,n.Z)("size"),range:[1,500],step:1,defaultValue:this.brush.settings.size,labelFormat:e=>e+"px",onEnd:e=>{this.brush.settings.size=e,this.updateBrush()}}),this.softness=new c.Z("clone-brush-hardness",{label:(0,n.Z)("softness"),defaultValue:this.brush.settings.softness,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.brush.settings.softness=e,this.updateBrush()}}),this.opacity=new c.Z("clone-brush-transparency",{label:(0,n.Z)("transparency"),defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%"}),(0,s.ZP)("clone-aligned").addEventListener("change",this.alignChange,!1),this.sourceMarker=document.createElement("img"),this.sourceMarker.src="/img/cursor/source.svg",this.sourceMarker.id="source-marker",this.addDownListeners(),this.setMode("source"),this.layerSelect()}}class y extends h.Z{constructor(e){super("detail",e),this.mode="blur",this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,s.ZP)("retouch-no-layer").style.display="block",(0,s.ZP)("retouch-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,s.ZP)("retouch-sub-tools").style.display="block",(0,s.ZP)("retouch-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.updateBrush()},this.toggleMode=()=>{this.setMode("blur"===this.mode?"sharpen":"blur")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,s.ZP)("detail-mode-blur")?"blur":"sharpen")},this.setMode=e=>{this.mode=e,(0,s.ZP)("detail-mode-blur").checked="blur"===this.mode,(0,s.ZP)("detail-mode-sharpen").checked="sharpen"===this.mode},this.isShiftDown=!1,this.shiftDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleMode())},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleMode())},this.updateBrush=()=>{this.brush.generate(),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),(0,s.ZP)("detail-brush-preview").innerHTML="",(0,s.ZP)("detail-brush-preview").appendChild(this.brush.canvas)},this.down=(e,t)=>{this.selected&&(this.x=this.y=-1,"touch"!==t&&this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),i=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0),e.x!==this.x||e.y!==this.y){let s=e.x-this.x,n=e.y-this.y,a=s>0?1:-1,r=n>0?1:-1;if(s=s<0?-s:s,n=n<0?-n:n,s>n){let e=.5*s;for(let o=1;o<=s;o++)this.x+=a,e+=n,e>=s&&(e-=s,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=s,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}}i&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{let i=this.strength.getValue(),s=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);s.save(),s.drawImage(this.selected.canvas,-e,-t),"blur"===this.mode?this.blur(s):this.sharpen(s),s.globalCompositeOperation="destination-in",s.drawImage(this.brush.canvas,0,0),s.restore(),this.scratch.ctx.save(),this.scratch.ctx.globalAlpha=.01*i,this.scratch.ctx.drawImage(this.patch,e,t),this.scratch.ctx.restore()},this.getPatchContext=(e,t)=>this.patch?(this.patch.width!==e||this.patch.height!==t?(this.patch.width=e,this.patch.height=t):this.ptx.clearRect(0,0,e,t),this.ptx):(this.patch=r.vL(e,t),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=e=>{this.removeMoveListeners();let t=r.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=r.$E(this.selected.canvas,t);this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"detail",layer:this.selected,patchRect:t,patch:e,rect:this.selected.rect.clone()})}window.requestAnimationFrame((()=>this.stage.render()))},this.sharpen=e=>{const t=.3;for(var i,s,n,a,r,o,h,c,l,d,u,p,g,m=e.canvas.width,v=e.canvas.height,f=[0,-1,0,-1,5,-1,0,-1,0],y=Math.round(Math.sqrt(f.length)),w=.5*y|0,x=e.createImageData(m,v),b=x.data,Z=e.getImageData(0,0,m,v).data,k=v;k--;)for(i=m;i--;){for(n=k,s=i,h=4*(k*m+i),a=0,r=0,o=0,0,u=0;u<y;u++)for(d=0;d<y;d++)g=s+d-w,(p=n+u-w)>=0&&p<v&&g>=0&&g<m&&(l=f[u*y+d],a+=Z[c=4*(p*m+g)]*l,r+=Z[c+1]*l,o+=Z[c+2]*l,Z[c+3]*l);b[h]=a*t+.7*Z[h],b[h+1]=r*t+.7*Z[h+1],b[h+2]=o*t+.7*Z[h+2],b[h+3]=Z[h+3]}e.putImageData(x,0,0)},this.blur=e=>{var t,i,s,n,a,r,o,h,c,l,d,u,p,g,m=e.canvas.width,v=e.canvas.height,f=e.getImageData(0,0,m,v),y=f.data,w=m-1,x=v-1;var b=[],Z=[],k=[],E=[],P=[],S=[];for(p=u=0,r=0;r<v;r++){for(t=6*y[p],i=6*y[p+1],s=6*y[p+2],n=6*y[p+3],o=1;o<=5;o++)h=p+((o>w?w:o)<<2),t+=y[h++],i+=y[h++],s+=y[h++],n+=y[h];for(a=0;a<m;a++)b[u]=t,Z[u]=i,k[u]=s,E[u]=n,0==r&&(P[a]=((h=a+6)<w?h:w)<<2,S[a]=(h=a-5)>0?h<<2:0),c=p+P[a],l=p+S[a],t+=y[c++]-y[l++],i+=y[c++]-y[l++],s+=y[c++]-y[l++],n+=y[c]-y[l],u++;p+=m<<2}for(a=0;a<m;a++){for(t=6*b[d=a],i=6*Z[d],s=6*k[d],n=6*E[d],o=1;o<=5;o++)t+=b[d+=o>x?0:m],i+=Z[d],s+=k[d],n+=E[d];for(u=a<<2,r=0;r<v;r++)y[u+3]=g=34*n>>>12,g>0?(g=255/g,y[u]=(34*t>>>12)*g,y[u+1]=(34*i>>>12)*g,y[u+2]=(34*s>>>12)*g):y[u]=y[u+1]=y[u+2]=0,0===a&&(P[r]=((h=r+6)<x?h:x)*m,S[r]=(h=r-5)>0?h*m:0),c=a+P[r],l=a+S[r],t+=b[c]-b[l],i+=Z[c]-Z[l],s+=k[c]-k[l],n+=E[c]-E[l],u+=m<<2}e.putImageData(f,0,0)},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.removeDownListeners(),this.size.cleanUp(),this.softness.cleanUp(),this.strength.cleanUp(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),(0,s.ZP)("detail-mode-blur").removeEventListener("click",this.selectMode,!1),(0,s.ZP)("detail-mode-sharpen").removeEventListener("click",this.selectMode,!1),this.selected=null,this.patch=null,this.ptx=null},document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),(0,s.ZP)("detail-mode-blur").addEventListener("click",this.selectMode,!1),(0,s.ZP)("detail-mode-sharpen").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new d.Z(Object.assign(Object.assign({},new u.Z),{size:100,softness:.5})),this.size=new c.Z("detail-brush-size",{label:(0,n.Z)("size"),range:[1,500],step:1,defaultValue:this.brush.settings.size,labelFormat:e=>e+"px",onEnd:e=>{this.brush.settings.size=e,this.updateBrush()}}),this.softness=new c.Z("detail-brush-hardness",{label:(0,n.Z)("softness"),defaultValue:this.brush.settings.softness,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.brush.settings.softness=e,this.updateBrush()}}),this.strength=new c.Z("detail-brush-strength",{label:(0,n.Z)("strength"),range:[1,100],defaultValue:40,step:1}),this.addDownListeners(),this.setMode("blur"),this.layerSelect()}}class w extends h.Z{constructor(e){super("toning",e),this.mode="lighten",this.range="midtone",this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,s.ZP)("retouch-no-layer").style.display="block",(0,s.ZP)("retouch-sub-tools").style.display="none",this.selected=null,void this.updateBrush();(0,s.ZP)("retouch-sub-tools").style.display="block",(0,s.ZP)("retouch-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.updateBrush()},this.toggleMode=()=>{this.setMode("lighten"===this.mode?"darken":"lighten")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,s.ZP)("toning-mode-lighten")?"lighten":"darken")},this.setMode=e=>{this.mode=e,(0,s.ZP)("toning-mode-lighten").checked="lighten"===this.mode,(0,s.ZP)("toning-mode-darken").checked="darken"===this.mode},this.isShiftDown=!1,this.shiftDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleMode())},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleMode())},this.updateBrush=()=>{this.brush.generate(),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),(0,s.ZP)("toning-brush-preview").innerHTML="",(0,s.ZP)("toning-brush-preview").append(this.brush.canvas)},this.down=(e,t)=>{this.selected&&(this.range=document.querySelector('input[name="toning-range"]:checked').value,this.x=this.y=-1,"touch"!==t&&this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),i=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0),e.x!==this.x||e.y!==this.y){let s=e.x-this.x,n=e.y-this.y,a=s>0?1:-1,r=n>0?1:-1;if(s=s<0?-s:s,n=n<0?-n:n,s>n){let e=.5*s;for(let o=1;o<=s;o++)this.x+=a,e+=n,e>=s&&(e-=s,this.y+=r),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}else{let e=.5*n;for(let o=1;o<=n;o++)this.y+=r,e+=s,e>=n&&(e-=n,this.x+=a),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0)}}i&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{let i=this.strength.getValue(),s=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);s.save(),s.drawImage(this.selected.canvas,-e,-t),"lighten"===this.mode?this.lighten(s,this.range,i):this.darken(s,this.range,i),s.globalCompositeOperation="destination-in",s.drawImage(this.brush.canvas,0,0),s.restore(),this.scratch.ctx.drawImage(this.patch,e,t)},this.getPatchContext=(e,t)=>this.patch?(this.patch.width!==e||this.patch.height!==t?(this.patch.width=e,this.patch.height=t):this.ptx.clearRect(0,0,e,t),this.ptx):(this.patch=r.vL(e,t),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=e=>{this.removeMoveListeners();let t=r.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=r.$E(this.selected.canvas,t);this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"toning",layer:this.selected,patchRect:t,patch:e,rect:this.selected.rect.clone()})}window.requestAnimationFrame((()=>this.stage.render()))},this.lighten=(e,t,i)=>{var s=e.canvas.width,n=e.canvas.height;i/=10;for(var a,r,o,h,c,l,d=e.getImageData(0,0,s,n),u=d.data,p=n;p--;)for(a=s;a--;){switch(r=u[c=4*(p*s+a)]/255,o=u[c+1]/255,h=u[c+2]/255,t){case"highlight":r+=i*(Math.exp(r)-1),o+=i*(Math.exp(o)-1),h+=i*(Math.exp(h)-1);break;case"midtone":r+=(l=.25*i)*Math.sin(r*Math.PI),o+=l*Math.sin(o*Math.PI),h+=l*Math.sin(h*Math.PI);break;case"shadow":r=(l=1-.5*i)*r+(1-l),o=l*o+(1-l),h=l*h+(1-l)}(r*=255)>255&&(r=255),(o*=255)>255&&(o=255),(h*=255)>255&&(h=255),u[c]=r,u[c+1]=o,u[c+2]=h}e.putImageData(d,0,0)},this.darken=(e,t,i)=>{var s=e.canvas.width,n=e.canvas.height;i/=10;for(var a,r,o,h,c,l,d=e.getImageData(0,0,s,n),u=d.data,p=n;p--;)for(a=s;a--;){switch(r=u[c=4*(p*s+a)]/255,o=u[c+1]/255,h=u[c+2]/255,t){case"highlight":r*=l=1-.75*i,o*=l,h*=l;break;case"midtone":r-=(l=.25*i)*Math.sin(r*Math.PI),o-=l*Math.sin(o*Math.PI),h-=l*Math.sin(h*Math.PI);break;case"shadow":r+=i*(1-Math.exp(1-r)),o+=i*(1-Math.exp(1-o)),h+=i*(1-Math.exp(1-h))}(r*=255)<0&&(r=0),(o*=255)<0&&(o=0),(h*=255)<0&&(h=0),u[c]=r,u[c+1]=o,u[c+2]=h}e.putImageData(d,0,0)},this.cleanUp=()=>{this.stage.fresco.removeScratch(),this.removeDownListeners(),this.size.cleanUp(),this.softness.cleanUp(),this.strength.cleanUp(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),(0,s.ZP)("detail-mode-blur").removeEventListener("click",this.selectMode,!1),(0,s.ZP)("detail-mode-sharpen").removeEventListener("click",this.selectMode,!1),(0,s.ZP)("toning-brush-preview").innerHTML="",this.selected=null,this.patch=null,this.ptx=null},document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),(0,s.ZP)("toning-mode-lighten").addEventListener("click",this.selectMode,!1),(0,s.ZP)("toning-mode-darken").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new d.Z(Object.assign(Object.assign({},new u.Z),{size:50,softness:.5})),this.size=new c.Z("toning-brush-size",{label:(0,n.Z)("size"),range:[1,500],step:1,defaultValue:this.brush.settings.size,labelFormat:e=>e+"px",onEnd:e=>{this.brush.settings.size=e,this.updateBrush()}}),this.softness=new c.Z("toning-brush-hardness",{label:(0,n.Z)("softness"),defaultValue:this.brush.settings.softness,labelFormat:e=>(100*e).toFixed(0)+"%",onChange:e=>{this.brush.settings.softness=e,this.updateBrush()}}),this.strength=new c.Z("toning-brush-strength",{label:(0,n.Z)("strength"),range:[1,10],defaultValue:3,step:1}),this.addDownListeners(),this.setMode("lighten"),this.layerSelect()}}class x extends h.Z{constructor(e){super("retouch",e),this.cancelClick=()=>{document.dispatchEvent(new CustomEvent("tool-cancel"))},this.selectSubTool=e=>{this.setSubTool(e.currentTarget.value)},this.setSubTool=e=>{var t;if(!this.subTool||this.subTool.name!==e)switch((0,s.ZP)("retouch-heal-settings").style.display="none",(0,s.ZP)("retouch-clone-settings").style.display="none",(0,s.ZP)("retouch-detail-settings").style.display="none",(0,s.ZP)("retouch-toning-settings").style.display="none",null===(t=this.subTool)||void 0===t||t.cleanUp(),this.subTool=null,(0,s.ZP)("retouch-"+e+"-settings").style.display="block",e){case"heal":this.subTool=new v(this.stage);break;case"clone":this.subTool=new f(this.stage);break;case"detail":this.subTool=new y(this.stage);break;case"toning":this.subTool=new w(this.stage)}},this.cleanUp=()=>{var e;(0,s.ZP)("retouch-close").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("retouch-cancel").removeEventListener("click",this.cancelClick,!1),(0,s.ZP)("retouch-type-heal").removeEventListener("change",this.selectSubTool,!1),(0,s.ZP)("retouch-type-clone").removeEventListener("change",this.selectSubTool,!1),(0,s.ZP)("retouch-type-detail").removeEventListener("change",this.selectSubTool,!1),(0,s.ZP)("retouch-type-toning").removeEventListener("change",this.selectSubTool,!1),null===(e=this.subTool)||void 0===e||e.cleanUp(),this.subTool=null},(0,s.ZP)("retouch-close").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("retouch-cancel").addEventListener("click",this.cancelClick,!1),(0,s.ZP)("retouch-type-heal").addEventListener("change",this.selectSubTool,!1),(0,s.ZP)("retouch-type-clone").addEventListener("change",this.selectSubTool,!1),(0,s.ZP)("retouch-type-detail").addEventListener("change",this.selectSubTool,!1),(0,s.ZP)("retouch-type-toning").addEventListener("change",this.selectSubTool,!1);const t=document.querySelector('input[name="retouch-type"]:checked').value;this.setSubTool(t)}}},67538:(e,t,i)=>{i.d(t,{Z:()=>f});var s=i(96548),n=i(93947),a=i(33655),r=i(36817),o=i(4188),h=i(43673),c=i(44170),l=i(94178),d=i(23868),u=i(74820),p=i(75934);class g extends d.Z{constructor(e){super((0,s.Z)("dialogAddLayerTitle"),!0),this.rotation=0,this.maxSize=1920,this.addLayerSearch=()=>{document.dispatchEvent(new CustomEvent("navigate",{detail:"search"})),this.cleanUp()},this.addLayerGenerator=()=>{document.dispatchEvent(new CustomEvent("navigate",{detail:"generator"})),this.cleanUp()},this.addLayerChoice=async e=>{e.stopPropagation();let t="x"===u.ZP.product;switch(e.currentTarget.getAttribute("data")){case"text":this.stage.addText(),document.dispatchEvent(new CustomEvent("select-tool",{detail:t?"arrange":"text"})),this.stage.reform&&this.stage.reform.dblClick();break;case"image":await(0,p.Q0)(!0).then((async e=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let t=0;t<e.length;t++)await(0,p.ZB)(this.stage,e[t],!1);document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"}))}));break;case"shape":this.stage.addShape(),document.dispatchEvent(new CustomEvent("select-tool",{detail:t?"arrange":"shape"}));break;case"frame":this.stage.addFrame(),document.dispatchEvent(new CustomEvent("select-tool",{detail:t?"arrange":"frame"}));break;case"empty":this.stage.addEmpty(),this.stage.notify("layerAdded")}this.cleanUp()},this.stage=e,this.dialog.style.width="500px",this.dialog.style.maxWidth="500px",this.setContent(`\n            <label class="pad-0">${(0,s.Z)("dialogAddLayerHL")}</label>\n\n            <ul id="add-layer-type" class="push-buttons small pad-20">\n                <li id="add-layer-empty" data="empty"><img src="/img/tool/empty.svg" class="ic"><span>${(0,s.Z)("empty")}</span></li>\n                <li id="add-layer-image" data="image"><img src="/img/tool/image.svg" class="ic"><span>${(0,s.Z)("image")}</span></li>\n                <li id="add-layer-frame" data="frame"><img src="/img/tool/frame.svg" class="ic"><span>${(0,s.Z)("frame")}</span></li>\n                <li id="add-layer-text" data="text"><img src="/img/tool/text.svg" class="ic"><span>${(0,s.Z)("text")}</span></li>\n                <li id="add-layer-shape" data="shape"><img src="/img/tool/shape.svg" class="ic"><span>${(0,s.Z)("shape")}</span></li>\n            </ul>\n            <div style="display:flex;gap:20px" class="pad-20">\n                <div id="add-layer-search" class="button outline big" style="flex-grow:1;min-width:unset;"><img src="/img/icon/stock.svg" class="ic" width="20" height="20" loading="lazy">${(0,s.Z)("imageSearch")}</div>\n                <div id="add-layer-generator" class="button outline big" style="flex-grow:1;min-width:unset;"><img src="/img/icon/ai-small.svg" class="ic" width="20" height="20" loading="lazy">${(0,s.Z)("imageGenerator")}</div>\n            </div>\n        `),(0,n.ZP)("add-layer-empty").addEventListener("click",this.addLayerChoice,!0),(0,n.ZP)("add-layer-image").addEventListener("click",this.addLayerChoice,!0),(0,n.ZP)("add-layer-text").addEventListener("click",this.addLayerChoice,!0),(0,n.ZP)("add-layer-frame").addEventListener("click",this.addLayerChoice,!0),(0,n.ZP)("add-layer-shape").addEventListener("click",this.addLayerChoice,!0),(0,n.ZP)("add-layer-search").addEventListener("click",this.addLayerSearch,!0),(0,n.ZP)("add-layer-generator").addEventListener("click",this.addLayerGenerator,!0),(0,n.ZP)("dialog-apply"+this.mid).style.display="none"}}var m=i(82282),v=i(31971);class f{constructor(e){this.isDown=!1,this.stamp=(new Date).getTime(),this.changeName=()=>{this.stamp=(new Date).getTime();let e=this.stage.fresco.getLayerById(this.settingsId),t=Object.assign({},e.settings);const i=(0,n.ZP)("layer-settings-name").value;e.settings.name!==i&&(e.settings.name=i,this.stage.history.add({type:"layerSettings",kind:"name",layer:e,settings:t}),(0,n.ZP)(e.id+"-name")&&((0,n.ZP)(e.id+"-name").innerHTML=e.settings.name+"<span>"+(0,s.Z)(e.type)+"</span>"))},this.changeBlendMode=()=>{this.stamp=(new Date).getTime();let e=this.stage.fresco.getLayerById(this.settingsId),t=Object.assign({},e.settings);e.settings.blendmode=(0,n.ZP)("layer-settings-blend-mode").value,this.stage.history.add({type:"layerSettings",kind:"blendMode",layer:e,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLocked=e=>{this.stamp=(new Date).getTime();const t=(0,n.ZP)("layer-settings-locked-true").checked;this.stage.changeLocked(void 0,t)},this.changeVisible=e=>{this.stamp=(new Date).getTime();let t=this.stage.fresco.getLayerById(this.settingsId);const i=(0,n.ZP)("layer-settings-visible-true").checked;this.stage.changeVisible(t,i)},this.redraw=e=>{var t;if(!this.stage||this.stage.supressRender)return;if(this.isDown&&!this.stage.layerDrag)return;const i=(0,n.ZP)("layer-list");if(i){for(;i.lastChild;)i.removeChild(i.lastChild);if(this.stage.fresco){const e=r.Z.bestFit(this.stage.fresco.width,this.stage.fresco.height,80,120),h=e.width/this.stage.fresco.width,l=this.stage.fresco.width,d=this.stage.fresco.height;(0,n.ZP)("layer-box-add").style.width=e.width+8+"px",(0,n.ZP)("layer-box-background").style.width=e.width+8+"px",(0,n.ZP)("layer-box-background-color").style.background=null!==(t=this.stage.fresco.color)&&void 0!==t?t:"unset";for(var o=this.stage.fresco.layers.length-1;o>=0;o--){const t=this.stage.fresco.layers[o];let u=(0,n.T)("div",{className:"layer"});u.style.width=e.width+8+"px",u.style.height=e.height+8+"px",u.id=t.id,t.settings.visible||u.classList.add("hidden");let p=a.vL(e.width,e.height);if(t.canvas){let i=p.getContext("2d");if(t.rect.width/l>.5||t.rect.height/d>.5)i.scale(h,h),this.stage.renderLayer(i,t,!0);else{i.translate(e.width/2,e.height/2),i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.rotate(t.rect.rotation*Math.PI/180);const s=r.Z.bestFit(t.rect.width,t.rect.height,e.width-8,e.height-8);i.drawImage(t.baked?t.baked:t.canvas,-s.width/2,-s.height/2,Math.max(s.width,1),Math.max(s.height,1))}}u.appendChild(p);const g=(0,n.T)("img",{className:"more",src:"/img/icon/three-dot.svg",title:(0,s.Z)("layerSettings")});g.addEventListener("pointerdown",(e=>{e.stopPropagation(),e.preventDefault(),this.stage.selectLayer(t),this.showSettings()}),!0),u.appendChild(g);let v=(0,n.T)("div",{className:"icons"});if(u.appendChild(v),t.settings.locked&&!t.settings.visible||!t.settings.locked){const e=(0,n.T)("img",{className:"visibility",title:t.settings.visible?(0,s.Z)("visible"):(0,s.Z)("hidden"),src:t.settings.visible?"/img/icon/visible.svg":"/img/icon/hidden.svg"});e.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault()}),!0),e.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.stage.changeVisible(t,!t.settings.visible)}),!1),v.appendChild(e)}else{let e=(0,n.T)("img",{src:"/img/icon/locked.svg",className:"locked",title:(0,s.Z)("locked")});e.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault()}),!0),e.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.stage.changeLocked(t,!1)}),!1),v.appendChild(e)}if(t.animation){const e=(0,n.T)("img",{src:t.animation.block?"/img/icon/animation/none.svg":"/img/icon/animation/animation.svg",title:(0,s.Z)("animation"),className:"animation"});e.addEventListener("mousedown",(()=>{document.dispatchEvent(new CustomEvent("panel-animation"))})),v.appendChild(e)}if(t instanceof m.Z&&t.hasMask()){const e=(0,n.T)("img",{src:"/img/icon/mask.svg",title:(0,s.Z)("hasCutout"),className:"cutout"});e.addEventListener("mousedown",(()=>{document.dispatchEvent(new CustomEvent("select-tool",{detail:"cutout"}))})),e.addEventListener("dblclick",(()=>{this.stage.maskApply()})),v.appendChild(e)}switch(t.settings.link&&""!==t.settings.link&&(u.appendChild((0,n.T)("img",{src:"/img/icon/linked.svg",className:"linked"})),u.classList.add(t.settings.link)),t.type){case c.Z.TYPE_IMAGE:v.appendChild((0,n.T)("img",{src:"/img/tool/image.svg",title:(0,s.Z)("image"),className:"type"}));break;case c.Z.TYPE_FRAME:v.appendChild((0,n.T)("img",{src:"/img/tool/frame.svg",title:(0,s.Z)("frame"),className:"type"}));break;case c.Z.TYPE_ELEMENT:v.appendChild((0,n.T)("img",{src:"/img/tool/element.svg",title:(0,s.Z)("element"),className:"type"}));break;case c.Z.TYPE_TEXT:v.appendChild((0,n.T)("img",{src:"/img/tool/text.svg",title:(0,s.Z)("text"),className:"type"}));break;case c.Z.TYPE_SHAPE:v.appendChild((0,n.T)("img",{src:"/img/tool/shape.svg",title:(0,s.Z)("shape"),className:"type"}))}u.addEventListener("mousedown",this.mouseDown,!1),u.addEventListener("touchstart",this.touchStart,{passive:!1}),i.appendChild(u)}this.markSelected(!1)}}},this.markSelected=(e=!0)=>{var t;if("block"===(0,n.ZP)("layer-settings").style.display&&this.hideSettings(),this.stage&&this.stage.fresco&&(0,n.ZP)("layer-box")){if(e){const e=(0,n.ZP)("layer-list").getElementsByClassName("layer");for(let t=0;t<e.length;t++)e[t].classList.remove("haslink","selected")}const i=this.stage.fresco.getSelectedStack();for(let e of i)if(null===(t=(0,n.ZP)(e.id))||void 0===t||t.classList.add("selected"),e.hasLink()){const t=(0,n.ZP)("layer-list").getElementsByClassName(e.settings.link);for(let e=0;e<t.length;e++)t[e].classList.add("haslink")}}},this.settingsId="",this.showSettings=()=>{let e=this.stage.fresco.getSelected();e&&e.id!==this.settingsId?((0,n.ZP)("layer-settings").style.display="block",this.settingsId=e.id,this.opacity.setValue(e.settings.opacity),(0,n.ZP)("layer-settings-name").value=e.settings.name,(0,n.ZP)("layer-settings-blend-mode").value=e.settings.blendmode,(0,n.ZP)("layer-settings-visible-true").checked=e.settings.visible,(0,n.ZP)("layer-settings-visible-false").checked=!e.settings.visible,(0,n.ZP)("layer-settings-locked-true").checked=e.settings.locked,(0,n.ZP)("layer-settings-locked-false").checked=!e.settings.locked,window.requestAnimationFrame((()=>{const t=(0,n.ZP)("layer-settings").getBoundingClientRect();let i=a.HS((0,n.ZP)(e.id)).y-(0,n.ZP)("layer-box-content-ss-content").scrollTop;i+t.height>(0,n.ZP)("workspace").clientHeight&&(i=(0,n.ZP)("workspace").clientHeight-t.height-4),(0,n.ZP)("layer-settings").style.top=i-16+"px",(0,n.ZP)("layer-settings").style.right="80px"}))):this.hideSettings(!0)},this.hideSettings=(e=!1)=>{!e&&(new Date).getTime()-this.stamp<300||(this.settingsId="",(0,n.ZP)("layer-settings").style.display="none",document.dispatchEvent(new CustomEvent("layer-arrange")))},this.touchStart=e=>{1!==e.touches.length&&(e.preventDefault(),e.stopPropagation(),this.down(e.touches[0].clientX,e.touches[0].clientY,e.currentTarget,e.shiftKey||e.ctrlKey),this.stage.fresco.getSelected()&&(document.addEventListener("touchmove",this.touchMove,{passive:!1}),document.addEventListener("touchend",this.touchEnd,{passive:!1})))},this.touchMove=e=>{1!==e.touches.length&&(e.preventDefault(),e.stopPropagation(),this.move(e.touches[0].clientX,e.touches[0].clientY))},this.touchEnd=e=>{e.preventDefault(),e.stopPropagation(),this.up(e.touches[0].clientX,e.touches[0].clientY),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=e=>{if("INPUT"!==document.activeElement.nodeName&&"SELECT"!==document.activeElement.nodeName){if(e.stopPropagation(),this.down(e.clientX,e.clientY,e.currentTarget,e.shiftKey||e.ctrlKey),e.button>0)return this.stamp=(new Date).getTime(),void this.showSettings();this.stage.fresco.getSelected()&&(document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0),(0,n.ZP)("layer-box").classList.add("down"),this.isDown=!0)}},this.mouseMove=e=>{e.stopPropagation(),this.move(e.clientX,e.clientY)},this.mouseUp=e=>{e.stopPropagation(),this.up(e.clientX,e.clientY),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.down=(e,t,i,s)=>{this.downY=t,this.heightY=(0,n.ZP)("layer-box-content-ss-content").scrollHeight,(s||this.stage.fresco.isSelectedStack()||!this.stage.fresco.isSelectedById(i.id))&&(s&&this.stage.fresco.isSelectedById(i.id)?this.stage.unselectLayerById(i.id):this.stage.selectLayerById(i.id,s,!0))},this.pointInLayerBox=(e,t)=>{const i=(0,n.ZP)("layer-list").getBoundingClientRect();return e>=i.x&&e<=i.x+i.width&&t>=i.y&&t<=i.y+i.height},this.move=(e,t)=>{const i=(0,n.ZP)("layer-list");if(!this.pointInLayerBox(e,t)){if(this.ghost){this.ghost.classList.remove("ghost"),this.ghost.style.left="unset",this.ghost.style.top="unset",this.ghostFill.remove();const e=this.stage.fresco.layers.length-this.stage.fresco.selectedLayerNr()-1;i.children[e].before(this.ghost),this.ghost=null,this.ghostFill=null}if(!this.stage.layerDrag){const i=this.stage.fresco.getSelected(),s=(0,n.ZP)(i.id);this.stage.layerDrag={fresco:this.stage.fresco.id,layer:i,node:(0,n.T)("div",{className:"grabbed-layer"},(0,n.T)("div",{className:"thumb"},a.dN(s.querySelector("canvas"))),(0,n.T)("div",i.settings.name)),position:new h.Z(e,t),blocked:this.stage.fresco.block},this.stage.workspace.append(this.stage.layerDrag.node),document.body.style.cursor="move"}const s=this.stage.layerDrag.node.getBoundingClientRect();return this.stage.layerDrag.node.style.left=e-s.width/2+"px",this.stage.layerDrag.node.style.top=t-s.height/2+"px",this.stage.layerDrag.position=new h.Z(e,t),void document.dispatchEvent(new CustomEvent("layer-drag-move"))}if(this.stage.layerDrag){if(this.stage.coating.clear(),document.body.style.cursor="unset",this.stage.layerDrag.fresco!==this.stage.fresco.id){const i=this.stage.layerDrag.node.getBoundingClientRect();return this.stage.layerDrag.node.style.left=e-i.width/2+"px",this.stage.layerDrag.node.style.top=t-i.height/2+"px",void(this.stage.layerDrag.position=new h.Z(e,t))}this.stage.layerDrag.node.remove(),this.stage.layerDrag=null}this.ghost||(this.ghost=(0,n.ZP)(this.stage.fresco.getSelected().id),this.startY=this.ghost.offsetTop,this.ghost.style.left=this.ghost.offsetLeft+"px",this.ghostFill=document.createElement("div"),this.ghostFill.id="ghost-fill",this.ghostFill.style.width=this.ghost.clientWidth+4+"px",this.ghostFill.style.height=this.ghost.clientHeight+4+"px",this.ghost.before(this.ghostFill),this.ghost.classList.add("ghost"),i.appendChild(this.ghost)),-1===this.startY&&(this.startY=this.ghost.offsetTop,this.downY=t),this.ghost.style.top=this.startY-(this.downY-t)+"px",this.moveGhostFill(),window.clearTimeout(this.auto);let s=(0,n.ZP)("layer-box-content-ss-content");this.ghost.offsetTop<s.scrollTop-5?this.autoScroll(-20):this.ghost.offsetTop+this.ghost.offsetHeight>s.scrollTop+s.offsetHeight+5&&this.autoScroll(20)},this.moveGhostFill=()=>{this.ghost.offsetTop>this.ghostFill.offsetTop+this.ghostFill.offsetHeight/2+10?this.ghostFill.nextElementSibling.classList.contains("selected")||this.ghostFill.nextElementSibling.after(this.ghostFill):this.ghost.offsetTop<this.ghostFill.offsetTop-this.ghostFill.offsetHeight/2-10&&this.ghostFill.previousElementSibling&&this.ghostFill.previousElementSibling.before(this.ghostFill)},this.autoScroll=e=>{window.clearTimeout(this.auto);const t=(0,n.ZP)("layer-box-content-ss-content"),i=()=>{this.ghost&&(e<0&&t.scrollTop>10||e>0&&t.scrollTop+10<this.heightY-t.clientHeight)&&(this.startY=-1,t.scrollTop+=e,this.ghost.style.top=this.ghost.offsetTop-10+e+"px",this.moveGhostFill(),this.auto=window.setTimeout(i,80))};this.auto=window.setTimeout(i,80)},this.up=(e,t)=>{this.isDown=!1,(0,n.ZP)("layer-box").classList.remove("down"),document.body.style.cursor="unset",this.stage.layerDrag&&(this.pointInLayerBox(e,t)||document.dispatchEvent(new CustomEvent("layer-drag-drop")),this.stage.layerDrag.node.remove(),this.stage.layerDrag=void 0),this.ghost&&(this.ghost.classList.remove("ghost"),this.ghost.style.left="0px",this.ghost.style.top="0px",this.ghostFill.before(this.ghost),this.ghostFill.remove(),this.ghost=void 0,this.ghostFill=void 0);let i=this.stage.fresco.selectedLayerNr(),s=(0,n.ZP)("layer-list").getElementsByClassName("layer");const a=this.stage.fresco.getSelected();for(var r=0;r<s.length;r++)if(s[r].id===a.id){let e=s.length-r-1;e!=i&&this.stage.changeOrder(i,e);break}},this.stage=e,document.addEventListener("layer-list-render",(()=>this.redraw()),!0),document.addEventListener("layer-select",(()=>this.markSelected()),!1),(0,n.ZP)("layer-box-add").addEventListener("click",(()=>new g(this.stage)),!1),(0,n.ZP)("layer-box-background").addEventListener("click",(()=>new v.Z(this.stage)),!1),(0,n.ZP)("layer-settings-name").addEventListener("blur",this.changeName,!1),(0,n.ZP)("layer-settings-name").addEventListener("keydown",(e=>{"Enter"===e.key&&(e.currentTarget.blur(),this.hideSettings(!0))}),!0),(0,n.ZP)("layer-settings-close").addEventListener("click",(()=>this.hideSettings(!0)),!1),(0,n.ZP)("layer-settings-delete").addEventListener("click",(()=>this.stage.deleteLayer()),!1),(0,n.ZP)("layer-settings-duplicate").addEventListener("click",(()=>this.stage.duplicateLayer()),!1),(0,n.ZP)("layer-settings-blend-mode").addEventListener("change",this.changeBlendMode,!1),(0,n.ZP)("layer-settings-visible-false").addEventListener("click",this.changeVisible,!1),(0,n.ZP)("layer-settings-visible-true").addEventListener("click",this.changeVisible,!1),(0,n.ZP)("layer-settings-locked-false").addEventListener("click",this.changeLocked,!1),(0,n.ZP)("layer-settings-locked-true").addEventListener("click",this.changeLocked,!1),(0,n.ZP)("layer-settings-merge-down").addEventListener("click",(()=>this.stage.mergeDown()),!1),(0,n.ZP)("layer-settings-merge-visible").addEventListener("click",(()=>this.stage.mergeVisible()),!1),(0,n.ZP)("layer-settings-merge-flatten").addEventListener("click",(()=>this.stage.mergeFlatten()),!1),this.opacity=new o.Z("layer-settings-opacity",{defaultValue:1,label:(0,s.Z)("opacity"),labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100,onChange:e=>{this.stage.fresco.getLayerById(this.settingsId).settings.opacity=e,document.dispatchEvent(new CustomEvent("viewport-render"))},onEnd:(e,t)=>{this.stamp=(new Date).getTime();let i=this.stage.fresco.getLayerById(this.settingsId);this.stage.history.add({type:"layerSettings",kind:"opacity",layer:i,settings:Object.assign(Object.assign({},i.settings),{opacity:t})})}}),new l.Z((0,n.ZP)("layer-box-content")),(0,n.ZP)("layer-box-content").oncontextmenu=e=>(e.preventDefault(),e.stopPropagation(),!1)}}},11966:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(96548),n=i(93947),a=i(23868),r=i(74820);class o extends a.Z{constructor(){super((0,s.Z)("preferences"),!1),this.dialog.style.width="440px",this.dialog.style.maxWidth="440px",this.setContent(`\n            <label>${(0,s.Z)("viewOBarAccent")}</label>\n            <div id="preference-accent" class="pad-4 color-pod-list" style="display:flex">\n                <div class="color-pod small" data="ash" style="background-color:#383E42"></div>\n                <div class="color-pod small" data="brown" style="background-color:#715649"></div>\n                <div class="color-pod small" data="coral" style="background-color:#F3764C"></div>\n                <div class="color-pod small" data="pink" style="background-color:#F17686"></div>\n                <div class="color-pod small" data="rose" style="background-color:#FE5151"></div>\n                <div class="color-pod small" data="red" style="background-color:#BA2B46"></div>\n                <div class="color-pod small" data="plum" style="background-color:#5A354F"></div>\n                <div class="color-pod small" data="maroon" style="background-color:#A82068"></div>\n                <div class="color-pod small" data="purple" style="background-color:#7D4199"></div>\n                <div class="color-pod small" data="lavender" style="background-color:#6D5DD2"></div>\n                <div class="color-pod small" data="denim" style="background-color:#496171"></div>\n                <div class="color-pod small" data="blue" style="background-color:#0099CC"></div>\n                <div class="color-pod small" data="teal" style="background-color:#00A5A5"></div>\n                <div class="color-pod small" data="green" style="background-color:#48B07B"></div>\n                <div class="color-pod small" data="lime" style="background-color:#95C20F"></div>\n                <div class="color-pod small" data="mustard" style="background-color:#F5BB00"></div>\n            </div>\n\n            <label class="pad-16">${(0,s.Z)("viewOBarWorkspace")}</label>\n            <div id="preference-workspace" class="color-selector-presets extended pad-4" style="width:200px">\n                <div data="dark" class="color-pod square" style="background-color: #232529"></div>\n                <div data="iron" class="color-pod square" style="background-color: #606060"></div>\n                <div data="steel" class="color-pod square" style="background-color: #999999"></div>\n                <div data="light" class="color-pod square" style="background-color: #cccccc"></div>\n            </div>\n\n            <a id="preference-theme-reset" class="link pad-20" style="display:inline-block;">${(0,s.Z)("reset")}</a>\n            \n            <input type="checkbox" id="setting-use-legacy-save" />\n            <label class="switch pad-16" for="setting-use-legacy-save">${(0,s.Z)("viewOBarUseLegacySave")}<span></span></label>\n\n            <div class="splitter small pad-16"></div>\n            <input type="checkbox" id="setting-ask-preresize" />\n            <label class="pad-10 switch" for="setting-ask-preresize">${(0,s.Z)("viewOBarAskPrerezise")}<span></span></label>\n            <div class="splitter small pad-10"></div>\n            <input type="checkbox" id="setting-guides" />\n            <label class="pad-10 switch" for="setting-guides">${(0,s.Z)("viewOBarShowGu")}<span></span></label>\n            <input type="checkbox" id="settings-snap-to" />\n            <label class="pad-10 switch" for="settings-snap-to">${(0,s.Z)("viewOBarSnap")}<span></span></label>\n            <input type="checkbox" id="settings-smooth" />\n            <label class="pad-10 switch" for="settings-smooth">${(0,s.Z)("viewOBarSmooth")}<span></span></label>\n            <div class="splitter small pad-10"></div>\n            <input type="checkbox" id="settings-all-tooltip" />\n            <label class="pad-10 switch" for="settings-all-tooltip">${(0,s.Z)("viewOBarAllTooltip")}<span></span></label>\n            <label class="split pad-10" for="settings-scroll-mode">${(0,s.Z)("viewOBarScollMode")}\n                <div class="select pad-0" style="width:auto">\n                    <select id="settings-scroll-mode">\n                        <option value="zoom">${(0,s.Z)("zoom")}</option>\n                        <option value="move">${(0,s.Z)("move")}</option>\n                        <option value="none">${(0,s.Z)("none")}</option>\n                    </select> \n                </div>\n            </label>\n        `);let e=r.ZP.accent,t=(0,n.ZP)("preference-accent").getElementsByTagName("div");for(var i=0;i<t.length;i+=1)t[i].addEventListener("click",(t=>{document.documentElement.classList.remove(e),e=t.currentTarget.getAttribute("data"),document.documentElement.classList.add(e),document.dispatchEvent(new CustomEvent("layer-list-render")),(0,r.Lt)("accent",e)}));let a=r.ZP.workspace,o=(0,n.ZP)("preference-workspace").getElementsByTagName("div");for(i=0;i<o.length;i+=1)o[i].addEventListener("click",(e=>{document.documentElement.classList.remove(a),a=e.currentTarget.getAttribute("data"),document.documentElement.classList.add(a),(0,r.Lt)("workspace",a)}));(0,n.ZP)("preference-theme-reset").addEventListener("click",(()=>{(0,r.Lt)("workspace","default"),(0,r.Lt)("accent","default"),document.documentElement.className=""}));const h=(0,n.ZP)("setting-use-legacy-save");h.checked=r.ZP.useLegacySave,h.onchange=()=>(0,r.Lt)("useLegacySave",h.checked);const c=(0,n.ZP)("setting-ask-preresize");c.checked=r.ZP.askToPreResize,c.onchange=()=>(0,r.Lt)("askToPreResize",c.checked);const l=(0,n.ZP)("setting-guides");l.checked=r.ZP.showGuides,l.onchange=()=>(0,r.Lt)("showGuides",l.checked);const d=(0,n.ZP)("settings-snap-to");d.checked=r.ZP.snapToGuides,d.onchange=()=>(0,r.Lt)("snapToGuides",d.checked);const u=(0,n.ZP)("settings-smooth");u.checked=r.ZP.smoothScaling,u.onchange=()=>(0,r.Lt)("smoothScaling",u.checked);const p=(0,n.ZP)("settings-scroll-mode");p.value=r.ZP.scrollMode,p.onchange=()=>(0,r.Lt)("scrollMode",p.value);const g=(0,n.ZP)("settings-all-tooltip");g.checked=r.ZP.allTooltip,g.onchange=()=>(0,r.Lt)("allTooltip",g.checked),(0,n.ZP)("dialog-apply"+this.mid).style.display="none",(0,n.ZP)("dialog-cancel"+this.mid).innerText=(0,s.Z)("close")}}},94545:(e,t,i)=>{i.a(e,(async(e,s)=>{try{i.d(t,{Z:()=>R});var n=i(93947),a=i(96548),r=i(5182),o=i(33655),h=i(22817),c=i(94178),l=i(55390),d=i(77549),u=i(74820),p=i(67538),g=i(63515),m=i(65725),v=i(3948),f=i(89),y=i(69453),w=i(74469),x=i(16557),b=i(99954),Z=i(46970),k=i(877),E=i(71956),P=i(34604),S=i(51158),C=i(4543),L=i(66246),T=i(11966),M=i(40147),A=i(72155),I=e([r]);r=(I.then?(await I)():I)[0];class R extends r.Z{constructor(){super(),this.isKeyDown=!1,this.isPreviewMode=!1,this.resize=()=>{if(this.isPreviewMode)this.stage.resize(0,0,this.stage.workspace.offsetWidth-15,this.stage.workspace.offsetHeight-16);else{let e="minimized"===u.ZP.boxBarXState?0:110,t=this.tool?(0,n.ZP)(this.tool.name).clientWidth+62:60;this.stage.resize(t,0,this.stage.workspace.offsetWidth-t-e,this.stage.workspace.offsetHeight-46),(0,n.ZP)("bottom-bar").style.paddingLeft=t+20+"px"}this.scrollbar&&this.scrollbar.resize(),this.tool&&"crop"===this.tool.name&&this.tool.refit()},this.togglePreviewMode=()=>{var e,t;this.isHome()||this.isModal()||(this.isPreviewMode=!this.isPreviewMode,this.isPreviewMode?((0,n.ZP)("box-bar").style.display="none",(0,n.ZP)("menu-bar").style.display="none",(0,n.ZP)("bottom-bar").style.display="none",this.stage.reform&&(this.wasSuppress=this.stage.reform.supressed,this.stage.reform.supress(!0)),this.tool&&(null===(e=(0,n.ZP)(this.tool.name))||void 0===e||e.classList.remove("active"))):((0,n.ZP)("box-bar").style.display="flex",(0,n.ZP)("menu-bar").style.display="flex",(0,n.ZP)("bottom-bar").style.display="flex",this.tool&&(null===(t=(0,n.ZP)(this.tool.name))||void 0===t||t.classList.add("active"),this.stage.reform&&!this.wasSuppress&&this.stage.reform.supress(!1))),this.resize())},this.keyDown=e=>{const t=document.activeElement;if(o.PP(t))"Enter"===e.key&&"TEXTAREA"!==t.nodeName&&document.activeElement.blur();else if("§"!==e.key&&"~"!==e.key||e.preventDefault(),!this.isHome()&&!this.isModal())if(e.ctrlKey||e.metaKey)switch(e.key.toLowerCase()){case"o":return e.preventDefault(),void this.home.openClick();case"s":return e.preventDefault(),void this.saveClick();case"q":return e.preventDefault(),void this.closeClick();case"z":return e.preventDefault(),e.shiftKey?this.stage.history.redo():this.stage.history.undo(),!1;case"y":return e.preventDefault(),this.stage.history.redo(),!1;case"0":return e.preventDefault(),void this.stage.setZoom("fit");case"1":return e.preventDefault(),void this.stage.setZoom("1");case"2":return e.preventDefault(),void this.stage.setZoom("fill");case"3":return e.preventDefault(),void this.stage.setZoom("3");case"-":return e.preventDefault(),void this.stage.setZoomStep(!1);case"+":case"=":return e.preventDefault(),void this.stage.setZoomStep(!0)}else{if(" "===e.key)return this.stage.coating.setPan(),void e.preventDefault();if("Tab"===e.key)return e.preventDefault(),void this.togglePreviewMode();if("Escape"!==e.key)if("Enter"!==e.key){if("Delete"===e.key||"Backspace"===e.key)return e.preventDefault(),void this.stage.deleteLayer();switch(e.key.toLowerCase()){case"p":this.toggleTool("layout");break;case"c":this.toggleTool("crop");break;case"k":this.toggleTool("cutout");break;case"v":this.toggleTool("arrange");break;case"a":this.toggleTool("adjust");break;case"e":this.toggleTool("effect");break;case"q":this.toggleTool("liquify");break;case"r":this.toggleTool("retouch");break;case"b":this.toggleTool("paint");break;case"t":this.toggleTool("add-text");break;case"i":this.toggleTool("add-image");break;case"o":this.toggleTool("add-element")}}else this.applyToolEvent();else this.isPreviewMode?this.togglePreviewMode():this.cancelToolEvent()}},this.keyUp=e=>{if(this.isModal())return e.stopImmediatePropagation(),e.stopPropagation(),void e.preventDefault();" "!==e.key||this.stage.coating.removePan()},this.setUpMenuBar=()=>{let e=(0,n.ZP)("tool-menu").getElementsByTagName("li");for(var t=0;t<e.length;t++)e[t].addEventListener("click",(e=>this.toggleTool(e.currentTarget.getAttribute("data"))),!1);document.addEventListener("tool-apply",this.applyToolEvent,!0),document.addEventListener("tool-cancel",this.cancelToolEvent,!0),document.addEventListener("select-tool",this.selectTool,!0),(0,n.ZP)("menu-bar").addEventListener("mouseenter",(()=>{u.ZP.allTooltip&&(0,n.ZP)("menu-bar").classList.add("active")})),(0,n.ZP)("menu-bar").addEventListener("mouseleave",(()=>{(0,n.ZP)("menu-bar").classList.remove("active")})),(0,n.ZP)("toggle-home").addEventListener("click",(()=>{this.toggleTool(),this.navigate()}),!1),(0,n.ZP)("toggle-settings").addEventListener("click",(()=>{new T.Z}),!1),this.loadView("layout","workspace","tool-drawer").then((e=>new c.Z((0,n.ZP)("layout-content")))),this.loadView("arrange","workspace","tool-drawer").then((e=>new c.Z((0,n.ZP)("arrange-content")))),this.loadView("animation","workspace","tool-drawer").then((e=>new c.Z((0,n.ZP)("animation-content")))),this.loadView("add-text","workspace","tool-drawer").then((e=>new c.Z((0,n.ZP)("add-text-content")))),this.loadView("add-element","workspace","tool-drawer").then((e=>new c.Z((0,n.ZP)("add-element-content")))),this.loadView("crop","workspace","tool-drawer").then((e=>new c.Z((0,n.ZP)("crop-content")))),this.loadView("cutout","workspace","tool-drawer").then((e=>new c.Z((0,n.ZP)("cutout-content")))),this.loadView("adjust","workspace","tool-drawer").then((e=>new c.Z((0,n.ZP)("adjust-content")))),this.loadView("effect","workspace","tool-drawer").then((e=>new c.Z((0,n.ZP)("effect-content")))),this.loadView("liquify","workspace","tool-drawer").then((e=>new c.Z((0,n.ZP)("liquify-content")))),this.loadView("retouch","workspace","tool-drawer").then((e=>new c.Z((0,n.ZP)("retouch-content")))),this.loadView("paint","workspace","tool-drawer").then((e=>new c.Z((0,n.ZP)("paint-content"))))},this.setUpBottomBar=()=>{(0,n.ZP)("close").addEventListener("click",this.closeClick,!1),(0,n.ZP)("save").addEventListener("click",this.saveClick,!1);const e=(0,n.ZP)("undo"),t=(0,n.ZP)("redo");e.addEventListener("click",(()=>this.stage.history.undo())),t.addEventListener("click",(()=>this.stage.history.redo())),document.addEventListener("history-update",(async i=>{e.classList.toggle("disabled",i.detail.atStart),t.classList.toggle("disabled",i.detail.atEnd)})),(0,n.ZP)("animator-play").addEventListener("click",(()=>this.stage.playAnimation())),(0,n.ZP)("animator-stop").addEventListener("click",(()=>this.stage.stopAnimation())),(0,n.ZP)("zoom-out").addEventListener("click",(()=>this.stage.setZoomStep(!1)),!1),(0,n.ZP)("zoom-in").addEventListener("click",(()=>this.stage.setZoomStep(!0)),!1),(0,n.ZP)("zoom-level").addEventListener("click",(()=>{(0,n.ZP)("zoom-selector").classList.toggle("active")}),!1);let i=(0,n.ZP)("zoom-selector").getElementsByTagName("li");for(var s=0;s<i.length;s++)i[s].addEventListener("click",(e=>{(0,n.ZP)("zoom-selector").classList.toggle("active");const t=e.currentTarget.getAttribute("data");this.stage.setZoom(t)}),!1);const a=()=>{var e;const t=null===(e=this.stage.fresco)||void 0===e?void 0:e.hasAnimation();(0,n.ZP)("animator").classList.toggle("enabled",t)};document.addEventListener("history-update",a),document.addEventListener("layer-select",a)},this.setUpBoxBar=()=>{this.layerBox=new p.Z(this.stage),this.scrollbar=new d.Z(this.stage),this.navigator=new l.Z(this.stage,(0,n.ZP)("workspace"));const e=(0,n.ZP)("box-tab");e.setAttribute("tooltip","minimized"===u.ZP.boxBarXState?(0,a.Z)("maximize"):(0,a.Z)("minimize")),e.addEventListener("click",(()=>{let t=(0,n.ZP)("box-bar").classList.value;t="maximized"===t?"minimized":"maximized",(0,n.ZP)("box-bar").classList.value=t,e.setAttribute("tooltip","minimized"===t?(0,a.Z)("maximize"):(0,a.Z)("minimize")),e.classList.toggle("minimized","minimized"===t),(0,u.Lt)("boxBarXState",t),this.resize()}),!1),(0,n.ZP)("box-bar").classList.value=u.ZP.boxBarXState,(0,n.ZP)("box-tab").classList.value=u.ZP.boxBarXState},this.animationPlayEvent=e=>{(0,n.ZP)("animator").classList.add("playing"),(0,n.ZP)("animator").setAttribute("time",e.detail),(0,n.ZP)("animator-progress-line").style.width="0%"},this.animationStepEvent=e=>{const t=Number(e.detail),i=Number((0,n.ZP)("animator").getAttribute("time"));(0,n.ZP)("animator-time").innerText=(Math.min(t,i)/1e3).toFixed(1);const s=Math.min(t/i,1);(0,n.ZP)("animator-progress-line").style.width=100*s+"%"},this.animationStopEvent=e=>{(0,n.ZP)("animator").classList.remove("playing")},this.applyToolEvent=()=>{var e;null===(e=this.tool)||void 0===e||e.apply(),this.toggleTool()},this.cancelToolEvent=()=>{var e;null===(e=this.tool)||void 0===e||e.cancel(),this.toggleTool()},this.selectTool=e=>{var t;e&&e.detail&&this.tool&&this.tool.name===e.detail||(null===(t=this.tool)||void 0===t||t.apply(),this.toggleTool(null==e?void 0:e.detail))},this.layerMarked=()=>{this.tool||this.toggleTool("arrange")},this.toggleTool=async e=>{var t,i,s,a;if("more"===e)return;const r=this.tool&&this.tool.name===e;if(this.tool&&(e&&this.tool.apply(),this.stage.history.commitTransaction(),this.stage.coating.removeCursorImage(),null===(t=(0,n.ZP)("tool-"+this.tool.name))||void 0===t||t.classList.remove("active"),null===(i=(0,n.ZP)(this.tool.name))||void 0===i||i.classList.remove("active"),this.tool.cleanUp(),this.tool=null),e&&!r){if(!(0,n.ZP)(e)&&(await this.loadView(e,"workspace","tool-drawer").then((t=>new c.Z((0,n.ZP)(e+"-content")))),this.tool))return;switch((0,n.ZP)("menu-bar").classList.remove("active"),e){case"arrange":this.tool=new E.Z(this.stage);break;case"animation":this.tool=new L.Z(this.stage);break;case"layout":this.tool=new y.Z(this.stage);break;case"crop":this.tool=new g.Z(this.stage);break;case"cutout":this.tool=new w.Z(this.stage);break;case"adjust":this.tool=new x.Z(this.stage);break;case"effect":this.tool=new b.Z(this.stage);break;case"retouch":this.tool=new P.Z(this.stage);break;case"liquify":this.tool=new S.Z(this.stage);break;case"paint":this.tool=new m.Z(this.stage);break;case"add-element":this.tool=new M.Z(this.stage);break;case"add-text":this.tool=new k.Z(this.stage);break;case"focus":this.tool=new v.Z(this.stage);break;case"glitch":this.tool=new f.Z(this.stage);break;case"dispersion":this.tool=new A.Z(this.stage);break;case"preset":this.tool=new Z.Z(this.stage);break;case"colorize":this.tool=new C.Z(this.stage)}}!this.tool||this.tool instanceof E.Z||this.tool instanceof y.Z||this.tool instanceof k.Z||this.tool instanceof M.Z?this.stage.reform.supress(!1):this.stage.reform.supress(!0),this.tool&&(null===(s=(0,n.ZP)("tool-"+this.tool.name))||void 0===s||s.classList.add("active"),null===(a=(0,n.ZP)(this.tool.name))||void 0===a||a.classList.add("active")),this.resize()},this.stage.tabLimit=1,this.stage.reform=new h.Z(this.stage,"ARRANGE"),window.onresize=()=>this.resize(),document.body.onkeydown=e=>this.keyDown(e),document.body.onkeyup=e=>this.keyUp(e),Promise.all([this.loadView("menu-bar","workspace").then(this.setUpMenuBar),this.loadView("box-bar","workspace").then(this.setUpBoxBar),this.loadView("bottom-bar","workspace").then(this.setUpBottomBar)]).then((e=>{this.whenLoaded()})),document.addEventListener("resize",(()=>this.resize())),document.addEventListener("layer-marked",(()=>this.layerMarked())),document.addEventListener("preferences",(()=>new T.Z),!0),document.addEventListener("animation-play",this.animationPlayEvent,!0),document.addEventListener("animation-step",this.animationStepEvent,!0),document.addEventListener("animation-stop",this.animationStopEvent,!0),document.addEventListener("zoom-change",(()=>{(0,n.ZP)("zoom-level").innerText=Math.round(100*this.stage.zoom)+"%"}),!1)}}s()}catch(R){s(R)}}))},72982:(e,t,i)=>{i.a(e,(async(s,n)=>{try{var a,r=s([a=i(82646)]),[a]=r.then?(await r)():r;await i.v(t,e.id,"f742b95ed20aa15ebd50",{"./pixlr_bg.js":{__wbindgen_string_new:a.h4,__wbg_x_7af334499c70ecf9:a.ut,__wbg_y_7b2e0b17f2702db7:a.qY,__wbg_width_9a7937fdc4208452:a.nx,__wbg_height_c0440005f53e9792:a.Wy,__wbindgen_memory:a.oH,__wbg_buffer_3f3d764d4747d564:a.jp,__wbg_newwithbyteoffsetandlength_b79525f5b383cdb2:a.gI,__wbindgen_object_drop_ref:a.ug,__wbg_new_4c0b35176d4e6c47:a.BY,__wbindgen_throw:a.Or}}),n()}catch(o){n(o)}}),1)}},c={};function l(e){var t=c[e];if(void 0!==t)return t.exports;var i=c[e]={id:e,loaded:!1,exports:{}};return h[e](i,i.exports,l),i.loaded=!0,i.exports}l.m=h,e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},l.a=(n,a,r)=>{var o;r&&((o=[]).d=-1);var h,c,l,d=new Set,u=n.exports,p=new Promise(((e,t)=>{l=t,c=e}));p[t]=u,p[e]=e=>(o&&e(o),d.forEach(e),p.catch((e=>{}))),n.exports=p,a((n=>{var a;h=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[e])return n;if(n.then){var a=[];a.d=0,n.then((e=>{r[t]=e,s(a)}),(e=>{r[i]=e,s(a)}));var r={};return r[e]=e=>e(a),r}}var o={};return o[e]=e=>{},o[t]=n,o})))(n);var r=()=>h.map((e=>{if(e[i])throw e[i];return e[t]})),c=new Promise((t=>{(a=()=>t(r)).r=0;var i=e=>e!==o&&!d.has(e)&&(d.add(e),e&&!e.d&&(a.r++,e.push(a)));h.map((t=>t[e](i)))}));return a.r?c:r()}),(e=>(e?l(p[i]=e):c(u),s(o)))),o&&o.d<0&&(o.d=0)},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},a=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var i=Object.create(null);l.r(i);var s={};n=n||[null,a({}),a([]),a(a)];for(var r=2&t&&e;"object"==typeof r&&!~n.indexOf(r);r=a(r))Object.getOwnPropertyNames(r).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,l.d(i,s),i},l.d=(e,t)=>{for(var i in t)l.o(t,i)&&!l.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,i)=>(l.f[i](e,t),t)),[])),l.u=e=>(({1477:"checkout.modal",2556:"tiff",4200:"gif",4500:"pdf-lib",5215:"native",6600:"adyen",7346:"infill",8155:"ffmpeg"}[e]||e)+"."+{630:"4926b999c5b1aa4e682b",979:"a9d4f94d1acc1b2e035e",1477:"342fcc4f2e46cea21ed4",1562:"b2f23a17be955c413f98",1633:"bca408a432aca422601b",1977:"89c716bdfd95beb917a1",2312:"2fd7b3b3429155b9194f",2501:"0e62a93348f468613965",2513:"f48dcc4df2e8f946a302",2556:"028335f129a76d461bf3",2638:"c703f43a369bc1c758fc",2646:"b8e45a59491ae2cde641",3997:"7b9b51d90111e121d898",4184:"ed7dd98ffe72bfc36821",4200:"acd155c1a24fe0cbb4a8",4495:"ca6cc6e40224ccd33bef",4500:"e98a8e7b6841d80d9a88",4886:"5a88193c64749d4a6b45",4905:"decc471637174350cd4d",5126:"347d9f5aa6cd9ab95979",5215:"f7234d60687d25012e82",5289:"256498886f282b787803",6600:"3eb28922ab8190623298",7250:"bf5506039142aafaf875",7251:"abea7bec738cb6eedafb",7346:"25e95833b756f84241e1",7391:"e79e94b7e6c04e34855a",7392:"a8a921f00c0cc9c0b792",7630:"682dfb21527a726fe020",8030:"b387797e56823649a39f",8132:"e16dab4e88552747154e",8155:"9ecc49753135a0b9f541",9304:"c861181918e8e885244c",9316:"7201d6229987d809759d"}[e]+".js"),l.miniCssF=e=>{},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},o="pixlr:",l.l=(e,t,i,s)=>{if(r[e])r[e].push(t);else{var n,a;if(void 0!==i)for(var h=document.getElementsByTagName("script"),c=0;c<h.length;c++){var d=h[c];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==o+i){n=d;break}}n||(a=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,l.nc&&n.setAttribute("nonce",l.nc),n.setAttribute("data-webpack",o+i),n.src=e),r[e]=[t];var u=(t,i)=>{n.onerror=n.onload=null,clearTimeout(p);var s=r[e];if(delete r[e],n.parentNode&&n.parentNode.removeChild(n),s&&s.forEach((e=>e(i))),t)return t(i)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=u.bind(null,n.onerror),n.onload=u.bind(null,n.onload),a&&document.head.appendChild(n)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.j=1166,l.v=(e,t,i,s)=>{var n=fetch(l.p+""+i+".module.wasm");return"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(n,s).then((t=>Object.assign(e,t.instance.exports))):n.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,s))).then((t=>Object.assign(e,t.instance.exports)))},l.p="/dist/",(()=>{l.b=document.baseURI||self.location.href;var e={1166:0,5215:0,8132:0,2646:0};l.f.j=(t,i)=>{var s=l.o(e,t)?e[t]:void 0;if(0!==s)if(s)i.push(s[2]);else{var n=new Promise(((i,n)=>s=e[t]=[i,n]));i.push(s[2]=n);var a=l.p+l.u(t),r=new Error;l.l(a,(i=>{if(l.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var n=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;r.message="Loading chunk "+t+" failed.\n("+n+": "+a+")",r.name="ChunkLoadError",r.type=n,r.request=a,s[1](r)}}),"chunk-"+t,t)}};var t=(t,i)=>{var s,n,[a,r,o]=i,h=0;if(a.some((t=>0!==e[t]))){for(s in r)l.o(r,s)&&(l.m[s]=r[s]);if(o)o(l)}for(t&&t(i);h<a.length;h++)n=a[h],l.o(e,n)&&e[n]&&e[n][0](),e[n]=0},i=self.webpackChunkpixlr=self.webpackChunkpixlr||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),l.nc=void 0;var d=l(94424);x=d})();